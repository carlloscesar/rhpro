<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thermas - Sistema RH Pro</title>
    <!-- Corre√ß√£o de login aplicada: 17/09/2025 20:36 -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            line-height: 1.6;
        }
        
        /* Employee Details Animations */
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
                max-height: 0;
            }
            to {
                opacity: 1;
                transform: translateY(0);
                max-height: 500px;
            }
        }
        
        @keyframes slideUp {
            from {
                opacity: 1;
                transform: translateY(0);
                max-height: 500px;
            }
            to {
                opacity: 0;
                transform: translateY(-10px);
                max-height: 0;
            }
        }
        
        /* Login Screen */
        .login-container {
            max-width: 400px;
            margin: 10vh auto;
            padding: 2rem;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        /* App Container */
        .app-container {
            max-width: 1000px;
            margin: 20px auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        /* Header */
        .app-header {
            background: #333;
            color: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .header-left img {
            width: 30px;
            height: auto;
        }
        
        .header-title {
            font-size: 1.2rem;
            margin: 0;
        }
        
        .header-subtitle {
            font-size: 0.8rem;
            color: #ccc;
            margin: 0;
        }
        
        /* Main Content */
        .app-content {
            padding: 2rem;
        }
        
        /* Buttons */
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-block;
            width: auto;
        }
        
        .btn:hover {
            background: #0056b3;
            transform: translateY(-1px);
        }
        
        .btn-full {
            width: 100%;
            padding: 12px;
            font-size: 16px;
        }
        
        /* Admin Components */
        .btn-sm {
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            border-radius: 0.2rem;
        }
        
        .badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            font-weight: 700;
            line-height: 1;
            text-align: center;
            white-space: nowrap;
            vertical-align: baseline;
            border-radius: 0.25rem;
        }
        
        .badge-success { background-color: #28a745; color: white; }
        .badge-warning { background-color: #ffc107; color: black; }
        .badge-info { background-color: #17a2b8; color: white; }
        .badge-secondary { background-color: #6c757d; color: white; }
        .badge-danger { background-color: #dc3545; color: white; }
        
        .user-item:hover, .group-item:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transform: translateY(-1px);
            transition: all 0.3s ease;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #ddd;
        }
        
        .btn-secondary {
            background: #6c757d;
            font-size: 12px;
            padding: 6px 12px;
        }
        
        .btn-secondary:hover {
            background: #545b62;
        }
        
        .btn-danger {
            background: #dc3545;
        }
        
        .btn-danger:hover {
            background: #c82333;
        }
        
        .btn-success {
            background: #28a745;
        }
        
        .btn-success:hover {
            background: #218838;
        }
        
        /* Form Elements */
        .form-group {
            margin-bottom: 1rem;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #333;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0,123,255,0.25);
        }
        
        /* Cards */
        .card {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            transition: all 0.2s ease;
        }
        
        .card:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }
        
        .card-clickable {
            cursor: pointer;
            text-align: center;
        }
        
        .card-white {
            background: white;
        }
        
        /* Grid Layouts */
        .grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
        }
        
        .grid-4 {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
        }
        
        .grid-5 {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 1.5rem;
        }
        
        .grid-6 {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 1.5rem;
        }
        
        .grid-8 {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 1.5rem;
        }
        
        .grid-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
        }
        
        /* Section Headers */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .section-title {
            font-size: 1.5rem;
            color: #333;
            margin: 0;
        }
        
        /* Tables */
        .table-container {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .table-header {
            background: #f8f9fa;
            padding: 1rem;
            border-bottom: 1px solid #dee2e6;
        }
        
        .table-title {
            font-size: 1.1rem;
            margin: 0;
            color: #333;
        }
        
        .table-grid {
            display: grid;
            grid-template-columns: 3fr 2fr 2fr 1fr 1fr;
            gap: 1rem;
            padding: 1rem;
            border-bottom: 1px solid #e9ecef;
            align-items: center;
        }
        
        .table-grid:last-child {
            border-bottom: none;
        }
        
        .table-header-row {
            background: #f1f3f4;
            font-weight: 600;
            color: #333;
        }
        
        /* Status Badges */
        .status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status-success {
            background: #d4edda;
            color: #155724;
        }
        
        .status-warning {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-danger {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status-info {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        /* Utility Classes */
        .text-center { text-align: center; }
        .text-left { text-align: left; }
        .text-right { text-align: right; }
        .mb-1 { margin-bottom: 1rem; }
        .mb-2 { margin-bottom: 2rem; }
        .mt-1 { margin-top: 1rem; }
        .mt-2 { margin-top: 2rem; }
        
        /* Dashboard Stats */
        .stat-card {
            text-align: center;
            padding: 2rem;
            border-radius: 8px;
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 0.5rem 0;
        }
        
        .stat-label {
            font-size: 1rem;
            opacity: 0.8;
            margin: 0;
        }
        
        .stat-blue { background: #e3f2fd; color: #1976d2; }
        .stat-orange { background: #fff3e0; color: #f57c00; }
        .stat-green { background: #e8f5e8; color: #388e3c; }
        .stat-purple { background: #f3e5f5; color: #7b1fa2; }
        
        /* Enhanced Dashboard Styles */
        .stat-trend {
            font-size: 0.85rem;
            margin-top: 0.5rem;
            opacity: 0.8;
        }
        
        /* Chart Styles */
        .chart-container {
            margin-top: 1rem;
        }
        
        .chart-bar {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .chart-label {
            width: 80px;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .chart-progress {
            flex: 1;
            height: 25px;
            background: #e9ecef;
            border-radius: 12px;
            position: relative;
            margin-left: 1rem;
            display: flex;
            align-items: center;
        }
        
        .chart-fill {
            height: 100%;
            background: linear-gradient(90deg, #007bff, #0056b3);
            border-radius: 12px;
            transition: width 0.5s ease;
        }
        
        .chart-progress span {
            position: absolute;
            right: 10px;
            font-size: 0.8rem;
            color: #495057;
            font-weight: 500;
        }
        
        /* Trend Line Chart */
        .trend-line {
            height: 150px;
            position: relative;
            background: linear-gradient(to top, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 8px;
            margin-top: 1rem;
        }
        
        .trend-point {
            position: absolute;
            bottom: 20px;
            width: 40px;
            text-align: center;
            font-size: 0.75rem;
            color: #495057;
        }
        
        .trend-point::before {
            content: '';
            position: absolute;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 8px;
            height: 8px;
            background: #007bff;
            border-radius: 50%;
            box-shadow: 0 0 0 3px rgba(0,123,255,0.3);
        }
        
        /* Alert Styles */
        .alerts-container {
            margin-top: 1rem;
        }
        
        .alert-item {
            display: flex;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            border-radius: 6px;
            font-size: 0.9rem;
        }
        
        .alert-warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
        }
        
        .alert-info {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
        }
        
        .alert-success {
            background: #d4edda;
            border-left: 4px solid #28a745;
        }
        
        .alert-icon {
            margin-right: 0.75rem;
            font-size: 1.2rem;
        }
        
        .alert-content {
            flex: 1;
        }
        
        .alert-content strong {
            display: block;
        }
        
        .alert-content small {
            color: #6c757d;
        }
        
        /* Quick Actions */
        .quick-actions {
            margin-top: 1rem;
        }
        
        /* Activity Timeline */
        .activity-timeline {
            margin-top: 1rem;
        }
        
        .activity-item {
            display: flex;
            padding: 1rem 0;
            border-bottom: 1px solid #e9ecef;
        }
        
        .activity-item:last-child {
            border-bottom: none;
        }
        
        .activity-time {
            width: 120px;
            font-size: 0.8rem;
            color: #6c757d;
            flex-shrink: 0;
        }
        
        .activity-content {
            flex: 1;
            font-size: 0.9rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .activity-tag {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .activity-tag.success {
            background: #d4edda;
            color: #155724;
        }
        
        .activity-tag.pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .activity-tag.info {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        /* Micro-interactions and Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-30px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        
        @keyframes glow {
            from { box-shadow: 0 0 5px rgba(0,123,255,0.3); }
            to { box-shadow: 0 0 20px rgba(0,123,255,0.6); }
        }
        
        .animate-fadeIn {
            animation: fadeIn 0.5s ease-out;
        }
        
        .animate-slideIn {
            animation: slideIn 0.4s ease-out;
        }
        
        .animate-pulse {
            animation: pulse 2s infinite;
        }
        
        .animate-shake {
            animation: shake 0.5s ease-in-out;
        }
        
        .animate-bounce {
            animation: bounce 1s ease-in-out;
        }
        
        .animate-glow {
            animation: glow 1s ease-in-out infinite alternate;
        }
        
        /* Enhanced Button Interactions */
        .btn {
            position: relative;
            overflow: hidden;
            transform: translateZ(0);
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .btn:hover::before {
            left: 100%;
        }
        
        .btn:active {
            transform: scale(0.98);
        }
        
        /* Card Interactions */
        .card-clickable {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .card-clickable:hover {
            transform: translateY(-8px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .card-clickable:active {
            transform: translateY(-4px);
        }
        
        /* Form Interactions */
        input:focus, select:focus, textarea:focus {
            animation: glow 0.3s ease-in-out;
        }
        
        .form-group {
            position: relative;
        }
        
        .form-group label {
            transition: all 0.3s ease;
        }
        
        .form-group input:focus + label,
        .form-group select:focus + label,
        .form-group textarea:focus + label {
            color: #007bff;
            transform: scale(0.95);
        }
        
        /* Status Animations */
        .status {
            transform: translateX(0);
        }
        
        .status.show {
            animation: slideIn 0.3s ease-out;
        }
        
        .status.error {
            animation: shake 0.5s ease-in-out;
        }
        
        /* Loading States */
        .btn-loading {
            position: relative;
            color: transparent !important;
        }
        
        .btn-loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 16px;
            height: 16px;
            margin: -8px 0 0 -8px;
            border: 2px solid #ffffff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Estilos para Aprova√ß√µes */
        .stat-badge {
            background: #007bff;
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .approval-row {
            transition: all 0.2s ease;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 1rem;
            margin: 0.5rem 0;
        }

        .approval-row:hover {
            background: #f8f9fa;
            border-color: #007bff;
            box-shadow: 0 2px 8px rgba(0,123,255,0.1);
        }

        .priority-badge {
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
            text-align: center;
            white-space: nowrap;
        }

        .priority-urgent {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #ffcdd2;
        }

        .priority-high {
            background: #fff3e0;
            color: #ef6c00;
            border: 1px solid #ffcc02;
        }

        .priority-medium {
            background: #fffde7;
            color: #f57f17;
            border: 1px solid #fff176;
        }

        .priority-low {
            background: #e8f5e8;
            color: #2e7d32;
            border: 1px solid #c8e6c9;
        }

        .priority-normal {
            background: #f5f5f5;
            color: #666;
            border: 1px solid #ddd;
        }

        .actions-cell {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
        }

        .btn-sm {
            padding: 0.4rem 0.8rem;
            font-size: 0.85rem;
            border-radius: 4px;
            min-width: auto;
        }

        .request-detail-card {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1rem 0;
        }

        .request-detail-card h5 {
            color: #333;
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }

        .detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .detail-grid > div {
            background: white;
            padding: 0.8rem;
            border-radius: 4px;
            border: 1px solid #e9ecef;
        }

        .section-stats {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .filters-row {
            padding: 1rem;
        }

        /* Estilos para badges de status */
        .status-badge {
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
            text-align: center;
            white-space: nowrap;
            display: inline-block;
        }

        .status-badge.pending {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .status-badge.approved {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-badge.rejected {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c2c7;
        }

        .status-badge.unknown {
            background: #f8f9fa;
            color: #6c757d;
            border: 1px solid #dee2e6;
        }

        /* Estilos para linha de requisi√ß√£o */
        .request-row {
            transition: all 0.2s ease;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 1rem;
            margin: 0.5rem 0;
        }

        .request-row:hover {
            background: #f8f9fa;
            border-color: #007bff;
            box-shadow: 0 2px 8px rgba(0,123,255,0.1);
        }

        .request-row[data-status="approved"] {
            border-left: 4px solid #28a745;
        }

        .request-row[data-status="rejected"] {
            border-left: 4px solid #dc3545;
        }

        .request-row[data-status="pending"] {
            border-left: 4px solid #ffc107;
        }

        /* Responsividade para aprova√ß√µes */
        @media (max-width: 768px) {
            .actions-cell {
                flex-direction: column;
                gap: 0.3rem;
            }
            
            .btn-sm {
                width: 100%;
                min-width: 60px;
            }
            
            .detail-grid {
                grid-template-columns: 1fr;
            }
            
            .section-stats {
                flex-direction: column;
                gap: 0.3rem;
            }
            
            .filters-row > div {
                flex-direction: column;
                gap: 10px;
            }
        }
        
        /* Table Row Interactions */
        .table-grid:not(.table-header-row):hover {
            background: #f8f9fa;
            transform: translateX(5px);
            transition: all 0.2s ease;
        }
        
        /* Progress Indicators */
        .progress-bar {
            width: 100%;
            height: 4px;
            background: #e9ecef;
            border-radius: 2px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #007bff, #0056b3);
            border-radius: 2px;
            transition: width 0.3s ease;
        }
        
        /* Notification Toast */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 1rem;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        .toast.success { border-left: 4px solid #28a745; }
        .toast.warning { border-left: 4px solid #ffc107; }
        .toast.error { border-left: 4px solid #dc3545; }
        .toast.info { border-left: 4px solid #17a2b8; }
        
        /* Floating Action Hints */
        .floating-hint {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: #333;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            transform: translateY(100px);
            transition: transform 0.3s ease;
            z-index: 999;
        }
        
        .floating-hint.show {
            transform: translateY(0);
        }
        
        /* Interactive Dashboard Stats */
        .stat-card:hover .stat-number {
            animation: pulse 0.6s ease-in-out;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .grid-3 { grid-template-columns: 1fr; }
            .grid-2 { grid-template-columns: 1fr; }
            .grid-4 { grid-template-columns: repeat(2, 1fr); }
            .app-container { margin: 10px; }
            .table-grid { grid-template-columns: 1fr; }
            .toast { right: 10px; top: 10px; }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="login" class="login-container">
        <div class="mb-2">
            <img src="logo-thermas.png" alt="Thermas Logo" style="max-width: 120px; height: auto; margin-bottom: 1rem;">
            <h1 style="margin-bottom: 0.5rem; font-size: 1.8rem;">Thermas</h1>
            <h2 style="font-size: 1.2rem; color: #666; margin-bottom: 0.5rem;">Sistema RH Pro</h2>
        </div>
        <p style="color: #666; margin-bottom: 2rem;">Gest√£o de Recursos Humanos</p>
        
        <div class="form-group">
            <label>Usu√°rio/Email:</label>
            <input type="text" id="email" placeholder="Digite seu usu√°rio ou email" value="admin">
        </div>
        
        <div class="form-group">
            <label>Senha:</label>
            <input type="password" id="password" placeholder="Digite sua senha" value="">
        </div>
        
        <button id="loginButton" class="btn btn-full btn-success">Entrar no Sistema</button>
        
        <div id="status" class="status status-info mt-1">
            Digite suas credenciais para acessar o sistema.
        </div>
    </div>

    <!-- Main App -->
    <div id="app" class="app-container" style="display: none;">
        <!-- Header -->
        <div class="app-header">
            <div class="header-left">
                <img src="logo-thermas.png" alt="Thermas Logo">
                <div>
                    <h2 class="header-title">Thermas - Sistema RH Pro</h2>
                    <p class="header-subtitle" id="currentSection">Dashboard</p>
                </div>
            </div>
            <button id="logoutButton" class="btn btn-danger">Sair</button>
        </div>

        <!-- Content -->
        <div class="app-content">
            <!-- Main Menu -->
            <div id="mainMenu" class="grid-4 mb-2">
                <div class="card card-clickable" data-section="dashboard">
                    <h3>üìä Dashboard</h3>
                    <p>Vis√£o geral do sistema</p>
                </div>
                <div class="card card-clickable" data-section="funcionarios">
                    <h3>üë• Funcion√°rios</h3>
                    <p>Gerenciar colaboradores</p>
                </div>
                <div class="card card-clickable" data-section="requisicoes">
                    <h3>üìã Requisi√ß√µes</h3>
                    <p>Solicita√ß√µes dos funcion√°rios</p>
                </div>
                <div class="card card-clickable" data-section="aprovacoes">
                    <h3>‚úÖ Aprova√ß√µes</h3>
                    <p>Gerenciar aprova√ß√µes pendentes</p>
                </div>
                <div class="card card-clickable" data-section="relatorios">
                    <h3>üìà Relat√≥rios</h3>
                    <p>Relat√≥rios e estat√≠sticas</p>
                </div>
                <div class="card card-clickable" data-section="departamentos">
                    <h3>üè¢ Departamentos</h3>
                    <p>Gerenciar departamentos</p>
                </div>
                <div class="card card-clickable" data-section="cargos">
                    <h3>üíº Cargos</h3>
                    <p>Consultar CBO e cargos</p>
                </div>
                <div class="card card-clickable" data-section="self-service">
                    <h3>üë§ Portal do Colaborador</h3>
                    <p>Self-service para funcion√°rios</p>
                </div>
                <div class="card card-clickable" data-section="performance">
                    <h3>‚≠ê Performance</h3>
                    <p>Avalia√ß√µes e desenvolvimento</p>
                </div>
                <div class="card card-clickable" data-section="analytics">
                    <h3>üìä Analytics</h3>
                    <p>Business Intelligence e KPIs</p>
                </div>
                <div class="card card-clickable" data-section="automations">
                    <h3>ü§ñ Automa√ß√µes</h3>
                    <p>Workflows e IA</p>
                </div>
                <div class="card card-clickable" data-section="integrations">
                    <h3>üîó Integra√ß√µes</h3>
                    <p>Sistemas externos</p>
                </div>
                <div class="card card-clickable" data-section="compliance">
                    <h3>‚öñÔ∏è Compliance</h3>
                    <p>LGPD e auditoria</p>
                </div>
                <div class="card card-clickable" data-section="surveys">
                    <h3>üìã Pesquisas</h3>
                    <p>Pesquisas de clima e satisfa√ß√£o</p>
                </div>
                <div class="card card-clickable" data-section="executive">
                    <h3>üëî Centro Executivo</h3>
                    <p>Dashboard C-Level</p>
                </div>
                <div class="card card-clickable" data-section="admin-users">
                    <h3>üë§ Administra√ß√£o</h3>
                    <p>Usu√°rios, grupos e permiss√µes</p>
                </div>
            </div>

            <!-- Dashboard Section -->
            <div id="dashboard" style="display: block;">
                <h3 class="section-title mb-1">Dashboard - Analytics RH</h3>
                
                <!-- KPIs Principais -->
                <div class="grid-4 mb-2">
                    <div class="card stat-card stat-blue">
                        <h4 class="stat-label">Funcion√°rios Ativos</h4>
                        <p class="stat-number" id="totalEmployees">0</p>
                        <div class="stat-trend">Aguardando dados</div>
                    </div>
                    <div class="card stat-card stat-green">
                        <h4 class="stat-label">Novos Contratados</h4>
                        <p class="stat-number" id="newHires">0</p>
                        <div class="stat-trend">Aguardando dados</div>
                    </div>
                    <div class="card stat-card stat-orange">
                        <h4 class="stat-label">Aprova√ß√µes Pendentes</h4>
                        <p class="stat-number" id="pendingRequests">0</p>
                        <div class="stat-trend">Aguardando dados</div>
                    </div>
                    <div class="card stat-card stat-purple">
                        <h4 class="stat-label">Dias M√©dia Contrata√ß√£o</h4>
                        <p class="stat-number" id="avgTimeHire">0</p>
                        <div class="stat-trend">Aguardando dados</div>
                    </div>
                </div>
                
                <!-- Gr√°ficos e Analytics -->
                <div class="grid-2 mb-2">
                    <div class="card">
                        <h4>üìä Headcount por Departamento</h4>
                        <div id="departmentChart" class="chart-container">
                            <div style="text-align: center; padding: 2rem; color: #6c757d;">
                                Nenhum dado dispon√≠vel ainda
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h4>üìà Tend√™ncia de Contrata√ß√µes</h4>
                        <div id="hiringTrend" class="chart-container">
                            <div style="text-align: center; padding: 2rem; color: #6c757d;">
                                Hist√≥rico ser√° exibido conforme dados forem inseridos
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Alertas e A√ß√µes R√°pidas -->
                <div class="grid-2 mb-2">
                    <div class="card">
                        <h4>üö® Alertas Importantes</h4>
                        <div class="alerts-container">
                            <div style="text-align: center; padding: 2rem; color: #6c757d;">
                                Nenhum alerta no momento
                            </div>
                        </div>

                        </div>
                    </div>
                    
                    <div class="card">
                        <h4>‚ö° A√ß√µes R√°pidas</h4>
                        <div class="quick-actions">
                            <button class="btn btn-primary btn-block mb-1" data-section="funcionarios">üë• Novo Funcion√°rio</button>
                            <button class="btn btn-success btn-block mb-1" data-section="requisicoes">üìã Nova Requisi√ß√£o</button>
                            <button class="btn btn-info btn-block mb-1" data-section="relatorios">üìä Gerar Relat√≥rio</button>
                            <button class="btn btn-warning btn-block mb-1" data-section="aprovacoes">‚úÖ Aprovar Pend√™ncias</button>
                        </div>
                    </div>
                </div>
                
                <!-- Atividades Recentes -->
                <div class="card">
                    <h4>üìã Atividades Recentes do Sistema</h4>
                    <div class="activity-timeline">
                        <div style="text-align: center; padding: 2rem; color: #6c757d;">
                            Nenhuma atividade registrada ainda
                        </div>
                    </div>
                </div>
            </div>

            <!-- Portal do Colaborador Section -->
            <div id="self-service" style="display: none;">
                <h3 class="section-title mb-1">üë§ Portal do Colaborador - Self Service</h3>
                
                <!-- Employee Profile Card -->
                <div class="card mb-2">
                    <h4>üë§ Meu Perfil</h4>
                    <div class="grid-2" style="gap: 2rem; align-items: start;">
                        <div>
                            <div style="display: flex; align-items: center; margin-bottom: 1rem;">
                                <div style="width: 60px; height: 60px; background: #007bff; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem; margin-right: 1rem;">
                                    JS
                                </div>
                                <div>
                                    <h5 style="margin: 0;">Jo√£o Silva</h5>
                                    <p style="margin: 0.25rem 0; color: #6c757d;">Desenvolvedor Senior</p>
                                    <p style="margin: 0; color: #6c757d; font-size: 0.9rem;">Departamento de TI</p>
                                </div>
                            </div>
                            <div style="background: #f8f9fa; padding: 1rem; border-radius: 6px;">
                                <p><strong>Email:</strong> joao.silva@thermas.com</p>
                                <p><strong>Telefone:</strong> (11) 99999-9999</p>
                                <p><strong>Data de Admiss√£o:</strong> 15/03/2022</p>
                                <p><strong>Status:</strong> <span style="color: #28a745;">Ativo</span></p>
                            </div>
                        </div>
                        <div>
                            <button id="editProfileButton" class="btn btn-primary btn-block mb-1">
                                ‚úèÔ∏è Editar Dados Pessoais
                            </button>
                            <button id="changePasswordButton" class="btn btn-info btn-block mb-1">
                                üîí Alterar Senha
                            </button>
                            <button id="downloadPayStubButton" class="btn btn-success btn-block mb-1">
                                üí∞ Baixar Holerite
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Quick Actions -->
                <div class="grid-3 mb-2">
                    <div class="card card-clickable" data-action="requestVacation">
                        <h4>üèñÔ∏è Solicitar F√©rias</h4>
                        <p>Solicite suas f√©rias de forma r√°pida</p>
                        <div style="color: #007bff; font-size: 0.9rem;">Saldo: 25 dias</div>
                    </div>
                    <div class="card card-clickable" data-action="requestReimbursement">
                        <h4>üí≥ Reembolso</h4>
                        <p>Solicite reembolso de despesas</p>
                        <div style="color: #28a745; font-size: 0.9rem;">Limite: R$ 1.500/m√™s</div>
                    </div>
                    <div class="card card-clickable" data-action="viewTimeBank">
                        <h4>‚è±Ô∏è Banco de Horas</h4>
                        <p>Consulte seu saldo de horas</p>
                        <div style="color: #ffc107; font-size: 0.9rem;">Saldo: +12h 30min</div>
                    </div>
                </div>
                
                <!-- My Requests -->
                <div class="card mb-2">
                    <h4>üìã Minhas Solicita√ß√µes</h4>
                    <div class="table-container">
                        <div class="table-grid table-header-row">
                            <span>Tipo</span>
                            <span>Data Solicita√ß√£o</span>
                            <span>Status</span>
                            <span>A√ß√µes</span>
                        </div>
                        <div class="table-grid">
                            <span>F√©rias</span>
                            <span>20/08/2025</span>
                            <span><span style="background: #fff3cd; color: #856404; padding: 2px 8px; border-radius: 12px; font-size: 0.8rem;">Pendente</span></span>
                            <span>
                                <button class="btn btn-sm btn-info">Ver</button>
                                <button class="btn btn-sm btn-danger">Cancelar</button>
                            </span>
                        </div>
                        <div class="table-grid">
                            <span>Reembolso</span>
                            <span>18/08/2025</span>
                            <span><span style="background: #d4edda; color: #155724; padding: 2px 8px; border-radius: 12px; font-size: 0.8rem;">Aprovado</span></span>
                            <span>
                                <button class="btn btn-sm btn-info">Ver</button>
                            </span>
                        </div>
                        <div class="table-grid">
                            <span>Material</span>
                            <span>15/08/2025</span>
                            <span><span style="background: #d4edda; color: #155724; padding: 2px 8px; border-radius: 12px; font-size: 0.8rem;">Aprovado</span></span>
                            <span>
                                <button class="btn btn-sm btn-info">Ver</button>
                            </span>
                        </div>
                    </div>
                </div>
                
                <!-- Documents & Benefits -->
                <div class="grid-2">
                    <div class="card">
                        <h4>üìÑ Documentos</h4>
                        <div style="padding: 1rem 0;">
                            <button class="btn btn-outline-primary btn-block mb-1" data-action="downloadDocument" data-param="declaracao">
                                üìÑ Declara√ß√£o de V√≠nculo
                            </button>
                            <button class="btn btn-outline-primary btn-block mb-1" data-action="downloadDocument" data-param="comprovante">
                                üìÑ Comprovante de Rendimentos
                            </button>
                            <button class="btn btn-outline-primary btn-block mb-1" data-action="downloadDocument" data-param="cracha">
                                üÜî Segunda Via do Crach√°
                            </button>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h4>üéÅ Benef√≠cios</h4>
                        <div style="padding: 1rem 0;">
                            <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #eee;">
                                <span>Vale Alimenta√ß√£o</span>
                                <span style="color: #28a745; font-weight: bold;">R$ 450/m√™s</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #eee;">
                                <span>Vale Transporte</span>
                                <span style="color: #28a745; font-weight: bold;">R$ 220/m√™s</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #eee;">
                                <span>Plano de Sa√∫de</span>
                                <span style="color: #007bff; font-weight: bold;">Ativo</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 0.5rem 0;">
                                <span>Seguro de Vida</span>
                                <span style="color: #007bff; font-weight: bold;">Ativo</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Performance Management Section -->
            <div id="performance" style="display: none;">
                <h3 class="section-title mb-1">‚≠ê Gest√£o de Performance, Avalia√ß√µes e Desenvolvimento</h3>
                
                <!-- Performance Overview Cards -->
                <div class="grid-4 mb-2">
                    <div class="card stat-card stat-blue">
                        <h4 class="stat-label">Avalia√ß√µes Conclu√≠das</h4>
                        <p class="stat-number" id="totalEvaluations">0</p>
                        <div class="stat-trend">Aguardando dados</div>
                    </div>
                    <div class="card stat-card stat-green">
                        <h4 class="stat-label">OKRs Ativos</h4>
                        <p class="stat-number" id="activeOKRs">0</p>
                        <div class="stat-trend">Aguardando dados</div>
                    </div>
                    <div class="card stat-card stat-purple">
                        <h4 class="stat-label">PDIs em Andamento</h4>
                        <p class="stat-number" id="activePDIs">0</p>
                        <div class="stat-trend">Aguardando dados</div>
                    </div>
                    <div class="card stat-card stat-orange">
                        <h4 class="stat-label">Ciclos Ativos</h4>
                        <p class="stat-number" id="activeCycles">0</p>
                        <div class="stat-trend">Aguardando dados</div>
                    </div>
                </div>
                
                <!-- Navigation Tabs -->
                <div class="grid-4 mb-2">
                    <div class="card card-clickable" data-action="showPerformanceTab" data-param="evaluations" id="tabEvaluations">
                        <h4>üìù Avalia√ß√µes</h4>
                        <p>Gerenciar ciclos e avalia√ß√µes de performance</p>
                    </div>
                    <div class="card card-clickable" data-action="showPerformanceTab" data-param="okrs" id="tabOKRs">
                        <h4>üéØ OKRs</h4>
                        <p>Objetivos e Resultados-Chave</p>
                    </div>
                    <div class="card card-clickable" data-action="showPerformanceTab" data-param="pdis" id="tabPDIs">
                        <h4>üìö PDIs</h4>
                        <p>Planos de Desenvolvimento Individual</p>
                    </div>
                    <div class="card card-clickable" data-action="showPerformanceTab" data-param="competencies" id="tabCompetencies">
                        <h4>‚≠ê Compet√™ncias</h4>
                        <p>Matriz de compet√™ncias e habilidades</p>
                    </div>
                </div>

                <!-- Tab Content: Evaluations -->
                <div id="performanceTabEvaluations" class="performance-tab">
                    <div class="card mb-2">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <h4>üìã Ciclos de Avalia√ß√£o</h4>
                            <button class="btn btn-primary" data-action="showCreateEvaluationCycleForm">‚ûï Novo Ciclo</button>
                        </div>
                        
                        <div id="evaluationCyclesList">
                            <div style="text-align: center; padding: 2rem; color: #6c757d;">
                                <div class="spinner" style="margin: 0 auto 1rem;"></div>
                                Carregando ciclos de avalia√ß√£o...
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <h4>üìä Avalia√ß√µes Recentes</h4>
                            <button class="btn btn-success" data-action="showCreateEvaluationForm">‚ûï Nova Avalia√ß√£o</button>
                        </div>
                        
                        <div id="evaluationsList">
                            <div style="text-align: center; padding: 2rem; color: #6c757d;">
                                <div class="spinner" style="margin: 0 auto 1rem;"></div>
                                Carregando avalia√ß√µes...
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tab Content: OKRs -->
                <div id="performanceTabOKRs" class="performance-tab" style="display: none;">
                    <div class="card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <h4>üéØ Objetivos e Resultados-Chave (OKRs)</h4>
                            <button class="btn btn-primary" data-action="showCreateOKRForm">‚ûï Novo OKR</button>
                        </div>
                        
                        <div id="okrsList">
                            <div style="text-align: center; padding: 2rem; color: #6c757d;">
                                <div class="spinner" style="margin: 0 auto 1rem;"></div>
                                Carregando OKRs...
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tab Content: PDIs -->
                <div id="performanceTabPDIs" class="performance-tab" style="display: none;">
                    <div class="card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <h4>üìö Planos de Desenvolvimento Individual (PDIs)</h4>
                            <button class="btn btn-primary" data-action="showCreatePDIForm">‚ûï Novo PDI</button>
                        </div>
                        
                        <div id="pdisList">
                            <div style="text-align: center; padding: 2rem; color: #6c757d;">
                                <div class="spinner" style="margin: 0 auto 1rem;"></div>
                                Carregando PDIs...
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tab Content: Competencies -->
                <div id="performanceTabCompetencies" class="performance-tab" style="display: none;">
                    <div class="card">
                        <h4>‚≠ê Matriz de Compet√™ncias</h4>
                        
                        <div id="competenciesList">
                            <div style="text-align: center; padding: 2rem; color: #6c757d;">
                                <div class="spinner" style="margin: 0 auto 1rem;"></div>
                                Carregando compet√™ncias...
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Surveys Section -->
            <div id="surveys" style="display: none;">
                <h3 class="section-title mb-1">üìã Sistema de Pesquisas</h3>
                
                <!-- Surveys Overview Cards -->
                <div class="grid-4 mb-2">
                    <div class="card stat-card stat-blue">
                        <h4 class="stat-label">Pesquisas Ativas</h4>
                        <p class="stat-number" id="activeSurveys">0</p>
                        <div class="stat-trend">Aguardando dados</div>
                    </div>
                    <div class="card stat-card stat-green">
                        <h4 class="stat-label">Respostas Recebidas</h4>
                        <p class="stat-number" id="totalResponses">0</p>
                        <div class="stat-trend">Aguardando dados</div>
                    </div>
                    <div class="card stat-card stat-purple">
                        <h4 class="stat-label">Taxa de Participa√ß√£o</h4>
                        <p class="stat-number" id="participationRate">0%</p>
                        <div class="stat-trend">Aguardando dados</div>
                    </div>
                    <div class="card stat-card stat-orange">
                        <h4 class="stat-label">Pesquisas An√¥nimas</h4>
                        <p class="stat-number" id="anonymousSurveys">0</p>
                        <div class="stat-trend">Aguardando dados</div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="grid-3 mb-2">
                    <div class="card card-clickable" data-action="showCreateSurveyForm">
                        <h4>‚ûï Nova Pesquisa</h4>
                        <p>Criar pesquisa de clima ou satisfa√ß√£o</p>
                        <div style="color: #007bff; font-size: 0.9rem;">Op√ß√µes an√¥nimas dispon√≠veis</div>
                    </div>
                    <div class="card card-clickable" data-action="showSurveyTemplates">
                        <h4>üìã Templates</h4>
                        <p>Modelos pr√©-definidos de pesquisas</p>
                        <div style="color: #28a745; font-size: 0.9rem;">Clima, Satisfa√ß√£o, Engagement</div>
                    </div>
                    <div class="card card-clickable" data-action="showSurveyReports">
                        <h4>üìä Relat√≥rios</h4>
                        <p>Analytics e insights das pesquisas</p>
                        <div style="color: #ffc107; font-size: 0.9rem;">Gr√°ficos e estat√≠sticas</div>
                    </div>
                </div>

                <!-- Active Surveys List -->
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h4>üìã Pesquisas Dispon√≠veis</h4>
                        <div>
                            <select id="surveyTypeFilter" style="padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px; margin-right: 0.5rem;">
                                <option value="all">Todos os tipos</option>
                                <option value="climate">Pesquisas de Clima</option>
                                <option value="satisfaction">Satisfa√ß√£o</option>
                                <option value="engagement">Engagement</option>
                                <option value="feedback">Feedback</option>
                                <option value="custom">Personalizada</option>
                            </select>
                            <button class="btn btn-primary" data-action="refreshSurveysList">üîÑ Atualizar</button>
                        </div>
                    </div>
                    
                    <div id="surveysList">
                        <div style="text-align: center; padding: 2rem; color: #6c757d;">
                            <div class="spinner" style="margin: 0 auto 1rem;"></div>
                            Carregando pesquisas...
                        </div>
                    </div>
                </div>

                <!-- Survey Templates Modal -->
                <div id="surveyTemplatesModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
                    <div style="background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); max-width: 800px; width: 90%; max-height: 80vh; overflow-y: auto;" data-action="stopPropagation">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                            <h4 style="margin: 0; color: #333;">üìã Templates de Pesquisa</h4>
                            <button data-action="closeSurveyTemplatesModal" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #666;">&times;</button>
                        </div>

                        <div class="grid-2" style="gap: 1rem;">
                            <div class="card" style="border: 2px solid #e9ecef; cursor: pointer;" data-action="createFromTemplate" data-param="climate">
                                <h5 style="color: #007bff; margin-bottom: 0.5rem;">üå°Ô∏è Pesquisa de Clima Organizacional</h5>
                                <p style="color: #666; margin-bottom: 1rem;">Avalie a satisfa√ß√£o geral, comunica√ß√£o e ambiente de trabalho</p>
                                <ul style="color: #666; font-size: 0.9rem; margin: 0;">
                                    <li>6 perguntas essenciais</li>
                                    <li>Pesquisa an√¥nima</li>
                                    <li>Escalas de avalia√ß√£o</li>
                                    <li>Campos de texto aberto</li>
                                </ul>
                            </div>

                            <div class="card" style="border: 2px solid #e9ecef; cursor: pointer;" data-action="createFromTemplate" data-param="satisfaction">
                                <h5 style="color: #28a745; margin-bottom: 0.5rem;">üòä Pesquisa de Satisfa√ß√£o</h5>
                                <p style="color: #666; margin-bottom: 1rem;">Me√ßa a satisfa√ß√£o com produtos, servi√ßos ou processos</p>
                                <ul style="color: #666; font-size: 0.9rem; margin: 0;">
                                    <li>Escalas de 1-10</li>
                                    <li>M√∫ltipla escolha</li>
                                    <li>NPS (Net Promoter Score)</li>
                                    <li>Feedback qualitativo</li>
                                </ul>
                            </div>

                            <div class="card" style="border: 2px solid #e9ecef; cursor: pointer;" data-action="createFromTemplate" data-param="engagement">
                                <h5 style="color: #6f42c1; margin-bottom: 0.5rem;">üöÄ Pesquisa de Engagement</h5>
                                <p style="color: #666; margin-bottom: 1rem;">Avalie o engajamento e motiva√ß√£o dos colaboradores</p>
                                <ul style="color: #666; font-size: 0.9rem; margin: 0;">
                                    <li>Perguntas sobre motiva√ß√£o</li>
                                    <li>Avalia√ß√£o de lideran√ßa</li>
                                    <li>Oportunidades de crescimento</li>
                                    <li>Cultura organizacional</li>
                                </ul>
                            </div>

                            <div class="card" style="border: 2px solid #e9ecef; cursor: pointer;" data-action="createFromTemplate" data-param="feedback360">
                                <h5 style="color: #dc3545; margin-bottom: 0.5rem;">üéØ Feedback 360¬∞</h5>
                                <p style="color: #666; margin-bottom: 1rem;">Avalia√ß√£o completa com m√∫ltiplas perspectivas</p>
                                <ul style="color: #666; font-size: 0.9rem; margin: 0;">
                                    <li>Auto-avalia√ß√£o</li>
                                    <li>Avalia√ß√£o de pares</li>
                                    <li>Avalia√ß√£o de liderados</li>
                                    <li>Compet√™ncias espec√≠ficas</li>
                                </ul>
                            </div>
                        </div>

                        <div style="text-align: center; margin-top: 2rem;">
                            <button class="btn btn-secondary" data-action="closeSurveyTemplatesModal">Cancelar</button>
                            <button class="btn btn-primary" data-action="showCreateSurveyForm" style="margin-left: 0.5rem;">Criar do Zero</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Business Analytics Section -->
            <div id="analytics" style="display: none;">
                <h3 class="section-title mb-1">üìä Business Analytics & Intelligence</h3>
                
                <!-- Executive KPIs -->
                <div class="grid-4 mb-2">
                    <div class="card stat-card stat-blue">
                        <h4 class="stat-label">Receita por Funcion√°rio</h4>
                        <p class="stat-number">R$ 0</p>
                        <div class="stat-trend">Aguardando dados</div>
                    </div>
                    <div class="card stat-card stat-green">
                        <h4 class="stat-label">Taxa de Reten√ß√£o</h4>
                        <p class="stat-number">0%</p>
                        <div class="stat-trend">Aguardando dados</div>
                    </div>
                    <div class="card stat-card stat-purple">
                        <h4 class="stat-label">Custo por Contrata√ß√£o</h4>
                        <p class="stat-number">R$ 0</p>
                        <div class="stat-trend">Aguardando dados</div>
                    </div>
                    <div class="card stat-card stat-orange">
                        <h4 class="stat-label">Engagement Score</h4>
                        <p class="stat-number">0%</p>
                        <div class="stat-trend">Aguardando dados</div>
                    </div>
                </div>
                
                <!-- Advanced Analytics -->
                <div class="grid-2 mb-2">
                    <div class="card">
                        <h4>üîÆ An√°lise Preditiva</h4>
                        <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px; margin: 1rem 0;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 1rem;">
                                <span><strong>Risco de Turnover (pr√≥ximos 90 dias)</strong></span>
                                <span style="color: #6c757d; font-weight: bold;">Sem dados</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 0%; background: linear-gradient(90deg, #dc3545, #c82333);"></div>
                            </div>
                            <small style="color: #6c757d;">Modelo ser√° calibrado com dados reais</small>
                        </div>
                        <div style="background: #e7f3ff; padding: 1rem; border-radius: 6px; border-left: 4px solid #007bff;">
                            <strong>üí° Insights:</strong>
                            <ul style="margin: 0.5rem 0;">
                                <li>Sistema aguardando dados para an√°lise</li>
                                <li>Insights ser√£o gerados automaticamente</li>
                                <li>Baseado em dados reais da empresa</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h4>üí∞ ROI de Treinamentos</h4>
                        <div class="chart-container">
                            <div class="chart-bar">
                                <div class="chart-label">Tech Skills</div>
                                <div class="chart-progress">
                                    <div class="chart-fill" style="width: 0%; background: linear-gradient(90deg, #28a745, #20c997);"></div>
                                    <span>0% ROI</span>
                                </div>
                            </div>
                            <div class="chart-bar">
                                <div class="chart-label">Lideran√ßa</div>
                                <div class="chart-progress">
                                    <div class="chart-fill" style="width: 0%; background: linear-gradient(90deg, #007bff, #0056b3);"></div>
                                    <span>0% ROI</span>
                                </div>
                            </div>
                            <div class="chart-bar">
                                <div class="chart-label">Vendas</div>
                                <div class="chart-progress">
                                    <div class="chart-fill" style="width: 0%; background: linear-gradient(90deg, #ffc107, #ffcd39);"></div>
                                    <span>0% ROI</span>
                                </div>
                            </div>
                        </div>
                        <div style="background: #f8f9fa; padding: 1rem; border-radius: 6px; margin-top: 1rem;">
                            <strong>üéØ Recomenda√ß√£o:</strong> Aguardando dados de treinamentos para an√°lise
                        </div>
                    </div>
                </div>
                
                <!-- Workforce Analytics -->
                <div class="card mb-2">
                    <h4>üë• An√°lise da For√ßa de Trabalho</h4>
                    <div class="grid-3" style="gap: 2rem; margin: 1rem 0;">
                        <div style="text-align: center;">
                            <h5>Distribui√ß√£o Et√°ria</h5>
                            <div style="height: 120px; position: relative; background: #f8f9fa; border-radius: 8px; display: flex; align-items: end; justify-content: space-around; padding: 1rem;">
                                <div style="width: 30px; height: 0%; background: #007bff; border-radius: 4px; display: flex; align-items: end; justify-content: center; color: white; font-size: 0.8rem;">0</div>
                                <div style="width: 30px; height: 0%; background: #28a745; border-radius: 4px; display: flex; align-items: end; justify-content: center; color: white; font-size: 0.8rem;">0</div>
                                <div style="width: 30px; height: 0%; background: #ffc107; border-radius: 4px; display: flex; align-items: end; justify-content: center; color: black; font-size: 0.8rem;">0</div>
                            </div>
                            <div style="display: flex; justify-content: space-around; margin-top: 0.5rem; font-size: 0.8rem;">
                                <span>20-30</span>
                                <span>31-45</span>
                                <span>46+</span>
                            </div>
                        </div>
                        
                        <div style="text-align: center;">
                            <h5>Diversidade de G√™nero</h5>
                            <div style="height: 120px; display: flex; align-items: center; justify-content: center;">
                                <div style="width: 100px; height: 100px; border-radius: 50%; background: #e9ecef; display: flex; align-items: center; justify-content: center; color: #6c757d; font-weight: bold; position: relative;">
                                    0%
                                    <div style="position: absolute; bottom: -2rem; left: 50%; transform: translateX(-50%); color: #6c757d; font-size: 0.8rem;">Sem dados</div>
                                </div>
                            </div>
                            <div style="margin-top: 1rem; font-size: 0.8rem; color: #6c757d;">
                                Aguardando dados demogr√°ficos
                            </div>
                        </div>
                        
                        <div style="text-align: center;">
                            <h5>Tempo de Casa</h5>
                            <div style="height: 120px; position: relative; background: #f8f9fa; border-radius: 8px; display: flex; align-items: end; justify-content: space-around; padding: 1rem;">
                                <div style="width: 25px; height: 0%; background: #dc3545; border-radius: 4px; display: flex; align-items: end; justify-content: center; color: white; font-size: 0.7rem;">0</div>
                                <div style="width: 25px; height: 0%; background: #ffc107; border-radius: 4px; display: flex; align-items: end; justify-content: center; color: black; font-size: 0.7rem;">0</div>
                                <div style="width: 25px; height: 0%; background: #28a745; border-radius: 4px; display: flex; align-items: end; justify-content: center; color: white; font-size: 0.7rem;">0</div>
                                <div style="width: 25px; height: 0%; background: #007bff; border-radius: 4px; display: flex; align-items: end; justify-content: center; color: white; font-size: 0.7rem;">0</div>
                            </div>
                            <div style="display: flex; justify-content: space-around; margin-top: 0.5rem; font-size: 0.7rem;">
                                <span>0-1a</span>
                                <span>1-3a</span>
                                <span>3-5a</span>
                                <span>5a+</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- AI Insights -->
                <div class="card">
                    <h4>ü§ñ Insights Inteligentes</h4>
                    <div class="grid-2" style="gap: 2rem;">
                        <div>
                            <h5>üö® Alertas Cr√≠ticos</h5>
                            <div class="alert-item alert-info">
                                <div class="alert-icon">üìä</div>
                                <div class="alert-content">
                                    <strong>Sistema em modo de an√°lise</strong>
                                    <br><small>Coletando dados para gerar insights automaticamente</small>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <h5>üí° Recomenda√ß√µes Estrat√©gicas</h5>
                            <div style="background: #f8f9fa; padding: 1rem; border-radius: 6px; margin-bottom: 1rem;">
                                <strong>IA em Configura√ß√£o</strong>
                                <p style="margin: 0.5rem 0;">Sistema aprendendo padr√µes da empresa para gerar recomenda√ß√µes personalizadas</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Automa√ß√µes Section -->
            <div id="automations" style="display: none;">
                <h3 class="section-title mb-1">ü§ñ Automa√ß√µes & Intelig√™ncia Artificial</h3>
                
                <!-- Automation Overview -->
                <div class="grid-4 mb-2">
                    <div class="card stat-card stat-blue">
                        <h4 class="stat-label">Workflows Ativos</h4>
                        <p class="stat-number">15</p>
                        <div class="stat-trend">üöÄ Automatizando 85% dos processos</div>
                    </div>
                    <div class="card stat-card stat-green">
                        <h4 class="stat-label">Horas Economizadas</h4>
                        <p class="stat-number">120h</p>
                        <div class="stat-trend">üìà +32% este m√™s</div>
                    </div>
                    <div class="card stat-card stat-purple">
                        <h4 class="stat-label">IA Assistente</h4>
                        <p class="stat-number">95%</p>
                        <div class="stat-trend">üéØ Taxa de acerto</div>
                    </div>
                    <div class="card stat-card stat-orange">
                        <h4 class="stat-label">Processos Otimizados</h4>
                        <p class="stat-number">28</p>
                        <div class="stat-trend">‚ö° Efici√™ncia m√°xima</div>
                    </div>
                </div>
                
                <!-- AI Assistant -->
                <div class="card mb-2">
                    <h4>üß† Assistente de IA - Thermas Bot</h4>
                    <div style="background: #f8f9fa; border-radius: 8px; padding: 1.5rem; margin: 1rem 0;">
                        <div style="display: flex; align-items: center; margin-bottom: 1rem;">
                            <div style="width: 50px; height: 50px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem; margin-right: 1rem;">
                                ü§ñ
                            </div>
                            <div>
                                <h5 style="margin: 0;">Thermas Bot</h5>
                                <p style="margin: 0.25rem 0; color: #6c757d;">Seu assistente inteligente de RH</p>
                                <span style="color: #28a745; font-size: 0.9rem;">‚óè Online - Pronto para ajudar</span>
                            </div>
                        </div>
                        
                        <div style="background: white; border-radius: 6px; padding: 1rem; margin: 1rem 0; min-height: 200px;">
                            <div id="chat-messages" style="max-height: 150px; overflow-y: auto;">
                                <div style="margin-bottom: 1rem;">
                                    <div style="background: #e3f2fd; padding: 0.5rem 1rem; border-radius: 15px; display: inline-block; max-width: 80%;">
                                        <small style="color: #6c757d;">Thermas Bot</small><br>
                                        Ol√°! Sou seu assistente de RH. Posso ajudar com d√∫vidas sobre pol√≠ticas, processos de contrata√ß√£o, an√°lise de dados e muito mais. Como posso ajudar hoje?
                                    </div>
                                </div>
                            </div>
                            <div style="display: flex; margin-top: 1rem;">
                                <input type="text" id="chat-input" placeholder="Digite sua pergunta sobre RH..." style="flex: 1; padding: 0.75rem; border: 1px solid #ddd; border-radius: 20px; margin-right: 0.5rem;">
                                <button class="btn btn-primary" data-action="sendChatMessage" style="border-radius: 50%; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center;">
                                    üì§
                                </button>
                            </div>
                        </div>
                        
                        <div style="background: #e7f3ff; padding: 1rem; border-radius: 6px; border-left: 4px solid #007bff;">
                            <strong>üí° Capacidades da IA:</strong>
                            <ul style="margin: 0.5rem 0; font-size: 0.9rem;">
                                <li>An√°lise preditiva de desempenho e turnover</li>
                                <li>Recomenda√ß√µes personalizadas de desenvolvimento</li>
                                <li>Automatiza√ß√£o de processos de recrutamento</li>
                                <li>Insights inteligentes sobre clima organizacional</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <!-- Active Workflows -->
                <div class="grid-2 mb-2">
                    <div class="card">
                        <h4>‚öôÔ∏è Workflows Autom√°ticos</h4>
                        <div class="workflow-item" style="border: 1px solid #e9ecef; border-radius: 6px; padding: 1rem; margin: 0.5rem 0;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <h6 style="margin: 0; color: #007bff;">Onboarding Autom√°tico</h6>
                                    <small style="color: #6c757d;">Novo funcion√°rio ‚Üí Criar conta ‚Üí Enviar documentos ‚Üí Agendar integra√ß√£o</small>
                                </div>
                                <span style="color: #28a745; font-weight: bold;">‚úÖ Ativo</span>
                            </div>
                        </div>
                        
                        <div class="workflow-item" style="border: 1px solid #e9ecef; border-radius: 6px; padding: 1rem; margin: 0.5rem 0;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <h6 style="margin: 0; color: #28a745;">Aprova√ß√£o de F√©rias</h6>
                                    <small style="color: #6c757d;">Solicita√ß√£o ‚Üí Validar saldo ‚Üí Notificar gestor ‚Üí Atualizar calend√°rio</small>
                                </div>
                                <span style="color: #28a745; font-weight: bold;">‚úÖ Ativo</span>
                            </div>
                        </div>
                        
                        <div class="workflow-item" style="border: 1px solid #e9ecef; border-radius: 6px; padding: 1rem; margin: 0.5rem 0;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <h6 style="margin: 0; color: #ffc107;">Avalia√ß√£o de Performance</h6>
                                    <small style="color: #6c757d;">Ciclo iniciado ‚Üí Notificar participantes ‚Üí Coletar feedback ‚Üí Gerar relat√≥rio</small>
                                </div>
                                <span style="color: #28a745; font-weight: bold;">‚úÖ Ativo</span>
                            </div>
                        </div>
                        
                        <button class="btn btn-primary btn-block mt-1" data-action="createNewWorkflow">+ Criar Novo Workflow</button>
                    </div>
                    
                    <div class="card">
                        <h4>üìä An√°lise Automatizada</h4>
                        <div style="background: #f8f9fa; padding: 1rem; border-radius: 6px; margin: 1rem 0;">
                            <h6>üîç Detec√ß√£o de Anomalias</h6>
                            <div style="margin: 0.5rem 0;">
                                <div style="display: flex; justify-content: space-between;">
                                    <span>Horas extras acima da m√©dia</span>
                                    <span style="color: #dc3545;">‚ö†Ô∏è Detectado</span>
                                </div>
                                <small style="color: #6c757d;">Departamento de TI: +40% vs m√™s anterior</small>
                            </div>
                        </div>
                        
                        <div style="background: #f8f9fa; padding: 1rem; border-radius: 6px; margin: 1rem 0;">
                            <h6>üìà Previs√µes Inteligentes</h6>
                            <div style="margin: 0.5rem 0;">
                                <div style="display: flex; justify-content: space-between;">
                                    <span>Necessidade de contrata√ß√£o</span>
                                    <span style="color: #007bff;">üìä Previsto</span>
                                </div>
                                <small style="color: #6c757d;">Marketing: +2 analistas em Q4/2025</small>
                            </div>
                        </div>
                        
                        <div style="background: #f8f9fa; padding: 1rem; border-radius: 6px; margin: 1rem 0;">
                            <h6>üéØ Otimiza√ß√£o de Processos</h6>
                            <div style="margin: 0.5rem 0;">
                                <div style="display: flex; justify-content: space-between;">
                                    <span>Tempo de aprova√ß√£o de f√©rias</span>
                                    <span style="color: #28a745;">‚ö° Otimizado</span>
                                </div>
                                <small style="color: #6c757d;">Reduzido de 5 para 2 dias √∫teis</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Integra√ß√µes Section -->
            <div id="integrations" style="display: none;">
                <h3 class="section-title mb-1">üîó Integra√ß√µes com Sistemas Externos</h3>
                
                <!-- Integration Status -->
                <div class="grid-4 mb-2">
                    <div class="card stat-card stat-green">
                        <h4 class="stat-label">Sistemas Conectados</h4>
                        <p class="stat-number">8</p>
                        <div class="stat-trend">üîó Totalmente integrados</div>
                    </div>
                    <div class="card stat-card stat-blue">
                        <h4 class="stat-label">Sincroniza√ß√µes/dia</h4>
                        <p class="stat-number">245</p>
                        <div class="stat-trend">üîÑ Em tempo real</div>
                    </div>
                    <div class="card stat-card stat-purple">
                        <h4 class="stat-label">Taxa de Sucesso</h4>
                        <p class="stat-number">99.8%</p>
                        <div class="stat-trend">‚úÖ Alta confiabilidade</div>
                    </div>
                    <div class="card stat-card stat-orange">
                        <h4 class="stat-label">Economia Mensal</h4>
                        <p class="stat-number">R$ 15K</p>
                        <div class="stat-trend">üí∞ ROI positivo</div>
                    </div>
                </div>
                
                <!-- Active Integrations -->
                <div class="grid-2 mb-2">
                    <div class="card">
                        <h4>‚úÖ Integra√ß√µes Ativas</h4>
                        <div class="integration-list">
                            <div style="display: flex; align-items: center; padding: 1rem; border: 1px solid #e9ecef; border-radius: 6px; margin: 0.5rem 0;">
                                <div style="width: 40px; height: 40px; background: #28a745; border-radius: 6px; display: flex; align-items: center; justify-content: center; color: white; margin-right: 1rem;">
                                    üíº
                                </div>
                                <div style="flex: 1;">
                                    <h6 style="margin: 0;">TOTVS Protheus</h6>
                                    <small style="color: #6c757d;">ERP Corporativo</small>
                                </div>
                                <span style="color: #28a745;">‚óè Online</span>
                            </div>
                            
                            <div style="display: flex; align-items: center; padding: 1rem; border: 1px solid #e9ecef; border-radius: 6px; margin: 0.5rem 0;">
                                <div style="width: 40px; height: 40px; background: #007bff; border-radius: 6px; display: flex; align-items: center; justify-content: center; color: white; margin-right: 1rem;">
                                    üí∞
                                </div>
                                <div style="flex: 1;">
                                    <h6 style="margin: 0;">Senior Sistemas</h6>
                                    <small style="color: #6c757d;">Folha de Pagamento</small>
                                </div>
                                <span style="color: #28a745;">‚óè Online</span>
                            </div>
                            
                            <div style="display: flex; align-items: center; padding: 1rem; border: 1px solid #e9ecef; border-radius: 6px; margin: 0.5rem 0;">
                                <div style="width: 40px; height: 40px; background: #ffc107; border-radius: 6px; display: flex; align-items: center; justify-content: center; color: black; margin-right: 1rem;">
                                    üìß
                                </div>
                                <div style="flex: 1;">
                                    <h6 style="margin: 0;">Microsoft 365</h6>
                                    <small style="color: #6c757d;">Email e Produtividade</small>
                                </div>
                                <span style="color: #28a745;">‚óè Online</span>
                            </div>
                            
                            <div style="display: flex; align-items: center; padding: 1rem; border: 1px solid #e9ecef; border-radius: 6px; margin: 0.5rem 0;">
                                <div style="width: 40px; height: 40px; background: #dc3545; border-radius: 6px; display: flex; align-items: center; justify-content: center; color: white; margin-right: 1rem;">
                                    üè•
                                </div>
                                <div style="flex: 1;">
                                    <h6 style="margin: 0;">SulAm√©rica Sa√∫de</h6>
                                    <small style="color: #6c757d;">Plano de Sa√∫de</small>
                                </div>
                                <span style="color: #28a745;">‚óè Online</span>
                            </div>
                        </div>
                        
                        <button class="btn btn-success btn-block mt-1" data-action="addNewIntegration">+ Nova Integra√ß√£o</button>
                    </div>
                    
                    <div class="card">
                        <h4>üìä APIs e Webhooks</h4>
                        <div style="background: #f8f9fa; padding: 1rem; border-radius: 6px; margin: 1rem 0;">
                            <h6>üîÑ Sincroniza√ß√µes Autom√°ticas</h6>
                            <div class="sync-item" style="display: flex; justify-content: space-between; margin: 0.5rem 0;">
                                <span>Funcion√°rios ‚Üí ERP</span>
                                <span style="color: #28a745; font-size: 0.9rem;">‚úÖ Sincronizado h√° 5 min</span>
                            </div>
                            <div class="sync-item" style="display: flex; justify-content: space-between; margin: 0.5rem 0;">
                                <span>Folha ‚Üí Sistema Cont√°bil</span>
                                <span style="color: #28a745; font-size: 0.9rem;">‚úÖ Sincronizado h√° 12 min</span>
                            </div>
                            <div class="sync-item" style="display: flex; justify-content: space-between; margin: 0.5rem 0;">
                                <span>Benef√≠cios ‚Üí Operadoras</span>
                                <span style="color: #ffc107; font-size: 0.9rem;">‚è≥ Sincronizando...</span>
                            </div>
                        </div>
                        
                        <div style="background: #e7f3ff; padding: 1rem; border-radius: 6px; margin: 1rem 0; border-left: 4px solid #007bff;">
                            <h6>üõ°Ô∏è Seguran√ßa e Conformidade</h6>
                            <ul style="margin: 0.5rem 0; font-size: 0.9rem;">
                                <li>Criptografia AES-256 para todos os dados</li>
                                <li>Conformidade LGPD (Lei Geral de Prote√ß√£o de Dados)</li>
                                <li>Auditoria completa de todas as transa√ß√µes</li>
                                <li>Backup autom√°tico a cada 6 horas</li>
                            </ul>
                        </div>
                        
                        <button class="btn btn-info btn-block" data-action="viewAPIDocumentation">üìã Documenta√ß√£o da API</button>
                    </div>
                </div>
                
                <!-- Integration Marketplace -->
                <div class="card">
                    <h4>üè™ Marketplace de Integra√ß√µes</h4>
                    <div class="grid-4" style="gap: 1rem; margin: 1rem 0;">
                        <div style="border: 1px solid #e9ecef; border-radius: 6px; padding: 1rem; text-align: center;">
                            <div style="font-size: 2rem; margin-bottom: 0.5rem;">üè¶</div>
                            <h6 style="margin: 0.5rem 0;">Open Banking</h6>
                            <small style="color: #6c757d;">Integra√ß√£o banc√°ria</small>
                            <button class="btn btn-outline-primary btn-sm mt-1" data-action="installIntegration" data-param="openbanking">Instalar</button>
                        </div>
                        
                        <div style="border: 1px solid #e9ecef; border-radius: 6px; padding: 1rem; text-align: center;">
                            <div style="font-size: 2rem; margin-bottom: 0.5rem;">üì±</div>
                            <h6 style="margin: 0.5rem 0;">WhatsApp Business</h6>
                            <small style="color: #6c757d;">Comunica√ß√£o automatizada</small>
                            <button class="btn btn-outline-primary btn-sm mt-1" data-action="installIntegration" data-param="whatsapp">Instalar</button>
                        </div>
                        
                        <div style="border: 1px solid #e9ecef; border-radius: 6px; padding: 1rem; text-align: center;">
                            <div style="font-size: 2rem; margin-bottom: 0.5rem;">üìä</div>
                            <h6 style="margin: 0.5rem 0;">Power BI</h6>
                            <small style="color: #6c757d;">Business Intelligence</small>
                            <button class="btn btn-outline-primary btn-sm mt-1" data-action="installIntegration" data-param="powerbi">Instalar</button>
                        </div>
                        
                        <div style="border: 1px solid #e9ecef; border-radius: 6px; padding: 1rem; text-align: center;">
                            <div style="font-size: 2rem; margin-bottom: 0.5rem;">üéì</div>
                            <h6 style="margin: 0.5rem 0;">Alura Empresarial</h6>
                            <small style="color: #6c757d;">Treinamentos online</small>
                            <button class="btn btn-outline-primary btn-sm mt-1" data-action="installIntegration" data-param="alura">Instalar</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Compliance Section -->
            <div id="compliance" style="display: none;">
                <h3 class="section-title mb-1">‚öñÔ∏è Compliance & Auditoria LGPD</h3>
                
                <!-- Compliance Overview -->
                <div class="grid-4 mb-2">
                    <div class="card stat-card stat-green">
                        <h4 class="stat-label">Score de Conformidade</h4>
                        <p class="stat-number">98.7%</p>
                        <div class="stat-trend">üõ°Ô∏è Excelente compliance</div>
                    </div>
                    <div class="card stat-card stat-blue">
                        <h4 class="stat-label">Auditorias Realizadas</h4>
                        <p class="stat-number">24</p>
                        <div class="stat-trend">üìã Este ano</div>
                    </div>
                    <div class="card stat-card stat-purple">
                        <h4 class="stat-label">Dados Protegidos</h4>
                        <p class="stat-number">100%</p>
                        <div class="stat-trend">üîí Criptografados</div>
                    </div>
                    <div class="card stat-card stat-orange">
                        <h4 class="stat-label">Incidentes</h4>
                        <p class="stat-number">0</p>
                        <div class="stat-trend">‚úÖ Zero ocorr√™ncias</div>
                    </div>
                </div>
                
                <!-- LGPD Monitoring -->
                <div class="grid-2 mb-2">
                    <div class="card">
                        <h4>üõ°Ô∏è Monitoramento LGPD</h4>
                        <div style="background: #d4edda; padding: 1rem; border-radius: 6px; margin: 1rem 0; border-left: 4px solid #28a745;">
                            <h6>‚úÖ Requisitos Atendidos</h6>
                            <ul style="margin: 0.5rem 0; font-size: 0.9rem;">
                                <li>Consentimento expl√≠cito para coleta de dados</li>
                                <li>Direito ao esquecimento implementado</li>
                                <li>Portabilidade de dados funcionando</li>
                                <li>DPO (Data Protection Officer) designado</li>
                                <li>Registro de atividades de tratamento</li>
                            </ul>
                        </div>
                        
                        <div style="background: #fff3cd; padding: 1rem; border-radius: 6px; margin: 1rem 0; border-left: 4px solid #ffc107;">
                            <h6>‚ö†Ô∏è A√ß√µes Pendentes</h6>
                            <div style="margin: 0.5rem 0; font-size: 0.9rem;">
                                <div style="display: flex; justify-content: space-between; margin: 0.5rem 0;">
                                    <span>Treinamento LGPD Q4</span>
                                    <span style="color: #856404;">Em andamento</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin: 0.5rem 0;">
                                    <span>Revis√£o de pol√≠ticas</span>
                                    <span style="color: #856404;">Agendada</span>
                                </div>
                            </div>
                        </div>
                        
                        <button class="btn btn-primary btn-block" data-action="generateLGPDReport">üìä Relat√≥rio LGPD</button>
                    </div>
                    
                    <div class="card">
                        <h4>üîç Trilha de Auditoria</h4>
                        <div class="audit-log">
                            <div style="border: 1px solid #e9ecef; border-radius: 6px; padding: 1rem; margin: 0.5rem 0;">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <strong>Acesso aos dados de Jo√£o Silva</strong>
                                        <br><small style="color: #6c757d;">Maria Santos (RH) - 22/08/2025 17:15</small>
                                    </div>
                                    <span style="color: #28a745;">‚úÖ</span>
                                </div>
                            </div>
                            
                            <div style="border: 1px solid #e9ecef; border-radius: 6px; padding: 1rem; margin: 0.5rem 0;">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <strong>Exporta√ß√£o de relat√≥rio salarial</strong>
                                        <br><small style="color: #6c757d;">Pedro Admin - 22/08/2025 16:45</small>
                                    </div>
                                    <span style="color: #28a745;">‚úÖ</span>
                                </div>
                            </div>
                            
                            <div style="border: 1px solid #e9ecef; border-radius: 6px; padding: 1rem; margin: 0.5rem 0;">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <strong>Backup autom√°tico de dados</strong>
                                        <br><small style="color: #6c757d;">Sistema - 22/08/2025 03:00</small>
                                    </div>
                                    <span style="color: #28a745;">‚úÖ</span>
                                </div>
                            </div>
                        </div>
                        
                        <button class="btn btn-info btn-block mt-1" data-action="viewFullAuditLog">üîç Log Completo</button>
                    </div>
                </div>
                
                <!-- Data Rights Management -->
                <div class="card mb-2">
                    <h4>üë§ Gest√£o de Direitos dos Titulares</h4>
                    <div class="grid-4" style="gap: 1rem; margin: 1rem 0;">
                        <div class="data-right-card" style="border: 1px solid #e9ecef; border-radius: 6px; padding: 1rem; text-align: center;">
                            <div style="font-size: 2rem; color: #007bff;">üì•</div>
                            <h6>Acesso aos Dados</h6>
                            <p style="font-size: 1.5rem; margin: 0.5rem 0; color: #007bff;">12</p>
                            <small style="color: #6c757d;">Solicita√ß√µes este m√™s</small>
                        </div>
                        
                        <div class="data-right-card" style="border: 1px solid #e9ecef; border-radius: 6px; padding: 1rem; text-align: center;">
                            <div style="font-size: 2rem; color: #28a745;">üì§</div>
                            <h6>Portabilidade</h6>
                            <p style="font-size: 1.5rem; margin: 0.5rem 0; color: #28a745;">3</p>
                            <small style="color: #6c757d;">Exporta√ß√µes realizadas</small>
                        </div>
                        
                        <div class="data-right-card" style="border: 1px solid #e9ecef; border-radius: 6px; padding: 1rem; text-align: center;">
                            <div style="font-size: 2rem; color: #ffc107;">‚úèÔ∏è</div>
                            <h6>Retifica√ß√£o</h6>
                            <p style="font-size: 1.5rem; margin: 0.5rem 0; color: #ffc107;">8</p>
                            <small style="color: #6c757d;">Corre√ß√µes solicitadas</small>
                        </div>
                        
                        <div class="data-right-card" style="border: 1px solid #e9ecef; border-radius: 6px; padding: 1rem; text-align: center;">
                            <div style="font-size: 2rem; color: #dc3545;">üóëÔ∏è</div>
                            <h6>Elimina√ß√£o</h6>
                            <p style="font-size: 1.5rem; margin: 0.5rem 0; color: #dc3545;">1</p>
                            <small style="color: #6c757d;">Direito ao esquecimento</small>
                        </div>
                    </div>
                </div>
                
                <!-- Security Dashboard -->
                <div class="card">
                    <h4>üîê Seguran√ßa e Prote√ß√£o de Dados</h4>
                    <div class="grid-3" style="gap: 2rem; margin: 1rem 0;">
                        <div>
                            <h6>üîí Criptografia</h6>
                            <div style="background: #d4edda; padding: 1rem; border-radius: 6px;">
                                <div style="display: flex; justify-content: space-between;">
                                    <span>Dados em tr√¢nsito</span>
                                    <span style="color: #28a745; font-weight: bold;">TLS 1.3</span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span>Dados em repouso</span>
                                    <span style="color: #28a745; font-weight: bold;">AES-256</span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span>Backups</span>
                                    <span style="color: #28a745; font-weight: bold;">Criptografados</span>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <h6>üë• Controle de Acesso</h6>
                            <div style="background: #e7f3ff; padding: 1rem; border-radius: 6px;">
                                <div style="display: flex; justify-content: space-between;">
                                    <span>Autentica√ß√£o MFA</span>
                                    <span style="color: #007bff; font-weight: bold;">100%</span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span>Perfis de acesso</span>
                                    <span style="color: #007bff; font-weight: bold;">5 n√≠veis</span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span>Sess√µes ativas</span>
                                    <span style="color: #007bff; font-weight: bold;">23</span>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <h6>üìä Monitoramento</h6>
                            <div style="background: #fff3cd; padding: 1rem; border-radius: 6px;">
                                <div style="display: flex; justify-content: space-between;">
                                    <span>Tentativas de login</span>
                                    <span style="color: #856404; font-weight: bold;">156 hoje</span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span>Falhas de login</span>
                                    <span style="color: #dc3545; font-weight: bold;">2</span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span>√öltima varredura</span>
                                    <span style="color: #28a745; font-weight: bold;">17:20</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Executive Command Center -->
            <div id="executive" style="display: none;">
                <h3 class="section-title mb-1">üëî Centro de Comando Executivo</h3>
                
                <!-- Executive KPIs -->
                <div class="grid-4 mb-2">
                    <div class="card stat-card stat-blue">
                        <h4 class="stat-label">ROI de RH</h4>
                        <p class="stat-number">385%</p>
                        <div class="stat-trend">üí∞ Return on Investment</div>
                    </div>
                    <div class="card stat-card stat-green">
                        <h4 class="stat-label">Custo por Funcion√°rio</h4>
                        <p class="stat-number">R$ 2.1K</p>
                        <div class="stat-trend">üìâ -15% vs ind√∫stria</div>
                    </div>
                    <div class="card stat-card stat-purple">
                        <h4 class="stat-label">√çndice de Inova√ß√£o</h4>
                        <p class="stat-number">9.2</p>
                        <div class="stat-trend">üöÄ Top 5% do mercado</div>
                    </div>
                    <div class="card stat-card stat-orange">
                        <h4 class="stat-label">Efici√™ncia Operacional</h4>
                        <p class="stat-number">94.8%</p>
                        <div class="stat-trend">‚ö° Otimiza√ß√£o m√°xima</div>
                    </div>
                </div>
                
                <!-- Strategic Dashboard -->
                <div class="grid-2 mb-2">
                    <div class="card">
                        <h4>üìà Crescimento Estrat√©gico</h4>
                        <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px; margin: 1rem 0;">
                            <h6>üéØ Metas Corporativas 2025</h6>
                            <div style="margin: 1rem 0;">
                                <div style="display: flex; justify-content: space-between; margin: 0.5rem 0;">
                                    <span>Crescimento de receita</span>
                                    <span style="color: #28a745; font-weight: bold;">78% atingido</span>
                                </div>
                                <div class="progress-bar" style="height: 8px; margin: 0.25rem 0;">
                                    <div class="progress-fill" style="width: 78%; background: linear-gradient(90deg, #28a745, #20c997);"></div>
                                </div>
                            </div>
                            
                            <div style="margin: 1rem 0;">
                                <div style="display: flex; justify-content: space-between; margin: 0.5rem 0;">
                                    <span>Expans√£o de mercado</span>
                                    <span style="color: #007bff; font-weight: bold;">92% atingido</span>
                                </div>
                                <div class="progress-bar" style="height: 8px; margin: 0.25rem 0;">
                                    <div class="progress-fill" style="width: 92%;"></div>
                                </div>
                            </div>
                            
                            <div style="margin: 1rem 0;">
                                <div style="display: flex; justify-content: space-between; margin: 0.5rem 0;">
                                    <span>Inova√ß√£o de produtos</span>
                                    <span style="color: #ffc107; font-weight: bold;">65% atingido</span>
                                </div>
                                <div class="progress-bar" style="height: 8px; margin: 0.25rem 0;">
                                    <div class="progress-fill" style="width: 65%; background: linear-gradient(90deg, #ffc107, #ffcd39);"></div>
                                </div>
                            </div>
                        </div>
                        
                        <button class="btn btn-success btn-block" data-action="generateStrategicReport">üìä Relat√≥rio Estrat√©gico</button>
                    </div>
                    
                    <div class="card">
                        <h4>üîÆ Intelig√™ncia de Neg√≥cios</h4>
                        <div style="background: #e7f3ff; padding: 1rem; border-radius: 6px; margin: 1rem 0; border-left: 4px solid #007bff;">
                            <h6>üí° Insights Executivos</h6>
                            <ul style="margin: 0.5rem 0; font-size: 0.9rem;">
                                <li><strong>Oportunidade:</strong> Mercado de termas cresceu 23% - expandir opera√ß√µes</li>
                                <li><strong>Risco:</strong> Competi√ß√£o aumentou 15% - acelerar inova√ß√£o</li>
                                <li><strong>Efici√™ncia:</strong> Automa√ß√£o reduziu custos em R$ 180K/ano</li>
                                <li><strong>Talento:</strong> Pool de candidatos qualificados +40%</li>
                            </ul>
                        </div>
                        
                        <div style="background: #d4edda; padding: 1rem; border-radius: 6px; margin: 1rem 0; border-left: 4px solid #28a745;">
                            <h6>üìà Recomenda√ß√µes Priorit√°rias</h6>
                            <ol style="margin: 0.5rem 0; font-size: 0.9rem;">
                                <li>Investir R$ 2M em tecnologia de automa√ß√£o</li>
                                <li>Contratar 12 especialistas em wellness</li>
                                <li>Abrir 2 novas unidades em Q1/2026</li>
                                <li>Implementar programa de sustentabilidade</li>
                            </ol>
                        </div>
                        
                        <button class="btn btn-primary btn-block" data-action="scheduleExecutiveMeeting">üìÖ Agendar Reuni√£o</button>
                    </div>
                </div>
                
                <!-- Leadership Dashboard -->
                <div class="card mb-2">
                    <h4>üë• Painel de Lideran√ßa</h4>
                    <div class="grid-4" style="gap: 1rem; margin: 1rem 0;">
                        <div style="text-align: center; padding: 1rem;">
                            <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 2rem; margin: 0 auto 1rem;">
                                üë®‚Äçüíº
                            </div>
                            <h6>CEO - Carlos Silva</h6>
                            <p style="font-size: 0.9rem; color: #6c757d; margin: 0.5rem 0;">Estrat√©gia & Vis√£o</p>
                            <div style="background: #28a745; color: white; padding: 0.25rem 0.5rem; border-radius: 12px; font-size: 0.8rem;">‚óè Online</div>
                        </div>
                        
                        <div style="text-align: center; padding: 1rem;">
                            <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 2rem; margin: 0 auto 1rem;">
                                üë©‚Äçüíº
                            </div>
                            <h6>CFO - Lucia Fernandez</h6>
                            <p style="font-size: 0.9rem; color: #6c757d; margin: 0.5rem 0;">Finan√ßas & Controladoria</p>
                            <div style="background: #28a745; color: white; padding: 0.25rem 0.5rem; border-radius: 12px; font-size: 0.8rem;">‚óè Online</div>
                        </div>
                        
                        <div style="text-align: center; padding: 1rem;">
                            <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 2rem; margin: 0 auto 1rem;">
                                üë®‚Äçüíª
                            </div>
                            <h6>CTO - Marco Oliveira</h6>
                            <p style="font-size: 0.9rem; color: #6c757d; margin: 0.5rem 0;">Tecnologia & Inova√ß√£o</p>
                            <div style="background: #ffc107; color: black; padding: 0.25rem 0.5rem; border-radius: 12px; font-size: 0.8rem;">‚óè Ausente</div>
                        </div>
                        
                        <div style="text-align: center; padding: 1rem;">
                            <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 2rem; margin: 0 auto 1rem;">
                                üë©‚Äç‚öïÔ∏è
                            </div>
                            <h6>CHRO - Maria Santos</h6>
                            <p style="font-size: 0.9rem; color: #6c757d; margin: 0.5rem 0;">Recursos Humanos</p>
                            <div style="background: #28a745; color: white; padding: 0.25rem 0.5rem; border-radius: 12px; font-size: 0.8rem;">‚óè Online</div>
                        </div>
                    </div>
                </div>
                
                <!-- Real-time Alerts -->
                <div class="card">
                    <h4>üö® Alertas Executivos em Tempo Real</h4>
                    <div style="max-height: 300px; overflow-y: auto;">
                        <div class="alert-item alert-success" style="margin: 0.5rem 0;">
                            <div class="alert-icon">üéâ</div>
                            <div class="alert-content">
                                <strong>Meta trimestral superada!</strong>
                                <br><small>Receita Q3 atingiu 108% da meta prevista</small>
                                <br><small style="color: #6c757d;">H√° 2 horas</small>
                            </div>
                        </div>
                        
                        <div class="alert-item alert-warning" style="margin: 0.5rem 0;">
                            <div class="alert-icon">‚ö†Ô∏è</div>
                            <div class="alert-content">
                                <strong>Anomalia detectada</strong>
                                <br><small>Custos operacionais subiram 12% esta semana</small>
                                <br><small style="color: #6c757d;">H√° 4 horas</small>
                            </div>
                        </div>
                        
                        <div class="alert-item alert-info" style="margin: 0.5rem 0;">
                            <div class="alert-icon">üìä</div>
                            <div class="alert-content">
                                <strong>Novo insight dispon√≠vel</strong>
                                <br><small>An√°lise preditiva indica crescimento de 25% em Q4</small>
                                <br><small style="color: #6c757d;">H√° 6 horas</small>
                            </div>
                        </div>
                        
                        <div class="alert-item alert-success" style="margin: 0.5rem 0;">
                            <div class="alert-icon">üèÜ</div>
                            <div class="alert-content">
                                <strong>Reconhecimento recebido</strong>
                                <br><small>Thermas classificada no Top 10 "Melhores Lugares para Trabalhar"</small>
                                <br><small style="color: #6c757d;">Ontem</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Administra√ß√£o de Usu√°rios Section -->
            <div id="admin-users" style="display: none;">
                <h3 class="section-title mb-1">üë§ Administra√ß√£o de Usu√°rios e Grupos</h3>
                
                <!-- Navigation Tabs -->
                <div class="card mb-2">
                    <div style="display: flex; gap: 10px; border-bottom: 1px solid #ddd; padding-bottom: 10px;">
                        <button id="tab-users" class="btn btn-primary" data-action="showAdminTab" data-param="users" style="background: #007bff;">üë• Usu√°rios</button>
                        <button id="tab-groups" class="btn btn-secondary" data-action="showAdminTab" data-param="groups">üè¢ Grupos</button>
                        <button id="tab-permissions" class="btn btn-secondary" data-action="showAdminTab" data-param="permissions">üîê Permiss√µes</button>
                        <button id="tab-ad-sync" class="btn btn-secondary" data-action="showAdminTab" data-param="ad-sync">üîÑ Sincroniza√ß√£o AD</button>
                    </div>
                </div>

                <!-- Users Tab -->
                <div id="admin-tab-users" style="display: block;">
                    <div class="section-header">
                        <h4>Gerenciamento de Usu√°rios</h4>
                        <button class="btn btn-success" data-action="showCreateUserModal">+ Novo Usu√°rio</button>
                    </div>
                    
                    <!-- Users List -->
                    <div id="users-list" class="card">
                        <div style="text-align: center; padding: 2rem; color: #666;">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">üë•</div>
                            <p>Carregando usu√°rios...</p>
                        </div>
                    </div>
                </div>

                <!-- Groups Tab -->
                <div id="admin-tab-groups" style="display: none;">
                    <div class="section-header">
                        <h4>Gerenciamento de Grupos</h4>
                        <button class="btn btn-success" data-action="showCreateGroupModal">+ Novo Grupo</button>
                    </div>
                    
                    <!-- Groups List -->
                    <div id="groups-list" class="card">
                        <div style="text-align: center; padding: 2rem; color: #666;">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">üè¢</div>
                            <p>Carregando grupos...</p>
                        </div>
                    </div>
                </div>

                <!-- Permissions Tab -->
                <div id="admin-tab-permissions" style="display: none;">
                    <div class="section-header">
                        <h4>Configura√ß√£o de Permiss√µes</h4>
                    </div>
                    
                    <div class="grid-2">
                        <div class="card">
                            <h5>üéØ Permiss√µes por Fun√ß√£o</h5>
                            <div id="role-permissions">
                                <div style="margin: 1rem 0; padding: 1rem; background: #f8f9fa; border-radius: 6px;">
                                    <h6>üëë Administradores</h6>
                                    <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px;">
                                        <span class="badge badge-success">‚úÖ Usu√°rios</span>
                                        <span class="badge badge-success">‚úÖ Grupos</span>
                                        <span class="badge badge-success">‚úÖ Funcion√°rios</span>
                                        <span class="badge badge-success">‚úÖ Relat√≥rios</span>
                                        <span class="badge badge-success">‚úÖ Sistema</span>
                                    </div>
                                </div>
                                
                                <div style="margin: 1rem 0; padding: 1rem; background: #f8f9fa; border-radius: 6px;">
                                    <h6>üë• Recursos Humanos</h6>
                                    <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px;">
                                        <span class="badge badge-success">‚úÖ Funcion√°rios</span>
                                        <span class="badge badge-success">‚úÖ Requisi√ß√µes</span>
                                        <span class="badge badge-success">‚úÖ Relat√≥rios</span>
                                        <span class="badge badge-warning">‚ö†Ô∏è Grupos (parcial)</span>
                                    </div>
                                </div>
                                
                                <div style="margin: 1rem 0; padding: 1rem; background: #f8f9fa; border-radius: 6px;">
                                    <h6>üçΩÔ∏è Departamentos</h6>
                                    <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px;">
                                        <span class="badge badge-info">üëÅÔ∏è Visualizar (pr√≥prio setor)</span>
                                        <span class="badge badge-warning">‚ö†Ô∏è Requisi√ß√µes (pr√≥prias)</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card">
                            <h5>‚öôÔ∏è Configura√ß√µes de Seguran√ßa</h5>
                            <div style="background: #fff3cd; padding: 1rem; border-radius: 6px; margin: 1rem 0; border-left: 4px solid #ffc107;">
                                <h6>üîê Pol√≠ticas de Acesso</h6>
                                <ul style="margin: 0.5rem 0; font-size: 0.9rem;">
                                    <li>Tokens JWT com expira√ß√£o de 8 horas</li>
                                    <li>Senhas criptografadas com bcrypt</li>
                                    <li>Controle de acesso baseado em grupos</li>
                                    <li>Logs de auditoria autom√°ticos</li>
                                </ul>
                            </div>
                            
                            <div style="background: #d4edda; padding: 1rem; border-radius: 6px; margin: 1rem 0; border-left: 4px solid #28a745;">
                                <h6>üìä Status do Sistema</h6>
                                <div style="display: flex; justify-content: space-between; margin: 0.5rem 0;">
                                    <span>Usu√°rios ativos</span>
                                    <span style="color: #28a745; font-weight: bold;" id="active-users-count">-</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin: 0.5rem 0;">
                                    <span>Grupos configurados</span>
                                    <span style="color: #007bff; font-weight: bold;" id="groups-count">-</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin: 0.5rem 0;">
                                    <span>√öltima atividade</span>
                                    <span style="color: #6c757d; font-weight: bold;" id="last-activity">-</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- AD Synchronization Tab -->
                <div id="admin-tab-ad-sync" style="display: none;">
                    <div class="section-header">
                        <h4>üîÑ Sincroniza√ß√£o com Active Directory</h4>
                        <button class="btn btn-success" data-action="showADConfigModal">‚öôÔ∏è Configurar AD</button>
                    </div>
                    
                    <div class="grid-2">
                        <!-- AD Connection Status -->
                        <div class="card">
                            <h5>üì° Status da Conex√£o</h5>
                            <div id="ad-status" style="padding: 1rem;">
                                <div style="background: #f8f9fa; padding: 1rem; border-radius: 6px; text-align: center;">
                                    <div style="font-size: 2rem; margin-bottom: 0.5rem;">‚ö†Ô∏è</div>
                                    <p style="margin: 0; color: #666;">Active Directory n√£o configurado</p>
                                    <small style="color: #666;">Configure as credenciais para come√ßar</small>
                                </div>
                            </div>
                            
                            <div style="margin-top: 1rem;">
                                <button id="test-ad-connection" class="btn btn-full" data-action="testADConnection">üîç Testar Conex√£o</button>
                            </div>
                        </div>
                        
                        <!-- Sync Actions -->
                        <div class="card">
                            <h5>üîÑ A√ß√µes de Sincroniza√ß√£o</h5>
                            <div style="display: flex; flex-direction: column; gap: 1rem;">
                                <button class="btn btn-full" data-action="syncUsersFromAD" id="sync-users-btn">
                                    üë• Importar Usu√°rios do AD
                                </button>
                                
                                <button class="btn btn-full" data-action="syncGroupsFromAD" id="sync-groups-btn" style="background: #6c757d;">
                                    üè¢ Importar Grupos do AD
                                </button>
                                
                                <button class="btn btn-full" data-action="showSyncHistory" style="background: #17a2b8;">
                                    üìä Hist√≥rico de Sincroniza√ß√£o
                                </button>
                            </div>
                            
                            <div style="background: #d1ecf1; padding: 1rem; border-radius: 6px; margin-top: 1rem; border-left: 4px solid #bee5eb;">
                                <h6>üåê Active Directory Local</h6>
                                <ul style="margin: 0; font-size: 0.9rem;">
                                    <li>Sistema preparado para AD em rede local</li>
                                    <li>Configure quando implantar na sua rede</li>
                                    <li>Usu√°rios existentes n√£o ser√£o sobrescritos</li>
                                    <li>Grupos AD mapeados automaticamente</li>
                                    <li>Senhas validadas diretamente no AD</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Sync Results -->
                    <div class="card" style="margin-top: 1rem;">
                        <h5>üìã Resultados da √öltima Sincroniza√ß√£o</h5>
                        <div id="sync-results" style="padding: 1rem;">
                            <div style="text-align: center; color: #666; padding: 2rem;">
                                <div style="font-size: 2rem; margin-bottom: 0.5rem;">üìã</div>
                                <p style="margin: 0;">Nenhuma sincroniza√ß√£o executada ainda</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- AD Configuration -->
                    <div class="card" style="margin-top: 1rem;">
                        <h5>‚öôÔ∏è Configura√ß√£o Atual</h5>
                        <div id="ad-config-display" style="padding: 1rem;">
                            <div style="background: #f8f9fa; padding: 1rem; border-radius: 6px;">
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                    <div>
                                        <label style="font-weight: 600; color: #333;">Servidor AD:</label>
                                        <p style="margin: 0; color: #666;" id="ad-server-display">N√£o configurado</p>
                                    </div>
                                    <div>
                                        <label style="font-weight: 600; color: #333;">Dom√≠nio:</label>
                                        <p style="margin: 0; color: #666;" id="ad-domain-display">N√£o configurado</p>
                                    </div>
                                    <div>
                                        <label style="font-weight: 600; color: #333;">Base DN:</label>
                                        <p style="margin: 0; color: #666;" id="ad-base-dn-display">N√£o configurado</p>
                                    </div>
                                    <div>
                                        <label style="font-weight: 600; color: #333;">√öltima sincroniza√ß√£o:</label>
                                        <p style="margin: 0; color: #666;" id="last-sync-display">Nunca</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Funcion√°rios Section -->
            <div id="funcionarios" style="display: none;">
                <div class="section-header">
                    <h3 class="section-title">Gerenciamento de Funcion√°rios</h3>
                    <div style="display: flex; gap: 10px;">
                        <button id="delete-selected-btn" class="btn btn-danger" data-action="deleteSelectedEmployees" style="display: none;">üóëÔ∏è Excluir Selecionados</button>
                        <button class="btn btn-success" data-action="showSubSection" data-param="novo-funcionario">+ Novo Funcion√°rio</button>
                    </div>
                </div>

                <!-- Campo de Pesquisa -->
                <div class="search-container" style="
                    background: white; 
                    padding: 1rem; 
                    margin: 1rem 0; 
                    border-radius: 8px; 
                    border: 1px solid #ddd;
                    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                ">
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <div style="position: relative; flex: 1;">
                            <input 
                                type="text" 
                                id="employee-search" 
                                placeholder="üîç Pesquisar funcion√°rios (nome, email, cargo...)"
                                style="
                                    width: 100%;
                                    padding: 0.75rem 1rem;
                                    border: 2px solid #e3e6f0;
                                    border-radius: 5px;
                                    font-size: 14px;
                                    outline: none;
                                    transition: all 0.3s ease;
                                "
                                onkeyup="searchEmployees(this.value)"
                                onfocus="this.style.borderColor='#4e73df'; this.style.boxShadow='0 0 0 0.2rem rgba(78,115,223,.25)'"
                                onblur="this.style.borderColor='#e3e6f0'; this.style.boxShadow='none'"
                            >
                        </div>
                        <button 
                            data-action="clearSearch" 
                            style="
                                padding: 0.75rem 1rem;
                                background: #6c757d;
                                color: white;
                                border: none;
                                border-radius: 5px;
                                cursor: pointer;
                                font-size: 12px;
                                white-space: nowrap;
                            "
                            title="Limpar pesquisa"
                        >üóëÔ∏è Limpar</button>
                    </div>
                    <div id="search-results-count" style="
                        margin-top: 0.5rem;
                        font-size: 12px;
                        color: #6c757d;
                        font-style: italic;
                    "></div>
                </div>
                
                <div class="table-container">
                    <div class="table-header">
                        <h4 class="table-title">Lista de Funcion√°rios</h4>
                    </div>
                    <div class="table-grid table-header-row" style="grid-template-columns: 50px 2fr 1fr 1fr 100px 100px;">
                        <span style="display: flex; align-items: center; justify-content: center;">
                            <input type="checkbox" id="select-all-employees" data-action="toggleSelectAll" style="cursor: pointer;" title="Selecionar/Desmarcar todos">
                        </span>
                        <span>Nome</span>
                        <span>Cargo</span>
                        <span>Sal√°rio</span>
                        <span>Status</span>
                        <span>A√ß√µes</span>
                    </div>
                    <div id="funcionarios-list">
                        <div class="table-grid">
                            <span style="color: #6c757d; grid-column: 1 / -1; text-align: center; padding: 2rem;">
                                üîÑ Carregando funcion√°rios...
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Requisi√ß√µes Section -->
            <div id="requisicoes" style="display: none;">
                <div class="section-header">
                    <h3 class="section-title">Requisi√ß√µes dos Funcion√°rios</h3>
                    <button class="btn btn-success" data-action="showSubSection" data-param="nova-requisicao">+ Nova Requisi√ß√£o</button>
                </div>
                
                <!-- Filtros de Requisi√ß√µes -->
                <div class="card">
                    <div class="filters-row" style="padding: 1rem;">
                        <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                            <div>
                                <label style="display: block; font-weight: 500; margin-bottom: 5px;">Status:</label>
                                <select id="request-status-filter" onchange="filterRequestsByStatus()" 
                                        style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; min-width: 140px;">
                                    <option value="">Todos os status</option>
                                    <option value="pending">‚è≥ Pendentes</option>
                                    <option value="approved">‚úÖ Aprovadas</option>
                                    <option value="rejected">‚ùå Rejeitadas</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; font-weight: 500; margin-bottom: 5px;">Pesquisar:</label>
                                <input type="text" id="request-search" placeholder="Pesquisar requisi√ß√µes..." 
                                       style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; width: 250px;"
                                       onkeyup="filterRequests(this.value)">
                            </div>
                            <div style="margin-left: auto;">
                                <button class="btn btn-secondary" data-action="refreshRequests" style="margin-top: 1.5rem;">
                                    üîÑ Atualizar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="table-container">
                    <div class="table-header">
                        <h4 class="table-title">Requisi√ß√µes</h4>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <div id="request-results-count" style="color: #666; font-size: 14px;"></div>
                        </div>
                    </div>
                    <div class="table-grid table-header-row">
                        <span>Funcion√°rio</span>
                        <span>Tipo</span>
                        <span>Data</span>
                        <span>Status</span>
                        <span>A√ß√µes</span>
                    </div>
                    <div id="requests-list">
                        <div style="text-align: center; padding: 2rem; color: #666;">
                            üîÑ Carregando requisi√ß√µes...
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tipos de Requisi√ß√µes Section -->
            <div id="tipos-requisicoes" style="display: none;">
                <div class="section-header">
                    <h3 class="section-title">Configura√ß√£o de Tipos de Requisi√ß√µes</h3>
                    <button class="btn btn-success" data-action="showForm">+ Novo Tipo de Requisi√ß√£o</button>
                </div>
                
                <div id="list">
                    <div class="card card-white">
                        <h3>Solicita√ß√£o de F√©rias</h3>
                        <p>Categoria: Tempo</p>
                        <p>Status: Ativo</p>
                        <button class="btn btn-secondary mt-1" data-action="editRequest" data-param="1">Editar</button>
                    </div>
                    
                    <div class="card card-white">
                        <h3>Reembolso de Despesas</h3>
                        <p>Categoria: Financeiro</p>
                        <p>Status: Ativo</p>
                        <button class="btn btn-secondary mt-1" data-action="editRequest" data-param="2">Editar</button>
                    </div>
                    
                    <div class="card card-white">
                        <h3>Solicita√ß√£o de Material</h3>
                        <p>Categoria: Material</p>
                        <p>Status: Ativo</p>
                        <button class="btn btn-secondary mt-1" data-action="editRequest" data-param="3">Editar</button>
                    </div>
                </div>

                <div id="form" style="display: none;">
                    <div class="card card-white">
                        <h3>Novo Tipo de Requisi√ß√£o</h3>
                        
                        <div class="form-group">
                            <label>Nome do Tipo:</label>
                            <input type="text" id="requestName" placeholder="Ex: Solicita√ß√£o de F√©rias">
                        </div>
                        
                        <div class="form-group">
                            <label>Categoria:</label>
                            <select id="requestCategory">
                                <option value="">Selecione...</option>
                                <option value="tempo">Tempo</option>
                                <option value="financeiro">Financeiro</option>
                                <option value="material">Material</option>
                                <option value="outros">Outros</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Descri√ß√£o:</label>
                            <textarea id="requestDescription" rows="3" placeholder="Descreva o tipo de requisi√ß√£o..."></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label>Status:</label>
                            <select id="requestStatus">
                                <option value="ativo">Ativo</option>
                                <option value="inativo">Inativo</option>
                            </select>
                        </div>
                        
                        <button class="btn btn-success" data-action="saveRequest">Salvar</button>
                        <button class="btn btn-secondary" data-action="showList">Cancelar</button>
                    </div>
                </div>
            </div>

            <!-- Aprova√ß√µes Section -->
            <div id="aprovacoes" style="display: none;">
                <div class="section-header">
                    <h3 class="section-title">‚úÖ Central de Aprova√ß√µes</h3>
                    <div class="section-stats">
                        <span id="pending-count" class="stat-badge">0 pendentes</span>
                        <span id="today-approvals" class="stat-badge">0 hoje</span>
                    </div>
                </div>

                <!-- Filtros de Aprova√ß√£o -->
                <div class="card">
                    <div class="filters-row">
                        <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                            <div>
                                <label style="display: block; font-weight: 500; margin-bottom: 5px;">Pesquisar:</label>
                                <input type="text" id="approval-search" placeholder="Buscar por funcion√°rio, t√≠tulo ou tipo..." 
                                       style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; width: 250px;"
                                       onkeyup="filterApprovals()">
                            </div>
                            <div>
                                <label style="display: block; font-weight: 500; margin-bottom: 5px;">Status:</label>
                                <select id="approval-status-filter" onchange="filterApprovals()" 
                                        style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; min-width: 140px;">
                                    <option value="">Todos os status</option>
                                    <option value="pending">‚è≥ Pendentes</option>
                                    <option value="approved">‚úÖ Aprovadas</option>
                                    <option value="rejected">‚ùå Rejeitadas</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; font-weight: 500; margin-bottom: 5px;">Prioridade:</label>
                                <select id="approval-priority-filter" onchange="filterApprovals()" 
                                        style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; min-width: 120px;">
                                    <option value="">Todas</option>
                                    <option value="urgent">üî¥ Urgente</option>
                                    <option value="high">üü† Alta</option>
                                    <option value="medium">üü° M√©dia</option>
                                    <option value="low">üü¢ Baixa</option>
                                </select>
                            </div>
                            <div style="margin-left: auto;">
                                <button class="btn btn-secondary" data-action="refreshApprovals">
                                    üîÑ Atualizar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Lista de Aprova√ß√µes -->
                <div class="table-container">
                    <div class="table-header">
                        <h4 class="table-title">Hist√≥rico de Aprova√ß√µes</h4>
                        <div id="approval-results-count" style="color: #666; font-size: 14px;"></div>
                    </div>
                    <div class="table-grid table-header-row">
                        <span>Funcion√°rio</span>
                        <span>Requisi√ß√£o</span>
                        <span>Prioridade</span>
                        <span>Status</span>
                        <span>Data</span>
                        <span>A√ß√µes</span>
                    </div>
                    <div id="approvals-list">
                        <div style="text-align: center; padding: 2rem; color: #666;">
                            üîÑ Carregando aprova√ß√µes...
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal de Aprova√ß√£o/Rejei√ß√£o -->
            <div id="approvalModal" class="modal" style="display: none;">
                <div class="modal-content" style="max-width: 600px;">
                    <div class="modal-header">
                        <h4 id="approval-modal-title">Aprovar Requisi√ß√£o</h4>
                        <button type="button" class="btn btn-link" data-action="closeApprovalModal">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div id="approval-request-details"></div>
                        
                        <div class="form-group" id="approval-comments-group">
                            <label for="approval-comments">Coment√°rios (opcional):</label>
                            <textarea id="approval-comments" rows="3" 
                                      placeholder="Adicione coment√°rios sobre sua decis√£o..."></textarea>
                        </div>
                        
                        <div class="form-group" id="rejection-reason-group" style="display: none;">
                            <label for="rejection-reason">Motivo da rejei√ß√£o *:</label>
                            <textarea id="rejection-reason" rows="3" 
                                      placeholder="Descreva o motivo da rejei√ß√£o (obrigat√≥rio)..."></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <div id="approval-actions">
                            <button class="btn btn-success" data-action="confirmApproval">
                                ‚úÖ Confirmar Aprova√ß√£o
                            </button>
                            <button class="btn btn-danger" data-action="showRejectionForm">
                                ‚ùå Rejeitar
                            </button>
                            <button class="btn btn-secondary" data-action="closeApprovalModal">
                                Cancelar
                            </button>
                        </div>
                        <div id="rejection-actions" style="display: none;">
                            <button class="btn btn-danger" data-action="confirmRejection">
                                ‚ùå Confirmar Rejei√ß√£o
                            </button>
                            <button class="btn btn-secondary" data-action="showApprovalForm">
                                ‚Üê Voltar
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Relat√≥rios Section -->
            <div id="relatorios" style="display: none;">
                <h3 class="section-title mb-1">Relat√≥rios e Estat√≠sticas</h3>
                
                <div class="grid-2">
                    <div class="card card-white">
                        <h4>Requisi√ß√µes por M√™s</h4>
                        <div class="mt-1">
                            <p>Janeiro: 12 requisi√ß√µes</p>
                            <p>Fevereiro: 8 requisi√ß√µes</p>
                            <p>Mar√ßo: 15 requisi√ß√µes</p>
                            <p>Abril: 10 requisi√ß√µes</p>
                        </div>
                        <button class="btn mt-1">üìä Ver Relat√≥rio Completo</button>
                    </div>
                    
                    <div class="card card-white">
                        <h4>Tipos Mais Solicitados</h4>
                        <div class="mt-1">
                            <p>1. F√©rias (45%)</p>
                            <p>2. Reembolso (30%)</p>
                            <p>3. Material (15%)</p>
                            <p>4. Outros (10%)</p>
                        </div>
                        <button class="btn mt-1">üìà Exportar Dados</button>
                    </div>
                </div>
            </div>

            <!-- Departamentos Section -->
            <div id="departamentos" style="display: none;">
                <div class="section-header">
                    <h3 class="section-title">Gerenciamento de Departamentos</h3>
                    <button class="btn btn-success" data-action="showNewDepartmentForm">+ Novo Departamento</button>
                </div>
                
                <div id="departamentos-list" class="table-container">
                    <div class="table-header">
                        <h4 class="table-title">Lista de Departamentos</h4>
                    </div>
                    <div class="table-grid table-header-row" style="grid-template-columns: 2fr 2fr 1fr 1fr 1fr;">
                        <span>Nome</span>
                        <span>Descri√ß√£o</span>
                        <span>Respons√°vel</span>
                        <span>Status</span>
                        <span>A√ß√µes</span>
                    </div>
                    <div class="table-grid" style="grid-template-columns: 2fr 2fr 1fr 1fr 1fr;">
                        <span>Tecnologia da Informa√ß√£o</span>
                        <span>Desenvolvimento e suporte de sistemas</span>
                        <span>Jo√£o Silva</span>
                        <span class="status status-success">Ativo</span>
                        <button class="btn btn-secondary">Editar</button>
                    </div>
                    <div class="table-grid" style="grid-template-columns: 2fr 2fr 1fr 1fr 1fr;">
                        <span>Recursos Humanos</span>
                        <span>Gest√£o de pessoas e processos</span>
                        <span>Maria Santos</span>
                        <span class="status status-success">Ativo</span>
                        <button class="btn btn-secondary">Editar</button>
                    </div>
                    <div class="table-grid" style="grid-template-columns: 2fr 2fr 1fr 1fr 1fr;">
                        <span>Administrativo</span>
                        <span>Suporte administrativo geral</span>
                        <span>Ana Costa</span>
                        <span class="status status-success">Ativo</span>
                        <button class="btn btn-secondary">Editar</button>
                    </div>
                    <div class="table-grid" style="grid-template-columns: 2fr 2fr 1fr 1fr 1fr;">
                        <span>Financeiro</span>
                        <span>Controle financeiro e contabilidade</span>
                        <span>Carlos Oliveira</span>
                        <span class="status status-success">Ativo</span>
                        <button class="btn btn-secondary">Editar</button>
                    </div>
                    <div class="table-grid" style="grid-template-columns: 2fr 2fr 1fr 1fr 1fr;">
                        <span>Operacional</span>
                        <span>Opera√ß√µes e manuten√ß√£o</span>
                        <span>Pedro Silva</span>
                        <span class="status status-success">Ativo</span>
                        <button class="btn btn-secondary">Editar</button>
                    </div>
                </div>
            </div>

            <!-- Cargos Section -->
            <div id="cargos" style="display: none;">
                <div class="section-header">
                    <h3 class="section-title">Consulta CBO - Classifica√ß√£o Brasileira de Ocupa√ß√µes</h3>
                    <button class="btn btn-success" data-action="refreshCboData">üîÑ Atualizar CBO</button>
                </div>
                
                <div class="card card-white mb-1">
                    <h4>Buscar Cargos</h4>
                    <div class="grid-2" style="align-items: end;">
                        <div class="form-group">
                            <label>Buscar por nome do cargo:</label>
                            <input type="text" id="cboSearch" placeholder="Digite o nome do cargo (ex: Analista)" onkeyup="searchCbo()">
                        </div>
                        <div class="form-group">
                            <label>Filtrar por grande grupo:</label>
                            <select id="cboGrupo" onchange="filterByGroup()">
                                <option value="">Todos os grupos</option>
                                <option value="1">1 - Membros superiores do poder p√∫blico</option>
                                <option value="2">2 - Profissionais das ci√™ncias e das artes</option>
                                <option value="3">3 - T√©cnicos de n√≠vel m√©dio</option>
                                <option value="4">4 - Trabalhadores de servi√ßos administrativos</option>
                                <option value="5">5 - Trabalhadores dos servi√ßos</option>
                                <option value="6">6 - Vendedores e prestadores de servi√ßos do com√©rcio</option>
                                <option value="7">7 - Trabalhadores da produ√ß√£o de bens e servi√ßos industriais</option>
                                <option value="8">8 - Trabalhadores da produ√ß√£o de bens e servi√ßos industriais</option>
                                <option value="9">9 - Trabalhadores de manuten√ß√£o e repara√ß√£o</option>
                                <option value="0">0 - Membros das for√ßas armadas</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div id="cbo-results" class="table-container">
                    <div class="table-header">
                        <h4 class="table-title">Resultados da CBO</h4>
                    </div>
                    <div class="table-grid table-header-row" style="grid-template-columns: 1fr 3fr 2fr 1fr;">
                        <span>C√≥digo CBO</span>
                        <span>T√≠tulo da Ocupa√ß√£o</span>
                        <span>Grupo</span>
                        <span>A√ß√µes</span>
                    </div>
                    <div class="table-grid" style="grid-template-columns: 1fr 3fr 2fr 1fr;">
                        <span>1414-05</span>
                        <span>Diretor de recursos humanos</span>
                        <span>Membros superiores do poder p√∫blico</span>
                        <button class="btn btn-secondary" data-action="selectCbo" data-param="1414-05" data-description="Diretor de recursos humanos">Selecionar</button>
                    </div>
                    <div class="table-grid" style="grid-template-columns: 1fr 3fr 2fr 1fr;">
                        <span>2516-05</span>
                        <span>Analista de recursos humanos</span>
                        <span>Profissionais das ci√™ncias e das artes</span>
                        <button class="btn btn-secondary" data-action="selectCbo" data-param="2516-05" data-description="Analista de recursos humanos">Selecionar</button>
                    </div>
                    <div class="table-grid" style="grid-template-columns: 1fr 3fr 2fr 1fr;">
                        <span>4110-05</span>
                        <span>Auxiliar de pessoal</span>
                        <span>Trabalhadores de servi√ßos administrativos</span>
                        <button class="btn btn-secondary" data-action="selectCbo" data-param="4110-05" data-description="Auxiliar de pessoal">Selecionar</button>
                    </div>
                    <div class="table-grid" style="grid-template-columns: 1fr 3fr 2fr 1fr;">
                        <span>1237-10</span>
                        <span>Diretor administrativo</span>
                        <span>Membros superiores do poder p√∫blico</span>
                        <button class="btn btn-secondary" data-action="selectCbo" data-param="1237-10" data-description="Diretor administrativo">Selecionar</button>
                    </div>
                    <div class="table-grid" style="grid-template-columns: 1fr 3fr 2fr 1fr;">
                        <span>2124-05</span>
                        <span>Administrador</span>
                        <span>Profissionais das ci√™ncias e das artes</span>
                        <button class="btn btn-secondary" data-action="selectCbo" data-param="2124-05" data-description="Administrador">Selecionar</button>
                    </div>
                    <div class="table-grid" style="grid-template-columns: 1fr 3fr 2fr 1fr;">
                        <span>3171-05</span>
                        <span>T√©cnico em inform√°tica</span>
                        <span>T√©cnicos de n√≠vel m√©dio</span>
                        <button class="btn btn-secondary" data-action="selectCbo" data-param="3171-05" data-description="T√©cnico em inform√°tica">Selecionar</button>
                    </div>
                </div>
                
                <div id="selected-cbo" class="card card-white mt-1" style="display: none;">
                    <h4>Cargo Selecionado</h4>
                    <div id="cbo-details">
                        <!-- Detalhes do cargo selecionado -->
                    </div>
                    <button class="btn btn-success mt-1" data-action="addCargoToSystem">Adicionar ao Sistema</button>
                    <button class="btn btn-secondary mt-1" data-action="clearCboSelection">Limpar Sele√ß√£o</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Enhanced status system with micro-interactions
        function showStatus(message, type = 'info') {
            const status = document.getElementById('status');
            if (status) {
                status.textContent = message;
                status.className = `status status-${type} mt-1 show`;
                if (type === 'warning' || type === 'danger') {
                    status.classList.add('error');
                }
            }
            
            // Also show toast notification
            showToast(message, type);
        }
        
        function showToast(message, type = 'info') {
            // Remove existing toasts
            const existingToasts = document.querySelectorAll('.toast');
            existingToasts.forEach(toast => toast.remove());
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 1.2rem;">
                        ${type === 'success' ? '‚úÖ' : type === 'warning' ? '‚ö†Ô∏è' : type === 'danger' ? '‚ùå' : '‚ÑπÔ∏è'}
                    </span>
                    <span>${message}</span>
                    <button data-action="removeElement" style="background: none; border: none; font-size: 1.2rem; cursor: pointer; margin-left: auto;">√ó</button>
                </div>
            `;
            
            document.body.appendChild(toast);
            
            // Animate in
            setTimeout(() => toast.classList.add('show'), 100);
            
            // Auto remove after 4 seconds
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.classList.remove('show');
                    setTimeout(() => toast.remove(), 300);
                }
            }, 4000);
        }
        
        // Loading button states
        function setButtonLoading(button, loading = true) {
            if (loading) {
                button.classList.add('btn-loading');
                button.disabled = true;
            } else {
                button.classList.remove('btn-loading');
                button.disabled = false;
            }
        }
        
        // Progressive form validation
        function addFormInteractions() {
            const inputs = document.querySelectorAll('input, select, textarea');
            inputs.forEach(input => {
                input.addEventListener('focus', function() {
                    this.parentElement.classList.add('animate-glow');
                });
                
                input.addEventListener('blur', function() {
                    this.parentElement.classList.remove('animate-glow');
                });
                
                input.addEventListener('input', function() {
                    if (this.value) {
                        this.style.borderColor = '#28a745';
                        this.style.background = '#f8fff8';
                    } else {
                        this.style.borderColor = '#ddd';
                        this.style.background = 'white';
                    }
                });
            });
        }
        
        // Animate section transitions
        function animateSection(sectionId) {
            const section = document.getElementById(sectionId);
            if (section) {
                section.style.opacity = '0';
                section.style.transform = 'translateY(20px)';
                
                setTimeout(() => {
                    section.style.transition = 'all 0.5s ease';
                    section.style.opacity = '1';
                    section.style.transform = 'translateY(0)';
                }, 50);
            }
        }
        
        function clearAllSampleData() {
            // Reset dashboard counters to 0
            const counters = ['totalEmployees', 'newHires', 'pendingRequests', 'avgTimeHire'];
            counters.forEach(id => {
                const element = document.getElementById(id);
                if (element) element.textContent = '0';
            });
            
            // Clear all stat trends globally
            document.querySelectorAll('.stat-trend').forEach(trend => {
                trend.textContent = 'Aguardando dados';
            });
            
            // Clear all stat numbers globally
            document.querySelectorAll('.stat-number').forEach(stat => {
                if (stat.textContent.includes('R$')) {
                    stat.textContent = 'R$ 0';
                } else if (stat.textContent.includes('%')) {
                    stat.textContent = '0%';
                } else if (/^\d+/.test(stat.textContent)) {
                    stat.textContent = '0';
                }
            });
            
            // Clear all progress bars globally
            document.querySelectorAll('.progress-fill, .chart-fill').forEach(fill => {
                fill.style.width = '0%';
            });
            
            // Clear all fictional employee names
            clearAllFictionalNames();
            
            // Clear employees list
            clearEmployeesList();
            
            // Clear all other sections with sample data
            clearAllSectionsData();
            
            // Clear analytics data
            clearAnalyticsData();
            
            // Clear all advanced sections
            clearAdvancedSections();
            
            // Global cleanup of remaining data
            performGlobalCleanup();
            
            console.log('‚úÖ Sistema limpo - todos os dados fict√≠cios removidos');
            showToast('Sistema iniciado sem dados de exemplo', 'info');
        }
        
        function clearAllFictionalNames() {
            const fictionalNames = [
                'Jo√£o Silva', 'Maria Santos', 'Pedro Oliveira', 'Ana Costa', 
                'Carlos Mendes', 'Lucia Fernandez', 'Carlos Silva', 'Marco Oliveira'
            ];
            
            // Simple and safe approach - find elements with fictional names
            const allElements = document.querySelectorAll('*');
            allElements.forEach(el => {
                if (el.textContent && el.children.length === 0) { // Only text nodes
                    let content = el.textContent;
                    fictionalNames.forEach(name => {
                        if (content.includes(name)) {
                            content = content.replace(new RegExp(name, 'g'), '[Nome n√£o definido]');
                        }
                    });
                    if (content !== el.textContent) {
                        el.textContent = content;
                    }
                }
            });
        }
        
        function performGlobalCleanup() {
            try {
                // Clear table rows with sample data (except headers) - safer approach
                const tableRows = document.querySelectorAll('.table-grid:not(.table-header-row)');
                const rowsToRemove = [];
                tableRows.forEach(row => {
                    if (row && row.textContent && (
                        row.textContent.includes('Tecnologia da Informa√ß√£o') || 
                        row.textContent.includes('Recursos Humanos') || 
                        row.textContent.includes('Financeiro') ||
                        row.textContent.includes('Administrativo') ||
                        row.textContent.includes('Operacional') ||
                        row.textContent.includes('Desenvolvedor') ||
                        row.textContent.includes('Analista') ||
                        row.textContent.includes('Gerente')
                    )) {
                        rowsToRemove.push(row);
                    }
                });
                
                // Remove identified rows
                rowsToRemove.forEach(row => row.remove());
                
            } catch (error) {
                console.warn('Error in global cleanup:', error);
            }
        }
        
        function clearEmployeesList() {
            // Clear main employees table
            const employeesListContainer = document.querySelector('#funcionarios .table-container');
            if (employeesListContainer) {
                const header = employeesListContainer.querySelector('.table-header');
                const headerRow = employeesListContainer.querySelector('.table-header-row');
                
                employeesListContainer.innerHTML = '';
                if (header) employeesListContainer.appendChild(header);
                if (headerRow) employeesListContainer.appendChild(headerRow);
                
                // Just clear the container, let loadEmployeesData handle empty state
                const funcionariosList = document.getElementById('funcionarios-list');
                if (funcionariosList) {
                    funcionariosList.innerHTML = '';
                }
            }
            
            // Clear self-service employee profile data
            clearSelfServiceData();
            
            // Clear performance evaluations
            clearPerformanceData();
            
            // Clear all references to fictional employees
            clearFictionalEmployees();
        }
        
        function clearSelfServiceData() {
            // Clear employee profile in self-service
            const profileCards = document.querySelectorAll('#self-service .card');
            profileCards.forEach(card => {
                if (card.innerHTML.includes('Jo√£o Silva') || card.innerHTML.includes('Desenvolvedor')) {
                    card.innerHTML = '<h4>Perfil do Colaborador</h4><div style="text-align: center; padding: 2rem; color: #6c757d;">Dados do funcion√°rio ser√£o carregados ap√≥s login</div>';
                }
            });
            
            // Clear requests in self-service
            const requestsTables = document.querySelectorAll('#self-service .table-container');
            requestsTables.forEach(table => {
                const headerRow = table.querySelector('.table-header-row');
                if (headerRow) {
                    table.innerHTML = '';
                    table.appendChild(headerRow);
                    const emptyMsg = document.createElement('div');
                    emptyMsg.style.cssText = 'text-align: center; padding: 2rem; color: #6c757d;';
                    emptyMsg.textContent = 'Nenhuma solicita√ß√£o encontrada';
                    table.appendChild(emptyMsg);
                }
            });
        }
        
        function clearPerformanceData() {
            const performanceSection = document.getElementById('performance');
            if (performanceSection) {
                // Clear performance evaluations table
                const perfTables = performanceSection.querySelectorAll('.table-container');
                perfTables.forEach(table => {
                    const headerRow = table.querySelector('.table-header-row');
                    if (headerRow) {
                        table.innerHTML = '';
                        table.appendChild(headerRow);
                        const emptyMsg = document.createElement('div');
                        emptyMsg.style.cssText = 'text-align: center; padding: 2rem; color: #6c757d;';
                        emptyMsg.textContent = 'Nenhuma avalia√ß√£o registrada ainda';
                        table.appendChild(emptyMsg);
                    }
                });
                
                // Reset all performance KPI numbers to 0
                const perfStats = performanceSection.querySelectorAll('.stat-number');
                perfStats.forEach(stat => stat.textContent = '0');
                
                // Clear performance trends
                const perfTrends = performanceSection.querySelectorAll('.stat-trend');
                perfTrends.forEach(trend => trend.textContent = 'Aguardando dados');
                
                // Clear performance chart data
                const chartBars = performanceSection.querySelectorAll('.chart-bar');
                chartBars.forEach(bar => {
                    const fill = bar.querySelector('.chart-fill');
                    const span = bar.querySelector('span');
                    if (fill) fill.style.width = '0%';
                    if (span) span.textContent = '0/10';
                });
                
                // Clear trend data
                const trendPoints = performanceSection.querySelectorAll('.trend-point');
                trendPoints.forEach(point => point.remove());
                
                // Reset trend containers
                const trendLines = performanceSection.querySelectorAll('.trend-line');
                trendLines.forEach(line => {
                    line.innerHTML = '<div style="text-align: center; padding: 2rem; color: #6c757d;">Dados hist√≥ricos ser√£o exibidos ap√≥s avalia√ß√µes</div>';
                });
                
                // Clear performance insights and all colored divs
                const coloredDivs = performanceSection.querySelectorAll('div[style*="color"], span[style*="color"]');
                coloredDivs.forEach(div => {
                    if (div.textContent.includes('Crescimento') || div.textContent.includes('%') || div.textContent.match(/\d+(\.\d+)?%/)) {
                        div.textContent = 'Aguardando dados';
                        div.style.color = '#6c757d';
                    }
                });
            }
        }
        
        function clearFictionalEmployees() {
            // List of fictional names to remove
            const fictionalNames = ['Jo√£o Silva', 'Maria Santos', 'Pedro Oliveira', 'Ana Costa', 'Carlos Mendes', 'Lucia Fernandez'];
            
            // Remove from entire document
            fictionalNames.forEach(name => {
                const elements = document.querySelectorAll('*');
                elements.forEach(el => {
                    if (el.innerHTML && el.innerHTML.includes(name) && !el.classList.contains('table-header-row')) {
                        // If it's a table row, remove the entire row
                        if (el.classList.contains('table-grid') && !el.classList.contains('table-header-row')) {
                            el.remove();
                        } 
                        // If it's a card with employee data, replace content
                        else if (el.classList.contains('card')) {
                            const title = el.querySelector('h4');
                            el.innerHTML = '';
                            if (title) el.appendChild(title);
                            const emptyMsg = document.createElement('div');
                            emptyMsg.style.cssText = 'text-align: center; padding: 2rem; color: #6c757d;';
                            emptyMsg.textContent = 'Nenhum dado dispon√≠vel';
                            el.appendChild(emptyMsg);
                        }
                    }
                });
            });
        }
        
        function clearAllSectionsData() {
            // Clear request types sample data
            clearRequestTypesData();
            
            // Clear approval requests
            const approvalCards = document.querySelectorAll('#aprovacoes .card:not(.card-white)');
            approvalCards.forEach(card => {
                if (card.innerHTML.includes('Solicita√ß√£o') || card.innerHTML.includes('Jo√£o') || card.innerHTML.includes('Ana')) {
                    card.innerHTML = '<div style="text-align: center; padding: 2rem; color: #6c757d;">Nenhuma aprova√ß√£o pendente</div>';
                }
            });
            
            // Clear reports data
            const reportCards = document.querySelectorAll('#relatorios .card');
            reportCards.forEach(card => {
                if (card.innerHTML.includes('Janeiro:') || card.innerHTML.includes('F√©rias (45%)')) {
                    const title = card.querySelector('h4');
                    card.innerHTML = '';
                    if (title) card.appendChild(title);
                    const emptyMsg = document.createElement('div');
                    emptyMsg.style.cssText = 'text-align: center; padding: 2rem; color: #6c757d;';
                    emptyMsg.textContent = 'Dados ser√£o exibidos ap√≥s cadastros';
                    card.appendChild(emptyMsg);
                }
            });
            
            // Clear departments sample data - more comprehensive approach
            clearDepartmentsData();
        }
        
        function clearRequestTypesData() {
            // Clear request types cards
            const requestTypeCards = document.querySelectorAll('#tipos-requisicoes #list .card:not(#form)');
            requestTypeCards.forEach(card => {
                if (card.innerHTML.includes('Solicita√ß√£o de F√©rias') || 
                    card.innerHTML.includes('Reembolso de Despesas') || 
                    card.innerHTML.includes('Solicita√ß√£o de Material')) {
                    card.remove();
                }
            });
            
            // Add empty message for request types
            const requestTypesListDiv = document.querySelector('#tipos-requisicoes #list');
            if (requestTypesListDiv && !requestTypesListDiv.querySelector('.card:not(#form)')) {
                const emptyMsg = document.createElement('div');
                emptyMsg.style.cssText = 'text-align: center; padding: 2rem; color: #6c757d;';
                emptyMsg.textContent = 'Nenhum tipo de requisi√ß√£o cadastrado ainda';
                requestTypesListDiv.appendChild(emptyMsg);
            }
        }
        
        function clearDepartmentsData() {
            // Clear all department table rows that are not headers
            const deptRows = document.querySelectorAll('#departamentos-list .table-grid:not(.table-header-row)');
            deptRows.forEach(row => {
                // Remove any row that contains department data
                if (row.textContent.includes('TI') || 
                    row.textContent.includes('RH') || 
                    row.textContent.includes('Financeiro') ||
                    row.textContent.includes('Tecnologia') ||
                    row.textContent.includes('Recursos Humanos') ||
                    row.textContent.includes('Jo√£o') ||
                    row.textContent.includes('Maria') ||
                    row.textContent.includes('Pedro')) {
                    row.remove();
                }
            });
            
            // Add empty message if no departments remain
            const deptContainer = document.querySelector('#departamentos-list');
            if (deptContainer) {
                const remainingRows = deptContainer.querySelectorAll('.table-grid:not(.table-header-row)');
                if (remainingRows.length === 0) {
                    const emptyMsg = document.createElement('div');
                    emptyMsg.style.cssText = 'text-align: center; padding: 2rem; color: #6c757d;';
                    emptyMsg.textContent = 'Nenhum departamento cadastrado ainda';
                    deptContainer.appendChild(emptyMsg);
                }
            }
        }

        // Field Toggle Function for Privacy
        function toggleField(fieldType, employeeId, realValue) {
            const hiddenElement = document.getElementById(`${fieldType}-hidden-${employeeId}`);
            const visibleElement = document.getElementById(`${fieldType}-${employeeId}`);
            const button = event.target;
            
            if (hiddenElement && visibleElement) {
                if (hiddenElement.style.display !== 'none') {
                    // Mostrar valor real
                    hiddenElement.style.display = 'none';
                    visibleElement.style.display = 'inline';
                    button.textContent = 'üôà';
                    button.title = 'Ocultar';
                    
                    // Auto-hide after 3 seconds for security
                    setTimeout(() => {
                        if (button.textContent === 'üôà') {
                            hiddenElement.style.display = 'inline';
                            visibleElement.style.display = 'none';
                            button.textContent = 'üëÅÔ∏è';
                            button.title = 'Mostrar';
                        }
                    }, 3000);
                } else {
                    // Ocultar valor
                    hiddenElement.style.display = 'inline';
                    visibleElement.style.display = 'none';
                    button.textContent = 'üëÅÔ∏è';
                    button.title = 'Mostrar';
                }
            }
        }

        // Employee Search Functions
        let allEmployeesData = [];

        function searchEmployees(searchTerm) {
            const searchLower = searchTerm.toLowerCase().trim();
            const container = document.getElementById('funcionarios-list');
            const resultCount = document.getElementById('search-results-count');
            
            if (!container || !allEmployeesData.length) return;
            
            if (!searchTerm) {
                // Show all employees
                displayFilteredEmployees(allEmployeesData);
                resultCount.textContent = '';
                return;
            }
            
            // Filter employees based on search term
            const filteredEmployees = allEmployeesData.filter(employee => {
                return (
                    (employee.name && employee.name.toLowerCase().includes(searchLower)) ||
                    (employee.email && employee.email.toLowerCase().includes(searchLower)) ||
                    (employee.position && employee.position.toLowerCase().includes(searchLower)) ||
                    (employee.employee_code && employee.employee_code.toLowerCase().includes(searchLower))
                );
            });
            
            displayFilteredEmployees(filteredEmployees);
            
            // Update result count
            if (filteredEmployees.length === 0) {
                resultCount.textContent = `‚ùå Nenhum funcion√°rio encontrado para "${searchTerm}"`;
                resultCount.style.color = '#dc3545';
            } else if (filteredEmployees.length === 1) {
                resultCount.textContent = `‚úÖ 1 funcion√°rio encontrado`;
                resultCount.style.color = '#28a745';
            } else {
                resultCount.textContent = `‚úÖ ${filteredEmployees.length} funcion√°rios encontrados`;
                resultCount.style.color = '#28a745';
            }
        }

        function displayFilteredEmployees(employees) {
            const container = document.getElementById('funcionarios-list');
            if (!container) return;
            
            if (employees.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: #6c757d; background: white; border-radius: 8px; margin: 1rem 0;">
                        üîç Nenhum funcion√°rio encontrado com os crit√©rios de pesquisa
                    </div>
                `;
                return;
            }
            
            let html = '';
            employees.forEach((employee, index) => {
                const salary = employee.salary ? 
                    `R$ ${parseFloat(employee.salary).toLocaleString('pt-BR', {minimumFractionDigits: 2})}` : 
                    'N√£o informado';
                
                const employeeId = employee.id.substring(0, 8);
                html += `
                    <div class="employee-row" style="
                        display: grid; 
                        grid-template-columns: 50px 2fr 1fr 1fr 100px 100px; 
                        gap: 1rem; 
                        padding: 1rem; 
                        margin: 5px 0;
                        background: white !important; 
                        border: 1px solid #ddd;
                        border-radius: 8px;
                        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                        align-items: center;
                    ">
                        <span style="display: flex; align-items: center; justify-content: center;">
                            <input type="checkbox" class="employee-checkbox" data-employee-id="${employee.id}" data-employee-name="${employee.name}" data-action="updateDeleteButton" style="cursor: pointer;">
                        </span>
                        <span style="color: #333; font-size: 14px;">
                            <strong style="color: #000;">${employee.name || 'Nome n√£o informado'}</strong><br>
                            <small style="color: #666; display: flex; align-items: center; gap: 5px;">
                                <span id="email-${employeeId}" style="display: none;">${employee.email || 'Email n√£o informado'}</span>
                                <span id="email-hidden-${employeeId}" style="color: #999;">***@***.com</span>
                                <button data-action="toggleField" data-field="email" data-employee-id="\${employeeId}" data-value="\${employee.email || 'Email n√£o informado'}" style="
                                    background: none; 
                                    border: none; 
                                    cursor: pointer; 
                                    font-size: 12px; 
                                    color: #666;
                                    padding: 2px;
                                ">üëÅÔ∏è</button>
                            </small>
                        </span>
                        <span style="color: #333; font-size: 14px;">${employee.position || 'N√£o informado'}</span>
                        <span style="font-weight: bold; color: #28a745; font-size: 14px; display: flex; align-items: center; gap: 5px;">
                            <span id="salary-${employeeId}" style="display: none;">${salary}</span>
                            <span id="salary-hidden-${employeeId}" style="color: #999;">R$ ***,**</span>
                            <button data-action="toggleField" data-field="salary" data-employee-id="\${employeeId}" data-value="\${salary}" style="
                                background: none; 
                                border: none; 
                                cursor: pointer; 
                                font-size: 12px; 
                                color: #28a745;
                                padding: 2px;
                            ">üëÅÔ∏è</button>
                        </span>
                        <span style="padding: 0.25rem 0.5rem; border-radius: 4px; background-color: #28a745; color: white; font-size: 0.75rem; text-align: center; font-weight: bold;">ATIVO</span>
                        <span>
                            <button style="
                                padding: 0.5rem 1rem; 
                                font-size: 12px; 
                                background: #007bff; 
                                color: white; 
                                border: none; 
                                border-radius: 4px; 
                                cursor: pointer;
                                font-weight: bold;
                            " data-action="toggleEmployeeDetails" data-employee-id="\${employeeId}" data-employee-name="\${employee.name}" data-employee-position="\${employee.position}" data-salary="\${salary}" data-email="\${employee.email}" data-hire-date="\${employee.hire_date}" data-employee-code="\${employee.employee_code}">VER</button>
                        </span>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function clearSearch() {
            const searchInput = document.getElementById('employee-search');
            const resultCount = document.getElementById('search-results-count');
            
            if (searchInput) {
                searchInput.value = '';
                searchEmployees('');
            }
            if (resultCount) {
                resultCount.textContent = '';
            }
            
            // Add visual feedback
            if (searchInput) {
                searchInput.style.backgroundColor = '#e8f5e8';
                setTimeout(() => {
                    searchInput.style.backgroundColor = '';
                }, 300);
            }
        }

        // Employee Details Toggle Function
        function toggleEmployeeDetails(employeeId, name, position, salary, email, hireDate, employeeCode) {
            // Check if details are already showing
            const existingDetails = document.getElementById(`details-${employeeId}`);
            
            if (existingDetails) {
                // Hide existing details with animation
                existingDetails.style.animation = 'slideUp 0.3s ease-out';
                setTimeout(() => existingDetails.remove(), 300);
                return;
            }
            
            // Hide all other open details first
            document.querySelectorAll('[id^="details-"]').forEach(detail => {
                detail.style.animation = 'slideUp 0.3s ease-out';
                setTimeout(() => detail.remove(), 200);
            });
            
            // Create details card
            const employeeRow = document.querySelector(`#email-${employeeId}`).closest('.employee-row');
            const detailsCard = document.createElement('div');
            detailsCard.id = `details-${employeeId}`;
            detailsCard.style.cssText = `
                grid-column: 1 / -1;
                background: #f8f9fa;
                border: 1px solid #dee2e6;
                border-radius: 8px;
                padding: 1.5rem;
                margin: 1rem 0;
                animation: slideDown 0.3s ease-out;
                box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            `;
            
            // Format hire date
            const formattedHireDate = hireDate ? new Date(hireDate).toLocaleDateString('pt-BR') : 'N√£o informado';
            
            detailsCard.innerHTML = `
                <div style="display: flex; justify-content: between; align-items: start; margin-bottom: 1rem;">
                    <h5 style="margin: 0; color: #495057; display: flex; align-items: center; gap: 10px;">
                        üë§ Detalhes do Funcion√°rio
                        <button data-action="removeEmployeeDetails" data-employee-id="\${employeeId}" style="
                            background: #dc3545;
                            color: white;
                            border: none;
                            border-radius: 50%;
                            width: 25px;
                            height: 25px;
                            cursor: pointer;
                            font-size: 12px;
                            margin-left: auto;
                        ">‚úï</button>
                    </h5>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                    <div>
                        <div style="margin-bottom: 1rem;">
                            <strong style="color: #495057; display: block; margin-bottom: 5px;">üìõ Nome Completo:</strong>
                            <span style="color: #6c757d;">${name}</span>
                        </div>
                        
                        <div style="margin-bottom: 1rem;">
                            <strong style="color: #495057; display: block; margin-bottom: 5px;">üìß Email:</strong>
                            <span style="color: #6c757d;">${email}</span>
                        </div>
                        
                        <div style="margin-bottom: 1rem;">
                            <strong style="color: #495057; display: block; margin-bottom: 5px;">üíº Cargo:</strong>
                            <span style="color: #6c757d;">${position}</span>
                        </div>
                    </div>
                    
                    <div>
                        <div style="margin-bottom: 1rem;">
                            <strong style="color: #495057; display: block; margin-bottom: 5px;">üí∞ Sal√°rio:</strong>
                            <span style="color: #28a745; font-weight: bold;">${salary}</span>
                        </div>
                        
                        <div style="margin-bottom: 1rem;">
                            <strong style="color: #495057; display: block; margin-bottom: 5px;">üìÖ Data de Admiss√£o:</strong>
                            <span style="color: #6c757d;">${formattedHireDate}</span>
                        </div>
                        
                        <div style="margin-bottom: 1rem;">
                            <strong style="color: #495057; display: block; margin-bottom: 5px;">üÜî C√≥digo:</strong>
                            <span style="color: #6c757d; font-family: monospace;">${employeeCode}</span>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 1.5rem; text-align: center;">
                    <button data-action="showDevAlert" data-message="Funcionalidade de edi√ß√£o em desenvolvimento!" style="
                        background: #007bff;
                        color: white;
                        border: none;
                        padding: 0.5rem 1rem;
                        border-radius: 5px;
                        cursor: pointer;
                        margin-right: 10px;
                        font-size: 12px;
                    ">‚úèÔ∏è Editar</button>
                    
                    <button data-action="showDevAlert" data-message="Funcionalidade de relat√≥rio em desenvolvimento!" style="
                        background: #28a745;
                        color: white;
                        border: none;
                        padding: 0.5rem 1rem;
                        border-radius: 5px;
                        cursor: pointer;
                        font-size: 12px;
                    ">üìä Relat√≥rio</button>
                </div>
            `;
            
            // Insert details card after the employee row
            employeeRow.parentNode.insertBefore(detailsCard, employeeRow.nextSibling);
        }

        // Employee Selection and Deletion Functions
        function toggleSelectAll() {
            const selectAllCheckbox = document.getElementById('select-all-employees');
            const employeeCheckboxes = document.querySelectorAll('.employee-checkbox');
            
            employeeCheckboxes.forEach(checkbox => {
                checkbox.checked = selectAllCheckbox.checked;
            });
            
            updateDeleteButton();
        }

        function updateDeleteButton() {
            const deleteBtn = document.getElementById('delete-selected-btn');
            const selectedCheckboxes = document.querySelectorAll('.employee-checkbox:checked');
            const selectAllCheckbox = document.getElementById('select-all-employees');
            const allCheckboxes = document.querySelectorAll('.employee-checkbox');
            
            if (selectedCheckboxes.length > 0) {
                deleteBtn.style.display = 'block';
                deleteBtn.textContent = `üóëÔ∏è Excluir Selecionados (${selectedCheckboxes.length})`;
            } else {
                deleteBtn.style.display = 'none';
            }
            
            // Update select all checkbox state
            if (allCheckboxes.length > 0) {
                if (selectedCheckboxes.length === allCheckboxes.length) {
                    selectAllCheckbox.checked = true;
                    selectAllCheckbox.indeterminate = false;
                } else if (selectedCheckboxes.length > 0) {
                    selectAllCheckbox.checked = false;
                    selectAllCheckbox.indeterminate = true;
                } else {
                    selectAllCheckbox.checked = false;
                    selectAllCheckbox.indeterminate = false;
                }
            }
        }

        async function deleteSelectedEmployees() {
            const selectedCheckboxes = document.querySelectorAll('.employee-checkbox:checked');
            
            if (selectedCheckboxes.length === 0) {
                showStatus('Nenhum funcion√°rio selecionado!', 'warning');
                return;
            }
            
            // Get selected employee data
            const selectedEmployees = Array.from(selectedCheckboxes).map(checkbox => ({
                id: checkbox.getAttribute('data-employee-id'),
                name: checkbox.getAttribute('data-employee-name')
            }));
            
            // Confirmation dialog
            const employeeNames = selectedEmployees.map(emp => emp.name).join(', ');
            const confirmMessage = selectedEmployees.length === 1 
                ? `Tem certeza que deseja excluir o funcion√°rio "${employeeNames}"?\\n\\nEsta a√ß√£o n√£o pode ser desfeita!`
                : `Tem certeza que deseja excluir ${selectedEmployees.length} funcion√°rios?\\n\\n${employeeNames}\\n\\nEsta a√ß√£o n√£o pode ser desfeita!`;
            
            if (!confirm(confirmMessage)) {
                return;
            }
            
            const deleteBtn = document.getElementById('delete-selected-btn');
            setButtonLoading(deleteBtn, true);
            
            try {
                console.log('üóëÔ∏è Excluindo funcion√°rios:', selectedEmployees);
                
                // Delete each employee
                const deletePromises = selectedEmployees.map(employee => 
                    fetch(`/api/employees/${employee.id}`, {
                        method: 'DELETE',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    })
                );
                
                const responses = await Promise.all(deletePromises);
                const results = await Promise.all(responses.map(r => r.json()));
                
                // Check if all deletions were successful
                const failed = results.filter(result => !result.success);
                
                if (failed.length === 0) {
                    showStatus(`${selectedEmployees.length} funcion√°rio(s) exclu√≠do(s) com sucesso!`, 'success');
                    showHint('Funcion√°rios removidos da base de dados!');
                    
                    // Reload employee list
                    setTimeout(() => {
                        loadEmployeesData();
                        setButtonLoading(deleteBtn, false);
                    }, 800);
                } else {
                    throw new Error(`Falha ao excluir ${failed.length} funcion√°rio(s)`);
                }
                
            } catch (error) {
                console.error('‚ùå Erro ao excluir funcion√°rios:', error);
                showStatus('Erro ao excluir funcion√°rios: ' + error.message, 'error');
                setButtonLoading(deleteBtn, false);
            }
        }

        // Employee Search Functions for Request Form
        let employeeSearchData = [];
        let selectedEmployeeId = null;

        async function loadEmployeesForSearch() {
            try {
                const response = await fetchWithAuth('/api/employees');
                const data = await response.json();
                if (data.success && data.data) {
                    employeeSearchData = data.data;
                    console.log('üìã Funcion√°rios carregados para pesquisa:', employeeSearchData.length);
                }
            } catch (error) {
                console.error('‚ùå Erro ao carregar funcion√°rios para pesquisa:', error);
            }
        }

        function searchEmployees(searchTerm) {
            if (!searchTerm || searchTerm.length < 2) {
                hideEmployeeDropdown();
                return;
            }

            const filtered = employeeSearchData.filter(emp => 
                emp.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                emp.employee_code.toLowerCase().includes(searchTerm.toLowerCase())
            );

            showEmployeeResults(filtered);
        }

        function showEmployeeResults(employees) {
            const dropdown = document.getElementById('employee-dropdown');
            if (!dropdown) return;

            if (employees.length === 0) {
                dropdown.innerHTML = '<div style="padding: 8px; color: #666;">Nenhum funcion√°rio encontrado</div>';
            } else {
                dropdown.innerHTML = employees.map(emp => `
                    <div style="
                        padding: 8px 12px; 
                        cursor: pointer; 
                        border-bottom: 1px solid #eee;
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                    " onmousedown="selectEmployee('${emp.id}', '${emp.name.replace(/'/g, '\\\'')}')" 
                       onmouseover="this.style.background='#f5f5f5'" 
                       onmouseout="this.style.background='white'">
                        <span>
                            <strong>${emp.name}</strong><br>
                            <small style="color: #666;">${emp.position || 'Posi√ß√£o n√£o definida'} - ${emp.employee_code}</small>
                        </span>
                    </div>
                `).join('');
            }
            dropdown.style.display = 'block';
        }

        function selectEmployee(employeeId, employeeName) {
            document.getElementById('reqFuncionarioSearch').value = employeeName;
            document.getElementById('reqFuncionario').value = employeeId;
            selectedEmployeeId = employeeId;
            hideEmployeeDropdown();
        }

        function showEmployeeDropdown() {
            loadEmployeesForSearch();
            if (employeeSearchData.length > 0) {
                showEmployeeResults(employeeSearchData);
            }
        }

        function hideEmployeeDropdown() {
            setTimeout(() => {
                const dropdown = document.getElementById('employee-dropdown');
                if (dropdown) dropdown.style.display = 'none';
            }, 200);
        }

        // Request Management Functions
        let allRequestsData = [];

        // Fun√ß√£o auxiliar para requisi√ß√µes autenticadas
        async function fetchWithAuth(url, options = {}) {
            const token = localStorage.getItem('authToken');
            const headers = {
                'Content-Type': 'application/json',
                ...options.headers
            };
            
            if (token) {
                headers['Authorization'] = `Bearer ${token}`;
            }
            
            return fetch(url, {
                ...options,
                headers
            });
        }

        async function loadRequestsData() {
            try {
                console.log('üìã Carregando requisi√ß√µes da API... 2');
                const response = await fetchWithAuth('/api/requests');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('üìä Dados de requisi√ß√µes recebidos:', data);
                
                allRequestsData = data.requests || [];
                displayRequests(allRequestsData);
                
            } catch (error) {
                console.error('‚ùå Erro ao carregar requisi√ß√µes:', error);
                const container = document.getElementById('requests-list');
                if (container) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 2rem; color: #dc3545;">
                            ‚ùå Erro ao carregar requisi√ß√µes: ${error.message}
                        </div>
                    `;
                }
            }
        }

        function displayRequests(requests) {
            const container = document.getElementById('requests-list');
            const countDiv = document.getElementById('request-results-count');
            
            if (!container) return;

            if (requests.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: #666;">
                        üìã Nenhuma requisi√ß√£o encontrada
                    </div>
                `;
                if (countDiv) countDiv.textContent = '';
                return;
            }

            // Update count
            if (countDiv) {
                countDiv.textContent = `${requests.length} requisi√ß√£o(s) encontrada(s)`;
            }

            let html = '';
            requests.forEach(request => {
                const statusClass = {
                    'pending': 'status-warning',
                    'approved': 'status-success',
                    'rejected': 'status-danger',
                    'cancelled': 'status-secondary'
                }[request.status] || 'status-secondary';

                const statusText = {
                    'pending': 'Pendente',
                    'approved': 'Aprovada',
                    'rejected': 'Rejeitada',
                    'cancelled': 'Cancelada'
                }[request.status] || request.status;

                const requestDate = new Date(request.created_at).toLocaleDateString('pt-BR');

                html += `
                    <div class="table-grid">
                        <span>${request.employee_name || 'Funcion√°rio n√£o encontrado'}</span>
                        <span>${request.request_type_name || request.title || 'Tipo n√£o definido'}</span>
                        <span>${requestDate}</span>
                        <span class="status ${statusClass}">${statusText}</span>
                        <button class="btn btn-secondary" data-action="viewRequest" data-request-id="\${request.id}">Ver</button>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function filterRequests(searchTerm) {
            if (!searchTerm) {
                displayRequests(allRequestsData);
                return;
            }

            const filtered = allRequestsData.filter(request => 
                (request.employee_name && request.employee_name.toLowerCase().includes(searchTerm.toLowerCase())) ||
                (request.title && request.title.toLowerCase().includes(searchTerm.toLowerCase())) ||
                (request.request_type_name && request.request_type_name.toLowerCase().includes(searchTerm.toLowerCase())) ||
                (request.status && request.status.toLowerCase().includes(searchTerm.toLowerCase()))
            );

            displayRequests(filtered);
        }

        function viewRequest(requestId) {
            console.log('üîç Visualizar requisi√ß√£o:', requestId);
            
            // Find the request in our data
            const request = allRequestsData.find(r => r.id === requestId);
            if (!request) {
                showStatus('Requisi√ß√£o n√£o encontrada', 'error');
                return;
            }
            
            showRequestModal(request);
        }

        function showRequestModal(request) {
            // Remove existing modal if any
            const existingModal = document.getElementById('request-modal');
            if (existingModal) existingModal.remove();
            
            // Format dates
            const createdDate = new Date(request.created_at).toLocaleDateString('pt-BR');
            const submittedDate = new Date(request.submitted_at).toLocaleDateString('pt-BR');
            const startDate = request.data?.start_date ? new Date(request.data.start_date).toLocaleDateString('pt-BR') : 'N√£o informado';
            
            // Status styling
            const statusClass = {
                'pending': 'status-warning',
                'approved': 'status-success',
                'rejected': 'status-danger',
                'cancelled': 'status-secondary'
            }[request.status] || 'status-secondary';
            
            const statusText = {
                'pending': 'Pendente',
                'approved': 'Aprovada',
                'rejected': 'Rejeitada',
                'cancelled': 'Cancelada'
            }[request.status] || request.status;
            
            // Priority styling
            const priorityClass = {
                'low': 'status-secondary',
                'normal': 'status-info',
                'high': 'status-warning',
                'urgent': 'status-danger'
            }[request.priority] || 'status-info';
            
            const priorityText = {
                'low': 'Baixa',
                'normal': 'Normal',
                'high': 'Alta',
                'urgent': 'Urgente'
            }[request.priority] || request.priority;
            
            const modalHTML = `
                <div id="request-modal" style="
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.5);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 1000;
                " data-action="closeRequestModal">
                    <div style="
                        background: white;
                        padding: 2rem;
                        border-radius: 8px;
                        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
                        max-width: 600px;
                        width: 90%;
                        max-height: 80vh;
                        overflow-y: auto;
                    " data-action="stopPropagation">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                            <h3 style="margin: 0; color: #1a365d;">Detalhes da Requisi√ß√£o</h3>
                            <button data-action="closeRequestModal" style="
                                background: none;
                                border: none;
                                font-size: 24px;
                                cursor: pointer;
                                color: #666;
                            ">&times;</button>
                        </div>
                        
                        <div style="display: grid; gap: 1rem;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <div>
                                    <label style="font-weight: bold; color: #333;">Funcion√°rio:</label>
                                    <p style="margin: 0.5rem 0;">${request.employee_name || 'N√£o informado'}</p>
                                </div>
                                <div>
                                    <label style="font-weight: bold; color: #333;">Tipo:</label>
                                    <p style="margin: 0.5rem 0;">${request.request_type_name || 'N√£o informado'}</p>
                                </div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <div>
                                    <label style="font-weight: bold; color: #333;">Status:</label>
                                    <p style="margin: 0.5rem 0;"><span class="status ${statusClass}">${statusText}</span></p>
                                </div>
                                <div>
                                    <label style="font-weight: bold; color: #333;">Prioridade:</label>
                                    <p style="margin: 0.5rem 0;"><span class="status ${priorityClass}">${priorityText}</span></p>
                                </div>
                            </div>
                            
                            <div>
                                <label style="font-weight: bold; color: #333;">T√≠tulo:</label>
                                <p style="margin: 0.5rem 0;">${request.title || request.data?.title || 'N√£o informado'}</p>
                            </div>
                            
                            <div>
                                <label style="font-weight: bold; color: #333;">Descri√ß√£o:</label>
                                <p style="margin: 0.5rem 0; background: #f8f9fa; padding: 1rem; border-radius: 4px; border-left: 3px solid #007bff;">
                                    ${request.description || request.data?.description || 'Nenhuma descri√ß√£o fornecida'}
                                </p>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
                                <div>
                                    <label style="font-weight: bold; color: #333;">Data de Cria√ß√£o:</label>
                                    <p style="margin: 0.5rem 0;">${createdDate}</p>
                                </div>
                                <div>
                                    <label style="font-weight: bold; color: #333;">Data de Submiss√£o:</label>
                                    <p style="margin: 0.5rem 0;">${submittedDate}</p>
                                </div>
                                <div>
                                    <label style="font-weight: bold; color: #333;">Data de In√≠cio:</label>
                                    <p style="margin: 0.5rem 0;">${startDate}</p>
                                </div>
                            </div>
                            
                            <div style="background: #f8f9fa; padding: 1rem; border-radius: 4px; margin-top: 1rem;">
                                <label style="font-weight: bold; color: #333;">ID da Requisi√ß√£o:</label>
                                <p style="margin: 0.5rem 0; font-family: monospace; font-size: 12px; color: #666;">${request.id}</p>
                            </div>
                        </div>
                        
                        <div style="margin-top: 2rem; display: flex; gap: 1rem; justify-content: flex-end;">
                            ${request.status === 'pending' ? `
                                <button class="btn btn-success" data-action="approveRequest" data-request-id="\${request.id}">‚úÖ Aprovar</button>
                                <button class="btn btn-danger" data-action="rejectRequest" data-request-id="\${request.id}">‚ùå Rejeitar</button>
                            ` : ''}
                            <button class="btn btn-secondary" data-action="closeRequestModal">Fechar</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            
            // Add animation
            const modal = document.getElementById('request-modal');
            modal.style.opacity = '0';
            setTimeout(() => {
                modal.style.opacity = '1';
                modal.style.transition = 'opacity 0.3s ease';
            }, 10);
        }

        function closeRequestModal(event) {
            if (event && event.target !== event.currentTarget) return;
            
            const modal = document.getElementById('request-modal');
            if (modal) {
                modal.style.opacity = '0';
                setTimeout(() => modal.remove(), 300);
            }
        }

        function approveRequest(requestId) {
            if (confirm('Tem certeza que deseja aprovar esta requisi√ß√£o?')) {
                showStatus('Funcionalidade de aprova√ß√£o em desenvolvimento', 'info');
                console.log('‚úÖ Aprovar requisi√ß√£o:', requestId);
            }
        }

        function rejectRequest(requestId) {
            const reason = prompt('Motivo da rejei√ß√£o (opcional):');
            if (reason !== null) {
                showStatus('Funcionalidade de rejei√ß√£o em desenvolvimento', 'info');
                console.log('‚ùå Rejeitar requisi√ß√£o:', requestId, 'Motivo:', reason);
            }
        }

        function showAddRequestTypeModal() {
            // Remove existing modal if any
            const existingModal = document.getElementById('add-request-type-modal');
            if (existingModal) existingModal.remove();
            
            const modalHTML = `
                <div id="add-request-type-modal" style="
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.5);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 1001;
                " data-action="closeAddRequestTypeModal">
                    <div style="
                        background: white;
                        padding: 2rem;
                        border-radius: 8px;
                        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
                        max-width: 500px;
                        width: 90%;
                    " data-action="stopPropagation">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                            <h3 style="margin: 0; color: #1a365d;">Novo Tipo de Requisi√ß√£o</h3>
                            <button data-action="closeAddRequestTypeModal" style="
                                background: none;
                                border: none;
                                font-size: 24px;
                                cursor: pointer;
                                color: #666;
                            ">&times;</button>
                        </div>
                        
                        <div style="display: grid; gap: 1rem;">
                            <div>
                                <label style="font-weight: bold; color: #333; display: block; margin-bottom: 0.5rem;">Nome do Tipo:</label>
                                <input type="text" id="newRequestTypeName" placeholder="Ex: Licen√ßa Paternidade" style="
                                    width: 100%;
                                    padding: 0.75rem;
                                    border: 2px solid #ddd;
                                    border-radius: 4px;
                                    font-size: 14px;
                                    box-sizing: border-box;
                                ">
                            </div>
                            
                            <div>
                                <label style="font-weight: bold; color: #333; display: block; margin-bottom: 0.5rem;">Descri√ß√£o:</label>
                                <textarea id="newRequestTypeDescription" placeholder="Descri√ß√£o do tipo de requisi√ß√£o..." style="
                                    width: 100%;
                                    padding: 0.75rem;
                                    border: 2px solid #ddd;
                                    border-radius: 4px;
                                    font-size: 14px;
                                    box-sizing: border-box;
                                    min-height: 80px;
                                    resize: vertical;
                                "></textarea>
                            </div>
                            
                            <div>
                                <label style="font-weight: bold; color: #333; display: block; margin-bottom: 0.5rem;">Categoria:</label>
                                <div style="display: flex; gap: 0.5rem; align-items: stretch;">
                                    <select id="newRequestTypeCategory" style="
                                        flex: 1;
                                        padding: 0.75rem;
                                        border: 2px solid #ddd;
                                        border-radius: 4px;
                                        font-size: 14px;
                                        box-sizing: border-box;
                                    ">
                                        <option value="Geral">Geral</option>
                                        <option value="F√©rias">F√©rias</option>
                                        <option value="Licen√ßa">Licen√ßa</option>
                                        <option value="Reembolso">Reembolso</option>
                                        <option value="Material">Material</option>
                                        <option value="Capacita√ß√£o">Capacita√ß√£o</option>
                                    </select>
                                    <button type="button" data-action="showAddCategoryModal" style="
                                        padding: 0.75rem 1rem;
                                        background: #28a745;
                                        color: white;
                                        border: none;
                                        border-radius: 4px;
                                        cursor: pointer;
                                        font-size: 16px;
                                        font-weight: bold;
                                        min-width: 45px;
                                        display: flex;
                                        align-items: center;
                                        justify-content: center;
                                    " title="Adicionar nova categoria">+</button>
                                </div>
                            </div>
                            
                            <div>
                                <label style="font-weight: bold; color: #333; display: block; margin-bottom: 0.5rem;">
                                    <input type="checkbox" id="newRequestTypeApproval" style="margin-right: 0.5rem;">
                                    Requer aprova√ß√£o
                                </label>
                            </div>
                        </div>
                        
                        <div style="margin-top: 2rem; display: flex; gap: 1rem; justify-content: flex-end;">
                            <button class="btn btn-secondary" data-action="closeAddRequestTypeModal">Cancelar</button>
                            <button class="btn btn-primary" data-action="saveNewRequestType">Criar Tipo</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            
            // Add animation and focus
            const modal = document.getElementById('add-request-type-modal');
            modal.style.opacity = '0';
            setTimeout(() => {
                modal.style.opacity = '1';
                modal.style.transition = 'opacity 0.3s ease';
                document.getElementById('newRequestTypeName').focus();
            }, 10);
        }

        function closeAddRequestTypeModal(event) {
            if (event && event.target !== event.currentTarget) return;
            
            const modal = document.getElementById('add-request-type-modal');
            if (modal) {
                modal.style.opacity = '0';
                setTimeout(() => modal.remove(), 300);
            }
        }

        async function saveNewRequestType() {
            const name = document.getElementById('newRequestTypeName').value.trim();
            const description = document.getElementById('newRequestTypeDescription').value.trim();
            const category = document.getElementById('newRequestTypeCategory').value;
            const requiresApproval = document.getElementById('newRequestTypeApproval').checked;
            
            if (!name) {
                showStatus('Nome do tipo √© obrigat√≥rio!', 'warning');
                document.getElementById('newRequestTypeName').focus();
                return;
            }
            
            try {
                const response = await fetchWithAuth('/api/requests/types', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name: name,
                        description: description,
                        category: category,
                        requires_approval: requiresApproval
                    })
                });
                
                const result = await response.json();
                
                if (response.ok && result.success) {
                    showStatus('Novo tipo de requisi√ß√£o criado com sucesso!', 'success');
                    
                    // Add to dropdown
                    const select = document.getElementById('reqTipo');
                    const option = document.createElement('option');
                    option.value = result.data.id;
                    option.textContent = name;
                    select.appendChild(option);
                    select.value = result.data.id;
                    
                    closeAddRequestTypeModal();
                    showHint(`Tipo "${name}" adicionado e selecionado!`);
                } else {
                    throw new Error(result.error || 'Erro ao criar tipo de requisi√ß√£o');
                }
                
            } catch (error) {
                console.error('‚ùå Erro ao criar tipo:', error);
                showStatus('Erro ao criar tipo: ' + error.message, 'danger');
            }
        }

        function showAddCategoryModal() {
            // Remove existing modal if any
            const existingModal = document.getElementById('add-category-modal');
            if (existingModal) existingModal.remove();
            
            const modalHTML = `
                <div id="add-category-modal" style="
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.5);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 1002;
                " data-action="closeAddCategoryModal">
                    <div style="
                        background: white;
                        padding: 2rem;
                        border-radius: 8px;
                        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
                        max-width: 400px;
                        width: 90%;
                    " data-action="stopPropagation">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                            <h3 style="margin: 0; color: #1a365d;">Nova Categoria</h3>
                            <button data-action="closeAddCategoryModal" style="
                                background: none;
                                border: none;
                                font-size: 24px;
                                cursor: pointer;
                                color: #666;
                            ">&times;</button>
                        </div>
                        
                        <div style="display: grid; gap: 1rem;">
                            <div>
                                <label style="font-weight: bold; color: #333; display: block; margin-bottom: 0.5rem;">Nome da Categoria:</label>
                                <input type="text" id="newCategoryName" placeholder="Ex: Benef√≠cios" style="
                                    width: 100%;
                                    padding: 0.75rem;
                                    border: 2px solid #ddd;
                                    border-radius: 4px;
                                    font-size: 14px;
                                    box-sizing: border-box;
                                ">
                            </div>
                            
                            <div>
                                <label style="font-weight: bold; color: #333; display: block; margin-bottom: 0.5rem;">Descri√ß√£o (opcional):</label>
                                <input type="text" id="newCategoryDescription" placeholder="Breve descri√ß√£o da categoria" style="
                                    width: 100%;
                                    padding: 0.75rem;
                                    border: 2px solid #ddd;
                                    border-radius: 4px;
                                    font-size: 14px;
                                    box-sizing: border-box;
                                ">
                            </div>
                        </div>
                        
                        <div style="margin-top: 2rem; display: flex; gap: 1rem; justify-content: flex-end;">
                            <button class="btn btn-secondary" data-action="closeAddCategoryModal">Cancelar</button>
                            <button class="btn btn-success" data-action="saveNewCategory">Criar Categoria</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            
            // Add animation and focus
            const modal = document.getElementById('add-category-modal');
            modal.style.opacity = '0';
            setTimeout(() => {
                modal.style.opacity = '1';
                modal.style.transition = 'opacity 0.3s ease';
                document.getElementById('newCategoryName').focus();
            }, 10);
        }

        function closeAddCategoryModal(event) {
            if (event && event.target !== event.currentTarget) return;
            
            const modal = document.getElementById('add-category-modal');
            if (modal) {
                modal.style.opacity = '0';
                setTimeout(() => modal.remove(), 300);
            }
        }

        function saveNewCategory() {
            const name = document.getElementById('newCategoryName').value.trim();
            const description = document.getElementById('newCategoryDescription').value.trim();
            
            if (!name) {
                showStatus('Nome da categoria √© obrigat√≥rio!', 'warning');
                document.getElementById('newCategoryName').focus();
                return;
            }
            
            // Check if category already exists
            const categorySelect = document.getElementById('newRequestTypeCategory');
            const existingOptions = Array.from(categorySelect.options);
            const categoryExists = existingOptions.some(option => 
                option.value.toLowerCase() === name.toLowerCase()
            );
            
            if (categoryExists) {
                showStatus('Esta categoria j√° existe!', 'warning');
                document.getElementById('newCategoryName').focus();
                return;
            }
            
            // Add new category to the dropdown
            const option = document.createElement('option');
            option.value = name;
            option.textContent = name;
            option.selected = true;
            categorySelect.appendChild(option);
            
            showStatus('Nova categoria criada com sucesso!', 'success');
            closeAddCategoryModal();
            showHint(`Categoria "${name}" adicionada e selecionada!`);
            
            // Store the new category (for future persistence)
            console.log('üìù Nova categoria criada:', { name, description });
        }
        
        // Show floating hints
        function showHint(message, duration = 3000) {
            const existing = document.querySelector('.floating-hint');
            if (existing) existing.remove();
            
            const hint = document.createElement('div');
            hint.className = 'floating-hint';
            hint.textContent = message;
            document.body.appendChild(hint);
            
            setTimeout(() => hint.classList.add('show'), 100);
            setTimeout(() => {
                hint.classList.remove('show');
                setTimeout(() => hint.remove(), 300);
            }, duration);
        }

        async function performLogin() {
            console.log('performLogin chamado!');
            const username = document.getElementById('email').value; // Pode ser email ou username
            const password = document.getElementById('password').value;
            console.log('Email:', username, 'Password:', password);
            const loginBtn = document.getElementById('loginButton');
            
            if (!username || !password) {
                showStatus('Preencha usu√°rio/email e senha!', 'warning');
                document.getElementById('login').classList.add('animate-shake');
                setTimeout(() => document.getElementById('login').classList.remove('animate-shake'), 500);
                return;
            }
            
            // Add loading state
            setButtonLoading(loginBtn, true);
            
            try {
                console.log('üîê Realizando login...');
                console.log('üì° Enviando requisi√ß√£o para /api/auth/login...');
                
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email: username, password })
                });
                
                console.log('üì° Status da resposta:', response.status, response.ok);
                console.log('üì° Headers da resposta:', Object.fromEntries(response.headers.entries()));
                
                if (!response.ok) {
                    console.error('‚ùå Resposta n√£o OK:', response.status, response.statusText);
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                console.log('üì± Resposta completa do servidor:', result);
                console.log('üì± Tipo da resposta:', typeof result);
                console.log('üì± result.success:', result.success);
                
                if (result.success) {
                    console.log('‚úÖ Login bem-sucedido! Processando...');
                    
                    // Salvar token e dados do usu√°rio
                    console.log('üíæ Salvando token:', result.token ? 'PRESENTE' : 'AUSENTE');
                    localStorage.setItem('authToken', result.token);
                    localStorage.setItem('currentUser', JSON.stringify(result.user));
                    
                    // Success animation
                    document.getElementById('login').classList.add('animate-fadeIn');
                    showStatus(`Bem-vindo, ${result.user.name}!`, 'success');
                    
                    console.log('‚è≥ Aguardando 800ms para transi√ß√£o...');
                    setTimeout(() => {
                        console.log('üîÑ Alternando para aplica√ß√£o principal...');
                        document.getElementById('login').style.display = 'none';
                        document.getElementById('app').style.display = 'block';
                        document.getElementById('app').classList.add('animate-fadeIn');
                        
                        console.log('üë§ Inicializando sess√£o do usu√°rio...');
                        // Inicializar sistema com dados do usu√°rio
                        initializeUserSession(result.user);
                        showHint(`Sistema carregado! User: ${result.user.name}`);
                        clearAllSampleData();
                        console.log('‚úÖ Login e transi√ß√£o completos!');
                    }, 800);
                } else {
                    console.error('‚ùå Login falhou:', result.message);
                    setButtonLoading(loginBtn, false);
                    showStatus(result.message || 'Credenciais inv√°lidas!', 'danger');
                    document.getElementById('login').classList.add('animate-shake');
                    setTimeout(() => document.getElementById('login').classList.remove('animate-shake'), 500);
                }
                
            } catch (error) {
                console.error('‚ùå Erro no login:', error);
                setButtonLoading(loginBtn, false);
                showStatus('Erro de conex√£o. Verifique sua internet.', 'danger');
                document.getElementById('login').classList.add('animate-shake');
                setTimeout(() => document.getElementById('login').classList.remove('animate-shake'), 500);
            }
        }

        // Initialize user session after login
        function initializeUserSession(user) {
            console.log('üë§ Inicializando sess√£o do usu√°rio:', user);
            
            // Store user data globally
            window.currentUser = user;
            
            // Update UI based on user permissions
            updateUIForUserPermissions(user);
            
            // Load dashboard data with authentication
            updateDashboardMetrics();
        }
        
        // Update UI based on user groups and permissions
        function updateUIForUserPermissions(user) {
            const hasAdminAccess = user.is_admin || user.role === 'admin';
            const hasHRAccess = user.role === 'admin' || user.role === 'rh';
            const hasDepartmentalAccess = user.role === 'manager';
            
            // Show/hide menu items based on permissions
            const menuItems = document.querySelectorAll('.card[onclick]');
            menuItems.forEach(item => {
                const section = item.getAttribute('onclick').match(/showSection\('(.+?)'\)/)?.[1];
                
                if (section === 'funcionarios' && !hasHRAccess && !hasDepartmentalAccess) {
                    item.style.opacity = '0.5';
                    item.style.pointerEvents = 'none';
                    item.title = 'Sem permiss√£o para acessar';
                }
            });
            
            console.log('üîê Permiss√µes aplicadas:', { hasAdminAccess, hasHRAccess, hasDepartmentalAccess });
        }
        
        // Get authentication headers for API calls
        function getAuthHeaders() {
            const token = localStorage.getItem('authToken');
            return {
                'Content-Type': 'application/json',
                'Authorization': token ? `Bearer ${token}` : ''
            };
        }
        
        function logout() {
            if (confirm('Deseja sair do sistema?')) {
                // Clear stored data
                localStorage.removeItem('authToken');
                localStorage.removeItem('currentUser');
                window.currentUser = null;
                
                // Reset UI
                document.getElementById('login').style.display = 'block';
                document.getElementById('app').style.display = 'none';
                document.getElementById('email').value = 'admin';
                document.getElementById('password').value = '';
                showStatus('Digite suas credenciais para acessar o sistema.', 'info');
                showSection('dashboard');
            }
        }

        function showSection(section) {
            // Hide all sections with fade out
            const sections = ['dashboard', 'funcionarios', 'requisicoes', 'aprovacoes', 'relatorios', 'departamentos', 'cargos', 'self-service', 'performance', 'surveys', 'analytics', 'automations', 'integrations', 'compliance', 'executive', 'admin-users'];
            sections.forEach(s => {
                const el = document.getElementById(s);
                if (el && el.style.display !== 'none') {
                    el.style.opacity = '0';
                    el.style.transform = 'translateX(-20px)';
                    setTimeout(() => el.style.display = 'none', 200);
                }
            });
            
            // Hide main menu if not dashboard
            const mainMenu = document.getElementById('mainMenu');
            if (section === 'dashboard') {
                mainMenu.style.display = 'grid';
                mainMenu.classList.add('animate-fadeIn');
            } else {
                mainMenu.style.display = 'none';
            }
            
            // Show selected section with animation
            setTimeout(() => {
                const targetSection = document.getElementById(section);
                if (targetSection) {
                    targetSection.style.display = 'block';
                    targetSection.classList.add('animate-fadeIn');
                    animateSection(section);
                    
                    // Load real data for sections
                    if (section === 'funcionarios') {
                        setTimeout(() => loadEmployeesData(), 500);
                    } else if (section === 'requisicoes') {
                        setTimeout(() => loadRequestsData(), 500);
                    } else if (section === 'performance') {
                        setTimeout(() => loadPerformanceSection(), 500);
                    } else if (section === 'surveys') {
                        setTimeout(() => loadSurveysSection(), 500);
                    } else if (section === 'departamentos') {
                        setTimeout(() => loadDepartmentsTable(), 500);
                    } else if (section === 'admin-users') {
                        setTimeout(() => loadAdminData(), 500);
                    }
                }
            }, 200);
            
            // Update breadcrumb with animation
            const sectionNames = {
                'dashboard': 'Dashboard',
                'funcionarios': 'Funcion√°rios',
                'requisicoes': 'Requisi√ß√µes',
                'aprovacoes': 'Aprova√ß√µes',
                'relatorios': 'Relat√≥rios',
                'departamentos': 'Departamentos',
                'cargos': 'Consulta CBO',
                'self-service': 'Portal do Colaborador',
                'performance': 'Gest√£o de Performance',
                'surveys': 'Sistema de Pesquisas',
                'analytics': 'Business Analytics',
                'automations': 'Automa√ß√µes e IA',
                'integrations': 'Integra√ß√µes Externas',
                'compliance': 'Compliance e Auditoria',
                'executive': 'Centro de Comando Executivo',
                'admin-users': 'Administra√ß√£o de Usu√°rios'
            };
            
            const breadcrumb = document.getElementById('currentSection');
            breadcrumb.style.opacity = '0';
            setTimeout(() => {
                breadcrumb.textContent = sectionNames[section] || 'Dashboard';
                breadcrumb.style.opacity = '1';
                breadcrumb.style.transition = 'opacity 0.3s ease';
            }, 100);
            
            // Add back button if not dashboard
            if (section !== 'dashboard') {
                setTimeout(() => {
                    const targetDiv = document.getElementById(section);
                    if (targetDiv && !targetDiv.querySelector('.back-to-dashboard')) {
                        const backBtn = document.createElement('button');
                        backBtn.className = 'btn btn-secondary back-to-dashboard mb-1 animate-slideIn';
                        backBtn.onclick = () => {
                            backBtn.classList.add('animate-bounce');
                            setTimeout(() => showSection('dashboard'), 200);
                        };
                        backBtn.textContent = '‚Üê Voltar ao Dashboard';
                        targetDiv.insertBefore(backBtn, targetDiv.firstChild);
                    }
                }, 300);
            }
            
            // Show contextual hints
            const hints = {
                'funcionarios': 'Dica: Use o bot√£o "Novo Funcion√°rio" para cadastrar colaboradores',
                'requisicoes': 'Dica: Clique em "Nova Requisi√ß√£o" para criar solicita√ß√µes',
                'departamentos': 'Dica: Organize sua empresa criando departamentos',
                'cargos': 'Dica: Use a busca para encontrar cargos oficiais da CBO',
                'self-service': 'Dica: Portal onde funcion√°rios podem gerenciar suas pr√≥prias informa√ß√µes',
                'performance': 'Dica: Gerencie avalia√ß√µes de desempenho e metas dos funcion√°rios',
                'surveys': 'Dica: Crie pesquisas an√¥nimas de clima e satisfa√ß√£o para coletar feedback',
                'analytics': 'Dica: Analise dados para tomada de decis√£o estrat√©gica',
                'automations': 'Dica: Configure workflows autom√°ticos e assistente de IA',
                'integrations': 'Dica: Conecte com sistemas externos como ERP e folha de pagamento',
                'compliance': 'Dica: Monitore conformidade LGPD e realize auditorias de seguran√ßa',
                'executive': 'Dica: Dashboard executivo com KPIs estrat√©gicos e insights de C-Level'
            };
            
            if (hints[section]) {
                setTimeout(() => showHint(hints[section]), 1000);
            }
        }

        function showForm() {
            document.getElementById('list').style.display = 'none';
            document.getElementById('form').style.display = 'block';
        }

        function showList() {
            document.getElementById('list').style.display = 'block';
            document.getElementById('form').style.display = 'none';
        }

        function showSubSection(section) {
            if (section === 'nova-requisicao') {
                showNewRequestForm();
            } else if (section === 'novo-funcionario') {
                showNewEmployeeForm();
            } else {
                showStatus(`Funcionalidade "${section}" em desenvolvimento`, 'info');
            }
        }
        // Tornar a fun√ß√£o globalmente acess√≠vel
        window.showSubSection = showSubSection;
        console.log('üìå showSubSection adicionada ao window:', typeof window.showSubSection);

        function showNewRequestForm() {
            console.log('üéØ showNewRequestForm chamada!');
            // Create and show new request form
            const requisicoes = document.getElementById('requisicoes');
            
            if (!requisicoes) {
                console.error('‚ùå Se√ß√£o de requisi√ß√µes n√£o encontrada!');
                showStatus('Por favor, navegue para a se√ß√£o de Requisi√ß√µes primeiro', 'warning');
                return;
            }
            
            // Hide the existing content
            const existingContent = requisicoes.querySelector('.table-container');
            if (existingContent) existingContent.style.display = 'none';
            
            // Remove any existing form
            const existingForm = requisicoes.querySelector('#nova-requisicao-form');
            if (existingForm) existingForm.remove();
            
            // Create new form
            const formHTML = `
                <div id="nova-requisicao-form" class="card card-white">
                    <h4>Nova Requisi√ß√£o</h4>
                    
                    <div class="form-group">
                        <label>Funcion√°rio:</label>
                        <div style="position: relative;">
                            <input type="text" id="reqFuncionarioSearch" placeholder="Digite o nome do funcion√°rio..." 
                                   style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;"
                                   onkeyup="searchEmployees(this.value)" onfocus="showEmployeeDropdown()" onblur="hideEmployeeDropdown()">
                            <div id="employee-dropdown" style="
                                display: none;
                                position: absolute;
                                top: 100%;
                                left: 0;
                                right: 0;
                                background: white;
                                border: 1px solid #ddd;
                                border-top: none;
                                max-height: 200px;
                                overflow-y: auto;
                                z-index: 1000;
                            "></div>
                        </div>
                        <input type="hidden" id="reqFuncionario" />
                    </div>
                    
                    <div class="form-group">
                        <label>Tipo de Requisi√ß√£o:</label>
                        <div style="display: flex; gap: 0.5rem; align-items: stretch;">
                            <select id="reqTipo" style="flex: 1;" onchange="onRequestTypeChange()">
                                <option value="">üîÑ Carregando tipos...</option>
                            </select>
                            <button type="button" data-action="showAddRequestTypeModal" style="
                                padding: 0.75rem 1rem;
                                background: #007bff;
                                color: white;
                                border: none;
                                border-radius: 4px;
                                cursor: pointer;
                                font-size: 16px;
                                font-weight: bold;
                                min-width: 45px;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                            " title="Adicionar novo tipo de requisi√ß√£o">+</button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Descri√ß√£o:</label>
                        <textarea id="reqDescricao" rows="4" placeholder="Descreva a requisi√ß√£o..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>Data de In√≠cio:</label>
                        <input type="date" id="reqDataInicio">
                    </div>
                    
                    <div class="form-group">
                        <label>Data de Fim (opcional):</label>
                        <input type="date" id="reqDataFim">
                    </div>
                    
                    <div class="form-group">
                        <label>Prioridade:</label>
                        <select id="reqPrioridade">
                            <option value="baixa">Baixa</option>
                            <option value="media" selected>M√©dia</option>
                            <option value="alta">Alta</option>
                        </select>
                    </div>
                    
                    <button class="btn btn-success" data-action="saveNewRequest">Salvar Requisi√ß√£o</button>
                    <button class="btn btn-secondary" data-action="cancelNewRequest" style="margin-left: 10px;">Cancelar</button>
                </div>
            `;
            
            requisicoes.insertAdjacentHTML('beforeend', formHTML);
            
            // Carregar tipos de requisi√ß√µes dinamicamente
            loadRequestTypes();
        }
        
        async function loadRequestTypes() {
            try {
                console.log('üìã Carregando tipos de requisi√ß√µes...');
                
                const response = await fetchWithAuth('/api/requests/types');
                const result = await response.json();
                
                const select = document.getElementById('reqTipo');
                if (!select) return;
                
                // Limpar op√ß√µes existentes
                select.innerHTML = '<option value="">Selecione o tipo...</option>';
                
                if (result.success && result.data) {
                    result.data.forEach(type => {
                        const option = document.createElement('option');
                        option.value = type.id;
                        option.textContent = type.name;
                        option.setAttribute('data-category', type.category);
                        select.appendChild(option);
                    });
                    
                    console.log(`‚úÖ ${result.data.length} tipos de requisi√ß√µes carregados`);
                } else {
                    console.error('‚ùå Erro ao carregar tipos:', result.error);
                    select.innerHTML = '<option value="">Erro ao carregar tipos</option>';
                }
                
            } catch (error) {
                console.error('‚ùå Erro na requisi√ß√£o:', error);
                const select = document.getElementById('reqTipo');
                if (select) {
                    select.innerHTML = '<option value="">Erro ao carregar tipos</option>';
                }
            }
        }
        
        async function onRequestTypeChange() {
            console.log('üîÑ onRequestTypeChange chamada');
            
            const select = document.getElementById('reqTipo');
            const selectedValue = select.value;
            
            console.log('üìã Valor selecionado:', selectedValue);
            
            // Esconder/mostrar campos b√°sicos baseado no tipo selecionado
            toggleBasicFields(selectedValue);
            
            if (!selectedValue) {
                // Limpar campos din√¢micos se nenhum tipo selecionado
                console.log('üßπ Limpando campos din√¢micos');
                clearDynamicFields();
                return;
            }
            
            // Buscar detalhes do tipo de requisi√ß√£o selecionado
            try {
                console.log('üìã Carregando campos espec√≠ficos do tipo:', selectedValue);
                
                const response = await fetchWithAuth(`/api/requests/types/${selectedValue}`);
                console.log('üì° Resposta da API recebida:', response.status);
                
                const result = await response.json();
                console.log('üìä Dados da API:', result);
                
                if (result.success && result.data && result.data.form_fields) {
                    const formFields = result.data.form_fields;
                    console.log(`‚úÖ Carregando ${formFields.length} campos espec√≠ficos:`, formFields.slice(0, 3));
                    
                    // Renderizar campos din√¢micos
                    console.log('üé® Iniciando renderiza√ß√£o dos campos din√¢micos');
                    renderDynamicFields(formFields);
                    console.log('‚úÖ Renderiza√ß√£o conclu√≠da');
                } else {
                    console.log('‚ö†Ô∏è Tipo sem campos espec√≠ficos, usando formul√°rio padr√£o');
                    clearDynamicFields();
                }
                
            } catch (error) {
                console.error('‚ùå Erro ao carregar campos espec√≠ficos:', error);
                console.error('Stack trace:', error.stack);
                clearDynamicFields();
            }
        }
        
        function toggleBasicFields(selectedValue) {
            // ID do tipo "Contrata√ß√£o"
            const contratacaoId = '4463c3bf-faf3-4ccb-91ff-e8da6349566e';
            
            // Encontrar todos os campos b√°sicos que devem ser escondidos
            const basicFieldsSelectors = [
                'label[for="reqFuncionarioSearch"]', // Label do funcion√°rio
                '#reqFuncionarioSearch', // Input do funcion√°rio  
                '#employee-dropdown', // Dropdown do funcion√°rio
                'label[for="reqDescricao"]', // Label da descri√ß√£o
                '#reqDescricao', // Textarea da descri√ß√£o
                'label[for="reqDataInicio"]', // Label da data de in√≠cio
                '#reqDataInicio', // Input da data de in√≠cio
                'label[for="reqDataFim"]', // Label da data de fim
                '#reqDataFim', // Input da data de fim
                'label[for="reqPrioridade"]', // Label da prioridade
                '#reqPrioridade' // Select da prioridade
            ];
            
            const isContratacao = selectedValue === contratacaoId;
            
            basicFieldsSelectors.forEach(selector => {
                const element = document.querySelector(selector);
                if (element) {
                    const formGroup = element.closest('.form-group');
                    if (formGroup) {
                        formGroup.style.display = isContratacao ? 'none' : 'block';
                    } else {
                        element.style.display = isContratacao ? 'none' : 'block';
                    }
                }
            });
            
            console.log(isContratacao ? 'üîí Campos b√°sicos escondidos para Contrata√ß√£o' : 'üëÅÔ∏è Campos b√°sicos exibidos');
        }
        
        function clearDynamicFields() {
            const container = document.getElementById('dynamic-fields-container');
            if (container) {
                container.remove();
            }
        }
        
        function normalizeOptions(field) {
            // Fun√ß√£o para normalizar op√ß√µes de campos de m√∫ltipla escolha
            const raw = field.options ?? field.choices ?? field.values ?? field.extra?.options ?? [];
            
            // Se for string, dividir por separadores
            if (typeof raw === 'string') {
                return raw.split(/[,;\n]/)
                    .map(s => s.trim())
                    .filter(s => s)
                    .map(option => ({ label: option, value: option }));
            }
            
            // Se for array
            if (Array.isArray(raw)) {
                return raw.map(option => {
                    if (typeof option === 'string') {
                        return { label: option, value: option };
                    } else if (option && typeof option === 'object') {
                        return {
                            label: String(option.label ?? option.name ?? option.value ?? option.id ?? option),
                            value: String(option.value ?? option.id ?? option.label ?? option.name ?? option)
                        };
                    }
                    return { label: String(option), value: String(option) };
                })
                .filter(opt => opt.label && opt.value)
                .filter((opt, index, arr) => 
                    // Remove duplicatas mantendo a primeira ocorr√™ncia
                    arr.findIndex(o => o.value === opt.value) === index
                );
            }
            
            // Se for objeto (mapa key: label)
            if (raw && typeof raw === 'object' && !Array.isArray(raw)) {
                return Object.entries(raw)
                    .map(([value, label]) => ({
                        label: String(label),
                        value: String(value)
                    }))
                    .filter(opt => opt.label && opt.value);
            }
            
            return [];
        }

        function renderDynamicFields(formFields) {
            try {
                console.log('üé® renderDynamicFields iniciada com', formFields.length, 'campos');
                
                // Limpar campos existentes
                clearDynamicFields();
                
                // Criar container para campos din√¢micos
                const form = document.getElementById('nova-requisicao-form');
                console.log('üìù Formul√°rio encontrado:', !!form);
                
                const existingFields = form.querySelector('.form-group:last-of-type');
                console.log('üîç Campos existentes encontrados:', !!existingFields);
            
            const dynamicContainer = document.createElement('div');
            dynamicContainer.id = 'dynamic-fields-container';
            dynamicContainer.innerHTML = '<h5 style="margin: 1.5rem 0 1rem 0; color: #007bff; border-bottom: 2px solid #007bff; padding-bottom: 0.5rem;">üìã Campos Espec√≠ficos</h5>';
            
            // Agrupar campos por se√ß√£o
            const sections = {};
            formFields.forEach(field => {
                const section = field.section || 'Geral';
                if (!sections[section]) {
                    sections[section] = [];
                }
                sections[section].push(field);
            });
            
            // Renderizar cada se√ß√£o
            Object.keys(sections).forEach(sectionName => {
                const sectionDiv = document.createElement('div');
                sectionDiv.className = 'form-section';
                sectionDiv.style.cssText = `
                    margin-bottom: 2rem;
                    border: 1px solid #e9ecef;
                    border-radius: 8px;
                    padding: 1.5rem;
                    background: #f8f9fa;
                `;
                
                // T√≠tulo da se√ß√£o
                const sectionTitle = document.createElement('h6');
                sectionTitle.textContent = sectionName;
                sectionTitle.style.cssText = `
                    margin: 0 0 1rem 0;
                    color: #495057;
                    font-weight: 600;
                    padding-bottom: 0.5rem;
                    border-bottom: 1px solid #dee2e6;
                `;
                sectionDiv.appendChild(sectionTitle);
                
                // Campos da se√ß√£o
                sections[sectionName].forEach(field => {
                    const fieldDiv = document.createElement('div');
                    fieldDiv.className = 'form-group';
                    fieldDiv.style.marginBottom = '1rem';
                    
                    // Label
                    const label = document.createElement('label');
                    label.textContent = field.label + (field.required ? ' *' : '');
                    label.style.cssText = `
                        display: block;
                        font-weight: 500;
                        margin-bottom: 5px;
                        color: ${field.required ? '#dc3545' : '#495057'};
                    `;
                    fieldDiv.appendChild(label);
                    
                    // Input baseado no tipo
                    let input;
                    
                    switch (field.type) {
                        case 'text':
                        case 'email':
                        case 'tel':
                            input = document.createElement('input');
                            input.type = field.type;
                            input.name = field.name;
                            input.placeholder = field.placeholder || '';
                            input.required = field.required || false;
                            break;
                            
                        case 'number':
                            input = document.createElement('input');
                            input.type = 'number';
                            input.name = field.name;
                            input.placeholder = field.placeholder || '';
                            input.required = field.required || false;
                            if (field.min !== undefined) input.min = field.min;
                            if (field.max !== undefined) input.max = field.max;
                            if (field.step !== undefined) input.step = field.step;
                            break;
                            
                        case 'date':
                        case 'time':
                            input = document.createElement('input');
                            input.type = field.type;
                            input.name = field.name;
                            input.required = field.required || false;
                            break;
                            
                        case 'textarea':
                            input = document.createElement('textarea');
                            input.name = field.name;
                            input.placeholder = field.placeholder || '';
                            input.required = field.required || false;
                            input.rows = 3;
                            break;
                            
                        case 'select':
                            input = document.createElement('select');
                            input.name = field.name;
                            input.required = field.required || false;
                            
                            // Suporte a select m√∫ltiplo
                            if (field.multiple) {
                                input.multiple = true;
                                input.name = field.name + '[]';
                            }
                            
                            // Op√ß√£o vazia (apenas para select simples)
                            if (!field.multiple) {
                                const emptyOption = document.createElement('option');
                                emptyOption.value = '';
                                emptyOption.textContent = 'Selecione...';
                                input.appendChild(emptyOption);
                            }
                            
                            // Op√ß√µes normalizadas
                            const normalizedOptions = normalizeOptions(field);
                            console.log('üîß Campo select "' + field.name + '" com', normalizedOptions.length, 'op√ß√µes:', normalizedOptions.slice(0, 3));
                            
                            normalizedOptions.forEach(option => {
                                const optionElement = document.createElement('option');
                                optionElement.value = option.value;
                                optionElement.textContent = option.label;
                                input.appendChild(optionElement);
                            });
                            break;
                            
                        case 'checkboxes':
                            const checkboxContainer = document.createElement('div');
                            checkboxContainer.style.cssText = 'padding: 10px; border: 1px solid #ddd; border-radius: 5px; background: #fff;';
                            
                            // Op√ß√µes normalizadas
                            const normalizedCheckboxOptions = normalizeOptions(field);
                            console.log('üîß Campo checkboxes "' + field.name + '" com', normalizedCheckboxOptions.length, 'op√ß√µes:', normalizedCheckboxOptions.slice(0, 3));
                            
                            normalizedCheckboxOptions.forEach((option, idx) => {
                                const checkboxDiv = document.createElement('div');
                                checkboxDiv.style.cssText = 'display: flex; align-items: center; margin-bottom: 8px; min-height: 24px;';
                                
                                const checkbox = document.createElement('input');
                                checkbox.type = 'checkbox';
                                checkbox.name = field.name + '[]';
                                checkbox.value = option.value;
                                checkbox.id = field.name + '_' + idx;
                                checkbox.style.cssText = 'margin: 0 8px 0 0; flex-shrink: 0; width: 16px; height: 16px;';
                                
                                const checkboxLabel = document.createElement('label');
                                checkboxLabel.textContent = option.label;
                                checkboxLabel.htmlFor = checkbox.id;
                                checkboxLabel.style.cssText = 'cursor: pointer; line-height: 1.4; margin: 0; flex: 1; display: block;';
                                
                                checkboxDiv.appendChild(checkbox);
                                checkboxDiv.appendChild(checkboxLabel);
                                checkboxContainer.appendChild(checkboxDiv);
                            });
                            
                            input = checkboxContainer;
                            break;
                            
                        case 'file':
                            input = document.createElement('input');
                            input.type = 'file';
                            input.name = field.name;
                            input.required = field.required || false;
                            if (field.accept) input.accept = field.accept;
                            if (field.multiple) input.multiple = true;
                            break;
                            
                        default:
                            input = document.createElement('input');
                            input.type = 'text';
                            input.name = field.name;
                            input.placeholder = field.placeholder || '';
                            input.required = field.required || false;
                    }
                    
                    // Aplicar estilos ao input
                    if (input.tagName !== 'DIV') { // N√£o aplicar a containers (checkboxes)
                        input.style.cssText = `
                            width: 100%;
                            padding: 8px 12px;
                            border: 1px solid #ced4da;
                            border-radius: 4px;
                            font-size: 14px;
                            transition: border-color 0.15s ease-in-out;
                            background-color: #fff;
                            color: #495057;
                            font-family: inherit;
                        `;
                        
                        // Estilos espec√≠ficos para textarea
                        if (input.tagName === 'TEXTAREA') {
                            input.style.resize = 'vertical';
                            input.style.minHeight = '80px';
                        }
                    }
                    
                    fieldDiv.appendChild(input);
                    sectionDiv.appendChild(fieldDiv);
                });
                
                dynamicContainer.appendChild(sectionDiv);
            });
            
                // Inserir container ap√≥s os campos b√°sicos
                existingFields.parentNode.insertBefore(dynamicContainer, existingFields.nextSibling);
                console.log('‚úÖ Campos din√¢micos inseridos com sucesso');
                
            } catch (error) {
                console.error('‚ùå Erro na renderiza√ß√£o dos campos din√¢micos:', error);
                console.error('Stack trace:', error.stack);
            }
        }

        function showNewEmployeeForm() {
            // Create and show new employee form
            const funcionarios = document.getElementById('funcionarios');
            
            // Hide the existing content
            const existingContent = funcionarios.querySelector('.table-container');
            if (existingContent) existingContent.style.display = 'none';
            
            // Remove any existing form
            const existingForm = funcionarios.querySelector('#novo-funcionario-form');
            if (existingForm) existingForm.remove();
            
            // Create new form
            const formHTML = `
                <div id="novo-funcionario-form" class="card card-white">
                    <h4>Novo Funcion√°rio</h4>
                    
                    <div class="form-group">
                        <label>Nome Completo:</label>
                        <input type="text" id="empNome" placeholder="Digite o nome completo">
                    </div>
                    
                    <div class="form-group">
                        <label>Email:</label>
                        <input type="email" id="empEmail" placeholder="Digite o email">
                    </div>
                    
                    <div class="form-group">
                        <label>Departamento:</label>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <select id="empDepartamento" style="flex: 1;">
                                <option value="">Carregando departamentos...</option>
                            </select>
                            <button type="button" class="btn btn-success" data-action="showQuickDepartmentModal" title="Criar novo departamento" style="padding: 8px 12px;">+</button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Cargo (CBO):</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="empCargo" placeholder="Busque na CBO ou digite manualmente" style="flex: 1;">
                            <button type="button" class="btn btn-secondary" data-action="openCboSearch">üîç CBO</button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Data de Admiss√£o:</label>
                        <input type="date" id="empDataAdmissao">
                    </div>
                    
                    <div class="form-group">
                        <label>Sal√°rio:</label>
                        <input type="number" id="empSalario" placeholder="Digite o sal√°rio" step="0.01">
                    </div>
                    
                    <div class="form-group">
                        <label>Status:</label>
                        <select id="empStatus">
                            <option value="ativo" selected>Ativo</option>
                            <option value="inativo">Inativo</option>
                            <option value="ferias">Em F√©rias</option>
                        </select>
                    </div>
                    
                    <button class="btn btn-success" data-action="saveNewEmployee">Salvar Funcion√°rio</button>
                    <button class="btn btn-secondary" data-action="cancelNewEmployee" style="margin-left: 10px;">Cancelar</button>
                </div>
            `;
            
            funcionarios.insertAdjacentHTML('beforeend', formHTML);
            
            // Carregar departamentos do banco de dados
            loadDepartments();
        }
        
        // Fun√ß√£o para carregar departamentos do banco de dados
        async function loadDepartments() {
            try {
                console.log('üè¢ Carregando departamentos do banco...');
                
                const response = await fetchWithAuth('/api/departments');
                const data = await response.json();
                
                const departmentSelect = document.getElementById('empDepartamento');
                if (departmentSelect && data.success && data.departments) {
                    // Limpar op√ß√µes existentes
                    departmentSelect.innerHTML = '<option value="">Selecione o departamento...</option>';
                    
                    // Adicionar op√ß√µes dos departamentos do banco
                    data.departments.forEach(dept => {
                        const option = document.createElement('option');
                        option.value = dept.id;
                        option.textContent = dept.name;
                        departmentSelect.appendChild(option);
                    });
                    
                    console.log(`‚úÖ Carregados ${data.departments.length} departamentos`);
                } else if (departmentSelect) {
                    console.warn('‚ö†Ô∏è Erro ao carregar departamentos:', data.error);
                    departmentSelect.innerHTML = '<option value="">Erro ao carregar departamentos</option>';
                }
                
            } catch (error) {
                console.error('‚ùå Erro ao buscar departamentos:', error);
                const departmentSelect = document.getElementById('empDepartamento');
                if (departmentSelect) {
                    departmentSelect.innerHTML = '<option value="">Erro ao carregar departamentos</option>';
                }
            }
        }
        
        // Fun√ß√£o para carregar e exibir departamentos na se√ß√£o Departamentos
        async function loadDepartmentsTable() {
            try {
                console.log('üè¢ Carregando tabela de departamentos...');
                
                // Buscar todos os departamentos (ativos e inativos)
                const response = await fetchWithAuth('/api/departments?include_inactive=true');
                const data = await response.json();
                
                const container = document.getElementById('departamentos-list');
                if (!container) return;
                
                if (data.success && data.departments) {
                    // Limpar dados existentes (mantendo header)
                    const existingRows = container.querySelectorAll('.table-grid:not(.table-header-row)');
                    existingRows.forEach(row => row.remove());
                    
                    // Adicionar departamentos
                    data.departments.forEach(dept => {
                        const row = document.createElement('div');
                        row.className = 'table-grid';
                        row.style.gridTemplateColumns = '2fr 2fr 1fr 1fr 1fr';
                        
                        const statusClass = dept.is_active ? 'status-success' : 'status-danger';
                        const statusText = dept.is_active ? 'Ativo' : 'Inativo';
                        const toggleAction = dept.is_active ? 'inativar' : 'ativar';
                        const toggleIcon = dept.is_active ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è';
                        const toggleColor = dept.is_active ? 'btn-warning' : 'btn-info';
                        
                        row.innerHTML = `
                            <span>${dept.name}</span>
                            <span>${dept.description || 'Sem descri√ß√£o'}</span>
                            <span>-</span>
                            <span class="status ${statusClass}">${statusText}</span>
                            <span style="display: flex; gap: 5px;">
                                <button class="btn btn-primary btn-sm" 
                                        data-action="editDepartment" data-dept-id="\${dept.id}" 
                                        title="Editar departamento">
                                    ‚úèÔ∏è
                                </button>
                                <button class="btn ${toggleColor} btn-sm" 
                                        data-action="toggleDepartmentStatus" data-dept-id="\${dept.id}" data-dept-name="\${dept.name}" data-is-active="\${dept.is_active}" 
                                        title="${toggleAction} departamento">
                                    ${toggleIcon}
                                </button>
                                <button class="btn btn-danger btn-sm" 
                                        data-action="deleteDepartment" data-dept-id="\${dept.id}" data-dept-name="\${dept.name}" 
                                        title="Excluir departamento permanentemente">
                                    üóëÔ∏è
                                </button>
                            </span>
                        `;
                        
                        container.appendChild(row);
                    });
                    
                    if (data.departments.length === 0) {
                        const emptyRow = document.createElement('div');
                        emptyRow.style.textAlign = 'center';
                        emptyRow.style.padding = '2rem';
                        emptyRow.style.color = '#6c757d';
                        emptyRow.textContent = 'Nenhum departamento cadastrado ainda';
                        container.appendChild(emptyRow);
                    }
                    
                    console.log(`‚úÖ Tabela carregada com ${data.departments.length} departamentos`);
                } else {
                    console.warn('‚ö†Ô∏è Erro ao carregar departamentos:', data.error);
                }
                
            } catch (error) {
                console.error('‚ùå Erro ao buscar departamentos:', error);
            }
        }

        async function saveNewRequest() {
            const tipo = document.getElementById('reqTipo').value;
            const saveBtn = event.target;
            const contratacaoId = '4463c3bf-faf3-4ccb-91ff-e8da6349566e';
            
            if (!tipo) {
                showStatus('Selecione o tipo de requisi√ß√£o!', 'warning');
                const form = document.getElementById('nova-requisicao-form');
                form.classList.add('animate-shake');
                setTimeout(() => form.classList.remove('animate-shake'), 500);
                return;
            }
            
            let requestData = {};
            
            // Se for contrata√ß√£o, coletar apenas dados espec√≠ficos
            if (tipo === contratacaoId) {
                requestData = collectContratacaoData();
                if (!requestData) {
                    const form = document.getElementById('nova-requisicao-form');
                    form.classList.add('animate-shake');
                    setTimeout(() => form.classList.remove('animate-shake'), 500);
                    return; // Mensagem de erro j√° foi mostrada em collectContratacaoData()
                }
            } else {
                // Para outros tipos, usar l√≥gica atual
                const employeeId = document.getElementById('reqFuncionario').value;
                const descricao = document.getElementById('reqDescricao').value;
                const dataInicio = document.getElementById('reqDataInicio').value;
                
                if (!employeeId || !descricao || !dataInicio) {
                    showStatus('Preencha todos os campos obrigat√≥rios!', 'warning');
                    const form = document.getElementById('nova-requisicao-form');
                    form.classList.add('animate-shake');
                    setTimeout(() => form.classList.remove('animate-shake'), 500);
                    return;
                }
                
                requestData = {
                    employee_id: employeeId,
                    request_type_id: tipo,
                    title: `Requisi√ß√£o`,
                    description: descricao,
                    priority: 'normal',
                    start_date: dataInicio
                };
            }
            
            // Add loading state
            setButtonLoading(saveBtn, true);
            
            try {
                console.log('üì§ Enviando nova requisi√ß√£o:', requestData);
                
                const response = await fetchWithAuth('/api/requests', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });
                
                const result = await response.json();
                
                if (response.ok && result.success) {
                    showStatus('Requisi√ß√£o criada com sucesso!', 'success');
                    const form = document.getElementById('nova-requisicao-form');
                    form.classList.add('animate-fadeIn');
                    showHint('Nova requisi√ß√£o adicionada ao sistema!');
                    
                    setTimeout(() => {
                        cancelNewRequest();
                        loadRequestsData(); // Reload requests list
                        setButtonLoading(saveBtn, false);
                    }, 800);
                } else {
                    throw new Error(result.error || result.details || 'Erro ao criar requisi√ß√£o');
                }
                
            } catch (error) {
                console.error('‚ùå Erro ao salvar requisi√ß√£o:', error);
                showStatus('Erro ao criar requisi√ß√£o: ' + error.message, 'danger');
                setButtonLoading(saveBtn, false);
            }
        }
        
        function collectContratacaoData() {
            const formData = {};
            const dynamicContainer = document.getElementById('dynamic-fields-container');
            
            if (!dynamicContainer) {
                showStatus('Erro: Campos espec√≠ficos n√£o carregados!', 'warning');
                return null;
            }
            
            // Coletar dados de todos os campos espec√≠ficos
            const inputs = dynamicContainer.querySelectorAll('input, select, textarea');
            let hasRequiredFields = false;
            let missingRequired = [];
            
            inputs.forEach(input => {
                const name = input.name || input.id;
                if (!name) return;
                
                const isRequired = input.required || input.hasAttribute('required');
                
                if (input.type === 'checkbox') {
                    if (input.checked) {
                        if (!formData[name]) formData[name] = [];
                        formData[name].push(input.value);
                    }
                } else if (input.type === 'file') {
                    if (input.files && input.files.length > 0) {
                        formData[name] = Array.from(input.files).map(file => file.name);
                    }
                } else {
                    formData[name] = input.value;
                    
                    if (isRequired) {
                        hasRequiredFields = true;
                        if (!input.value || input.value.trim() === '') {
                            const label = input.previousElementSibling?.textContent || name;
                            missingRequired.push(label);
                        }
                    }
                }
            });
            
            if (missingRequired.length > 0) {
                showStatus(`Preencha os campos obrigat√≥rios: ${missingRequired.join(', ')}`, 'warning');
                return null;
            }
            
            // Retornar dados no formato esperado pelo backend
            return {
                request_type_id: '4463c3bf-faf3-4ccb-91ff-e8da6349566e',
                title: 'Contrata√ß√£o',
                description: 'Requisi√ß√£o de contrata√ß√£o com campos espec√≠ficos',
                priority: 'normal',
                data: formData // Todos os campos espec√≠ficos aqui
            };
        }

        function cancelNewRequest() {
            const form = document.getElementById('nova-requisicao-form');
            if (form) form.remove();
            
            const existingContent = document.getElementById('requisicoes').querySelector('.table-container');
            if (existingContent) existingContent.style.display = 'block';
        }
        // Tornar as fun√ß√µes globalmente acess√≠veis
        window.saveNewRequest = saveNewRequest;
        window.cancelNewRequest = cancelNewRequest;

        async function saveNewEmployee() {
            const nome = document.getElementById('empNome').value;
            const email = document.getElementById('empEmail').value;
            const cargo = document.getElementById('empCargo').value;
            const departamento = document.getElementById('empDepartamento').value;
            const dataAdmissao = document.getElementById('empDataAdmissao').value;
            const salario = document.getElementById('empSalario').value;
            const saveBtn = event.target;
            
            if (!nome || !email || !cargo || !dataAdmissao) {
                showStatus('Preencha todos os campos obrigat√≥rios!', 'warning');
                const form = document.getElementById('novo-funcionario-form');
                form.classList.add('animate-shake');
                setTimeout(() => form.classList.remove('animate-shake'), 500);
                return;
            }
            
            // Add loading state
            setButtonLoading(saveBtn, true);
            
            try {
                console.log('üíæ Salvando novo funcion√°rio:', { nome, email, cargo, departamento, dataAdmissao, salario });
                
                // Generate unique employee code
                const empCode = `EMP${Date.now()}`;
                
                // Prepare data for API
                const employeeData = {
                    employee_code: empCode,
                    name: nome,
                    email: email,
                    phone: null,
                    cpf: null,
                    birth_date: null,
                    hire_date: dataAdmissao,
                    position: cargo,
                    cbo_code: null,
                    salary: salario ? parseFloat(salario) : null,
                    is_active: true
                };
                
                console.log('üì§ Enviando dados para API:', employeeData);
                
                const response = await fetchWithAuth('/api/employees', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(employeeData)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                console.log('‚úÖ Funcion√°rio salvo com sucesso:', result);
                
                if (result.success) {
                    showStatus('Funcion√°rio cadastrado com sucesso!', 'success');
                    const form = document.getElementById('novo-funcionario-form');
                    form.classList.add('animate-bounce');
                    showHint(`${nome} foi adicionado √† equipe!`);
                    
                    setTimeout(() => {
                        cancelNewEmployee();
                        setButtonLoading(saveBtn, false);
                        // Recarregar a lista de funcion√°rios
                        if (typeof loadEmployeesData === 'function') {
                            loadEmployeesData();
                        }
                    }, 800);
                } else {
                    throw new Error(result.message || 'Erro ao salvar funcion√°rio');
                }
                
            } catch (error) {
                console.error('‚ùå Erro ao salvar funcion√°rio:', error);
                showStatus('Erro ao cadastrar funcion√°rio: ' + error.message, 'error');
                setButtonLoading(saveBtn, false);
                
                const form = document.getElementById('novo-funcionario-form');
                form.classList.add('animate-shake');
                setTimeout(() => form.classList.remove('animate-shake'), 500);
            }
        }

        function cancelNewEmployee() {
            const form = document.getElementById('novo-funcionario-form');
            if (form) form.remove();
            
            const existingContent = document.getElementById('funcionarios').querySelector('.table-container');
            if (existingContent) existingContent.style.display = 'block';
        }

        // Departamentos Functions
        function showNewDepartmentForm() {
            const departamentos = document.getElementById('departamentos');
            
            const existingContent = departamentos.querySelector('#departamentos-list');
            if (existingContent) existingContent.style.display = 'none';
            
            const existingForm = departamentos.querySelector('#novo-departamento-form');
            if (existingForm) existingForm.remove();
            
            const formHTML = `
                <div id="novo-departamento-form" class="card card-white">
                    <h4>Novo Departamento</h4>
                    
                    <div class="form-group">
                        <label>Nome do Departamento:</label>
                        <input type="text" id="deptNome" placeholder="Digite o nome do departamento">
                    </div>
                    
                    <div class="form-group">
                        <label>Descri√ß√£o:</label>
                        <textarea id="deptDescricao" rows="3" placeholder="Descreva as atividades do departamento..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>Respons√°vel:</label>
                        <select id="deptResponsavel">
                            <option value="">Selecione o respons√°vel...</option>
                            <option value="joao">Jo√£o Silva</option>
                            <option value="maria">Maria Santos</option>
                            <option value="pedro">Pedro Oliveira</option>
                            <option value="ana">Ana Costa</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Or√ßamento Anual:</label>
                        <input type="number" id="deptOrcamento" placeholder="Digite o or√ßamento" step="0.01">
                    </div>
                    
                    <div class="form-group">
                        <label>Status:</label>
                        <select id="deptStatus">
                            <option value="ativo" selected>Ativo</option>
                            <option value="inativo">Inativo</option>
                        </select>
                    </div>
                    
                    <button class="btn btn-success" data-action="saveNewDepartment">Salvar Departamento</button>
                    <button class="btn btn-secondary" data-action="cancelNewDepartment" style="margin-left: 10px;">Cancelar</button>
                </div>
            `;
            
            departamentos.insertAdjacentHTML('beforeend', formHTML);
        }

        function saveNewDepartment() {
            const nome = document.getElementById('deptNome').value;
            const descricao = document.getElementById('deptDescricao').value;
            const responsavel = document.getElementById('deptResponsavel').value;
            const saveBtn = event.target;
            
            if (!nome || !descricao || !responsavel) {
                showStatus('Preencha todos os campos obrigat√≥rios!', 'warning');
                const form = document.getElementById('novo-departamento-form');
                form.classList.add('animate-shake');
                setTimeout(() => form.classList.remove('animate-shake'), 500);
                return;
            }
            
            // Add loading state
            setButtonLoading(saveBtn, true);
            
            // Simulate save process
            setTimeout(() => {
                showStatus('Departamento criado com sucesso!', 'success');
                const form = document.getElementById('novo-departamento-form');
                form.classList.add('animate-fadeIn');
                showHint(`Departamento "${nome}" foi criado!`);
                
                setTimeout(() => {
                    cancelNewDepartment();
                    setButtonLoading(saveBtn, false);
                }, 800);
            }, 1000);
        }

        function cancelNewDepartment() {
            const form = document.getElementById('novo-departamento-form');
            if (form) form.remove();
            
            const existingContent = document.getElementById('departamentos').querySelector('#departamentos-list');
            if (existingContent) existingContent.style.display = 'block';
        }

        // CBO Functions
        let selectedCboData = null;

        function searchCbo() {
            const searchTerm = document.getElementById('cboSearch').value.toLowerCase();
            const grupo = document.getElementById('cboGrupo').value;
            
            // Simula√ß√£o de busca na CBO - em um sistema real, faria uma consulta √† API
            const cboData = [
                { codigo: '1414-05', titulo: 'Diretor de recursos humanos', grupo: '1', grupoNome: 'Membros superiores do poder p√∫blico' },
                { codigo: '2516-05', titulo: 'Analista de recursos humanos', grupo: '2', grupoNome: 'Profissionais das ci√™ncias e das artes' },
                { codigo: '4110-05', titulo: 'Auxiliar de pessoal', grupo: '4', grupoNome: 'Trabalhadores de servi√ßos administrativos' },
                { codigo: '1237-10', titulo: 'Diretor administrativo', grupo: '1', grupoNome: 'Membros superiores do poder p√∫blico' },
                { codigo: '2124-05', titulo: 'Administrador', grupo: '2', grupoNome: 'Profissionais das ci√™ncias e das artes' },
                { codigo: '3171-05', titulo: 'T√©cnico em inform√°tica', grupo: '3', grupoNome: 'T√©cnicos de n√≠vel m√©dio' },
                { codigo: '2123-05', titulo: 'Engenheiro de software', grupo: '2', grupoNome: 'Profissionais das ci√™ncias e das artes' },
                { codigo: '4110-10', titulo: 'Assistente administrativo', grupo: '4', grupoNome: 'Trabalhadores de servi√ßos administrativos' },
                { codigo: '2521-05', titulo: 'Contador', grupo: '2', grupoNome: 'Profissionais das ci√™ncias e das artes' },
                { codigo: '1425-10', titulo: 'Gerente financeiro', grupo: '1', grupoNome: 'Membros superiores do poder p√∫blico' }
            ];

            let filteredData = cboData;

            if (searchTerm) {
                filteredData = filteredData.filter(item => 
                    item.titulo.toLowerCase().includes(searchTerm) || 
                    item.codigo.includes(searchTerm)
                );
            }

            if (grupo) {
                filteredData = filteredData.filter(item => item.grupo === grupo);
            }

            updateCboResults(filteredData);
        }

        function filterByGroup() {
            searchCbo(); // Reutiliza a fun√ß√£o de busca
        }

        function updateCboResults(data) {
            const container = document.getElementById('cbo-results');
            const header = container.querySelector('.table-header');
            const headerRow = container.querySelector('.table-header-row');
            
            // Remove existing results
            const existingRows = container.querySelectorAll('.table-grid:not(.table-header-row)');
            existingRows.forEach(row => row.remove());
            
            // Add new results
            data.forEach(item => {
                const row = document.createElement('div');
                row.className = 'table-grid';
                row.style.gridTemplateColumns = '1fr 3fr 2fr 1fr';
                row.innerHTML = `
                    <span>${item.codigo}</span>
                    <span>${item.titulo}</span>
                    <span>${item.grupoNome}</span>
                    <button class="btn btn-secondary" data-action="selectCbo" data-codigo="\${item.codigo}" data-titulo="\${item.titulo}" data-grupo="\${item.grupoNome}">Selecionar</button>
                `;
                container.appendChild(row);
            });

            if (data.length === 0) {
                const row = document.createElement('div');
                row.className = 'table-grid';
                row.style.gridTemplateColumns = '1fr';
                row.style.textAlign = 'center';
                row.style.padding = '2rem';
                row.innerHTML = '<span>Nenhum cargo encontrado. Tente outros termos de busca.</span>';
                container.appendChild(row);
            }
        }

        function selectCbo(codigo, titulo, grupo) {
            selectedCboData = { codigo, titulo, grupo };
            
            const detailsDiv = document.getElementById('cbo-details');
            detailsDiv.innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                    <div><strong>C√≥digo CBO:</strong> ${codigo}</div>
                    <div><strong>Grupo:</strong> ${grupo}</div>
                </div>
                <div><strong>T√≠tulo:</strong> ${titulo}</div>
            `;
            
            const selectedDiv = document.getElementById('selected-cbo');
            selectedDiv.style.display = 'block';
            selectedDiv.classList.add('animate-slideIn');
            
            showStatus(`Cargo "${titulo}" selecionado!`, 'success');
            showHint('Cargo selecionado! Clique em "Adicionar ao Sistema"');
            
            // Animate the selection button that was clicked
            event.target.classList.add('animate-bounce');
            setTimeout(() => event.target.classList.remove('animate-bounce'), 1000);
        }

        function clearCboSelection() {
            selectedCboData = null;
            document.getElementById('selected-cbo').style.display = 'none';
            showStatus('Sele√ß√£o de cargo limpa', 'info');
        }

        function addCargoToSystem() {
            if (!selectedCboData) {
                showStatus('Nenhum cargo selecionado!', 'warning');
                return;
            }
            
            showStatus(`Cargo "${selectedCboData.titulo}" adicionado ao sistema!`, 'success');
            clearCboSelection();
        }

        function refreshCboData() {
            showStatus('Dados da CBO atualizados com sucesso!', 'success');
            searchCbo(); // Reload the search results
        }

        function openCboSearch() {
            showSection('cargos');
            showStatus('Use a busca acima para encontrar o cargo na CBO', 'info');
        }

        function editRequest(id) {
            showStatus(`Editando requisi√ß√£o ${id}...`, 'info');
        }

        function saveRequest() {
            const name = document.getElementById('requestName').value;
            const category = document.getElementById('requestCategory').value;
            const description = document.getElementById('requestDescription').value;
            const status = document.getElementById('requestStatus').value;
            
            if (name && category && description) {
                showStatus('Tipo de requisi√ß√£o salvo com sucesso!', 'success');
                showList();
                // Clear form
                document.getElementById('requestName').value = '';
                document.getElementById('requestCategory').value = '';
                document.getElementById('requestDescription').value = '';
                document.getElementById('requestStatus').value = 'ativo';
            } else {
                showStatus('Preencha todos os campos obrigat√≥rios!', 'warning');
            }
        }

        // Initialize all event listeners to replace inline handlers
        function initializeEventListeners() {
            // Login button
            const loginButton = document.getElementById('loginButton');
            if (loginButton) {
                loginButton.addEventListener('click', performLogin);
            }

            // Navigation elements (cards and buttons with data-section attributes)
            const navigationElements = document.querySelectorAll('[data-section]');
            navigationElements.forEach(element => {
                element.addEventListener('click', function() {
                    const section = this.getAttribute('data-section');
                    showSection(section);
                });
            });

            // Logout button
            const logoutButton = document.getElementById('logoutButton');
            if (logoutButton) {
                logoutButton.addEventListener('click', logout);
            }

            // Self-service profile buttons
            const editProfileButton = document.getElementById('editProfileButton');
            if (editProfileButton) {
                editProfileButton.addEventListener('click', editProfile);
            }

            const changePasswordButton = document.getElementById('changePasswordButton');
            if (changePasswordButton) {
                changePasswordButton.addEventListener('click', changePassword);
            }

            const downloadPayStubButton = document.getElementById('downloadPayStubButton');
            if (downloadPayStubButton) {
                downloadPayStubButton.addEventListener('click', downloadPayStub);
            }
        }

        // Initialize system with micro-interactions
        document.addEventListener('DOMContentLoaded', function() {
            showStatus('Digite suas credenciais para acessar o sistema.', 'info');
            
            // Add entrance animation to login screen
            setTimeout(() => {
                document.getElementById('login').classList.add('animate-fadeIn');
            }, 100);
            
            // Initialize event listeners
            initializeEventListeners();
            
            // Initialize form interactions
            addFormInteractions();
            
            // Add hover effects to all interactive elements
            addHoverEffects();
            
            // Dashboard metrics will be updated only after login and manually
            
            // Initialize dashboard animations
            setTimeout(() => {
                initializeDashboardAnimations();
            }, 1000);
        });
        
        // Initialize dashboard visual effects
        function initializeDashboardAnimations() {
            // Animate chart bars on load
            const chartBars = document.querySelectorAll('.chart-fill');
            chartBars.forEach((bar, index) => {
                const width = bar.style.width;
                bar.style.width = '0%';
                setTimeout(() => {
                    bar.style.width = width;
                }, 200 * (index + 1));
            });
            
            // Animate trend points
            const trendPoints = document.querySelectorAll('.trend-point');
            trendPoints.forEach((point, index) => {
                point.style.opacity = '0';
                point.style.transform = 'translateY(20px)';
                setTimeout(() => {
                    point.style.transition = 'all 0.5s ease';
                    point.style.opacity = '1';
                    point.style.transform = 'translateY(0)';
                }, 100 * (index + 1));
            });
            
            // Animate alerts
            const alerts = document.querySelectorAll('.alert-item');
            alerts.forEach((alert, index) => {
                alert.classList.add('animate-slideIn');
                alert.style.animationDelay = `${index * 0.1}s`;
            });
        }

        // Enhanced keyboard interactions
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                if (document.getElementById('login').style.display !== 'none') {
                    const loginBtn = document.getElementById('loginButton');
                    loginBtn.classList.add('animate-pulse');
                    setTimeout(() => loginBtn.classList.remove('animate-pulse'), 600);
                    performLogin();
                }
            }
        });
        
        // Add hover effects to interactive elements
        function addHoverEffects() {
            // Enhanced card hover effects
            document.querySelectorAll('.card-clickable').forEach(card => {
                card.addEventListener('mouseenter', function() {
                    this.style.transition = 'all 0.3s ease';
                });
                
                card.addEventListener('click', function() {
                    this.classList.add('animate-bounce');
                    setTimeout(() => this.classList.remove('animate-bounce'), 1000);
                });
            });
            
            // Enhanced button interactions
            document.querySelectorAll('.btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    if (!this.classList.contains('btn-loading')) {
                        this.classList.add('animate-pulse');
                        setTimeout(() => this.classList.remove('animate-pulse'), 300);
                    }
                });
            });
            
            // Table row interactions
            document.querySelectorAll('.table-grid:not(.table-header-row)').forEach(row => {
                row.addEventListener('mouseenter', function() {
                    this.style.transition = 'all 0.2s ease';
                });
            });
        }
        
        // Enhanced Dashboard Functions
        function showApprovals() {
            showToast('Carregando aprova√ß√µes pendentes...', 'info');
            setTimeout(() => {
                const approvals = [
                    { id: 1, employee: 'Jo√£o Silva', type: 'F√©rias', days: 15, status: 'Pendente' },
                    { id: 2, employee: 'Pedro Oliveira', type: 'Material', value: 'R$ 280,00', status: 'Pendente' },
                    { id: 3, employee: 'Ana Costa', type: 'Reembolso', value: 'R$ 450,00', status: 'Pendente' }
                ];
                
                let approvalHTML = `
                    <div style="background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin: 1rem 0;">
                        <h3>‚úÖ Central de Aprova√ß√µes</h3>
                        <p>Gerencie todas as aprova√ß√µes pendentes do sistema:</p>
                `;
                
                approvals.forEach(approval => {
                    approvalHTML += `
                        <div style="border: 1px solid #ddd; border-radius: 6px; padding: 1rem; margin: 1rem 0; display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>${approval.employee}</strong> - ${approval.type}
                                <br><small>${approval.days ? approval.days + ' dias' : approval.value}</small>
                            </div>
                            <div>
                                <button class="btn btn-success btn-sm" data-action="approveRequest" data-approval-id="\${approval.id}" data-employee="\${approval.employee}" data-type="\${approval.type}">Aprovar</button>
                                <button class="btn btn-danger btn-sm" data-action="rejectRequest" data-approval-id="\${approval.id}" data-employee="\${approval.employee}" data-type="\${approval.type}">Rejeitar</button>
                            </div>
                        </div>
                    `;
                });
                
                approvalHTML += `
                        <button class="btn btn-secondary" data-action="closeApprovalCenter">Fechar</button>
                    </div>
                `;
                
                document.getElementById('app').insertAdjacentHTML('beforeend', approvalHTML);
                showHint('Central de aprova√ß√µes carregada!');
            }, 1000);
        }
        
        function approveRequest(id, employee, type) {
            const btn = event.target;
            setButtonLoading(btn, true);
            
            setTimeout(() => {
                showToast(`${type} de ${employee} aprovado com sucesso!`, 'success');
                btn.parentElement.parentElement.style.background = '#d4edda';
                btn.parentElement.innerHTML = '<span style="color: #155724; font-weight: bold;">‚úÖ Aprovado</span>';
                
                // Update dashboard counter
                const counter = document.getElementById('pendingRequests');
                if (counter) {
                    const current = parseInt(counter.textContent);
                    counter.textContent = Math.max(0, current - 1);
                }
                
                setButtonLoading(btn, false);
            }, 1200);
        }
        
        function rejectRequest(id, employee, type) {
            const btn = event.target;
            setButtonLoading(btn, true);
            
            setTimeout(() => {
                showToast(`${type} de ${employee} foi rejeitado`, 'warning');
                btn.parentElement.parentElement.style.background = '#f8d7da';
                btn.parentElement.innerHTML = '<span style="color: #721c24; font-weight: bold;">‚ùå Rejeitado</span>';
                
                // Update dashboard counter
                const counter = document.getElementById('pendingRequests');
                if (counter) {
                    const current = parseInt(counter.textContent);
                    counter.textContent = Math.max(0, current - 1);
                }
                
                setButtonLoading(btn, false);
            }, 1000);
        }
        
        function generateExecutiveReport() {
            const btn = event.target;
            setButtonLoading(btn, true);
            showToast('Gerando relat√≥rio executivo...', 'info');
            
            setTimeout(() => {
                const reportData = {
                    period: 'Agosto 2025',
                    totalEmployees: 42,
                    newHires: 8,
                    departures: 2,
                    avgSalary: 'R$ 4.850,00',
                    turnoverRate: '4.8%',
                    satisfactionScore: '8.7/10'
                };
                
                const reportHTML = `
                    <div style="background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin: 1rem 0; max-width: 800px;">
                        <h3>üìä Relat√≥rio Executivo - ${reportData.period}</h3>
                        
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin: 2rem 0;">
                            <div style="text-align: center; padding: 1rem; background: #f8f9fa; border-radius: 6px;">
                                <h4 style="color: #007bff; margin: 0;">${reportData.totalEmployees}</h4>
                                <p style="margin: 0.5rem 0 0 0;">Total de Funcion√°rios</p>
                            </div>
                            <div style="text-align: center; padding: 1rem; background: #f8f9fa; border-radius: 6px;">
                                <h4 style="color: #28a745; margin: 0;">${reportData.newHires}</h4>
                                <p style="margin: 0.5rem 0 0 0;">Novas Contrata√ß√µes</p>
                            </div>
                            <div style="text-align: center; padding: 1rem; background: #f8f9fa; border-radius: 6px;">
                                <h4 style="color: #dc3545; margin: 0;">${reportData.departures}</h4>
                                <p style="margin: 0.5rem 0 0 0;">Desligamentos</p>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 2rem; margin: 2rem 0;">
                            <div>
                                <h5>üí∞ Informa√ß√µes Salariais</h5>
                                <p><strong>Sal√°rio M√©dio:</strong> ${reportData.avgSalary}</p>
                                <p><strong>Taxa de Turnover:</strong> ${reportData.turnoverRate}</p>
                            </div>
                            <div>
                                <h5>üòä Clima Organizacional</h5>
                                <p><strong>Satisfa√ß√£o Geral:</strong> ${reportData.satisfactionScore}</p>
                                <p><strong>Status:</strong> <span style="color: #28a745;">Excelente</span></p>
                            </div>
                        </div>
                        
                        <div style="margin: 2rem 0; padding: 1rem; background: #e7f3ff; border-radius: 6px; border-left: 4px solid #007bff;">
                            <h5>üìà Principais Insights</h5>
                            <ul style="margin: 0.5rem 0;">
                                <li>Crescimento de 5% no quadro de funcion√°rios</li>
                                <li>Meta de contrata√ß√£o superada em 33%</li>
                                <li>Taxa de reten√ß√£o de 95.2% (acima da meta)</li>
                                <li>Tempo m√©dio de contrata√ß√£o reduzido em 3 dias</li>
                            </ul>
                        </div>
                        
                        <div style="text-align: right; margin-top: 2rem;">
                            <button class="btn btn-success" data-action="downloadReport">üì• Baixar PDF</button>
                            <button class="btn btn-secondary" data-action="removeElement">Fechar</button>
                        </div>
                    </div>
                `;
                
                document.getElementById('app').insertAdjacentHTML('beforeend', reportHTML);
                showToast('Relat√≥rio executivo gerado!', 'success');
                setButtonLoading(btn, false);
                showHint('Relat√≥rio dispon√≠vel para download!');
            }, 2000);
        }
        
        function downloadReport() {
            showToast('Download iniciado! Arquivo ser√° salvo na pasta de downloads.', 'success');
            showHint('Em um sistema real, um PDF seria gerado e baixado automaticamente');
        }
        
        // Portal do Colaborador Functions
        function editProfile() {
            const btn = event.target;
            setButtonLoading(btn, true);
            showToast('Carregando formul√°rio de edi√ß√£o...', 'info');
            
            setTimeout(() => {
                const formHTML = `
                    <div style="background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin: 1rem 0;">
                        <h3>‚úèÔ∏è Editar Dados Pessoais</h3>
                        <form id="edit-profile-form">
                            <div class="grid-2" style="gap: 1rem; margin: 1rem 0;">
                                <div class="form-group">
                                    <label>Nome Completo:</label>
                                    <input type="text" value="Jo√£o Silva" required>
                                </div>
                                <div class="form-group">
                                    <label>Telefone:</label>
                                    <input type="tel" value="(11) 99999-9999" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Email Pessoal:</label>
                                <input type="email" value="joao.personal@email.com" required>
                            </div>
                            <div class="form-group">
                                <label>Endere√ßo:</label>
                                <textarea rows="3" placeholder="Rua, n√∫mero, complemento, bairro, cidade, CEP">Rua das Flores, 123, Apto 45
Centro, S√£o Paulo, SP
01234-567</textarea>
                            </div>
                            <div style="text-align: right; margin-top: 2rem;">
                                <button type="button" class="btn btn-success" data-action="saveProfileChanges">üíæ Salvar Altera√ß√µes</button>
                                <button type="button" class="btn btn-secondary" data-action="closeModal">Cancelar</button>
                            </div>
                        </form>
                    </div>
                `;
                
                document.getElementById('app').insertAdjacentHTML('beforeend', formHTML);
                setButtonLoading(btn, false);
                addFormInteractions(); // Add form interactions to new form
                showHint('Preencha os campos que deseja alterar');
            }, 1000);
        }
        
        function saveProfileChanges() {
            const btn = event.target;
            setButtonLoading(btn, true);
            
            setTimeout(() => {
                showToast('Dados atualizados com sucesso!', 'success');
                btn.parentElement.parentElement.parentElement.remove();
                setButtonLoading(btn, false);
                showHint('Suas informa√ß√µes foram atualizadas no sistema');
            }, 1500);
        }
        
        function changePassword() {
            const btn = event.target;
            setButtonLoading(btn, true);
            
            setTimeout(() => {
                const formHTML = `
                    <div style="background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin: 1rem 0;">
                        <h3>üîí Alterar Senha</h3>
                        <form id="change-password-form">
                            <div class="form-group">
                                <label>Senha Atual:</label>
                                <input type="password" required placeholder="Digite sua senha atual">
                            </div>
                            <div class="form-group">
                                <label>Nova Senha:</label>
                                <input type="password" required placeholder="Digite a nova senha (min. 8 caracteres)">
                            </div>
                            <div class="form-group">
                                <label>Confirmar Nova Senha:</label>
                                <input type="password" required placeholder="Digite novamente a nova senha">
                            </div>
                            <div style="background: #e7f3ff; padding: 1rem; border-radius: 6px; margin: 1rem 0;">
                                <small>
                                    <strong>Requisitos da senha:</strong><br>
                                    ‚Ä¢ M√≠nimo 8 caracteres<br>
                                    ‚Ä¢ Pelo menos uma letra mai√∫scula<br>
                                    ‚Ä¢ Pelo menos um n√∫mero<br>
                                    ‚Ä¢ Pelo menos um caractere especial
                                </small>
                            </div>
                            <div style="text-align: right; margin-top: 2rem;">
                                <button type="button" class="btn btn-success" data-action="savePasswordChange">üîê Alterar Senha</button>
                                <button type="button" class="btn btn-secondary" data-action="closeModal">Cancelar</button>
                            </div>
                        </form>
                    </div>
                `;
                
                document.getElementById('app').insertAdjacentHTML('beforeend', formHTML);
                setButtonLoading(btn, false);
                addFormInteractions();
                showHint('Por seguran√ßa, digite sua senha atual primeiro');
            }, 800);
        }
        
        function savePasswordChange() {
            const btn = event.target;
            setButtonLoading(btn, true);
            
            setTimeout(() => {
                showToast('Senha alterada com sucesso!', 'success');
                btn.parentElement.parentElement.parentElement.remove();
                setButtonLoading(btn, false);
                showHint('Sua senha foi atualizada. Use a nova senha no pr√≥ximo login.');
            }, 2000);
        }
        
        function downloadPayStub() {
            const btn = event.target;
            setButtonLoading(btn, true);
            showToast('Gerando holerite...', 'info');
            
            setTimeout(() => {
                showToast('Holerite de Agosto/2025 baixado com sucesso!', 'success');
                setButtonLoading(btn, false);
                showHint('Arquivo salvo na pasta Downloads');
            }, 1500);
        }
        
        function requestVacation() {
            showToast('Abrindo formul√°rio de f√©rias...', 'info');
            setTimeout(() => {
                const formHTML = `
                    <div style="background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin: 1rem 0;">
                        <h3>üèñÔ∏è Solicita√ß√£o de F√©rias</h3>
                        <div style="background: #d4edda; padding: 1rem; border-radius: 6px; margin-bottom: 1rem; border-left: 4px solid #28a745;">
                            <strong>Saldo Dispon√≠vel:</strong> 25 dias (per√≠odo aquisitivo: 03/2024 - 03/2025)
                        </div>
                        <form>
                            <div class="grid-2" style="gap: 1rem;">
                                <div class="form-group">
                                    <label>Data de In√≠cio:</label>
                                    <input type="date" required>
                                </div>
                                <div class="form-group">
                                    <label>Quantidade de Dias:</label>
                                    <select required>
                                        <option value="">Selecione...</option>
                                        <option value="10">10 dias</option>
                                        <option value="15">15 dias</option>
                                        <option value="20">20 dias</option>
                                        <option value="25">25 dias (per√≠odo completo)</option>
                                        <option value="30">30 dias</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Observa√ß√µes (opcional):</label>
                                <textarea rows="3" placeholder="Coment√°rios adicionais sobre sua solicita√ß√£o..."></textarea>
                            </div>
                            <div style="text-align: right; margin-top: 2rem;">
                                <button type="button" class="btn btn-success" data-action="submitVacationRequest">üìã Enviar Solicita√ß√£o</button>
                                <button type="button" class="btn btn-secondary" data-action="removeElement">Cancelar</button>
                            </div>
                        </form>
                    </div>
                `;
                
                document.getElementById('app').insertAdjacentHTML('beforeend', formHTML);
                addFormInteractions();
                showHint('Preencha as datas desejadas para suas f√©rias');
            }, 600);
        }
        
        function submitVacationRequest() {
            const btn = event.target;
            setButtonLoading(btn, true);
            
            setTimeout(() => {
                showToast('Solicita√ß√£o de f√©rias enviada com sucesso!', 'success');
                btn.parentElement.parentElement.remove();
                setButtonLoading(btn, false);
                showHint('Sua solicita√ß√£o ser√° analisada pelo RH');
            }, 1800);
        }
        
        function requestReimbursement() {
            showToast('Carregando formul√°rio de reembolso...', 'info');
            setTimeout(() => {
                const formHTML = `
                    <div style="background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin: 1rem 0;">
                        <h3>üí≥ Solicita√ß√£o de Reembolso</h3>
                        <div style="background: #d1ecf1; padding: 1rem; border-radius: 6px; margin-bottom: 1rem; border-left: 4px solid #17a2b8;">
                            <strong>Limite Mensal:</strong> R$ 1.500,00 | <strong>Utilizado:</strong> R$ 280,00 | <strong>Dispon√≠vel:</strong> R$ 1.220,00
                        </div>
                        <form>
                            <div class="grid-2" style="gap: 1rem;">
                                <div class="form-group">
                                    <label>Categoria:</label>
                                    <select required>
                                        <option value="">Selecione...</option>
                                        <option value="alimentacao">Alimenta√ß√£o</option>
                                        <option value="transporte">Transporte</option>
                                        <option value="hospedagem">Hospedagem</option>
                                        <option value="material">Material de Escrit√≥rio</option>
                                        <option value="outros">Outros</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Valor (R$):</label>
                                    <input type="number" step="0.01" min="0" max="1220" placeholder="0,00" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Data da Despesa:</label>
                                <input type="date" required>
                            </div>
                            <div class="form-group">
                                <label>Descri√ß√£o:</label>
                                <textarea rows="3" placeholder="Descreva a despesa realizada..." required></textarea>
                            </div>
                            <div class="form-group">
                                <label>Anexar Comprovante:</label>
                                <input type="file" accept="image/*,.pdf" required>
                                <small style="color: #6c757d;">Formatos aceitos: JPG, PNG, PDF (m√°x. 5MB)</small>
                            </div>
                            <div style="text-align: right; margin-top: 2rem;">
                                <button type="button" class="btn btn-success" data-action="submitReimbursement">üí∞ Enviar Solicita√ß√£o</button>
                                <button type="button" class="btn btn-secondary" data-action="removeElement">Cancelar</button>
                            </div>
                        </form>
                    </div>
                `;
                
                document.getElementById('app').insertAdjacentHTML('beforeend', formHTML);
                addFormInteractions();
                showHint('Anexe sempre o comprovante da despesa');
            }, 700);
        }
        
        function submitReimbursement() {
            const btn = event.target;
            setButtonLoading(btn, true);
            
            setTimeout(() => {
                showToast('Solicita√ß√£o de reembolso enviada!', 'success');
                btn.parentElement.parentElement.remove();
                setButtonLoading(btn, false);
                showHint('Reembolso ser√° processado em at√© 5 dias √∫teis');
            }, 2000);
        }
        
        function viewTimeBank() {
            showToast('Carregando banco de horas...', 'info');
            setTimeout(() => {
                const timeBankHTML = `
                    <div style="background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin: 1rem 0;">
                        <h3>‚è±Ô∏è Banco de Horas - Extrato</h3>
                        <div style="background: #fff3cd; padding: 1rem; border-radius: 6px; margin-bottom: 1rem; text-align: center; border-left: 4px solid #ffc107;">
                            <h4 style="margin: 0; color: #856404;">Saldo Atual: +12h 30min</h4>
                            <small>√öltima atualiza√ß√£o: 22/08/2025 √†s 17:30</small>
                        </div>
                        <div class="table-container">
                            <div class="table-grid table-header-row">
                                <span>Data</span>
                                <span>Tipo</span>
                                <span>Horas</span>
                                <span>Saldo</span>
                            </div>
                            <div class="table-grid">
                                <span>22/08/2025</span>
                                <span>Hora Extra</span>
                                <span style="color: #28a745;">+2h 30min</span>
                                <span>+12h 30min</span>
                            </div>
                            <div class="table-grid">
                                <span>21/08/2025</span>
                                <span>Hora Extra</span>
                                <span style="color: #28a745;">+1h 15min</span>
                                <span>+10h 00min</span>
                            </div>
                            <div class="table-grid">
                                <span>20/08/2025</span>
                                <span>Compensa√ß√£o</span>
                                <span style="color: #dc3545;">-1h 30min</span>
                                <span>+8h 45min</span>
                            </div>
                            <div class="table-grid">
                                <span>19/08/2025</span>
                                <span>Hora Extra</span>
                                <span style="color: #28a745;">+2h 15min</span>
                                <span>+10h 15min</span>
                            </div>
                        </div>
                        <div style="background: #e7f3ff; padding: 1rem; border-radius: 6px; margin: 1rem 0;">
                            <h5>üí° Informa√ß√µes Importantes:</h5>
                            <ul style="margin: 0.5rem 0;">
                                <li>Saldo positivo pode ser compensado em folga</li>
                                <li>Limite m√°ximo: 40 horas por m√™s</li>
                                <li>Validade: 12 meses a partir da data</li>
                            </ul>
                        </div>
                        <div style="text-align: right; margin-top: 2rem;">
                            <button class="btn btn-info" data-action="requestTimeOff">üèÉ‚Äç‚ôÇÔ∏è Solicitar Folga</button>
                            <button class="btn btn-secondary" data-action="closeModal">Fechar</button>
                        </div>
                    </div>
                `;
                
                document.getElementById('app').insertAdjacentHTML('beforeend', timeBankHTML);
                showHint('Voc√™ pode solicitar folga compensat√≥ria com seu saldo positivo');
            }, 1000);
        }
        
        function requestTimeOff() {
            showToast('Funcionalidade de folga compensat√≥ria ser√° implementada em breve!', 'info');
            showHint('Entre em contato com o RH para solicitar sua folga');
        }
        
        function downloadDocument(type) {
            const btn = event.target;
            setButtonLoading(btn, true);
            
            const documents = {
                'declaracao': 'Declara√ß√£o de V√≠nculo Empregat√≠cio',
                'comprovante': 'Comprovante de Rendimentos 2024',
                'cracha': 'Solicita√ß√£o de Segunda Via do Crach√°'
            };
            
            const docName = documents[type];
            showToast(`Gerando ${docName.toLowerCase()}...`, 'info');
            
            setTimeout(() => {
                showToast(`${docName} baixado com sucesso!`, 'success');
                setButtonLoading(btn, false);
                showHint('Documento salvo na pasta Downloads');
            }, 1500);
        }
        
        // Performance Management Functions
        function startEvaluation() {
            showToast('Iniciando processo de avalia√ß√£o 360¬∞...', 'info');
            setTimeout(() => {
                const evaluationHTML = `
                    <div style="background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin: 1rem 0; max-width: 900px;">
                        <h3>üìù Nova Avalia√ß√£o de Performance - 360¬∞</h3>
                        
                        <div class="grid-2" style="gap: 2rem; margin: 1rem 0;">
                            <div class="form-group">
                                <label>Funcion√°rio a ser Avaliado:</label>
                                <select id="eval-employee" required>
                                    <option value="">Selecione o funcion√°rio...</option>
                                    <option value="joao">Jo√£o Silva - Desenvolvedor Senior</option>
                                    <option value="ana">Ana Costa - Analista Marketing</option>
                                    <option value="carlos">Carlos Mendes - Analista Financeiro</option>
                                    <option value="maria">Maria Santos - Tech Lead</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Per√≠odo de Avalia√ß√£o:</label>
                                <select required>
                                    <option value="q3-2025">Q3 2025 (Jul-Set)</option>
                                    <option value="q2-2025">Q2 2025 (Abr-Jun)</option>
                                    <option value="q1-2025">Q1 2025 (Jan-Mar)</option>
                                </select>
                            </div>
                        </div>
                        
                        <div style="background: #e7f3ff; padding: 1rem; border-radius: 6px; margin: 1rem 0; border-left: 4px solid #007bff;">
                            <h5>üìä Metodologia 360¬∞</h5>
                            <p style="margin: 0.5rem 0;">A avalia√ß√£o incluir√° feedback de:</p>
                            <ul style="margin: 0.5rem 0;">
                                <li><strong>Auto-avalia√ß√£o</strong> - Reflex√£o do pr√≥prio funcion√°rio</li>
                                <li><strong>Gestor direto</strong> - Avalia√ß√£o da lideran√ßa</li>
                                <li><strong>Pares</strong> - Feedback de colegas do mesmo n√≠vel</li>
                                <li><strong>Subordinados</strong> - Avalia√ß√£o de liderados (se aplic√°vel)</li>
                            </ul>
                        </div>
                        
                        <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 6px; margin: 1rem 0;">
                            <h5>‚öôÔ∏è Compet√™ncias Avaliadas</h5>
                            <div class="grid-2" style="gap: 1rem;">
                                <div>
                                    <strong>Compet√™ncias T√©cnicas:</strong>
                                    <ul style="font-size: 0.9rem; margin: 0.5rem 0;">
                                        <li>Conhecimento t√©cnico</li>
                                        <li>Qualidade do trabalho</li>
                                        <li>Produtividade</li>
                                        <li>Inova√ß√£o</li>
                                    </ul>
                                </div>
                                <div>
                                    <strong>Compet√™ncias Comportamentais:</strong>
                                    <ul style="font-size: 0.9rem; margin: 0.5rem 0;">
                                        <li>Comunica√ß√£o</li>
                                        <li>Trabalho em equipe</li>
                                        <li>Lideran√ßa</li>
                                        <li>Adaptabilidade</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <div style="text-align: right; margin-top: 2rem;">
                            <button class="btn btn-success" data-action="createEvaluationCycle">üöÄ Iniciar Ciclo de Avalia√ß√£o</button>
                            <button class="btn btn-secondary" data-action="removeElement">Cancelar</button>
                        </div>
                    </div>
                `;
                
                document.getElementById('app').insertAdjacentHTML('beforeend', evaluationHTML);
                showHint('Selecione o funcion√°rio para iniciar a avalia√ß√£o 360¬∞');
            }, 800);
        }
        
        function createEvaluationCycle() {
            const employeeSelect = document.getElementById('eval-employee');
            const employee = employeeSelect.options[employeeSelect.selectedIndex].text;
            const btn = event.target;
            
            if (!employeeSelect.value) {
                showToast('Selecione um funcion√°rio primeiro!', 'warning');
                return;
            }
            
            setButtonLoading(btn, true);
            
            setTimeout(() => {
                showToast(`Ciclo de avalia√ß√£o iniciado para ${employee}!`, 'success');
                btn.parentElement.parentElement.remove();
                setButtonLoading(btn, false);
                showHint('Convites de avalia√ß√£o enviados para todos os participantes');
            }, 2000);
        }
        
        function showGoalManagement() {
            showToast('Carregando gest√£o de metas (OKRs)...', 'info');
            setTimeout(() => {
                const goalsHTML = `
                    <div style="background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin: 1rem 0; max-width: 1000px;">
                        <h3>üéØ Gest√£o de Metas - OKRs (Objectives & Key Results)</h3>
                        
                        <div style="display: flex; justify-content: between; margin: 1rem 0;">
                            <button class="btn btn-primary" data-action="createNewOKR">+ Nova Meta OKR</button>
                        </div>
                        
                        <div class="grid-2" style="gap: 2rem;">
                            <div class="card">
                                <h4>üè¢ Metas Organizacionais</h4>
                                <div style="margin: 1rem 0;">
                                    <div style="border-left: 4px solid #007bff; padding: 1rem; background: #f8f9fa; border-radius: 6px; margin-bottom: 1rem;">
                                        <h5 style="margin: 0 0 0.5rem 0; color: #007bff;">Crescimento de Receita</h5>
                                        <p style="margin: 0.5rem 0; font-size: 0.9rem;">Aumentar receita anual em 25%</p>
                                        <div class="progress-bar" style="margin: 0.5rem 0;">
                                            <div class="progress-fill" style="width: 78%;"></div>
                                        </div>
                                        <small style="color: #6c757d;">78% conclu√≠do - Meta: Dez 2025</small>
                                    </div>
                                    
                                    <div style="border-left: 4px solid #28a745; padding: 1rem; background: #f8f9fa; border-radius: 6px; margin-bottom: 1rem;">
                                        <h5 style="margin: 0 0 0.5rem 0; color: #28a745;">Satisfa√ß√£o do Cliente</h5>
                                        <p style="margin: 0.5rem 0; font-size: 0.9rem;">Atingir NPS de 70 pontos</p>
                                        <div class="progress-bar" style="margin: 0.5rem 0;">
                                            <div class="progress-fill" style="width: 95%; background: linear-gradient(90deg, #28a745, #20c997);"></div>
                                        </div>
                                        <small style="color: #6c757d;">95% conclu√≠do - NPS atual: 67</small>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card">
                                <h4>üë§ Metas Individuais</h4>
                                <div style="margin: 1rem 0;">
                                    <div style="border-left: 4px solid #ffc107; padding: 1rem; background: #f8f9fa; border-radius: 6px; margin-bottom: 1rem;">
                                        <h5 style="margin: 0 0 0.5rem 0; color: #856404;">Jo√£o Silva - Desenvolvedor</h5>
                                        <p style="margin: 0.5rem 0; font-size: 0.9rem;">Implementar 3 features cr√≠ticas</p>
                                        <div class="progress-bar" style="margin: 0.5rem 0;">
                                            <div class="progress-fill" style="width: 67%; background: linear-gradient(90deg, #ffc107, #ffcd39);"></div>
                                        </div>
                                        <small style="color: #6c757d;">2 de 3 features conclu√≠das</small>
                                    </div>
                                    
                                    <div style="border-left: 4px solid #dc3545; padding: 1rem; background: #f8f9fa; border-radius: 6px;">
                                        <h5 style="margin: 0 0 0.5rem 0; color: #dc3545;">Ana Costa - Marketing</h5>
                                        <p style="margin: 0.5rem 0; font-size: 0.9rem;">Gerar 500 leads qualificados</p>
                                        <div class="progress-bar" style="margin: 0.5rem 0;">
                                            <div class="progress-fill" style="width: 45%; background: linear-gradient(90deg, #dc3545, #c82333);"></div>
                                        </div>
                                        <small style="color: #6c757d;">225 leads gerados - Atraso identificado</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div style="background: #e7f3ff; padding: 1rem; border-radius: 6px; margin: 2rem 0; border-left: 4px solid #007bff;">
                            <h5>üìä Resumo Executivo</h5>
                            <div class="grid-3" style="gap: 1rem; text-align: center;">
                                <div>
                                    <strong style="color: #28a745; font-size: 1.5rem;">12</strong>
                                    <p style="margin: 0; font-size: 0.9rem;">Metas Atingidas</p>
                                </div>
                                <div>
                                    <strong style="color: #ffc107; font-size: 1.5rem;">8</strong>
                                    <p style="margin: 0; font-size: 0.9rem;">Em Progresso</p>
                                </div>
                                <div>
                                    <strong style="color: #dc3545; font-size: 1.5rem;">3</strong>
                                    <p style="margin: 0; font-size: 0.9rem;">Atrasadas</p>
                                </div>
                            </div>
                        </div>
                        
                        <div style="text-align: right; margin-top: 2rem;">
                            <button class="btn btn-info" data-action="generateOKRReport">üìä Relat√≥rio de Metas</button>
                            <button class="btn btn-secondary" data-action="removeElement">Fechar</button>
                        </div>
                    </div>
                `;
                
                document.getElementById('app').insertAdjacentHTML('beforeend', goalsHTML);
                showHint('Acompanhe o progresso de todas as metas da empresa');
            }, 1000);
        }
        
        function createNewOKR() {
            showToast('Funcionalidade de cria√ß√£o de OKR ser√° implementada em breve!', 'info');
            showHint('Entre em contato com o RH para definir novas metas');
        }
        
        function generateOKRReport() {
            showToast('Gerando relat√≥rio de metas...', 'info');
            setTimeout(() => {
                showToast('Relat√≥rio de OKRs gerado com sucesso!', 'success');
                showHint('Relat√≥rio enviado para seu email');
            }, 1500);
        }
        
        function createPDI() {
            showToast('Carregando ferramenta de PDI...', 'info');
            setTimeout(() => {
                const pdiHTML = `
                    <div style="background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin: 1rem 0; max-width: 900px;">
                        <h3>üìö Plano de Desenvolvimento Individual (PDI)</h3>
                        
                        <form>
                            <div class="grid-2" style="gap: 1rem; margin: 1rem 0;">
                                <div class="form-group">
                                    <label>Funcion√°rio:</label>
                                    <select required>
                                        <option value="">Selecione...</option>
                                        <option value="joao">Jo√£o Silva - Desenvolvedor Senior</option>
                                        <option value="ana">Ana Costa - Analista Marketing</option>
                                        <option value="carlos">Carlos Mendes - Analista Financeiro</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Per√≠odo do PDI:</label>
                                    <select required>
                                        <option value="">Selecione...</option>
                                        <option value="6m">6 meses</option>
                                        <option value="1a">1 ano</option>
                                        <option value="2a">2 anos</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>Objetivos de Desenvolvimento:</label>
                                <textarea rows="4" placeholder="Descreva os principais objetivos de crescimento profissional..." required></textarea>
                            </div>
                            
                            <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 6px; margin: 1rem 0;">
                                <h5>üéØ √Åreas de Foco (selecione at√© 3)</h5>
                                <div class="grid-2" style="gap: 1rem;">
                                    <div>
                                        <label><input type="checkbox"> Compet√™ncias T√©cnicas</label><br>
                                        <label><input type="checkbox"> Lideran√ßa e Gest√£o</label><br>
                                        <label><input type="checkbox"> Comunica√ß√£o</label><br>
                                        <label><input type="checkbox"> Pensamento Estrat√©gico</label>
                                    </div>
                                    <div>
                                        <label><input type="checkbox"> Inova√ß√£o e Criatividade</label><br>
                                        <label><input type="checkbox"> Relacionamento Interpessoal</label><br>
                                        <label><input type="checkbox"> Resolu√ß√£o de Problemas</label><br>
                                        <label><input type="checkbox"> Desenvolvimento de Equipe</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>A√ß√µes de Desenvolvimento Propostas:</label>
                                <textarea rows="4" placeholder="Ex: Cursos, mentorias, projetos especiais, certifica√ß√µes..." required></textarea>
                            </div>
                            
                            <div class="grid-2" style="gap: 1rem;">
                                <div class="form-group">
                                    <label>Or√ßamento Previsto (R$):</label>
                                    <input type="number" placeholder="0,00" min="0" step="100">
                                </div>
                                <div class="form-group">
                                    <label>Data de Revis√£o:</label>
                                    <input type="date" required>
                                </div>
                            </div>
                            
                            <div style="text-align: right; margin-top: 2rem;">
                                <button type="button" class="btn btn-success" data-action="savePDI">üìã Criar PDI</button>
                                <button type="button" class="btn btn-secondary" data-action="removeElement">Cancelar</button>
                            </div>
                        </form>
                    </div>
                `;
                
                document.getElementById('app').insertAdjacentHTML('beforeend', pdiHTML);
                addFormInteractions();
                showHint('Crie um plano personalizado de desenvolvimento');
            }, 1000);
        }
        
        function savePDI() {
            const btn = event.target;
            setButtonLoading(btn, true);
            
            setTimeout(() => {
                showToast('PDI criado com sucesso!', 'success');
                btn.parentElement.parentElement.remove();
                setButtonLoading(btn, false);
                showHint('Plano de desenvolvimento salvo e notifica√ß√µes enviadas');
            }, 2000);
        }
        
        // Performance Evaluation Functions
        function viewEvaluation(employee) {
            showToast(`Carregando avalia√ß√£o de ${employee}...`, 'info');
            setTimeout(() => {
                showToast('Avalia√ß√£o carregada com sucesso!', 'success');
                showHint('Funcionalidade detalhada ser√° implementada em breve');
            }, 1000);
        }
        
        function generatePDI(employee) {
            showToast(`Gerando PDI baseado na avalia√ß√£o de ${employee}...`, 'info');
            setTimeout(() => {
                showToast('PDI autom√°tico gerado!', 'success');
                showHint('PDI criado com base nos pontos de melhoria identificados');
            }, 1500);
        }
        
        function continueEvaluation(employee) {
            showToast(`Continuando avalia√ß√£o de ${employee}...`, 'info');
            setTimeout(() => {
                showHint('Redirecionando para formul√°rio de avalia√ß√£o...');
            }, 800);
        }
        
        // Automation Functions
        function sendChatMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            
            if (!message) {
                showToast('Digite uma mensagem primeiro!', 'warning');
                return;
            }
            
            const chatMessages = document.getElementById('chat-messages');
            
            // Add user message
            const userMessage = document.createElement('div');
            userMessage.style.marginBottom = '1rem';
            userMessage.style.textAlign = 'right';
            userMessage.innerHTML = `
                <div style="background: #007bff; color: white; padding: 0.5rem 1rem; border-radius: 15px; display: inline-block; max-width: 80%;">
                    <small style="color: #e3f2fd;">Voc√™</small><br>
                    ${message}
                </div>
            `;
            chatMessages.appendChild(userMessage);
            
            input.value = '';
            
            // Show typing indicator
            const typingMessage = document.createElement('div');
            typingMessage.style.marginBottom = '1rem';
            typingMessage.innerHTML = `
                <div style="background: #f8f9fa; padding: 0.5rem 1rem; border-radius: 15px; display: inline-block; max-width: 80%;">
                    <small style="color: #6c757d;">Thermas Bot</small><br>
                    <span class="animate-pulse">Digitando...</span>
                </div>
            `;
            chatMessages.appendChild(typingMessage);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Simulate AI response
            setTimeout(() => {
                typingMessage.remove();
                
                const responses = [
                    "Com base na an√°lise dos dados, recomendo revisar a pol√≠tica de horas extras no departamento de TI. O aumento de 40% pode indicar sobrecarga de trabalho.",
                    "Para otimizar o processo de contrata√ß√£o, sugiro implementar triagem autom√°tica de curr√≠culos com IA. Isso pode reduzir o tempo m√©dio em 5 dias.",
                    "Identifiquei que funcion√°rios com mais de 3 anos na empresa t√™m 85% menos probabilidade de sair. Recomendo focar na reten√ß√£o no primeiro ano.",
                    "A an√°lise preditiva mostra necessidade de 2 novos analistas no marketing para Q4. Posso iniciar o processo de recrutamento automaticamente.",
                    "Detectei padr√£o de baixo engajamento na equipe de vendas. Recomendo implementar programa de reconhecimento e feedback cont√≠nuo."
                ];
                
                const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                
                const botMessage = document.createElement('div');
                botMessage.style.marginBottom = '1rem';
                botMessage.innerHTML = `
                    <div style="background: #e3f2fd; padding: 0.5rem 1rem; border-radius: 15px; display: inline-block; max-width: 80%;">
                        <small style="color: #6c757d;">Thermas Bot</small><br>
                        ${randomResponse}
                    </div>
                `;
                chatMessages.appendChild(botMessage);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                showHint('Thermas Bot respondeu com insights inteligentes!');
            }, 2000);
        }
        
        function createNewWorkflow() {
            showToast('Carregando criador de workflows...', 'info');
            setTimeout(() => {
                const workflowHTML = `
                    <div style="background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin: 1rem 0; max-width: 800px;">
                        <h3>‚öôÔ∏è Criar Novo Workflow Autom√°tico</h3>
                        
                        <form>
                            <div class="form-group">
                                <label>Nome do Workflow:</label>
                                <input type="text" placeholder="Ex: Processo de Demiss√£o Autom√°tico" required>
                            </div>
                            
                            <div class="form-group">
                                <label>Gatilho (Trigger):</label>
                                <select required>
                                    <option value="">Selecione o evento que inicia o workflow...</option>
                                    <option value="new-employee">Novo funcion√°rio cadastrado</option>
                                    <option value="vacation-request">Solicita√ß√£o de f√©rias</option>
                                    <option value="performance-review">Avalia√ß√£o de performance conclu√≠da</option>
                                    <option value="resignation">Pedido de demiss√£o</option>
                                    <option value="birthday">Anivers√°rio do funcion√°rio</option>
                                    <option value="training-completion">Treinamento conclu√≠do</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label>A√ß√µes Autom√°ticas:</label>
                                <div style="background: #f8f9fa; padding: 1rem; border-radius: 6px; margin: 0.5rem 0;">
                                    <div class="workflow-actions">
                                        <label><input type="checkbox"> Enviar email de notifica√ß√£o</label><br>
                                        <label><input type="checkbox"> Criar tarefa para o gestor</label><br>
                                        <label><input type="checkbox"> Atualizar status no sistema</label><br>
                                        <label><input type="checkbox"> Gerar documento automaticamente</label><br>
                                        <label><input type="checkbox"> Agendar reuni√£o</label><br>
                                        <label><input type="checkbox"> Integrar com sistema externo</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="grid-2" style="gap: 1rem;">
                                <div class="form-group">
                                    <label>Prioridade:</label>
                                    <select required>
                                        <option value="low">Baixa</option>
                                        <option value="medium" selected>M√©dia</option>
                                        <option value="high">Alta</option>
                                        <option value="urgent">Urgente</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Departamento:</label>
                                    <select>
                                        <option value="">Todos os departamentos</option>
                                        <option value="ti">TI</option>
                                        <option value="rh">RH</option>
                                        <option value="vendas">Vendas</option>
                                        <option value="marketing">Marketing</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div style="background: #e7f3ff; padding: 1rem; border-radius: 6px; margin: 1rem 0; border-left: 4px solid #007bff;">
                                <strong>üí° Dica:</strong> Workflows bem configurados podem automatizar at√© 80% das tarefas repetitivas de RH, economizando tempo valioso da equipe.
                            </div>
                            
                            <div style="text-align: right; margin-top: 2rem;">
                                <button type="button" class="btn btn-success" data-action="saveNewWorkflow">üöÄ Criar Workflow</button>
                                <button type="button" class="btn btn-secondary" data-action="removeElement">Cancelar</button>
                            </div>
                        </form>
                    </div>
                `;
                
                document.getElementById('app').insertAdjacentHTML('beforeend', workflowHTML);
                addFormInteractions();
                showHint('Configure as a√ß√µes que devem acontecer automaticamente');
            }, 1000);
        }
        
        function saveNewWorkflow() {
            const btn = event.target;
            setButtonLoading(btn, true);
            
            setTimeout(() => {
                showToast('Workflow criado e ativado com sucesso!', 'success');
                btn.parentElement.parentElement.remove();
                setButtonLoading(btn, false);
                showHint('Novo workflow est√° funcionando em segundo plano');
            }, 2000);
        }
        
        // Integration Functions
        function addNewIntegration() {
            showToast('Carregando cat√°logo de integra√ß√µes...', 'info');
            setTimeout(() => {
                const integrationHTML = `
                    <div style="background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin: 1rem 0; max-width: 900px;">
                        <h3>üîó Adicionar Nova Integra√ß√£o</h3>
                        
                        <div style="background: #f8f9fa; padding: 1rem; border-radius: 6px; margin: 1rem 0;">
                            <h5>üèÜ Integra√ß√µes Recomendadas</h5>
                            <div class="grid-3" style="gap: 1rem; margin-top: 1rem;">
                                <div class="integration-option" style="border: 2px solid #28a745; border-radius: 8px; padding: 1rem; text-align: center; cursor: pointer;" data-action="selectIntegration" data-param="sap">
                                    <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üíº</div>
                                    <h6 style="margin: 0.5rem 0;">SAP SuccessFactors</h6>
                                    <small style="color: #6c757d;">Sistema completo de gest√£o de pessoas</small>
                                    <div style="background: #28a745; color: white; padding: 0.25rem 0.5rem; border-radius: 12px; font-size: 0.8rem; margin-top: 0.5rem;">Recomendado</div>
                                </div>
                                
                                <div class="integration-option" style="border: 1px solid #e9ecef; border-radius: 8px; padding: 1rem; text-align: center; cursor: pointer;" data-action="selectIntegration" data-param="workday">
                                    <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üè¢</div>
                                    <h6 style="margin: 0.5rem 0;">Workday HCM</h6>
                                    <small style="color: #6c757d;">Plataforma global de RH</small>
                                </div>
                                
                                <div class="integration-option" style="border: 1px solid #e9ecef; border-radius: 8px; padding: 1rem; text-align: center; cursor: pointer;" data-action="selectIntegration" data-param="metabase">
                                    <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üìä</div>
                                    <h6 style="margin: 0.5rem 0;">Metabase</h6>
                                    <small style="color: #6c757d;">Business Intelligence</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Ou configure integra√ß√£o personalizada:</label>
                            <input type="text" placeholder="URL da API ou nome do sistema...">
                        </div>
                        
                        <div id="integration-config" style="display: none;">
                            <div style="background: #fff3cd; padding: 1rem; border-radius: 6px; margin: 1rem 0; border-left: 4px solid #ffc107;">
                                <h6>‚öôÔ∏è Configura√ß√£o da Integra√ß√£o</h6>
                                <div class="grid-2" style="gap: 1rem; margin-top: 1rem;">
                                    <div class="form-group">
                                        <label>Endpoint da API:</label>
                                        <input type="url" placeholder="https://api.exemplo.com/v1">
                                    </div>
                                    <div class="form-group">
                                        <label>M√©todo de Autentica√ß√£o:</label>
                                        <select>
                                            <option>OAuth 2.0</option>
                                            <option>API Key</option>
                                            <option>Bearer Token</option>
                                            <option>Basic Auth</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Frequ√™ncia de Sincroniza√ß√£o:</label>
                                    <select>
                                        <option>Tempo real</option>
                                        <option>A cada 15 minutos</option>
                                        <option>Hora em hora</option>
                                        <option>Diariamente</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div style="text-align: right; margin-top: 2rem;">
                            <button class="btn btn-success" data-action="setupIntegration">üîó Configurar Integra√ß√£o</button>
                            <button class="btn btn-secondary" data-action="removeElement">Cancelar</button>
                        </div>
                    </div>
                `;
                
                document.getElementById('app').insertAdjacentHTML('beforeend', integrationHTML);
                addFormInteractions();
                showHint('Escolha uma integra√ß√£o recomendada ou configure uma personalizada');
            }, 1200);
        }
        
        function selectIntegration(type) {
            const integrations = {
                'sap': 'SAP SuccessFactors',
                'workday': 'Workday HCM', 
                'metabase': 'Metabase'
            };
            
            showToast(`${integrations[type]} selecionado!`, 'success');
            document.getElementById('integration-config').style.display = 'block';
            
            // Highlight selected integration
            document.querySelectorAll('.integration-option').forEach(option => {
                option.style.borderColor = '#e9ecef';
            });
            event.currentTarget.style.borderColor = '#007bff';
        }
        
        function setupIntegration() {
            const btn = event.target;
            setButtonLoading(btn, true);
            
            setTimeout(() => {
                showToast('Integra√ß√£o configurada com sucesso!', 'success');
                btn.parentElement.parentElement.remove();
                setButtonLoading(btn, false);
                showHint('Nova integra√ß√£o est√° sincronizando dados...');
            }, 2500);
        }
        
        function installIntegration(type) {
            const integrations = {
                'openbanking': 'Open Banking',
                'whatsapp': 'WhatsApp Business',
                'powerbi': 'Power BI',
                'alura': 'Alura Empresarial'
            };
            
            const btn = event.target;
            setButtonLoading(btn, true);
            
            setTimeout(() => {
                showToast(`${integrations[type]} instalado com sucesso!`, 'success');
                btn.textContent = '‚úÖ Instalado';
                btn.className = 'btn btn-success btn-sm mt-1';
                btn.disabled = true;
                setButtonLoading(btn, false);
                showHint(`${integrations[type]} est√° pronto para usar!`);
            }, 2000);
        }
        
        function viewAPIDocumentation() {
            showToast('Carregando documenta√ß√£o da API...', 'info');
            setTimeout(() => {
                const docHTML = `
                    <div style="background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin: 1rem 0; max-width: 1000px;">
                        <h3>üìã Documenta√ß√£o da API - Sistema RH Pro</h3>
                        
                        <div style="background: #f8f9fa; padding: 1rem; border-radius: 6px; margin: 1rem 0;">
                            <h5>üîß Endpoints Principais</h5>
                            <div style="font-family: monospace; font-size: 0.9rem; margin: 1rem 0;">
                                <div style="margin: 0.5rem 0;"><strong>GET</strong> /api/v1/employees - Lista todos os funcion√°rios</div>
                                <div style="margin: 0.5rem 0;"><strong>POST</strong> /api/v1/employees - Criar novo funcion√°rio</div>
                                <div style="margin: 0.5rem 0;"><strong>GET</strong> /api/v1/requests - Lista solicita√ß√µes</div>
                                <div style="margin: 0.5rem 0;"><strong>POST</strong> /api/v1/evaluations - Criar avalia√ß√£o</div>
                                <div style="margin: 0.5rem 0;"><strong>GET</strong> /api/v1/analytics - Dados de analytics</div>
                            </div>
                        </div>
                        
                        <div style="background: #e7f3ff; padding: 1rem; border-radius: 6px; margin: 1rem 0; border-left: 4px solid #007bff;">
                            <h6>üîë Autentica√ß√£o</h6>
                            <p style="margin: 0.5rem 0;">Todas as requisi√ß√µes devem incluir o header:</p>
                            <code style="background: #f1f3f4; padding: 0.25rem 0.5rem; border-radius: 4px;">Authorization: Bearer YOUR_API_KEY</code>
                        </div>
                        
                        <div style="background: #d4edda; padding: 1rem; border-radius: 6px; margin: 1rem 0; border-left: 4px solid #28a745;">
                            <h6>üìä Rate Limits</h6>
                            <ul style="margin: 0.5rem 0;">
                                <li>1000 requisi√ß√µes por hora por API key</li>
                                <li>Webhooks: at√© 100 por minuto</li>
                                <li>Bulk operations: at√© 1000 registros por vez</li>
                            </ul>
                        </div>
                        
                        <div style="text-align: right; margin-top: 2rem;">
                            <button class="btn btn-primary" data-action="downloadAPIKey">üîë Gerar API Key</button>
                            <button class="btn btn-secondary" data-action="removeElement">Fechar</button>
                        </div>
                    </div>
                `;
                
                document.getElementById('app').insertAdjacentHTML('beforeend', docHTML);
                showHint('Documenta√ß√£o completa da API dispon√≠vel');
            }, 1000);
        }
        
        function downloadAPIKey() {
            showToast('Gerando nova API key...', 'info');
            setTimeout(() => {
                const apiKey = 'rh_' + Math.random().toString(36).substr(2, 24);
                showToast(`API Key gerada: ${apiKey}`, 'success');
                showHint('Guarde esta chave em local seguro - ela n√£o ser√° exibida novamente');
            }, 1500);
        }
        
        // Compliance Functions
        function generateLGPDReport() {
            const btn = event.target;
            setButtonLoading(btn, true);
            showToast('Gerando relat√≥rio de conformidade LGPD...', 'info');
            
            setTimeout(() => {
                const reportHTML = `
                    <div style="background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin: 1rem 0; max-width: 900px;">
                        <h3>üìä Relat√≥rio de Conformidade LGPD - Agosto 2025</h3>
                        
                        <div style="background: #d4edda; padding: 1rem; border-radius: 6px; margin: 1rem 0; text-align: center; border-left: 4px solid #28a745;">
                            <h4 style="margin: 0; color: #155724;">Score de Conformidade: 98.7%</h4>
                            <small>Status: Excelente - Acima dos padr√µes da ind√∫stria</small>
                        </div>
                        
                        <div class="grid-2" style="gap: 2rem; margin: 2rem 0;">
                            <div>
                                <h5>‚úÖ Controles Implementados</h5>
                                <ul style="list-style: none; padding: 0;">
                                    <li style="margin: 0.5rem 0;">üîê Criptografia AES-256 - 100%</li>
                                    <li style="margin: 0.5rem 0;">üìã Consentimentos documentados - 100%</li>
                                    <li style="margin: 0.5rem 0;">üóëÔ∏è Direito ao esquecimento - 100%</li>
                                    <li style="margin: 0.5rem 0;">üì§ Portabilidade de dados - 100%</li>
                                    <li style="margin: 0.5rem 0;">üë• Controle de acesso - 98%</li>
                                    <li style="margin: 0.5rem 0;">üìä Logs de auditoria - 100%</li>
                                </ul>
                            </div>
                            
                            <div>
                                <h5>üìà M√©tricas do Per√≠odo</h5>
                                <div style="background: #f8f9fa; padding: 1rem; border-radius: 6px;">
                                    <p><strong>Solicita√ß√µes de Titulares:</strong> 24</p>
                                    <p><strong>Tempo M√©dio de Resposta:</strong> 2.3 dias</p>
                                    <p><strong>Taxa de Resolu√ß√£o:</strong> 100%</p>
                                    <p><strong>Incidentes de Seguran√ßa:</strong> 0</p>
                                    <p><strong>Treinamentos Realizados:</strong> 42 pessoas</p>
                                </div>
                            </div>
                        </div>
                        
                        <div style="background: #e7f3ff; padding: 1rem; border-radius: 6px; margin: 1rem 0; border-left: 4px solid #007bff;">
                            <h5>üéØ Pr√≥ximas A√ß√µes</h5>
                            <ol style="margin: 0.5rem 0;">
                                <li>Finalizar treinamento LGPD para novos funcion√°rios</li>
                                <li>Revisar pol√≠ticas de reten√ß√£o de dados</li>
                                <li>Implementar scanner autom√°tico de vulnerabilidades</li>
                                <li>Preparar relat√≥rio anual para ANPD</li>
                            </ol>
                        </div>
                        
                        <div style="text-align: right; margin-top: 2rem;">
                            <button class="btn btn-success" data-action="downloadComplianceReport">üì• Baixar PDF</button>
                            <button class="btn btn-secondary" data-action="closeModal">Fechar</button>
                        </div>
                    </div>
                `;
                
                document.getElementById('app').insertAdjacentHTML('beforeend', reportHTML);
                setButtonLoading(btn, false);
                showToast('Relat√≥rio LGPD gerado com sucesso!', 'success');
                showHint('Relat√≥rio dispon√≠vel para download');
            }, 2500);
        }
        
        function downloadComplianceReport() {
            showToast('Download do relat√≥rio de conformidade iniciado!', 'success');
            showHint('Arquivo PDF salvo na pasta Downloads');
        }
        
        function viewFullAuditLog() {
            showToast('Carregando log completo de auditoria...', 'info');
            setTimeout(() => {
                const logHTML = `
                    <div style="background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin: 1rem 0; max-width: 1000px;">
                        <h3>üîç Log Completo de Auditoria</h3>
                        
                        <div style="margin: 1rem 0;">
                            <input type="text" placeholder="Filtrar por usu√°rio, a√ß√£o ou data..." style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 6px;">
                        </div>
                        
                        <div style="max-height: 400px; overflow-y: auto; border: 1px solid #e9ecef; border-radius: 6px;">
                            <div class="table-grid table-header-row" style="grid-template-columns: 1fr 1fr 1fr 80px;">
                                <span>A√ß√£o</span>
                                <span>Usu√°rio</span>
                                <span>Data/Hora</span>
                                <span>Status</span>
                            </div>
                            <div class="table-grid" style="grid-template-columns: 1fr 1fr 1fr 80px;">
                                <span>Acesso aos dados de Jo√£o Silva</span>
                                <span>Maria Santos (RH)</span>
                                <span>22/08/2025 17:15</span>
                                <span style="color: #28a745;">‚úÖ</span>
                            </div>
                            <div class="table-grid" style="grid-template-columns: 1fr 1fr 1fr 80px;">
                                <span>Exporta√ß√£o relat√≥rio salarial</span>
                                <span>Pedro Admin</span>
                                <span>22/08/2025 16:45</span>
                                <span style="color: #28a745;">‚úÖ</span>
                            </div>
                            <div class="table-grid" style="grid-template-columns: 1fr 1fr 1fr 80px;">
                                <span>Login no sistema</span>
                                <span>Ana Costa</span>
                                <span>22/08/2025 16:30</span>
                                <span style="color: #28a745;">‚úÖ</span>
                            </div>
                            <div class="table-grid" style="grid-template-columns: 1fr 1fr 1fr 80px;">
                                <span>Backup autom√°tico</span>
                                <span>Sistema</span>
                                <span>22/08/2025 03:00</span>
                                <span style="color: #28a745;">‚úÖ</span>
                            </div>
                            <div class="table-grid" style="grid-template-columns: 1fr 1fr 1fr 80px;">
                                <span>Altera√ß√£o de senha</span>
                                <span>Carlos Mendes</span>
                                <span>21/08/2025 14:22</span>
                                <span style="color: #28a745;">‚úÖ</span>
                            </div>
                        </div>
                        
                        <div style="text-align: right; margin-top: 1rem;">
                            <button class="btn btn-primary" data-action="exportAuditLog">üìä Exportar Log</button>
                            <button class="btn btn-secondary" data-action="closeModal">Fechar</button>
                        </div>
                    </div>
                `;
                
                document.getElementById('app').insertAdjacentHTML('beforeend', logHTML);
                showHint('Log completo carregado - use o filtro para buscar');
            }, 1000);
        }
        
        function exportAuditLog() {
            showToast('Exportando log de auditoria...', 'info');
            setTimeout(() => {
                showToast('Log exportado com sucesso!', 'success');
                showHint('Arquivo CSV salvo na pasta Downloads');
            }, 1500);
        }
        
        // Executive Functions
        function generateStrategicReport() {
            const btn = event.target;
            setButtonLoading(btn, true);
            showToast('Gerando relat√≥rio estrat√©gico executivo...', 'info');
            
            setTimeout(() => {
                const reportHTML = `
                    <div style="background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin: 1rem 0; max-width: 1000px;">
                        <h3>üìä Relat√≥rio Estrat√©gico - Q3 2025</h3>
                        
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 1.5rem; border-radius: 8px; margin: 1rem 0; text-align: center;">
                            <h4 style="margin: 0;">ROI Global: 385%</h4>
                            <p style="margin: 0.5rem 0;">Investimentos em RH geraram R$ 3.85 para cada R$ 1 investido</p>
                        </div>
                        
                        <div class="grid-2" style="gap: 2rem; margin: 2rem 0;">
                            <div>
                                <h5>üéØ Metas Estrat√©gicas 2025</h5>
                                <div style="background: #f8f9fa; padding: 1rem; border-radius: 6px;">
                                    <div style="margin: 0.5rem 0;">
                                        <span>Crescimento Receita: 78% ‚úÖ</span>
                                        <div style="background: #e9ecef; border-radius: 10px; height: 8px; margin: 0.25rem 0;">
                                            <div style="background: #28a745; height: 8px; border-radius: 10px; width: 78%;"></div>
                                        </div>
                                    </div>
                                    <div style="margin: 0.5rem 0;">
                                        <span>Expans√£o Mercado: 92% ‚úÖ</span>
                                        <div style="background: #e9ecef; border-radius: 10px; height: 8px; margin: 0.25rem 0;">
                                            <div style="background: #007bff; height: 8px; border-radius: 10px; width: 92%;"></div>
                                        </div>
                                    </div>
                                    <div style="margin: 0.5rem 0;">
                                        <span>Inova√ß√£o Produtos: 65% ‚ö†Ô∏è</span>
                                        <div style="background: #e9ecef; border-radius: 10px; height: 8px; margin: 0.25rem 0;">
                                            <div style="background: #ffc107; height: 8px; border-radius: 10px; width: 65%;"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <h5>üí∞ Impacto Financeiro</h5>
                                <div style="background: #d4edda; padding: 1rem; border-radius: 6px;">
                                    <p><strong>Economia com Automa√ß√£o:</strong> R$ 1.8M</p>
                                    <p><strong>Redu√ß√£o Turnover:</strong> R$ 850K</p>
                                    <p><strong>Otimiza√ß√£o Processos:</strong> R$ 640K</p>
                                    <p><strong>ROI Treinamentos:</strong> R$ 420K</p>
                                    <hr>
                                    <p><strong>Total Economizado:</strong> R$ 3.71M</p>
                                </div>
                            </div>
                        </div>
                        
                        <div style="background: #e7f3ff; padding: 1rem; border-radius: 6px; margin: 2rem 0; border-left: 4px solid #007bff;">
                            <h5>üöÄ Recomenda√ß√µes Estrat√©gicas</h5>
                            <ol style="margin: 0.5rem 0;">
                                <li><strong>Q4 2025:</strong> Investir R$ 2M em automa√ß√£o avan√ßada</li>
                                <li><strong>Q1 2026:</strong> Expandir para 2 novas regi√µes</li>
                                <li><strong>Cont√≠nuo:</strong> Acelerar programa de inova√ß√£o</li>
                                <li><strong>2026:</strong> IPO ou capta√ß√£o S√©rie B</li>
                            </ol>
                        </div>
                        
                        <div style="text-align: right; margin-top: 2rem;">
                            <button class="btn btn-success" data-action="downloadStrategicReport">üì• Baixar PDF Executivo</button>
                            <button class="btn btn-secondary" data-action="closeModal">Fechar</button>
                        </div>
                    </div>
                `;
                
                document.getElementById('app').insertAdjacentHTML('beforeend', reportHTML);
                setButtonLoading(btn, false);
                showToast('Relat√≥rio estrat√©gico gerado!', 'success');
                showHint('Relat√≥rio executivo pronto para apresenta√ß√£o');
            }, 3000);
        }
        
        function downloadStrategicReport() {
            showToast('Download do relat√≥rio estrat√©gico iniciado!', 'success');
            showHint('PDF executivo salvo com gr√°ficos e insights');
        }
        
        function scheduleExecutiveMeeting() {
            const btn = event.target;
            setButtonLoading(btn, true);
            showToast('Verificando agenda da lideran√ßa...', 'info');
            
            setTimeout(() => {
                const meetingHTML = `
                    <div style="background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin: 1rem 0; max-width: 800px;">
                        <h3>üìÖ Agendar Reuni√£o Executiva</h3>
                        
                        <div style="background: #f8f9fa; padding: 1rem; border-radius: 6px; margin: 1rem 0;">
                            <h5>üë• Participantes Sugeridos</h5>
                            <div class="grid-2" style="gap: 1rem;">
                                <div>
                                    <label><input type="checkbox" checked> CEO - Carlos Silva</label><br>
                                    <label><input type="checkbox" checked> CFO - Lucia Fernandez</label><br>
                                    <label><input type="checkbox"> CTO - Marco Oliveira</label><br>
                                    <label><input type="checkbox" checked> CHRO - Maria Santos</label>
                                </div>
                                <div>
                                    <label><input type="checkbox"> Diretor Comercial</label><br>
                                    <label><input type="checkbox"> Diretor Marketing</label><br>
                                    <label><input type="checkbox"> Diretor Opera√ß√µes</label><br>
                                    <label><input type="checkbox"> Consultor Externo</label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="grid-2" style="gap: 1rem;">
                            <div class="form-group">
                                <label>Assunto da Reuni√£o:</label>
                                <select>
                                    <option>Revis√£o Estrat√©gica Q3</option>
                                    <option>Planejamento 2026</option>
                                    <option>Aprova√ß√£o de Investimentos</option>
                                    <option>An√°lise de Performance</option>
                                    <option>Decis√µes Cr√≠ticas</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Dura√ß√£o:</label>
                                <select>
                                    <option>1 hora</option>
                                    <option>1h 30min</option>
                                    <option>2 horas</option>
                                    <option>Meio dia</option>
                                    <option>Dia inteiro</option>
                                </select>
                            </div>
                        </div>
                        
                        <div style="background: #e7f3ff; padding: 1rem; border-radius: 6px; margin: 1rem 0; border-left: 4px solid #007bff;">
                            <h6>üìä Hor√°rios Dispon√≠veis (Pr√≥xima Semana)</h6>
                            <div style="margin: 0.5rem 0;">
                                <button class="btn btn-outline-primary btn-sm" style="margin: 0.25rem;">Seg 14:00-16:00</button>
                                <button class="btn btn-outline-primary btn-sm" style="margin: 0.25rem;">Ter 09:00-11:00</button>
                                <button class="btn btn-outline-primary btn-sm" style="margin: 0.25rem;">Qui 15:00-17:00</button>
                                <button class="btn btn-outline-primary btn-sm" style="margin: 0.25rem;">Sex 10:00-12:00</button>
                            </div>
                        </div>
                        
                        <div style="text-align: right; margin-top: 2rem;">
                            <button class="btn btn-success" data-action="confirmMeeting">üìÖ Confirmar Reuni√£o</button>
                            <button class="btn btn-secondary" data-action="closeModal">Cancelar</button>
                        </div>
                    </div>
                `;
                
                document.getElementById('app').insertAdjacentHTML('beforeend', meetingHTML);
                setButtonLoading(btn, false);
                showHint('Selecione hor√°rio e participantes para a reuni√£o');
            }, 1500);
        }
        
        function confirmMeeting() {
            const btn = event.target;
            setButtonLoading(btn, true);
            
            setTimeout(() => {
                showToast('Reuni√£o agendada com sucesso!', 'success');
                btn.parentElement.parentElement.remove();
                setButtonLoading(btn, false);
                showHint('Convites enviados para todos os participantes');
            }, 2000);
        }
        
        // Real-time dashboard updates
        async function updateDashboardMetrics() {
            try {
                console.log('üìä Atualizando m√©tricas do dashboard...');
                
                const response = await fetchWithAuth('/api/dashboard/analytics', {
                    headers: getAuthHeaders()
                });
                const result = await response.json();
                
                if (result.success) {
                    const metrics = result.data;
                    
                    // Animate counter changes
                    ['totalEmployees', 'newHires', 'pendingRequests', 'avgTimeHire'].forEach(key => {
                        const element = document.getElementById(key);
                        if (element && metrics[key] !== undefined) {
                            const currentValue = parseInt(element.textContent);
                            const newValue = metrics[key];
                            
                            if (currentValue !== newValue) {
                                element.classList.add('animate-pulse');
                                setTimeout(() => {
                                    element.textContent = newValue;
                                    element.classList.remove('animate-pulse');
                                }, 300);
                            }
                            
                            // Update trend text
                            const trendElement = element.parentElement.querySelector('.stat-trend');
                            if (trendElement) {
                                trendElement.textContent = newValue > 0 ? 'Dados atualizados' : 'Nenhum registro';
                            }
                        }
                    });
                    
                    // Update department chart if we have data
                    if (metrics.departmentStats && metrics.departmentStats.length > 0) {
                        updateDepartmentChart(metrics.departmentStats);
                    }
                    
                    console.log('‚úÖ M√©tricas atualizadas:', metrics);
                } else {
                    console.error('‚ùå Erro ao buscar m√©tricas:', result.error);
                }
                
            } catch (error) {
                console.error('‚ùå Erro ao atualizar m√©tricas:', error);
            }
        }
        
        // Update department chart with real data
        function updateDepartmentChart(departmentStats) {
            const chartContainer = document.getElementById('departmentChart');
            if (!chartContainer) return;
            
            if (departmentStats.length === 0) {
                chartContainer.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: #6c757d;">
                        Nenhum departamento cadastrado
                    </div>
                `;
                return;
            }
            
            const maxCount = Math.max(...departmentStats.map(d => d.employee_count));
            
            let chartHTML = '<div style="padding: 1rem;">';
            departmentStats.forEach(dept => {
                const percentage = maxCount > 0 ? (dept.employee_count / maxCount) * 100 : 0;
                const color = dept.employee_count > 0 ? '#007bff' : '#e9ecef';
                
                chartHTML += `
                    <div style="margin-bottom: 1rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                            <span style="font-weight: 500; color: #333;">${dept.name || 'Sem nome'}</span>
                            <span style="font-weight: bold; color: ${color};">${dept.employee_count}</span>
                        </div>
                        <div style="background: #f8f9fa; border-radius: 4px; height: 8px; overflow: hidden;">
                            <div style="background: ${color}; height: 100%; width: ${percentage}%; transition: width 0.3s ease;"></div>
                        </div>
                    </div>
                `;
            });
            chartHTML += '</div>';
            
            chartContainer.innerHTML = chartHTML;
        }
        
        // Add progress feedback for CBO search
        function searchCbo() {
            const searchTerm = document.getElementById('cboSearch').value.toLowerCase();
            const grupo = document.getElementById('cboGrupo').value;
            
            // Show loading state
            const container = document.getElementById('cbo-results');
            const loadingRow = document.createElement('div');
            loadingRow.className = 'table-grid';
            loadingRow.style.gridTemplateColumns = '1fr';
            loadingRow.style.textAlign = 'center';
            loadingRow.style.padding = '2rem';
            loadingRow.innerHTML = '<span class="animate-pulse">üîç Buscando na CBO...</span>';
            
            // Clear existing results
            const existingRows = container.querySelectorAll('.table-grid:not(.table-header-row)');
            existingRows.forEach(row => row.remove());
            container.appendChild(loadingRow);
            
            // Simulate search delay
            setTimeout(() => {
                loadingRow.remove();
                performCboSearch(searchTerm, grupo);
            }, 800);
        }
        
        function performCboSearch(searchTerm, grupo) {
            // Original search logic with enhanced results display
            const cboData = [
                { codigo: '1414-05', titulo: 'Diretor de recursos humanos', grupo: '1', grupoNome: 'Membros superiores do poder p√∫blico' },
                { codigo: '2516-05', titulo: 'Analista de recursos humanos', grupo: '2', grupoNome: 'Profissionais das ci√™ncias e das artes' },
                { codigo: '4110-05', titulo: 'Auxiliar de pessoal', grupo: '4', grupoNome: 'Trabalhadores de servi√ßos administrativos' },
                { codigo: '1237-10', titulo: 'Diretor administrativo', grupo: '1', grupoNome: 'Membros superiores do poder p√∫blico' },
                { codigo: '2124-05', titulo: 'Administrador', grupo: '2', grupoNome: 'Profissionais das ci√™ncias e das artes' },
                { codigo: '3171-05', titulo: 'T√©cnico em inform√°tica', grupo: '3', grupoNome: 'T√©cnicos de n√≠vel m√©dio' },
                { codigo: '2123-05', titulo: 'Engenheiro de software', grupo: '2', grupoNome: 'Profissionais das ci√™ncias e das artes' },
                { codigo: '4110-10', titulo: 'Assistente administrativo', grupo: '4', grupoNome: 'Trabalhadores de servi√ßos administrativos' },
                { codigo: '2521-05', titulo: 'Contador', grupo: '2', grupoNome: 'Profissionais das ci√™ncias e das artes' },
                { codigo: '1425-10', titulo: 'Gerente financeiro', grupo: '1', grupoNome: 'Membros superiores do poder p√∫blico' }
            ];

            let filteredData = cboData;

            if (searchTerm) {
                filteredData = filteredData.filter(item => 
                    item.titulo.toLowerCase().includes(searchTerm) || 
                    item.codigo.includes(searchTerm)
                );
            }

            if (grupo) {
                filteredData = filteredData.filter(item => item.grupo === grupo);
            }

            updateCboResults(filteredData);
            
            if (filteredData.length > 0) {
                showHint(`${filteredData.length} cargo(s) encontrado(s)!`);
            }
        }
        
        function clearCollaboratorPortalData() {
            const selfServiceSection = document.getElementById('self-service');
            if (selfServiceSection) {
                // Clear employee profile name and info
                const profileName = selfServiceSection.querySelector('h5');
                if (profileName && profileName.textContent === 'Jo√£o Silva') {
                    profileName.textContent = '[Nome n√£o definido]';
                }
                
                // Clear job title and department
                const profileTexts = selfServiceSection.querySelectorAll('p');
                profileTexts.forEach(p => {
                    if (p.textContent.includes('Desenvolvedor Senior')) {
                        p.textContent = '[Cargo n√£o definido]';
                    } else if (p.textContent.includes('Departamento de TI')) {
                        p.textContent = '[Departamento n√£o definido]';
                    }
                });
                
                // Clear all employee personal data in profile
                const profileDetails = selfServiceSection.querySelectorAll('p');
                profileDetails.forEach(p => {
                    if (p.innerHTML.includes('joao.silva@thermas.com')) {
                        p.innerHTML = '<strong>Email:</strong> [n√£o definido]';
                    } else if (p.innerHTML.includes('(11) 99999-9999')) {
                        p.innerHTML = '<strong>Telefone:</strong> [n√£o definido]';
                    } else if (p.innerHTML.includes('15/03/2022')) {
                        p.innerHTML = '<strong>Data de Admiss√£o:</strong> [n√£o definido]';
                    } else if (p.innerHTML.includes('Ativo')) {
                        p.innerHTML = '<strong>Status:</strong> <span style="color: #6c757d;">[n√£o definido]</span>';
                    }
                });
                
                // Clear vacation balance and other personal data
                const balanceTexts = selfServiceSection.querySelectorAll('div[style*="color: #007bff"], div[style*="color: #28a745"], div[style*="color: #ffc107"]');
                balanceTexts.forEach(div => {
                    if (div.textContent.includes('Saldo: 25 dias')) {
                        div.textContent = 'Saldo: 0 dias';
                        div.style.color = '#6c757d';
                    } else if (div.textContent.includes('Limite: R$ 1.500')) {
                        div.textContent = 'Limite: R$ 0';
                        div.style.color = '#6c757d';
                    } else if (div.textContent.includes('Saldo: +12h 30min')) {
                        div.textContent = 'Saldo: 0h';
                        div.style.color = '#6c757d';
                    }
                });
                
                // Clear requests table in portal
                const portalTables = selfServiceSection.querySelectorAll('.table-grid:not(.table-header-row)');
                portalTables.forEach(row => row.remove());
                
                // Add empty message to portal table
                const portalTableContainer = selfServiceSection.querySelector('.table-container');
                if (portalTableContainer && !portalTableContainer.querySelector('div[style*="text-align: center"]')) {
                    const emptyMsg = document.createElement('div');
                    emptyMsg.style.cssText = 'text-align: center; padding: 2rem; color: #6c757d;';
                    emptyMsg.textContent = 'Nenhuma solicita√ß√£o registrada';
                    portalTableContainer.appendChild(emptyMsg);
                }
                
                // Clear benefits values
                const benefitSpans = selfServiceSection.querySelectorAll('span[style*="font-weight: bold"]');
                benefitSpans.forEach(span => {
                    if (span.textContent.includes('R$')) {
                        span.textContent = 'R$ 0';
                        span.style.color = '#6c757d';
                    }
                });
                
                // Clear profile initials
                const avatarDiv = selfServiceSection.querySelector('div[style*="background: #007bff"]');
                if (avatarDiv && avatarDiv.textContent === 'JS') {
                    avatarDiv.textContent = '--';
                    avatarDiv.style.background = '#6c757d';
                }
            }
        }
        
        function clearAnalyticsData() {
            // Reset analytics KPIs more thoroughly
            const analyticsSection = document.getElementById('analytics');
            if (analyticsSection) {
                const analyticsStats = analyticsSection.querySelectorAll('.stat-number');
                analyticsStats.forEach(stat => {
                    if (stat.textContent.includes('R$')) {
                        stat.textContent = 'R$ 0';
                    } else if (stat.textContent.includes('%')) {
                        stat.textContent = '0%';
                    } else if (stat.textContent.includes('K')) {
                        stat.textContent = 'R$ 0K';
                    } else {
                        stat.textContent = '0';
                    }
                });
                
                // Clear all trend text in analytics
                const analyticsTrends = analyticsSection.querySelectorAll('.stat-trend');
                analyticsTrends.forEach(trend => trend.textContent = 'Aguardando dados');
                
                // Clear predictive analytics
                const progressBars = analyticsSection.querySelectorAll('.progress-fill');
                progressBars.forEach(bar => bar.style.width = '0%');
                
                // Clear workforce analytics charts
                const workforceCharts = analyticsSection.querySelectorAll('.chart-container');
                workforceCharts.forEach(chart => {
                    chart.innerHTML = '<div style="text-align: center; padding: 2rem; color: #6c757d;">Dados anal√≠ticos ser√£o gerados ap√≥s cadastros</div>';
                });
                
                // Clear specific analytics text content
                const analyticsSpans = analyticsSection.querySelectorAll('span[style*="font-weight: bold"]');
                analyticsSpans.forEach(span => {
                    if (span.textContent.match(/\d/)) {
                        if (span.textContent.includes('R$')) span.textContent = 'R$ 0';
                        else if (span.textContent.includes('%')) span.textContent = '0%';
                        else span.textContent = '0';
                        span.style.color = '#6c757d';
                    }
                });
            }
        }
        
        function clearAdvancedSections() {
            // Clear Executive Command Center
            clearExecutiveData();
            
            // Clear Integrations
            clearIntegrationsData();
            
            // Clear Compliance/LGPD
            clearComplianceData();
            
            // Clear Automations
            clearAutomationsData();
            
            // Clear Portal do Colaborador
            clearCollaboratorPortalData();
        }
        
        function clearExecutiveData() {
            const executiveSection = document.getElementById('executive');
            if (executiveSection) {
                // Reset executive KPIs to 0
                const execStats = executiveSection.querySelectorAll('.stat-number');
                execStats.forEach(stat => {
                    if (stat.textContent.includes('R$')) {
                        stat.textContent = 'R$ 0';
                    } else if (stat.textContent.includes('%')) {
                        stat.textContent = '0%';
                    } else {
                        stat.textContent = '0';
                    }
                });
                
                // Reset all executive trend text
                const trendElements = executiveSection.querySelectorAll('.stat-trend');
                trendElements.forEach(trend => {
                    trend.textContent = 'Aguardando dados';
                });
                
                // Clear strategic goals progress bars
                const progressBars = executiveSection.querySelectorAll('.progress-fill');
                progressBars.forEach(bar => bar.style.width = '0%');
                
                // Clear strategic goal percentages
                const goalPercentages = executiveSection.querySelectorAll('[style*="color: #28a745"], [style*="color: #007bff"], [style*="color: #ffc107"]');
                goalPercentages.forEach(goal => {
                    if (goal.textContent.includes('% atingido')) {
                        goal.textContent = '0% atingido';
                        goal.style.color = '#6c757d';
                    }
                });
                
                // Clear business insights
                const insightLists = executiveSection.querySelectorAll('ul, ol');
                insightLists.forEach(list => {
                    list.innerHTML = '<li style="color: #6c757d;">Aguardando dados para gerar insights</li>';
                });
                
                // Clear leadership team data
                const leadershipDivs = executiveSection.querySelectorAll('div[style*="text-align: center"]');
                leadershipDivs.forEach(div => {
                    const h6 = div.querySelector('h6');
                    if (h6 && (h6.textContent.includes('CEO') || h6.textContent.includes('CFO') || h6.textContent.includes('CTO'))) {
                        h6.textContent = h6.textContent.split(' - ')[0]; // Keep only the role
                        const statusDiv = div.querySelector('div[style*="background: #28a745"], div[style*="background: #ffc107"]');
                        if (statusDiv) {
                            statusDiv.textContent = '‚óè N√£o definido';
                            statusDiv.style.background = '#6c757d';
                            statusDiv.style.color = 'white';
                        }
                    }
                });
                
                // Clear specific executive values and metrics - more comprehensive
                const specificValues = executiveSection.querySelectorAll('span, div, p');
                specificValues.forEach(el => {
                    if (el.textContent && (el.textContent.includes('R$') || el.textContent.includes('%') || 
                        el.textContent.match(/^\d+/) || el.textContent.includes('atingido') || 
                        el.textContent.includes('R$ 180K') || el.textContent.includes('R$ 2M') ||
                        el.textContent.includes('23%') || el.textContent.includes('15%') ||
                        el.textContent.includes('40%') || el.textContent.includes('+40%'))) {
                        
                        if (el.textContent.includes('R$')) {
                            el.textContent = 'R$ 0';
                        } else if (el.textContent.includes('% atingido')) {
                            el.textContent = '0% atingido';
                        } else if (el.textContent.includes('%')) {
                            el.textContent = '0%';
                        } else if (el.textContent.match(/^\d+/)) {
                            el.textContent = '0';
                        } else {
                            el.textContent = 'Aguardando dados';
                        }
                        el.style.color = '#6c757d';
                    }
                });
            }
        }
        
        function clearIntegrationsData() {
            // Reset integration status indicators
            const integrationCards = document.querySelectorAll('#integrations .card');
            integrationCards.forEach(card => {
                const statusElements = card.querySelectorAll('.status, [style*="color: #28a745"], [style*="color: #dc3545"]');
                statusElements.forEach(status => {
                    status.textContent = 'N√£o configurado';
                    status.style.color = '#6c757d';
                    status.className = 'status';
                });
                
                // Reset sync indicators
                const syncElements = card.querySelectorAll('[style*="background: #d4edda"]');
                syncElements.forEach(sync => {
                    sync.style.background = '#f8f9fa';
                    sync.style.color = '#6c757d';
                    if (sync.textContent.includes('Sincronizado') || sync.textContent.includes('Ativo')) {
                        sync.textContent = 'Aguardando configura√ß√£o';
                    }
                });
            });
        }
        
        function clearComplianceData() {
            const complianceSection = document.getElementById('compliance');
            if (complianceSection) {
                // Reset LGPD compliance score and all stats
                const complianceStats = complianceSection.querySelectorAll('.stat-number');
                complianceStats.forEach(stat => {
                    if (stat.textContent.includes('%')) {
                        stat.textContent = '0%';
                    } else {
                        stat.textContent = '0';
                    }
                });
                
                // Clear compliance trends
                const complianceTrends = complianceSection.querySelectorAll('.stat-trend');
                complianceTrends.forEach(trend => trend.textContent = 'Aguardando dados');
                
                // Clear all colored status indicators
                const statusElements = complianceSection.querySelectorAll('[style*="color: #28a745"], [style*="color: #155724"], [style*="color: #856404"]');
                statusElements.forEach(status => {
                    status.style.color = '#6c757d';
                    if (status.textContent.includes('Excelente compliance') || 
                        status.textContent.includes('Zero ocorr√™ncias') ||
                        status.textContent.includes('Criptografados') ||
                        status.textContent.includes('Este ano')) {
                        status.textContent = 'Aguardando dados';
                    }
                });
                
                // Clear LGPD requirements lists and monitoring content
                const requirementsList = complianceSection.querySelectorAll('ul');
                requirementsList.forEach(list => {
                    list.innerHTML = '<li style="color: #6c757d;">Aguardando configura√ß√£o de conformidade</li>';
                });
                
                // Clear pending actions in LGPD monitoring
                const pendingActions = complianceSection.querySelectorAll('div[style*="display: flex; justify-content: space-between"]');
                pendingActions.forEach(action => {
                    if (action.textContent.includes('Treinamento LGPD') || 
                        action.textContent.includes('Revis√£o de pol√≠ticas') ||
                        action.textContent.includes('Em andamento') ||
                        action.textContent.includes('Agendada')) {
                        action.innerHTML = '<span>Nenhuma a√ß√£o pendente</span><span style="color: #6c757d;">--</span>';
                    }
                });
                
                // Clear audit trail logs with fictional data
                const auditLogs = complianceSection.querySelectorAll('.audit-log > div');
                auditLogs.forEach(log => log.remove());
                
                // Add empty message to audit log
                const auditLogContainer = complianceSection.querySelector('.audit-log');
                if (auditLogContainer && !auditLogContainer.querySelector('div[style*="text-align: center"]')) {
                    const emptyAuditMsg = document.createElement('div');
                    emptyAuditMsg.style.cssText = 'text-align: center; padding: 2rem; color: #6c757d;';
                    emptyAuditMsg.textContent = 'Nenhuma atividade de auditoria registrada';
                    auditLogContainer.appendChild(emptyAuditMsg);
                }
                
                // Clear data rights management numbers
                const dataRightCards = complianceSection.querySelectorAll('.data-right-card p');
                dataRightCards.forEach(p => {
                    if (p.textContent.match(/^\d+$/)) {
                        p.textContent = '0';
                        p.style.color = '#6c757d';
                    }
                });
                
                // Clear monitoring values (sessions, login attempts, etc.)
                const monitoringSpans = complianceSection.querySelectorAll('span[style*="font-weight: bold"]');
                monitoringSpans.forEach(span => {
                    if (span.textContent.includes('156 hoje') || 
                        span.textContent.includes('17:20') ||
                        span.textContent.includes('23') ||
                        span.textContent.includes('2') ||
                        span.textContent.includes('TLS 1.3') ||
                        span.textContent.includes('AES-256') ||
                        span.textContent.includes('5 n√≠veis')) {
                        
                        if (span.textContent.match(/^\d+/)) {
                            span.textContent = '0';
                        } else if (span.textContent.includes('hoje')) {
                            span.textContent = '0 hoje';
                        } else if (span.textContent.includes(':')) {
                            span.textContent = '--:--';
                        } else {
                            span.textContent = 'N√£o configurado';
                        }
                        span.style.color = '#6c757d';
                    }
                });
                
                // Clear background colored sections that contain LGPD monitoring data
                const coloredBackgrounds = complianceSection.querySelectorAll('div[style*="background: #d4edda"], div[style*="background: #fff3cd"], div[style*="background: #e7f3ff"]');
                coloredBackgrounds.forEach(bg => {
                    if (bg.innerHTML.includes('Requisitos Atendidos') || 
                        bg.innerHTML.includes('A√ß√µes Pendentes') ||
                        bg.innerHTML.includes('Controle de Acesso')) {
                        
                        // Keep the header but clear the content
                        const header = bg.querySelector('h6');
                        if (header) {
                            bg.innerHTML = '';
                            bg.appendChild(header);
                            const emptyMsg = document.createElement('p');
                            emptyMsg.style.cssText = 'margin: 0.5rem 0; font-size: 0.9rem; color: #6c757d;';
                            emptyMsg.textContent = 'Aguardando configura√ß√£o';
                            bg.appendChild(emptyMsg);
                        }
                    }
                });
                
                // Clear other audit data and specific compliance values  
                const auditElements = complianceSection.querySelectorAll('li, p, span, div');
                auditElements.forEach(el => {
                    if (el.textContent.includes('98.7%') || 
                        el.textContent.includes('24') || 
                        el.textContent.includes('100%') ||
                        el.textContent.includes('Conformidade total') ||
                        el.textContent.includes('Jo√£o Silva') ||
                        el.textContent.includes('Maria Santos') ||
                        el.textContent.includes('Pedro Admin') ||
                        el.textContent.includes('22/08/2025') ||
                        el.textContent.includes('Criptografados') ||
                        el.textContent.includes('Consentimento expl√≠cito') ||
                        el.textContent.includes('Direito ao esquecimento') ||
                        el.textContent.includes('Portabilidade de dados') ||
                        el.textContent.includes('DPO (Data Protection Officer)')) {
                        
                        if (el.textContent.includes('%')) {
                            el.textContent = '0%';
                        } else if (el.textContent.match(/^\d+$/)) {
                            el.textContent = '0';
                        } else {
                            el.textContent = 'N√£o configurado';
                        }
                        el.style.color = '#6c757d';
                    }
                });
            }
        }
        
        function clearAutomationsData() {
            const automationsSection = document.getElementById('automations');
            if (automationsSection) {
                // Reset automation metrics
                const autoStats = automationsSection.querySelectorAll('.stat-number');
                autoStats.forEach(stat => {
                    if (stat.textContent.includes('%')) {
                        stat.textContent = '0%';
                    } else {
                        stat.textContent = '0';
                    }
                });
                
                // Clear automation trends
                const autoTrends = automationsSection.querySelectorAll('.stat-trend');
                autoTrends.forEach(trend => trend.textContent = 'Aguardando dados');
                
                // Clear workflow status - more comprehensive
                const statusElements = automationsSection.querySelectorAll('[style*="color: #28a745"], [style*="color: #007bff"], span[style*="background: #d4edda"]');
                statusElements.forEach(status => {
                    status.style.color = '#6c757d';
                    status.style.background = '#f8f9fa';
                    if (status.textContent.includes('Ativo') || status.textContent.includes('Funcionando') || status.textContent.includes('Online') || status.textContent.includes('Autom√°tico')) {
                        status.textContent = 'Inativo';
                    }
                });
                
                // Clear all numeric values in automations
                const numericElements = automationsSection.querySelectorAll('span, div, p');
                numericElements.forEach(el => {
                    if (el.textContent.match(/^\d+%$/) || el.textContent.match(/^\d+$/)) {
                        if (el.textContent.includes('%')) {
                            el.textContent = '0%';
                        } else {
                            el.textContent = '0';
                        }
                        el.style.color = '#6c757d';
                    }
                });
            }
        }
        
        // Function to load real employees data
        async function loadEmployeesData() {
            // Aguarda a se√ß√£o estar vis√≠vel
            const funcionariosSection = document.getElementById('funcionarios');
            if (!funcionariosSection || funcionariosSection.style.display === 'none') {
                console.log('‚è≥ Aguardando se√ß√£o funcion√°rios ficar vis√≠vel...');
                setTimeout(loadEmployeesData, 300);
                return;
            }
            
            // Debug detalhado
            console.log('üîç Procurando container funcionarios-list...');
            console.log('üîç Se√ß√£o funcionarios existe?', !!funcionariosSection);
            console.log('üîç Se√ß√£o funcionarios vis√≠vel?', funcionariosSection.style.display !== 'none');
            
            // Tenta m√∫ltiplas formas de encontrar o elemento
            const listContainer = document.getElementById('funcionarios-list');
            const listByQuery = document.querySelector('#funcionarios-list');
            const listByQueryAll = document.querySelectorAll('#funcionarios-list');
            
            console.log('üîç getElementById:', !!listContainer);
            console.log('üîç querySelector:', !!listByQuery);
            console.log('üîç querySelectorAll length:', listByQueryAll.length);
            
            // Lista todos os IDs dentro da se√ß√£o funcion√°rios
            const allWithIds = document.querySelectorAll('#funcionarios [id]');
            console.log('üîç Elementos com ID na se√ß√£o funcion√°rios:');
            allWithIds.forEach(el => console.log('   -', el.id, el.tagName));
            
            if (!listContainer && !listByQuery) {
                console.error('‚ùå Container funcionarios-list n√£o encontrado de forma alguma');
                console.log('üîç Todos os elementos na se√ß√£o:', document.querySelectorAll('#funcionarios *'));
                
                // Vamos tentar criar o elemento se n√£o existir
                const tableContainer = document.querySelector('#funcionarios .table-container');
                if (tableContainer) {
                    console.log('üõ†Ô∏è Criando container funcionarios-list dinamicamente...');
                    const newContainer = document.createElement('div');
                    newContainer.id = 'funcionarios-list';
                    newContainer.innerHTML = `
                        <div class="table-grid">
                            <span style="color: #6c757d; grid-column: 1 / -1; text-align: center; padding: 2rem;">
                                üîÑ Carregando funcion√°rios...
                            </span>
                        </div>
                    `;
                    tableContainer.appendChild(newContainer);
                    setTimeout(() => loadEmployeesData(), 100);
                    return;
                }
                return;
            }
            
            const finalContainer = listContainer || listByQuery;
            
            console.log('‚úÖ Container encontrado:', finalContainer);
            console.log('üîç ID do container:', finalContainer.id);
            console.log('üîç Classe do container:', finalContainer.className);
            
            try {
                console.log('üîÑ Carregando funcion√°rios da API...');
                const response = await fetchWithAuth('/api/employees');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('üìä Dados recebidos:', data);
                
                if (data.success && data.data && Array.isArray(data.data) && data.data.length > 0) {
                    console.log('üîß Criando HTML simples para funcion√°rios...');
                    
                    // Store data for search functionality
                    allEmployeesData = data.data;
                    
                    let html = '';
                    data.data.forEach((employee, index) => {
                        console.log(`üìã Processando funcion√°rio ${index + 1}:`, employee.name);
                        
                        const salary = employee.salary ? 
                            `R$ ${parseFloat(employee.salary).toLocaleString('pt-BR', {minimumFractionDigits: 2})}` : 
                            'N√£o informado';
                        
                        const employeeId = employee.id.substring(0, 8);
                        html += `
                            <div class="employee-row" style="
                                display: grid; 
                                grid-template-columns: 50px 2fr 1fr 1fr 100px 100px; 
                                gap: 1rem; 
                                padding: 1rem; 
                                margin: 5px 0;
                                background: white !important; 
                                border: 1px solid #ddd;
                                border-radius: 8px;
                                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                                align-items: center;
                            ">
                                <span style="display: flex; align-items: center; justify-content: center;">
                                    <input type="checkbox" class="employee-checkbox" data-employee-id="${employee.id}" data-employee-name="${employee.name}" data-action="updateDeleteButton" style="cursor: pointer;">
                                </span>
                                <span style="color: #333; font-size: 14px;">
                                    <strong style="color: #000;">${employee.name || 'Nome n√£o informado'}</strong><br>
                                    <small style="color: #666; display: flex; align-items: center; gap: 5px;">
                                        <span id="email-${employeeId}" style="display: none;">${employee.email || 'Email n√£o informado'}</span>
                                        <span id="email-hidden-${employeeId}" style="color: #999;">***@***.com</span>
                                        <button data-action="toggleField" data-field="email" data-employee-id="\${employeeId}" data-value="\${employee.email || 'Email n√£o informado'}" style="
                                            background: none; 
                                            border: none; 
                                            cursor: pointer; 
                                            font-size: 12px; 
                                            color: #666;
                                            padding: 2px;
                                        ">üëÅÔ∏è</button>
                                    </small>
                                </span>
                                <span style="color: #333; font-size: 14px;">${employee.position || 'N√£o informado'}</span>
                                <span style="font-weight: bold; color: #28a745; font-size: 14px; display: flex; align-items: center; gap: 5px;">
                                    <span id="salary-${employeeId}" style="display: none;">${salary}</span>
                                    <span id="salary-hidden-${employeeId}" style="color: #999;">R$ ***,**</span>
                                    <button data-action="toggleField" data-field="salary" data-employee-id="\${employeeId}" data-value="\${salary}" style="
                                        background: none; 
                                        border: none; 
                                        cursor: pointer; 
                                        font-size: 12px; 
                                        color: #28a745;
                                        padding: 2px;
                                    ">üëÅÔ∏è</button>
                                </span>
                                <span style="padding: 0.25rem 0.5rem; border-radius: 4px; background-color: #28a745; color: white; font-size: 0.75rem; text-align: center; font-weight: bold;">ATIVO</span>
                                <span>
                                    <button style="
                                        padding: 0.5rem 1rem; 
                                        font-size: 12px; 
                                        background: #007bff; 
                                        color: white; 
                                        border: none; 
                                        border-radius: 4px; 
                                        cursor: pointer;
                                        font-weight: bold;
                                    " data-action="toggleEmployeeDetails" data-employee-id="\${employeeId}" data-employee-name="\${employee.name}" data-employee-position="\${employee.position}" data-salary="\${salary}" data-email="\${employee.email}" data-hire-date="\${employee.hire_date}" data-employee-code="\${employee.employee_code}">VER</button>
                                </span>
                            </div>
                        `;
                        
                        console.log('‚úÖ HTML criado para:', employee.name);
                    });
                    
                    finalContainer.innerHTML = html;
                    finalContainer.style.display = 'block';
                    finalContainer.style.visibility = 'visible';
                    finalContainer.style.opacity = '1';
                    
                    console.log('üéØ Total de funcion√°rios renderizados:', data.data.length);
                    console.log('üìä HTML final inserido no container');
                    console.log('üîç Container final:', finalContainer.outerHTML.substring(0, 200) + '...');
                    
                    console.log('‚úÖ Funcion√°rios carregados com sucesso!');
                    if (typeof showToast === 'function') {
                        showToast('Funcion√°rios carregados com sucesso!', 'success');
                    }
                } else {
                    finalContainer.innerHTML = `
                        <div class="table-grid">
                            <span style="color: #6c757d; grid-column: 1 / -1; text-align: center; padding: 2rem;">
                                Nenhum funcion√°rio cadastrado ainda
                            </span>
                        </div>
                    `;
                }
                
            } catch (error) {
                console.error('Erro ao carregar funcion√°rios:', error);
                finalContainer.innerHTML = `
                    <div class="table-grid">
                        <span style="color: #dc3545; grid-column: 1 / -1; text-align: center; padding: 2rem;">
                            ‚ùå Erro ao carregar funcion√°rios: ${error.message}
                        </span>
                    </div>
                `;
                if (typeof showToast === 'function') {
                    showToast('Erro ao carregar funcion√°rios', 'error');
                }
            }
        }

        // ============== SISTEMA DE APROVA√á√ïES ==============

        let currentApprovalId = null;
        let pendingApprovals = [];
        let filteredApprovals = [];

        // Carrega aprova√ß√µes pendentes
        async function loadPendingApprovals() {
            const approvalsSection = document.getElementById('aprovacoes');
            if (!approvalsSection || approvalsSection.style.display === 'none') {
                return;
            }

            const listContainer = document.getElementById('approvals-list');
            if (!listContainer) return;

            try {
                console.log('üîÑ Carregando aprova√ß√µes pendentes...');
                listContainer.innerHTML = '<div style="text-align: center; padding: 2rem; color: #666;">üîÑ Carregando aprova√ß√µes...</div>';
                
                const response = await fetchWithAuth('/api/requests/pending');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('üìä Aprova√ß√µes recebidas:', data);
                
                if (data.success && data.data && Array.isArray(data.data)) {
                    pendingApprovals = data.data;
                    filteredApprovals = [...pendingApprovals];
                    renderApprovals();
                    updateApprovalStats();
                    populateApprovalFilters();
                    
                    if (typeof showToast === 'function') {
                        showToast(`${data.data.length} aprova√ß√µes carregadas`, 'info');
                    }
                } else {
                    listContainer.innerHTML = '<div style="text-align: center; padding: 2rem; color: #666;">Nenhuma aprova√ß√£o pendente</div>';
                }
                
            } catch (error) {
                console.error('Erro ao carregar aprova√ß√µes:', error);
                listContainer.innerHTML = `<div style="text-align: center; padding: 2rem; color: #dc3545;">‚ùå Erro ao carregar aprova√ß√µes: ${error.message}</div>`;
                if (typeof showToast === 'function') {
                    showToast('Erro ao carregar aprova√ß√µes', 'error');
                }
            }
        }

        // Renderiza lista de aprova√ß√µes
        function renderApprovals() {
            const listContainer = document.getElementById('approvals-list');
            const countContainer = document.getElementById('approval-results-count');
            
            if (filteredApprovals.length === 0) {
                listContainer.innerHTML = '<div style="text-align: center; padding: 2rem; color: #666;">Nenhuma aprova√ß√£o pendente</div>';
                countContainer.textContent = '';
                return;
            }

            countContainer.textContent = `${filteredApprovals.length} requisi√ß√£o(√µes) aguardando aprova√ß√£o`;
            
            let html = '';
            filteredApprovals.forEach(approval => {
                const priorityIcon = getPriorityIcon(approval.priority);
                const priorityClass = getPriorityClass(approval.priority);
                const createdDate = new Date(approval.created_at).toLocaleDateString('pt-BR');
                const createdTime = new Date(approval.created_at).toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
                
                html += `
                    <div class="table-grid approval-row" data-priority="${approval.priority}" data-category="${approval.category}" data-department="${approval.department_name}">
                        <span>
                            <strong style="color: #333;">${approval.employee_name}</strong><br>
                            <small style="color: #666;">${approval.employee_code || ''}</small>
                        </span>
                        <span>
                            <strong style="color: #333;">${approval.title}</strong><br>
                            <small style="color: #666;">${approval.request_type_name}</small>
                        </span>
                        <span class="priority-badge ${priorityClass}">
                            ${priorityIcon} ${getPriorityText(approval.priority)}
                        </span>
                        <span>
                            <strong>${createdDate}</strong><br>
                            <small style="color: #666;">${createdTime}</small>
                        </span>
                        <span class="actions-cell">
                            <button class="btn btn-info btn-sm" data-action="viewApprovalDetails" data-approval-id="\${approval.id}" title="Ver detalhes">
                                üëÅÔ∏è Ver
                            </button>
                            <button class="btn btn-success btn-sm" data-action="openApprovalModal" data-approval-id="\${approval.id}" data-mode="approve" title="Aprovar">
                                ‚úÖ
                            </button>
                            <button class="btn btn-danger btn-sm" data-action="openApprovalModal" data-approval-id="\${approval.id}" data-mode="reject" title="Rejeitar">
                                ‚ùå
                            </button>
                        </span>
                    </div>
                `;
            });
            
            listContainer.innerHTML = html;
        }

        // Atualiza estat√≠sticas das aprova√ß√µes
        function updateApprovalStats() {
            const pendingCountEl = document.getElementById('pending-count');
            const todayApprovalsEl = document.getElementById('today-approvals');
            
            if (pendingCountEl) {
                pendingCountEl.textContent = `${pendingApprovals.length} pendentes`;
            }
            
            // Para hoje, vamos mostrar 0 at√© implementarmos hist√≥rico
            if (todayApprovalsEl) {
                todayApprovalsEl.textContent = '0 hoje';
            }
        }

        // Popula filtros de aprova√ß√£o
        function populateApprovalFilters() {
            const typeFilter = document.getElementById('approval-type-filter');
            const departmentFilter = document.getElementById('approval-department-filter');
            
            // Tipos √∫nicos
            const types = [...new Set(pendingApprovals.map(a => a.category).filter(Boolean))];
            if (typeFilter) {
                typeFilter.innerHTML = '<option value="">Todos os tipos</option>';
                types.forEach(type => {
                    typeFilter.innerHTML += `<option value="${type}">${type}</option>`;
                });
            }
            
            // Departamentos √∫nicos
            const departments = [...new Set(pendingApprovals.map(a => a.department_name).filter(Boolean))];
            if (departmentFilter) {
                departmentFilter.innerHTML = '<option value="">Todos</option>';
                departments.forEach(dept => {
                    departmentFilter.innerHTML += `<option value="${dept}">${dept}</option>`;
                });
            }
        }

        // Filtra aprova√ß√µes
        function filterApprovals() {
            const priorityFilter = document.getElementById('approval-priority-filter')?.value || '';
            const typeFilter = document.getElementById('approval-type-filter')?.value || '';
            const departmentFilter = document.getElementById('approval-department-filter')?.value || '';
            
            filteredApprovals = pendingApprovals.filter(approval => {
                return (!priorityFilter || approval.priority === priorityFilter) &&
                       (!typeFilter || approval.category === typeFilter) &&
                       (!departmentFilter || approval.department_name === departmentFilter);
            });
            
            renderApprovals();
        }

        // ============== FILTROS DE APROVA√á√ïES ==============
        
        // Filtra aprova√ß√µes por status, prioridade, tipo e pesquisa de texto
        function filterApprovals() {
            const searchText = document.getElementById('approval-search')?.value || '';
            const statusFilter = document.getElementById('approval-status-filter')?.value || '';
            const priorityFilter = document.getElementById('approval-priority-filter')?.value || '';
            const typeFilter = document.getElementById('approval-type-filter')?.value || '';
            
            filteredApprovals = pendingApprovals.filter(approval => {
                // Filtro de pesquisa por texto
                const matchesSearch = !searchText || 
                    approval.employee_name?.toLowerCase().includes(searchText.toLowerCase()) ||
                    approval.title?.toLowerCase().includes(searchText.toLowerCase()) ||
                    approval.description?.toLowerCase().includes(searchText.toLowerCase()) ||
                    approval.request_type_name?.toLowerCase().includes(searchText.toLowerCase()) ||
                    approval.employee_code?.toLowerCase().includes(searchText.toLowerCase());
                
                // Filtros de dropdown
                const matchesStatus = !statusFilter || approval.status === statusFilter;
                const matchesPriority = !priorityFilter || approval.priority === priorityFilter;
                const matchesType = !typeFilter || approval.request_type_name?.includes(typeFilter);
                
                return matchesSearch && matchesStatus && matchesPriority && matchesType;
            });
            
            renderFilteredApprovals();
        }

        // Renderiza aprova√ß√µes filtradas
        function renderFilteredApprovals() {
            const listContainer = document.getElementById('approvals-list');
            const countContainer = document.getElementById('approval-results-count');
            
            if (filteredApprovals.length === 0) {
                listContainer.innerHTML = '<div style="text-align: center; padding: 2rem; color: #666;">Nenhuma requisi√ß√£o encontrada</div>';
                countContainer.textContent = '';
                return;
            }

            const searchText = document.getElementById('approval-search')?.value || '';
            const statusFilter = document.getElementById('approval-status-filter')?.value || '';
            const hasFilters = searchText || statusFilter;
            
            countContainer.textContent = hasFilters 
                ? `${filteredApprovals.length} de ${pendingApprovals.length} requisi√ß√£o(√µes) encontrada(s)`
                : `${filteredApprovals.length} requisi√ß√£o(√µes) carregada(s)`;
            
            let html = '';
            filteredApprovals.forEach(approval => {
                const statusBadge = getStatusBadge(approval.status);
                const priorityIcon = getPriorityIcon(approval.priority);
                const createdDate = new Date(approval.created_at).toLocaleDateString('pt-BR');
                const createdTime = new Date(approval.created_at).toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
                
                // Diferentes a√ß√µes baseadas no status
                let actionsHtml = '';
                if (approval.status === 'pending') {
                    actionsHtml = `
                        <button class="btn btn-info btn-sm" data-action="viewRequestDetails" data-approval-id="\${approval.id}" title="Ver detalhes">
                            üëÅÔ∏è Ver
                        </button>
                        <button class="btn btn-success btn-sm" data-action="openApprovalModal" data-approval-id="\${approval.id}" data-mode="approve" title="Aprovar">
                            ‚úÖ Aprovar
                        </button>
                        <button class="btn btn-danger btn-sm" data-action="openApprovalModal" data-approval-id="\${approval.id}" data-mode="reject" title="Rejeitar">
                            ‚ùå Rejeitar
                        </button>
                    `;
                } else {
                    actionsHtml = `
                        <button class="btn btn-info btn-sm" data-action="viewRequestDetails" data-approval-id="\${approval.id}" title="Ver detalhes">
                            üëÅÔ∏è Ver
                        </button>
                    `;
                }
                
                html += `
                    <div class="table-grid approval-row" data-status="${approval.status}">
                        <span>
                            <strong style="color: #333;">${approval.employee_name}</strong><br>
                            <small style="color: #666;">${approval.employee_code || ''}</small>
                        </span>
                        <span>
                            <strong style="color: #333;">${approval.title}</strong><br>
                            <small style="color: #666;">${approval.request_type_name}</small>
                        </span>
                        <span>
                            <span class="priority-badge ${getPriorityClass(approval.priority)}">
                                ${priorityIcon} ${getPriorityText(approval.priority)}
                            </span>
                        </span>
                        <span>
                            ${statusBadge}
                        </span>
                        <span>
                            <strong>${createdDate}</strong><br>
                            <small style="color: #666;">${createdTime}</small>
                        </span>
                        <span class="actions-cell">
                            ${actionsHtml}
                        </span>
                    </div>
                `;
            });
            
            listContainer.innerHTML = html;
        }

        // Carrega todas as aprova√ß√µes (n√£o apenas pendentes)
        async function loadAllApprovalsData() {
            try {
                console.log('üîÑ Carregando todas as aprova√ß√µes...');
                const response = await fetchWithAuth('/api/requests');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('üìä Todas aprova√ß√µes recebidas:', data);
                
                if (data.success && data.requests) {
                    // Usar vari√°veis compat√≠veis
                    pendingApprovals = data.requests || [];
                    filteredApprovals = [...pendingApprovals];
                    renderFilteredApprovals();
                    updateApprovalStats();
                    populateApprovalFilters();
                    
                    if (typeof showToast === 'function') {
                        showToast(`${data.requests.length} requisi√ß√µes carregadas`, 'info');
                    }
                } else {
                    pendingApprovals = [];
                    filteredApprovals = [];
                    renderFilteredApprovals();
                }
                
            } catch (error) {
                console.error('Erro ao carregar aprova√ß√µes:', error);
                const listContainer = document.getElementById('approvals-list');
                if (listContainer) {
                    listContainer.innerHTML = `<div style="text-align: center; padding: 2rem; color: #dc3545;">‚ùå Erro ao carregar aprova√ß√µes: ${error.message}</div>`;
                }
                if (typeof showToast === 'function') {
                    showToast('Erro ao carregar aprova√ß√µes', 'error');
                }
            }
        }

        // Atualiza aprova√ß√µes
        async function refreshApprovals() {
            await loadAllApprovalsData();
        }

        // Abre modal de aprova√ß√£o/rejei√ß√£o
        function openApprovalModal(requestId, action) {
            const approval = pendingApprovals.find(a => a.id === requestId);
            if (!approval) return;
            
            currentApprovalId = requestId;
            const modal = document.getElementById('approvalModal');
            const modalTitle = document.getElementById('approval-modal-title');
            const detailsDiv = document.getElementById('approval-request-details');
            
            // Limpa campos
            document.getElementById('approval-comments').value = '';
            document.getElementById('rejection-reason').value = '';
            
            // Configura t√≠tulo e detalhes
            modalTitle.textContent = action === 'approve' ? 'Aprovar Requisi√ß√£o' : 'Rejeitar Requisi√ß√£o';
            
            const createdDate = new Date(approval.created_at).toLocaleDateString('pt-BR');
            const priorityIcon = getPriorityIcon(approval.priority);
            
            detailsDiv.innerHTML = `
                <div class="request-detail-card">
                    <h5>${approval.title}</h5>
                    <div class="detail-grid">
                        <div><strong>Funcion√°rio:</strong> ${approval.employee_name}</div>
                        <div><strong>Tipo:</strong> ${approval.request_type_name}</div>
                        <div><strong>Data:</strong> ${createdDate}</div>
                        <div><strong>Prioridade:</strong> ${priorityIcon} ${getPriorityText(approval.priority)}</div>
                    </div>
                    <div style="margin-top: 1rem;">
                        <strong>Descri√ß√£o:</strong>
                        <p style="background: #f8f9fa; padding: 1rem; border-radius: 4px; margin-top: 0.5rem;">
                            ${approval.description || 'Sem descri√ß√£o adicional'}
                        </p>
                    </div>
                </div>
            `;
            
            // Configura formul√°rio baseado na a√ß√£o
            if (action === 'approve') {
                showApprovalForm();
            } else {
                showRejectionForm();
            }
            
            modal.style.display = 'flex';
        }

        // Mostra formul√°rio de aprova√ß√£o
        function showApprovalForm() {
            document.getElementById('approval-modal-title').textContent = 'Aprovar Requisi√ß√£o';
            document.getElementById('approval-comments-group').style.display = 'block';
            document.getElementById('rejection-reason-group').style.display = 'none';
            document.getElementById('approval-actions').style.display = 'block';
            document.getElementById('rejection-actions').style.display = 'none';
        }

        // Mostra formul√°rio de rejei√ß√£o
        function showRejectionForm() {
            document.getElementById('approval-modal-title').textContent = 'Rejeitar Requisi√ß√£o';
            document.getElementById('approval-comments-group').style.display = 'none';
            document.getElementById('rejection-reason-group').style.display = 'block';
            document.getElementById('approval-actions').style.display = 'none';
            document.getElementById('rejection-actions').style.display = 'block';
        }

        // Confirma aprova√ß√£o
        async function confirmApproval() {
            if (!currentApprovalId) return;
            
            const comments = document.getElementById('approval-comments').value.trim();
            const submitBtn = document.querySelector('#approval-actions .btn-success');
            const originalText = submitBtn.textContent;
            
            try {
                submitBtn.textContent = '‚è≥ Aprovando...';
                submitBtn.disabled = true;
                
                const response = await fetchWithAuth(`/api/requests/${currentApprovalId}/approve`, {
                    method: 'PUT',
                    body: JSON.stringify({ comments })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    if (typeof showToast === 'function') {
                        showToast('Requisi√ß√£o aprovada com sucesso!', 'success');
                    }
                    closeApprovalModal();
                    await loadAllApprovalsData();
                } else {
                    throw new Error(data.error || 'Erro ao aprovar requisi√ß√£o');
                }
                
            } catch (error) {
                console.error('Erro ao aprovar:', error);
                if (typeof showToast === 'function') {
                    showToast(error.message, 'error');
                }
            } finally {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        }

        // Confirma rejei√ß√£o
        async function confirmRejection() {
            if (!currentApprovalId) return;
            
            const rejectionReason = document.getElementById('rejection-reason').value.trim();
            if (!rejectionReason || rejectionReason.length < 10) {
                if (typeof showToast === 'function') {
                    showToast('Motivo da rejei√ß√£o deve ter no m√≠nimo 10 caracteres', 'error');
                }
                return;
            }
            
            const submitBtn = document.querySelector('#rejection-actions .btn-danger');
            const originalText = submitBtn.textContent;
            
            try {
                submitBtn.textContent = '‚è≥ Rejeitando...';
                submitBtn.disabled = true;
                
                const response = await fetchWithAuth(`/api/requests/${currentApprovalId}/reject`, {
                    method: 'PUT',
                    body: JSON.stringify({ rejection_reason: rejectionReason })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    if (typeof showToast === 'function') {
                        showToast('Requisi√ß√£o rejeitada com sucesso!', 'success');
                    }
                    closeApprovalModal();
                    await loadAllApprovalsData();
                } else {
                    throw new Error(data.error || 'Erro ao rejeitar requisi√ß√£o');
                }
                
            } catch (error) {
                console.error('Erro ao rejeitar:', error);
                if (typeof showToast === 'function') {
                    showToast(error.message, 'error');
                }
            } finally {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        }

        // Fecha modal de aprova√ß√£o
        function closeApprovalModal() {
            document.getElementById('approvalModal').style.display = 'none';
            currentApprovalId = null;
        }

        // Ver detalhes da requisi√ß√£o (usando modal existente)
        function viewApprovalDetails(requestId) {
            const approval = pendingApprovals.find(a => a.id === requestId);
            if (!approval) return;
            
            showRequestModal({
                id: approval.id,
                title: approval.title,
                description: approval.description,
                employee_name: approval.employee_name,
                employee_code: approval.employee_code,
                employee_email: approval.employee_email,
                request_type_name: approval.request_type_name,
                category: approval.category,
                priority: approval.priority,
                status: approval.status,
                created_at: approval.created_at,
                department_name: approval.department_name
            });
        }

        // Fun√ß√µes utilit√°rias para prioridade
        function getPriorityIcon(priority) {
            switch(priority) {
                case 'urgent': return 'üî¥';
                case 'high': return 'üü†';
                case 'medium': return 'üü°';
                case 'low': return 'üü¢';
                default: return '‚ö™';
            }
        }

        function getPriorityClass(priority) {
            switch(priority) {
                case 'urgent': return 'priority-urgent';
                case 'high': return 'priority-high';
                case 'medium': return 'priority-medium';
                case 'low': return 'priority-low';
                default: return 'priority-normal';
            }
        }

        function getPriorityText(priority) {
            switch(priority) {
                case 'urgent': return 'Urgente';
                case 'high': return 'Alta';
                case 'medium': return 'M√©dia';
                case 'low': return 'Baixa';
                default: return 'Normal';
            }
        }

        // ============== FILTROS DE REQUISI√á√ïES ==============
        
        // Usando as vari√°veis j√° existentes globalmente
        let filteredRequestsData = [];

        // Filtra requisi√ß√µes por status
        function filterRequestsByStatus() {
            const statusFilter = document.getElementById('request-status-filter')?.value || '';
            const searchInput = document.getElementById('request-search')?.value || '';
            
            filteredRequestsData = allRequestsData.filter(request => {
                const matchesStatus = !statusFilter || request.status === statusFilter;
                const matchesSearch = !searchInput || 
                    request.employee_name?.toLowerCase().includes(searchInput.toLowerCase()) ||
                    request.title?.toLowerCase().includes(searchInput.toLowerCase()) ||
                    request.request_type_name?.toLowerCase().includes(searchInput.toLowerCase());
                
                return matchesStatus && matchesSearch;
            });
            
            renderFilteredRequests();
        }

        // Renderiza requisi√ß√µes filtradas
        function renderFilteredRequests() {
            const listContainer = document.getElementById('requests-list');
            const countContainer = document.getElementById('request-results-count');
            
            if (filteredRequestsData.length === 0) {
                listContainer.innerHTML = '<div style="text-align: center; padding: 2rem; color: #666;">Nenhuma requisi√ß√£o encontrada</div>';
                countContainer.textContent = '';
                return;
            }

            countContainer.textContent = `${filteredRequestsData.length} requisi√ß√£o(√µes) encontrada(s)`;
            
            let html = '';
            filteredRequestsData.forEach(request => {
                const statusBadge = getStatusBadge(request.status);
                const createdDate = new Date(request.created_at).toLocaleDateString('pt-BR');
                const priorityIcon = getPriorityIcon(request.priority);
                
                html += `
                    <div class="table-grid request-row" data-status="${request.status}">
                        <span>
                            <strong style="color: #333;">${request.employee_name}</strong><br>
                            <small style="color: #666;">${request.employee_code || ''}</small>
                        </span>
                        <span>
                            <strong style="color: #333;">${request.title}</strong><br>
                            <small style="color: #666;">${request.request_type_name}</small>
                        </span>
                        <span>
                            <strong>${createdDate}</strong><br>
                            <small style="color: #666;">${priorityIcon} ${getPriorityText(request.priority)}</small>
                        </span>
                        <span>
                            ${statusBadge}
                        </span>
                        <span class="actions-cell">
                            <button class="btn btn-info btn-sm" data-action="viewRequestDetails" data-request-id="\${request.id}" title="Ver detalhes">
                                üëÅÔ∏è Ver
                            </button>
                        </span>
                    </div>
                `;
            });
            
            listContainer.innerHTML = html;
        }

        // Carrega todas as requisi√ß√µes (n√£o apenas pendentes)
        async function loadAllRequests() {
            try {
                console.log('üîÑ Carregando todas as requisi√ß√µes...');
                const response = await fetchWithAuth('/api/requests');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('üìä Requisi√ß√µes recebidas:', data);
                
                if (data.success && data.requests && Array.isArray(data.requests)) {
                    allRequestsData = data.requests;
                    filteredRequestsData = [...allRequestsData];
                    renderFilteredRequests();
                    
                    if (typeof showToast === 'function') {
                        showToast(`${data.requests.length} requisi√ß√µes carregadas`, 'info');
                    }
                } else {
                    const listContainer = document.getElementById('requests-list');
                    listContainer.innerHTML = '<div style="text-align: center; padding: 2rem; color: #666;">Nenhuma requisi√ß√£o cadastrada ainda</div>';
                }
                
            } catch (error) {
                console.error('Erro ao carregar requisi√ß√µes:', error);
                const listContainer = document.getElementById('requests-list');
                listContainer.innerHTML = `<div style="text-align: center; padding: 2rem; color: #dc3545;">‚ùå Erro ao carregar requisi√ß√µes: ${error.message}</div>`;
                if (typeof showToast === 'function') {
                    showToast('Erro ao carregar requisi√ß√µes', 'error');
                }
            }
        }

        // Atualiza lista de requisi√ß√µes
        async function refreshRequests() {
            await loadAllRequests();
        }

        // Gera badge de status
        function getStatusBadge(status) {
            switch(status) {
                case 'pending':
                    return '<span class="status-badge pending">‚è≥ Pendente</span>';
                case 'approved':
                    return '<span class="status-badge approved">‚úÖ Aprovada</span>';
                case 'rejected':
                    return '<span class="status-badge rejected">‚ùå Rejeitada</span>';
                default:
                    return '<span class="status-badge unknown">‚ùì Desconhecido</span>';
            }
        }

        // Ver detalhes de uma requisi√ß√£o espec√≠fica
        function viewRequestDetails(requestId) {
            const request = allRequestsData.find(r => r.id === requestId);
            if (!request) return;
            
            showRequestModal({
                id: request.id,
                title: request.title,
                description: request.description,
                employee_name: request.employee_name,
                employee_code: request.employee_code,
                employee_email: request.employee_email,
                request_type_name: request.request_type_name,
                category: request.category,
                priority: request.priority,
                status: request.status,
                created_at: request.created_at,
                updated_at: request.updated_at,
                department_name: request.department_name
            });
        }

        // Carrega aprova√ß√µes quando a se√ß√£o √© mostrada
        const originalShowSection = showSection;
        showSection = function(section) {
            originalShowSection(section);
            if (section === 'aprovacoes') {
                setTimeout(() => loadAllApprovalsData(), 300);
            } else if (section === 'requisicoes') {
                setTimeout(() => loadAllRequests(), 300);
            } else if (section === 'departamentos') {
                setTimeout(() => loadDepartmentsTable(), 300);
            }
        };

        // Garante que o c√≥digo seja executado ap√≥s a DOM estar pronta
        document.addEventListener('DOMContentLoaded', function() {
            console.log('‚úÖ Sistema carregado e pronto para uso');
            
            // Carrega dados do dashboard apenas ap√≥s login
            // Dashboard ser√° carregado via initializeUserSession()
            
            // Verifica se elementos essenciais existem
            if (!document.getElementById('email') || !document.getElementById('password')) {
                console.warn('‚ö†Ô∏è Elementos de login n√£o encontrados');
            }
            
            // Garante que as fun√ß√µes est√£o dispon√≠veis globalmente
            window.performLogin = performLogin;
            console.log('Sistema inicializado! performLogin dispon√≠vel:', typeof window.performLogin);
            window.showSection = showSection;
            
            // Add event listener for survey type filter
            setTimeout(() => {
                const surveyTypeFilter = document.getElementById('surveyTypeFilter');
                if (surveyTypeFilter) {
                    surveyTypeFilter.addEventListener('change', function() {
                        if (typeof renderSurveysList === 'function') {
                            renderSurveysList();
                        }
                    });
                }
            }, 1000); // Wait for DOM to be fully ready
        });
        
        // Fun√ß√µes para modal de cria√ß√£o r√°pida de departamento
        function showQuickDepartmentModal() {
            // Remove existing modal if any
            const existingModal = document.getElementById('quick-department-modal');
            if (existingModal) existingModal.remove();
            
            const modalHTML = `
                <div id="quick-department-modal" style="
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.5);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 1003;
                " data-action="closeQuickDepartmentModal">
                    <div style="
                        background: white;
                        padding: 2rem;
                        border-radius: 8px;
                        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
                        max-width: 500px;
                        width: 90%;
                        max-height: 80vh;
                        overflow-y: auto;
                    " data-action="stopPropagation">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                            <h4 style="margin: 0; color: #333;">Criar Novo Departamento</h4>
                            <button data-action="closeQuickDepartmentModal" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #666;">&times;</button>
                        </div>
                        
                        <div class="form-group">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: bold;">Nome do Departamento:</label>
                            <input type="text" id="quickDeptName" placeholder="Digite o nome do departamento" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem;">
                        </div>
                        
                        <div class="form-group" style="margin-top: 1rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: bold;">Descri√ß√£o (opcional):</label>
                            <textarea id="quickDeptDescription" placeholder="Descreva as responsabilidades do departamento" rows="3" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem; resize: vertical;"></textarea>
                        </div>
                        
                        <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 1.5rem;">
                            <button class="btn btn-secondary" data-action="closeQuickDepartmentModal">Cancelar</button>
                            <button class="btn btn-success" data-action="saveQuickDepartment">Criar Departamento</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            
            // Add animation and focus
            const modal = document.getElementById('quick-department-modal');
            modal.style.opacity = '0';
            setTimeout(() => {
                modal.style.opacity = '1';
                modal.style.transition = 'opacity 0.3s ease';
                document.getElementById('quickDeptName').focus();
            }, 10);
        }
        
        function closeQuickDepartmentModal(event) {
            if (event && event.target !== event.currentTarget) return;
            
            const modal = document.getElementById('quick-department-modal');
            if (modal) {
                modal.style.opacity = '0';
                setTimeout(() => modal.remove(), 300);
            }
        }
        
        async function saveQuickDepartment() {
            const name = document.getElementById('quickDeptName').value.trim();
            const description = document.getElementById('quickDeptDescription').value.trim();
            const saveBtn = event.target;
            
            if (!name) {
                showStatus('Digite o nome do departamento!', 'warning');
                return;
            }
            
            // Loading state
            setButtonLoading(saveBtn, true);
            
            try {
                console.log('‚ûï Criando novo departamento:', { name, description });
                
                const response = await fetchWithAuth('/api/departments', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name: name,
                        description: description || null
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showStatus('Departamento criado com sucesso!', 'success');
                    showHint(`Departamento "${name}" foi adicionado!`);
                    
                    // Fechar modal
                    closeQuickDepartmentModal();
                    
                    // Recarregar lista de departamentos
                    await loadDepartments();
                    
                    // Recarregar tabela se estiver na se√ß√£o departamentos
                    if (document.getElementById('departamentos').style.display !== 'none') {
                        await loadDepartmentsTable();
                    }
                    
                    // Selecionar o novo departamento automaticamente
                    const departmentSelect = document.getElementById('empDepartamento');
                    if (departmentSelect && result.department) {
                        departmentSelect.value = result.department.id;
                    }
                    
                } else {
                    showStatus(result.error || 'Erro ao criar departamento', 'error');
                }
                
            } catch (error) {
                console.error('‚ùå Erro ao criar departamento:', error);
                showStatus('Erro ao criar departamento: ' + error.message, 'error');
            } finally {
                setButtonLoading(saveBtn, false);
            }
        }
        
        // Fun√ß√£o para editar departamento
        async function editDepartment(departmentId) {
            try {
                // Buscar dados do departamento
                const response = await fetchWithAuth(`/api/departments?include_inactive=true`);
                const data = await response.json();
                
                const department = data.departments.find(d => d.id === departmentId);
                if (!department) {
                    showStatus('Departamento n√£o encontrado', 'error');
                    return;
                }
                
                // Criar modal de edi√ß√£o
                showEditDepartmentModal(department);
                
            } catch (error) {
                console.error('‚ùå Erro ao buscar departamento:', error);
                showStatus('Erro ao carregar departamento: ' + error.message, 'error');
            }
        }
        
        // Fun√ß√£o para inativar/ativar departamento
        async function toggleDepartmentStatus(departmentId, departmentName, isActive) {
            const action = isActive ? 'inativar' : 'ativar';
            const confirmed = confirm(`Tem certeza que deseja ${action} o departamento "${departmentName}"?`);
            if (!confirmed) return;
            
            try {
                console.log(`üîÑ ${action} departamento:`, { departmentId, departmentName });
                
                const response = await fetchWithAuth(`/api/departments/${departmentId}/toggle-status`, {
                    method: 'PATCH'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    const actionDone = isActive ? 'inativado' : 'ativado';
                    showStatus(`Departamento ${actionDone} com sucesso!`, 'success');
                    showHint(`Departamento "${departmentName}" foi ${actionDone}!`);
                    
                    // Recarregar tabela
                    await loadDepartmentsTable();
                    
                    // Recarregar dropdowns
                    await loadDepartments();
                    
                } else {
                    showStatus(result.error || `Erro ao ${action} departamento`, 'error');
                }
                
            } catch (error) {
                console.error(`‚ùå Erro ao ${action} departamento:`, error);
                showStatus(`Erro ao ${action} departamento: ` + error.message, 'error');
            }
        }
        
        // Fun√ß√£o para excluir departamento com confirma√ß√£o
        async function deleteDepartment(departmentId, departmentName) {
            // Confirma√ß√£o
            const confirmed = confirm(`Tem certeza que deseja excluir o departamento "${departmentName}"?\n\nEsta a√ß√£o n√£o pode ser desfeita.`);
            if (!confirmed) return;
            
            try {
                console.log('üóëÔ∏è Excluindo departamento:', { departmentId, departmentName });
                
                const response = await fetchWithAuth(`/api/departments/${departmentId}`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showStatus('Departamento exclu√≠do com sucesso!', 'success');
                    showHint(`Departamento "${departmentName}" foi removido!`);
                    
                    // Recarregar tabela de departamentos
                    await loadDepartmentsTable();
                    
                    // Recarregar dropdowns se estiver no formul√°rio de funcion√°rios
                    await loadDepartments();
                    
                } else {
                    showStatus(result.error || 'Erro ao excluir departamento', 'error');
                }
                
            } catch (error) {
                console.error('‚ùå Erro ao excluir departamento:', error);
                showStatus('Erro ao excluir departamento: ' + error.message, 'error');
            }
        }
        
        // Modal de edi√ß√£o de departamento
        function showEditDepartmentModal(department) {
            // Remove existing modal if any
            const existingModal = document.getElementById('edit-department-modal');
            if (existingModal) existingModal.remove();
            
            const modalHTML = `
                <div id="edit-department-modal" style="
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.5);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 1004;
                " data-action="closeEditDepartmentModal">
                    <div style="
                        background: white;
                        padding: 2rem;
                        border-radius: 8px;
                        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
                        max-width: 500px;
                        width: 90%;
                        max-height: 80vh;
                        overflow-y: auto;
                    " data-action="stopPropagation">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                            <h4 style="margin: 0; color: #333;">Editar Departamento</h4>
                            <button data-action="closeEditDepartmentModal" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #666;">&times;</button>
                        </div>
                        
                        <div class="form-group">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: bold;">Nome do Departamento:</label>
                            <input type="text" id="editDeptName" value="${department.name}" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem;">
                        </div>
                        
                        <div class="form-group" style="margin-top: 1rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: bold;">Descri√ß√£o (opcional):</label>
                            <textarea id="editDeptDescription" rows="3" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem; resize: vertical;">${department.description || ''}</textarea>
                        </div>
                        
                        <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 1.5rem;">
                            <button class="btn btn-secondary" data-action="closeEditDepartmentModal">Cancelar</button>
                            <button class="btn btn-success" data-action="saveEditDepartment" data-dept-id="\${department.id}">Salvar Altera√ß√µes</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            
            // Add animation and focus
            const modal = document.getElementById('edit-department-modal');
            modal.style.opacity = '0';
            setTimeout(() => {
                modal.style.opacity = '1';
                modal.style.transition = 'opacity 0.3s ease';
                document.getElementById('editDeptName').focus();
            }, 10);
        }
        
        function closeEditDepartmentModal(event) {
            if (event && event.target !== event.currentTarget) return;
            
            const modal = document.getElementById('edit-department-modal');
            if (modal) {
                modal.style.opacity = '0';
                setTimeout(() => modal.remove(), 300);
            }
        }
        
        async function saveEditDepartment(departmentId) {
            const name = document.getElementById('editDeptName').value.trim();
            const description = document.getElementById('editDeptDescription').value.trim();
            const saveBtn = event.target;
            
            if (!name) {
                showStatus('Digite o nome do departamento!', 'warning');
                return;
            }
            
            // Loading state
            setButtonLoading(saveBtn, true);
            
            try {
                console.log('‚úèÔ∏è Editando departamento:', { departmentId, name, description });
                
                const response = await fetchWithAuth(`/api/departments/${departmentId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name: name,
                        description: description || null
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showStatus('Departamento editado com sucesso!', 'success');
                    showHint(`Departamento "${name}" foi atualizado!`);
                    
                    // Fechar modal
                    closeEditDepartmentModal();
                    
                    // Recarregar tabela
                    await loadDepartmentsTable();
                    
                    // Recarregar dropdowns
                    await loadDepartments();
                    
                } else {
                    showStatus(result.error || 'Erro ao editar departamento', 'error');
                }
                
            } catch (error) {
                console.error('‚ùå Erro ao editar departamento:', error);
                showStatus('Erro ao editar departamento: ' + error.message, 'error');
            } finally {
                setButtonLoading(saveBtn, false);
            }
        }

        // ====== PERFORMANCE, AVALIA√á√ïES E DESENVOLVIMENTO FUNCTIONS ======
        
        // Variables for current performance data
        let performanceData = {
            cycles: [],
            evaluations: [],
            okrs: [],
            pdis: [],
            competencies: []
        };

        // Load performance section
        async function loadPerformanceSection() {
            console.log('‚≠ê Carregando se√ß√£o de performance...');
            
            try {
                // Load all performance data in parallel
                await Promise.all([
                    loadEvaluationCycles(),
                    loadEvaluations(), 
                    loadOKRs(),
                    loadPDIs(),
                    loadCompetencies()
                ]);
                
                updatePerformanceStats();
                showPerformanceTab('evaluations'); // Show default tab
                
                console.log('‚úÖ Se√ß√£o de performance carregada');
            } catch (error) {
                console.error('‚ùå Erro ao carregar performance:', error);
                showStatus('Erro ao carregar dados de performance', 'error');
            }
        }

        // Show performance tab
        function showPerformanceTab(tabName) {
            // Hide all tabs
            const tabs = ['evaluations', 'okrs', 'pdis', 'competencies'];
            tabs.forEach(tab => {
                const tabElement = document.getElementById(`performanceTab${tab.charAt(0).toUpperCase() + tab.slice(1)}`);
                const tabButton = document.getElementById(`tab${tab.charAt(0).toUpperCase() + tab.slice(1)}`);
                
                if (tabElement) tabElement.style.display = 'none';
                if (tabButton) tabButton.classList.remove('active');
            });
            
            // Show selected tab
            const selectedTab = document.getElementById(`performanceTab${tabName.charAt(0).toUpperCase() + tabName.slice(1)}`);
            const selectedButton = document.getElementById(`tab${tabName.charAt(0).toUpperCase() + tabName.slice(1)}`);
            
            if (selectedTab) selectedTab.style.display = 'block';
            if (selectedButton) selectedButton.classList.add('active');
        }

        // Load evaluation cycles
        async function loadEvaluationCycles() {
            try {
                const response = await fetchWithAuth('/api/evaluation-cycles');
                const result = await response.json();
                
                if (result.success) {
                    performanceData.cycles = result.data;
                    renderEvaluationCycles();
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                console.error('‚ùå Erro ao carregar ciclos:', error);
                document.getElementById('evaluationCyclesList').innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: #dc3545;">
                        ‚ùå Erro ao carregar ciclos de avalia√ß√£o
                    </div>
                `;
            }
        }

        // Render evaluation cycles
        function renderEvaluationCycles() {
            const container = document.getElementById('evaluationCyclesList');
            
            if (performanceData.cycles.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: #6c757d;">
                        üìã Nenhum ciclo de avalia√ß√£o cadastrado
                    </div>
                `;
                return;
            }
            
            let html = '<div class="table-container">';
            html += `
                <div class="table-grid table-header-row">
                    <span>Nome do Ciclo</span>
                    <span>Tipo</span>
                    <span>Per√≠odo</span>
                    <span>Status</span>
                    <span>Avalia√ß√µes</span>
                    <span>A√ß√µes</span>
                </div>
            `;
            
            performanceData.cycles.forEach(cycle => {
                const startDate = new Date(cycle.start_date).toLocaleDateString('pt-BR');
                const endDate = new Date(cycle.end_date).toLocaleDateString('pt-BR');
                const statusClass = cycle.status === 'active' ? 'success' : cycle.status === 'completed' ? 'info' : 'warning';
                const statusText = cycle.status === 'active' ? 'Ativo' : cycle.status === 'completed' ? 'Conclu√≠do' : 'Cancelado';
                
                html += `
                    <div class="table-grid">
                        <span><strong>${cycle.name}</strong><br><small>${cycle.description || 'Sem descri√ß√£o'}</small></span>
                        <span>${cycle.evaluation_type}</span>
                        <span>${startDate} - ${endDate}</span>
                        <span><span class="badge badge-${statusClass}">${statusText}</span></span>
                        <span>${cycle.completed_evaluations}/${cycle.total_evaluations}</span>
                        <span>
                            <button class="btn btn-sm btn-info" data-action="viewCycle" data-cycle-id="\${cycle.id}">Ver</button>
                            ${cycle.status === 'active' ? `<button class="btn btn-sm btn-primary" data-action="manageCycle" data-cycle-id="\${cycle.id}">Gerenciar</button>` : ''}
                        </span>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        // Load evaluations
        async function loadEvaluations() {
            try {
                const response = await fetchWithAuth('/api/evaluations');
                const result = await response.json();
                
                if (result.success) {
                    performanceData.evaluations = result.data;
                    renderEvaluations();
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                console.error('‚ùå Erro ao carregar avalia√ß√µes:', error);
                document.getElementById('evaluationsList').innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: #dc3545;">
                        ‚ùå Erro ao carregar avalia√ß√µes
                    </div>
                `;
            }
        }

        // Render evaluations
        function renderEvaluations() {
            const container = document.getElementById('evaluationsList');
            
            if (performanceData.evaluations.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: #6c757d;">
                        üìä Nenhuma avalia√ß√£o cadastrada
                    </div>
                `;
                return;
            }
            
            let html = '<div class="table-container">';
            html += `
                <div class="table-grid table-header-row">
                    <span>Funcion√°rio</span>
                    <span>Avaliador</span>
                    <span>Per√≠odo</span>
                    <span>Score</span>
                    <span>Status</span>
                    <span>A√ß√µes</span>
                </div>
            `;
            
            performanceData.evaluations.forEach(evaluation => {
                const score = evaluation.overall_score ? evaluation.overall_score.toFixed(1) : '-';
                const statusClass = evaluation.status === 'completed' ? 'success' : evaluation.status === 'in_progress' ? 'warning' : 'secondary';
                const statusText = evaluation.status === 'completed' ? 'Conclu√≠da' : evaluation.status === 'in_progress' ? 'Em andamento' : 'Pendente';
                
                html += `
                    <div class="table-grid">
                        <span><strong>${evaluation.employee_name}</strong><br><small>${evaluation.employee_position || 'Sem cargo'}</small></span>
                        <span><strong>${evaluation.evaluator_name || 'N√£o definido'}</strong><br><small>${evaluation.evaluator_position || ''}</small></span>
                        <span>${evaluation.period}</span>
                        <span><span class="badge badge-${score !== '-' ? 'success' : 'secondary'}">${score}</span></span>
                        <span><span class="badge badge-${statusClass}">${statusText}</span></span>
                        <span>
                            <button class="btn btn-sm btn-info" data-action="viewEvaluation" data-evaluation-id="\${evaluation.id}">Ver</button>
                            ${evaluation.status !== 'completed' ? `<button class="btn btn-sm btn-primary" data-action="editEvaluation" data-evaluation-id="\${evaluation.id}">Editar</button>` : ''}
                        </span>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        // Load OKRs
        async function loadOKRs() {
            try {
                const response = await fetchWithAuth('/api/okrs');
                const result = await response.json();
                
                if (result.success) {
                    performanceData.okrs = result.data;
                    renderOKRs();
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                console.error('‚ùå Erro ao carregar OKRs:', error);
                document.getElementById('okrsList').innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: #dc3545;">
                        ‚ùå Erro ao carregar OKRs
                    </div>
                `;
            }
        }

        // Render OKRs
        function renderOKRs() {
            const container = document.getElementById('okrsList');
            
            if (performanceData.okrs.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: #6c757d;">
                        üéØ Nenhum OKR cadastrado
                    </div>
                `;
                return;
            }
            
            let html = '<div class="grid-2" style="gap: 1rem;">';
            
            performanceData.okrs.forEach(okr => {
                const priorityClass = okr.priority === 'critical' ? 'danger' : okr.priority === 'high' ? 'warning' : okr.priority === 'medium' ? 'info' : 'secondary';
                const statusClass = okr.status === 'completed' ? 'success' : okr.status === 'active' ? 'info' : 'secondary';
                const targetDate = new Date(okr.target_date).toLocaleDateString('pt-BR');
                
                html += `
                    <div class="card">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem;">
                            <div>
                                <h5 style="margin: 0; color: #333;">${okr.title}</h5>
                                <small style="color: #6c757d;">${okr.employee_name} - ${okr.department_name || 'Sem departamento'}</small>
                            </div>
                            <div style="text-align: right;">
                                <span class="badge badge-${priorityClass}">${okr.priority}</span>
                                <br>
                                <span class="badge badge-${statusClass}" style="margin-top: 0.25rem;">${okr.status}</span>
                            </div>
                        </div>
                        
                        <p style="color: #666; margin-bottom: 1rem;">${okr.objective}</p>
                        
                        <div style="margin-bottom: 1rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                <strong>Progresso:</strong>
                                <span>${okr.progress_percentage}%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${okr.progress_percentage}%; background: linear-gradient(90deg, #28a745, #20c997);"></div>
                            </div>
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <small style="color: #6c757d;">Meta: ${targetDate}</small>
                            <div>
                                <button class="btn btn-sm btn-info" data-action="viewOKR" data-okr-id="\${okr.id}">Ver</button>
                                <button class="btn btn-sm btn-primary" data-action="updateOKRProgress" data-okr-id="\${okr.id}">Atualizar</button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        // Load PDIs
        async function loadPDIs() {
            try {
                const response = await fetchWithAuth('/api/development-plans');
                const result = await response.json();
                
                if (result.success) {
                    performanceData.pdis = result.data;
                    renderPDIs();
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                console.error('‚ùå Erro ao carregar PDIs:', error);
                document.getElementById('pdisList').innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: #dc3545;">
                        ‚ùå Erro ao carregar PDIs
                    </div>
                `;
            }
        }

        // Render PDIs
        function renderPDIs() {
            const container = document.getElementById('pdisList');
            
            if (performanceData.pdis.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: #6c757d;">
                        üìö Nenhum PDI cadastrado
                    </div>
                `;
                return;
            }
            
            let html = '<div class="grid-2" style="gap: 1rem;">';
            
            performanceData.pdis.forEach(pdi => {
                const statusClass = pdi.status === 'completed' ? 'success' : pdi.status === 'active' ? 'info' : 'secondary';
                const targetDate = new Date(pdi.target_date).toLocaleDateString('pt-BR');
                const budgetUsed = pdi.budget_used || 0;
                const budgetAllocated = pdi.budget_allocated || 0;
                const budgetPercent = budgetAllocated > 0 ? ((budgetUsed / budgetAllocated) * 100).toFixed(1) : 0;
                
                html += `
                    <div class="card">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem;">
                            <div>
                                <h5 style="margin: 0; color: #333;">${pdi.title}</h5>
                                <small style="color: #6c757d;">${pdi.employee_name}</small>
                            </div>
                            <span class="badge badge-${statusClass}">${pdi.status}</span>
                        </div>
                        
                        <p style="color: #666; margin-bottom: 1rem;">${pdi.description || 'Sem descri√ß√£o'}</p>
                        
                        <div style="margin-bottom: 1rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                <strong>Progresso:</strong>
                                <span>${pdi.progress_percentage}%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${pdi.progress_percentage}%; background: linear-gradient(90deg, #007bff, #0056b3);"></div>
                            </div>
                        </div>
                        
                        ${budgetAllocated > 0 ? `
                        <div style="margin-bottom: 1rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                <strong>Or√ßamento:</strong>
                                <span>R$ ${budgetUsed.toFixed(2)} / R$ ${budgetAllocated.toFixed(2)}</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${budgetPercent}%; background: linear-gradient(90deg, #ffc107, #ffcd39);"></div>
                            </div>
                        </div>
                        ` : ''}
                        
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <small style="color: #6c757d;">Meta: ${targetDate}</small>
                            <div>
                                <button class="btn btn-sm btn-info" data-action="viewPDI" data-pdi-id="\${pdi.id}">Ver</button>
                                <button class="btn btn-sm btn-primary" data-action="updatePDIProgress" data-pdi-id="\${pdi.id}">Atualizar</button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        // Load competencies
        async function loadCompetencies() {
            try {
                const response = await fetchWithAuth('/api/competencies');
                const result = await response.json();
                
                if (result.success) {
                    performanceData.competencies = result.data;
                    renderCompetencies();
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                console.error('‚ùå Erro ao carregar compet√™ncias:', error);
                document.getElementById('competenciesList').innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: #dc3545;">
                        ‚ùå Erro ao carregar compet√™ncias
                    </div>
                `;
            }
        }

        // Render competencies
        function renderCompetencies() {
            const container = document.getElementById('competenciesList');
            
            if (performanceData.competencies.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: #6c757d;">
                        ‚≠ê Nenhuma compet√™ncia cadastrada
                    </div>
                `;
                return;
            }
            
            // Group by category
            const categories = {};
            performanceData.competencies.forEach(comp => {
                const category = comp.category || 'Sem categoria';
                if (!categories[category]) categories[category] = [];
                categories[category].push(comp);
            });
            
            let html = '';
            
            Object.keys(categories).forEach(category => {
                html += `
                    <div class="card mb-2">
                        <h5 style="margin-bottom: 1rem; color: #333; border-bottom: 2px solid #007bff; padding-bottom: 0.5rem;">
                            ${category}
                        </h5>
                        <div class="grid-3" style="gap: 1rem;">
                `;
                
                categories[category].forEach(comp => {
                    const levelClass = comp.level_required >= 4 ? 'danger' : comp.level_required >= 3 ? 'warning' : 'info';
                    
                    html += `
                        <div style="border: 1px solid #e9ecef; border-radius: 6px; padding: 1rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                <strong style="color: #333;">${comp.name}</strong>
                                <span class="badge badge-${levelClass}">N√≠vel ${comp.level_required}</span>
                            </div>
                            <p style="color: #666; margin: 0; font-size: 0.9rem;">${comp.description || 'Sem descri√ß√£o'}</p>
                        </div>
                    `;
                });
                
                html += '</div></div>';
            });
            
            container.innerHTML = html;
        }

        // Update performance stats
        function updatePerformanceStats() {
            const completedEvaluations = performanceData.evaluations.filter(e => e.status === 'completed').length;
            const activeOKRs = performanceData.okrs.filter(o => o.status === 'active').length;
            const activePDIs = performanceData.pdis.filter(p => p.status === 'active').length;
            const activeCycles = performanceData.cycles.filter(c => c.status === 'active').length;
            
            document.getElementById('totalEvaluations').textContent = completedEvaluations;
            document.getElementById('activeOKRs').textContent = activeOKRs;
            document.getElementById('activePDIs').textContent = activePDIs;
            document.getElementById('activeCycles').textContent = activeCycles;
        }

        // Show create forms (placeholder functions)
        function showCreateEvaluationCycleForm() {
            showStatus('Funcionalidade em desenvolvimento - Cria√ß√£o de Ciclo de Avalia√ß√£o', 'info');
        }

        function showCreateEvaluationForm() {
            showStatus('Funcionalidade em desenvolvimento - Cria√ß√£o de Avalia√ß√£o', 'info');
        }

        function showCreateOKRForm() {
            showStatus('Funcionalidade em desenvolvimento - Cria√ß√£o de OKR', 'info');
        }

        function showCreatePDIForm() {
            showStatus('Funcionalidade em desenvolvimento - Cria√ß√£o de PDI', 'info');
        }

        // View functions (placeholder)
        function viewEvaluation(id) {
            showStatus('Visualizando avalia√ß√£o: ' + id, 'info');
        }

        function viewOKR(id) {
            showStatus('Visualizando OKR: ' + id, 'info');
        }

        function viewPDI(id) {
            showStatus('Visualizando PDI: ' + id, 'info');
        }

        function viewCycle(id) {
            showStatus('Visualizando ciclo: ' + id, 'info');
        }

        // Update progress functions (placeholder)
        function updateOKRProgress(id) {
            showStatus('Funcionalidade em desenvolvimento - Atualiza√ß√£o de Progresso OKR', 'info');
        }

        function updatePDIProgress(id) {
            showStatus('Funcionalidade em desenvolvimento - Atualiza√ß√£o de Progresso PDI', 'info');
        }

        // ====== SISTEMA DE PESQUISAS FUNCTIONS ======
        
        // Variables for surveys data
        let surveysData = [];

        // Load surveys section
        async function loadSurveysSection() {
            console.log('üìã Carregando se√ß√£o de pesquisas...');
            
            try {
                await loadSurveysList();
                updateSurveysStats();
                console.log('‚úÖ Se√ß√£o de pesquisas carregada');
            } catch (error) {
                console.error('‚ùå Erro ao carregar pesquisas:', error);
                showStatus('Erro ao carregar dados de pesquisas', 'error');
            }
        }

        // Load surveys list
        async function loadSurveysList() {
            try {
                const response = await fetchWithAuth('/api/surveys');
                const result = await response.json();
                
                if (result.success) {
                    surveysData = result.data;
                    renderSurveysList();
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                console.error('‚ùå Erro ao carregar pesquisas:', error);
                document.getElementById('surveysList').innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: #dc3545;">
                        ‚ùå Erro ao carregar pesquisas
                    </div>
                `;
            }
        }

        // Render surveys list
        function renderSurveysList() {
            const container = document.getElementById('surveysList');
            const filterType = document.getElementById('surveyTypeFilter').value;
            
            let filteredSurveys = surveysData;
            if (filterType !== 'all') {
                filteredSurveys = surveysData.filter(survey => survey.survey_type === filterType);
            }
            
            if (filteredSurveys.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: #6c757d;">
                        üìã Nenhuma pesquisa encontrada
                        ${filterType !== 'all' ? ` para o tipo "${filterType}"` : ''}
                    </div>
                `;
                return;
            }
            
            let html = '<div class="table-container">';
            html += `
                <div class="table-grid table-header-row">
                    <span>T√≠tulo</span>
                    <span>Tipo</span>
                    <span>Status</span>
                    <span>An√¥nima</span>
                    <span>Respostas</span>
                    <span>Criada em</span>
                    <span>A√ß√µes</span>
                </div>
            `;
            
            filteredSurveys.forEach(survey => {
                const createdDate = new Date(survey.created_at).toLocaleDateString('pt-BR');
                const statusClass = survey.is_active ? 'success' : 'secondary';
                const statusText = survey.is_active ? 'Ativa' : 'Inativa';
                const anonymousText = survey.is_anonymous ? 'Sim' : 'N√£o';
                const anonymousClass = survey.is_anonymous ? 'info' : 'warning';
                const typeLabels = {
                    'climate': 'üå°Ô∏è Clima',
                    'satisfaction': 'üòä Satisfa√ß√£o',
                    'engagement': 'üöÄ Engagement',
                    'feedback': 'üí¨ Feedback',
                    'custom': '‚öôÔ∏è Personalizada'
                };
                
                html += `
                    <div class="table-grid">
                        <span>
                            <strong>${survey.title}</strong>
                            <br><small style="color: #6c757d;">${survey.description || 'Sem descri√ß√£o'}</small>
                        </span>
                        <span>${typeLabels[survey.survey_type] || survey.survey_type}</span>
                        <span><span class="badge badge-${statusClass}">${statusText}</span></span>
                        <span><span class="badge badge-${anonymousClass}">${anonymousText}</span></span>
                        <span>
                            <strong>${survey.completed_responses || 0}</strong>
                            <small style="color: #6c757d;">de ${survey.total_responses || 0}</small>
                        </span>
                        <span>${createdDate}</span>
                        <span>
                            <button class="btn btn-sm btn-info" data-action="viewSurvey" data-survey-id="\${survey.id}" title="Ver detalhes">üëÅÔ∏è</button>
                            <button class="btn btn-sm btn-primary" data-action="takeSurvey" data-survey-id="\${survey.id}" title="Responder pesquisa">üìù</button>
                            <button class="btn btn-sm btn-success" data-action="viewSurveyResults" data-survey-id="\${survey.id}" title="Ver resultados">üìä</button>
                            <button class="btn btn-sm btn-warning" data-action="manageSurveyQuestions" data-survey-id="\${survey.id}" title="Gerenciar perguntas">‚ùì</button>
                            <button class="btn btn-sm btn-secondary" data-action="generateSurveyLink" data-survey-id="\${survey.id}" title="Gerar link p√∫blico">üîó</button>
                            <button class="btn btn-sm ${survey.is_active ? 'btn-warning' : 'btn-secondary'}" data-action="toggleSurvey" data-survey-id="\${survey.id}" title="${survey.is_active ? 'Desativar' : 'Ativar'}">
                                ${survey.is_active ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è'}
                            </button>
                            <button class="btn btn-sm btn-danger" data-action="deleteSurvey" data-survey-id="\${survey.id}" data-survey-title="\${survey.title}" title="Excluir pesquisa">üóëÔ∏è</button>
                        </span>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        // Update surveys statistics
        function updateSurveysStats() {
            const activeSurveys = surveysData.filter(s => s.is_active).length;
            const totalResponses = surveysData.reduce((sum, s) => sum + (parseInt(s.total_responses) || 0), 0);
            const anonymousSurveys = surveysData.filter(s => s.is_anonymous).length;
            
            // Calculate participation rate (simplified)
            const totalInvitations = surveysData.reduce((sum, s) => sum + (parseInt(s.total_responses) || 0), 0);
            const participationRate = totalInvitations > 0 ? Math.round((totalResponses / totalInvitations) * 100) : 0;
            
            document.getElementById('activeSurveys').textContent = activeSurveys;
            document.getElementById('totalResponses').textContent = totalResponses;
            document.getElementById('participationRate').textContent = participationRate + '%';
            document.getElementById('anonymousSurveys').textContent = anonymousSurveys;
        }

        // Show survey templates modal
        function showSurveyTemplates() {
            const modal = document.getElementById('surveyTemplatesModal');
            modal.style.display = 'flex';
            modal.style.opacity = '0';
            setTimeout(() => {
                modal.style.opacity = '1';
                modal.style.transition = 'opacity 0.3s ease';
            }, 10);
        }

        // Close survey templates modal
        function closeSurveyTemplatesModal() {
            const modal = document.getElementById('surveyTemplatesModal');
            modal.style.opacity = '0';
            setTimeout(() => modal.style.display = 'none', 300);
        }

        // Create survey from template
        async function createFromTemplate(templateType) {
            console.log('üìã Criando pesquisa do template:', templateType);
            
            const templates = {
                'climate': {
                    title: 'Pesquisa de Clima Organizacional ' + new Date().getFullYear(),
                    description: 'Avalia√ß√£o do ambiente de trabalho e satisfa√ß√£o dos colaboradores',
                    survey_type: 'climate',
                    is_anonymous: true,
                    instructions: 'Esta pesquisa √© an√¥nima. Seja sincero(a) em suas respostas para nos ajudar a melhorar o ambiente de trabalho.',
                    questions: [
                        {
                            question_text: 'Como voc√™ avalia seu n√≠vel de satisfa√ß√£o geral com a empresa?',
                            question_type: 'scale',
                            is_required: true,
                            scale_min: 1,
                            scale_max: 10,
                            scale_labels: {"1": "Muito insatisfeito", "5": "Neutro", "10": "Muito satisfeito"}
                        },
                        {
                            question_text: 'Voc√™ se sente valorizado(a) pela empresa?',
                            question_type: 'single_choice',
                            is_required: true,
                            options: ["Sim, sempre", "Na maioria das vezes", "√Äs vezes", "Raramente", "Nunca"]
                        },
                        {
                            question_text: 'Como voc√™ avalia a comunica√ß√£o entre gestores e equipe?',
                            question_type: 'scale',
                            is_required: true,
                            scale_min: 1,
                            scale_max: 5,
                            scale_labels: {"1": "Muito ruim", "3": "Regular", "5": "Excelente"}
                        },
                        {
                            question_text: 'Voc√™ recomendaria a empresa como um bom lugar para trabalhar?',
                            question_type: 'yes_no',
                            is_required: true
                        },
                        {
                            question_text: 'O que voc√™ mais gosta no seu trabalho atual?',
                            question_type: 'text',
                            is_required: false
                        },
                        {
                            question_text: 'Que sugest√µes voc√™ daria para melhorar o ambiente de trabalho?',
                            question_type: 'text',
                            is_required: false
                        }
                    ]
                },
                'satisfaction': {
                    title: 'Pesquisa de Satisfa√ß√£o ' + new Date().getFullYear(),
                    description: 'Avalia√ß√£o da satisfa√ß√£o com produtos e servi√ßos',
                    survey_type: 'satisfaction',
                    is_anonymous: false,
                    instructions: 'Ajude-nos a melhorar nossos produtos e servi√ßos com sua opini√£o.',
                    questions: [
                        {
                            question_text: 'Como voc√™ avalia nossos produtos/servi√ßos?',
                            question_type: 'scale',
                            is_required: true,
                            scale_min: 1,
                            scale_max: 10,
                            scale_labels: {"1": "Muito ruim", "5": "Regular", "10": "Excelente"}
                        },
                        {
                            question_text: 'Qual a probabilidade de voc√™ nos recomendar para um amigo?',
                            question_type: 'scale',
                            is_required: true,
                            scale_min: 0,
                            scale_max: 10,
                            scale_labels: {"0": "N√£o recomendaria", "10": "Recomendaria certamente"}
                        },
                        {
                            question_text: 'O que mais te agrada em nossos servi√ßos?',
                            question_type: 'single_choice',
                            is_required: true,
                            options: ["Qualidade", "Pre√ßo", "Atendimento", "Rapidez", "Outro"]
                        },
                        {
                            question_text: 'Como podemos melhorar?',
                            question_type: 'text',
                            is_required: false
                        }
                    ]
                },
                'engagement': {
                    title: 'Pesquisa de Engagement ' + new Date().getFullYear(),
                    description: 'Avalia√ß√£o do engajamento e motiva√ß√£o dos colaboradores',
                    survey_type: 'engagement',
                    is_anonymous: true,
                    instructions: 'Queremos entender melhor seu engajamento e motiva√ß√£o no trabalho.',
                    questions: [
                        {
                            question_text: 'Voc√™ se sente motivado(a) no seu trabalho atual?',
                            question_type: 'scale',
                            is_required: true,
                            scale_min: 1,
                            scale_max: 10,
                            scale_labels: {"1": "Nada motivado", "5": "Neutro", "10": "Muito motivado"}
                        },
                        {
                            question_text: 'Suas ideias e opini√µes s√£o ouvidas pela lideran√ßa?',
                            question_type: 'single_choice',
                            is_required: true,
                            options: ["Sempre", "Frequentemente", "√Äs vezes", "Raramente", "Nunca"]
                        },
                        {
                            question_text: 'Voc√™ v√™ oportunidades de crescimento na empresa?',
                            question_type: 'yes_no',
                            is_required: true
                        },
                        {
                            question_text: 'O que mais te motiva no trabalho?',
                            question_type: 'text',
                            is_required: false
                        }
                    ]
                },
                'feedback360': {
                    title: 'Feedback 360¬∞ - ' + new Date().getFullYear(),
                    description: 'Avalia√ß√£o completa com m√∫ltiplas perspectivas',
                    survey_type: 'feedback',
                    is_anonymous: false,
                    instructions: 'Forne√ßa feedback construtivo sobre compet√™ncias e comportamentos.',
                    questions: [
                        {
                            question_text: 'Como voc√™ avalia a comunica√ß√£o desta pessoa?',
                            question_type: 'scale',
                            is_required: true,
                            scale_min: 1,
                            scale_max: 5,
                            scale_labels: {"1": "Precisa melhorar", "3": "Adequado", "5": "Excelente"}
                        },
                        {
                            question_text: 'Esta pessoa demonstra lideran√ßa?',
                            question_type: 'single_choice',
                            is_required: true,
                            options: ["Sempre", "Frequentemente", "√Äs vezes", "Raramente", "Nunca"]
                        },
                        {
                            question_text: 'Trabalha bem em equipe?',
                            question_type: 'yes_no',
                            is_required: true
                        },
                        {
                            question_text: 'Pontos fortes que voc√™ destacaria:',
                            question_type: 'text',
                            is_required: false
                        },
                        {
                            question_text: '√Åreas que poderiam ser desenvolvidas:',
                            question_type: 'text',
                            is_required: false
                        }
                    ]
                }
            };
            
            const template = templates[templateType];
            if (template) {
                closeSurveyTemplatesModal();
                await createSurveyFromTemplate(template);
            }
        }

        // Refresh surveys list
        function refreshSurveysList() {
            console.log('üîÑ Atualizando lista de pesquisas...');
            loadSurveysList();
            showStatus('Lista de pesquisas atualizada!', 'success');
        }

        // View survey details
        async function viewSurvey(surveyId) {
            try {
                console.log('üëÅÔ∏è Visualizando pesquisa:', surveyId);
                
                const response = await fetch(`/api/surveys/${surveyId}`);
                const result = await response.json();
                
                if (result.success && result.data) {
                    showSurveyDetails(result.data);
                } else {
                    showStatus('Erro ao carregar pesquisa: ' + (result.error || 'Dados n√£o encontrados'), 'error');
                }
                
            } catch (error) {
                console.error('‚ùå Erro ao visualizar pesquisa:', error);
                showStatus('Erro ao carregar detalhes da pesquisa', 'error');
            }
        }

        // Show survey details modal
        function showSurveyDetails(survey) {
            if (!survey || !survey.questions) {
                showStatus('Dados da pesquisa n√£o encontrados', 'error');
                return;
            }
            
            const questionsHTML = survey.questions.map((question, index) => {
                let questionPreview = '';
                
                switch (question.question_type) {
                    case 'text':
                        questionPreview = '<em style="color: #6c757d;">Campo de texto livre</em>';
                        break;
                    case 'yes_no':
                        questionPreview = '<span style="color: #6c757d;">‚ö™ Sim &nbsp;&nbsp; ‚ö™ N√£o</span>';
                        break;
                    case 'single_choice':
                        if (question.options) {
                            try {
                                const options = Array.isArray(question.options) ? question.options : JSON.parse(question.options);
                                questionPreview = options.map(opt => `‚ö™ ${opt}`).join(' &nbsp;&nbsp; ');
                            } catch (e) {
                                questionPreview = '<em style="color: #dc3545;">Erro nas op√ß√µes</em>';
                            }
                        }
                        break;
                    case 'scale':
                        const min = question.scale_min || 1;
                        const max = question.scale_max || 10;
                        questionPreview = `<span style="color: #6c757d;">Escala de ${min} a ${max}</span>`;
                        break;
                }
                
                return `
                    <div style="border: 1px solid #e9ecef; border-radius: 6px; padding: 1rem; margin-bottom: 1rem; background: #f8f9fa;">
                        <strong>${index + 1}. ${question.question_text}</strong>
                        ${question.is_required ? '<span style="color: #dc3545; font-size: 0.8rem; margin-left: 0.5rem;">(Obrigat√≥ria)</span>' : ''}
                        <div style="margin-top: 0.5rem;">${questionPreview}</div>
                    </div>
                `;
            }).join('');
            
            const modal = `
                <div id="surveyDetailsModal" style="
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.5);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 1000;
                " data-action="closeSurveyDetails">
                    <div style="
                        background: white;
                        padding: 2rem;
                        border-radius: 12px;
                        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
                        max-width: 800px;
                        width: 90%;
                        max-height: 80vh;
                        overflow-y: auto;
                    " data-action="stopPropagation">
                        <h3 style="margin: 0 0 1rem 0; color: #333;">üìã ${survey.title}</h3>
                        <p style="color: #666; margin-bottom: 2rem;">${survey.description}</p>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                            <div style="background: #e7f3ff; padding: 1rem; border-radius: 6px; text-align: center;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: #0066cc;">${survey.questions.length}</div>
                                <div style="font-size: 0.9rem; color: #666;">Perguntas</div>
                            </div>
                            <div style="background: #f0f8f0; padding: 1rem; border-radius: 6px; text-align: center;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: #28a745;">${survey.total_responses || 0}</div>
                                <div style="font-size: 0.9rem; color: #666;">Respostas</div>
                            </div>
                            <div style="background: ${survey.is_active ? '#fff3cd' : '#f8d7da'}; padding: 1rem; border-radius: 6px; text-align: center;">
                                <div style="font-size: 1.2rem; font-weight: bold; color: ${survey.is_active ? '#856404' : '#721c24'};">${survey.is_active ? 'Ativa' : 'Inativa'}</div>
                                <div style="font-size: 0.9rem; color: #666;">Status</div>
                            </div>
                        </div>
                        
                        <h4 style="margin: 2rem 0 1rem 0; color: #333;">üìù Perguntas</h4>
                        
                        ${survey.questions.length > 0 ? questionsHTML : `
                            <div style="text-align: center; padding: 3rem; color: #6c757d;">
                                <div style="font-size: 3rem; margin-bottom: 1rem;">üìù</div>
                                <h4>Nenhuma pergunta cadastrada</h4>
                                <p>Esta pesquisa ainda n√£o possui perguntas configuradas.</p>
                            </div>
                        `}
                        
                        <div style="display: flex; justify-content: flex-end; margin-top: 2rem; padding-top: 1rem; border-top: 2px solid #e9ecef;">
                            <button class="btn btn-secondary" data-action="closeSurveyDetails">Fechar</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modal);
        }

        // Close survey details modal
        function closeSurveyDetails(event) {
            if (event && event.target !== event.currentTarget) return;
            
            const modal = document.getElementById('surveyDetailsModal');
            if (modal) {
                modal.remove();
            }
        }

        // Take survey (respond to survey)
        async function takeSurvey(surveyId) {
            console.log('üìù Iniciando resposta da pesquisa:', surveyId);
            
            try {
                // Load survey with questions
                const response = await fetch(`/api/surveys/${surveyId}`);
                const result = await response.json();
                
                if (result.success) {
                    const survey = result.data;
                    showSurveyForm(survey);
                } else {
                    showStatus('Erro ao carregar pesquisa: ' + result.error, 'error');
                }
            } catch (error) {
                console.error('‚ùå Erro ao carregar pesquisa:', error);
                showStatus('Erro ao carregar pesquisa', 'error');
            }
        }

        // Show survey form for responding
        function showSurveyForm(survey) {
            let html = `
                <div id="surveyFormModal" style="
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.5);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 1010;
                " data-action="closeSurveyForm">
                    <div style="
                        background: white;
                        padding: 2rem;
                        border-radius: 8px;
                        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
                        max-width: 700px;
                        width: 90%;
                        max-height: 80vh;
                        overflow-y: auto;
                    " data-action="stopPropagation">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                            <div>
                                <h4 style="margin: 0; color: #333;">${survey.title}</h4>
                                <p style="margin: 0.5rem 0 0; color: #666; font-size: 0.9rem;">${survey.description || ''}</p>
                                ${survey.is_anonymous ? '<div style="margin-top: 0.5rem;"><span class="badge badge-info">Pesquisa An√¥nima</span></div>' : ''}
                            </div>
                            <button data-action="closeSurveyForm" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #666;">&times;</button>
                        </div>
                        
                        ${survey.instructions ? `
                        <div style="background: #e7f3ff; padding: 1rem; border-radius: 6px; border-left: 4px solid #007bff; margin-bottom: 1.5rem;">
                            <strong>üìã Instru√ß√µes:</strong>
                            <p style="margin: 0.5rem 0 0;">${survey.instructions}</p>
                        </div>
                        ` : ''}
                        
                        <form id="surveyResponseForm">
                            <div id="surveyQuestions">
                                ${renderSurveyQuestions(survey.questions)}
                            </div>
                            
                            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 2rem; padding-top: 1rem; border-top: 1px solid #e9ecef;">
                                <button type="button" class="btn btn-secondary" data-action="closeSurveyForm">Cancelar</button>
                                <button type="submit" class="btn btn-primary">Enviar Respostas</button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', html);
            
            // Add form submit handler
            document.getElementById('surveyResponseForm').onsubmit = (e) => submitSurveyResponse(e, survey.id);
            
            // Add animation
            const modal = document.getElementById('surveyFormModal');
            modal.style.opacity = '0';
            setTimeout(() => {
                modal.style.opacity = '1';
                modal.style.transition = 'opacity 0.3s ease';
            }, 10);
        }

        // Render survey questions
        function renderSurveyQuestions(questions) {
            if (!questions || questions.length === 0) {
                return '<div style="text-align: center; padding: 2rem; color: #6c757d;">Esta pesquisa n√£o possui perguntas.</div>';
            }
            
            let html = '';
            
            questions.forEach((question, index) => {
                html += `
                    <div class="form-group" style="margin-bottom: 2rem; padding: 1.5rem; border: 1px solid #e9ecef; border-radius: 6px;">
                        <label style="display: block; margin-bottom: 1rem; font-weight: bold; color: #333;">
                            ${index + 1}. ${question.question_text}
                            ${question.is_required ? '<span style="color: #dc3545;">*</span>' : ''}
                        </label>
                        ${renderQuestionInput(question)}
                    </div>
                `;
            });
            
            return html;
        }

        // Render question input based on type
        function renderQuestionInput(question) {
            const name = `question_${question.id}`;
            
            switch (question.question_type) {
                case 'text':
                    return `<textarea name="${name}" rows="3" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem; resize: vertical;" ${question.is_required ? 'required' : ''}></textarea>`;
                
                case 'yes_no':
                    return `
                        <div style="display: flex; gap: 1.5rem; flex-wrap: wrap; margin-top: 0.5rem;">
                            <label style="display: flex; align-items: center; font-weight: normal; cursor: pointer; padding: 0.5rem;">
                                <input type="radio" name="${name}" value="yes" ${question.is_required ? 'required' : ''} style="margin-right: 0.75rem;">
                                <span>Sim</span>
                            </label>
                            <label style="display: flex; align-items: center; font-weight: normal; cursor: pointer; padding: 0.5rem;">
                                <input type="radio" name="${name}" value="no" ${question.is_required ? 'required' : ''} style="margin-right: 0.75rem;">
                                <span>N√£o</span>
                            </label>
                        </div>
                    `;
                
                case 'single_choice':
                    if (question.options) {
                        let options;
                        try {
                            // Check if options is already an array or needs parsing
                            options = Array.isArray(question.options) ? question.options : JSON.parse(question.options);
                        } catch (e) {
                            console.error('Erro ao processar op√ß√µes:', question.options);
                            options = [];
                        }
                        
                        if (options.length > 0) {
                            return `<div style="margin-top: 0.5rem;">${options.map(option => `
                                <label style="display: flex; align-items: center; margin-bottom: 0.75rem; font-weight: normal; cursor: pointer; padding: 0.5rem; border-radius: 4px; transition: background-color 0.2s;" onmouseover="this.style.backgroundColor='#f8f9fa'" onmouseout="this.style.backgroundColor='transparent'">
                                    <input type="radio" name="${name}" value="${option}" ${question.is_required ? 'required' : ''} style="margin-right: 0.75rem;">
                                    <span>${option}</span>
                                </label>
                            `).join('')}</div>`;
                        }
                    }
                    return '<p style="color: #dc3545;">Op√ß√µes n√£o configuradas para esta pergunta.</p>';
                
                case 'scale':
                    const min = question.scale_min || 1;
                    const max = question.scale_max || 10;
                    let labels = {};
                    try {
                        labels = question.scale_labels ? (typeof question.scale_labels === 'object' ? question.scale_labels : JSON.parse(question.scale_labels)) : {};
                    } catch (e) {
                        console.error('Erro ao processar labels da escala:', question.scale_labels);
                        labels = {};
                    }
                    
                    let scaleHtml = `
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem;">
                            <span style="font-size: 0.9rem; color: #666;">${labels[min] || min}</span>
                            <span style="font-size: 0.9rem; color: #666;">${labels[max] || max}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; gap: 0.5rem;">
                    `;
                    
                    for (let i = min; i <= max; i++) {
                        scaleHtml += `
                            <label style="text-align: center; font-weight: normal; cursor: pointer; padding: 0.5rem; border-radius: 4px; transition: all 0.2s; min-width: 40px;" onmouseover="this.style.backgroundColor='#e3f2fd'" onmouseout="this.style.backgroundColor='transparent'">
                                <input type="radio" name="${name}" value="${i}" ${question.is_required ? 'required' : ''} style="display: block; margin: 0 auto 0.5rem;">
                                <span style="font-size: 0.9rem; font-weight: bold; color: #333;">${i}</span>
                            </label>
                        `;
                    }
                    
                    scaleHtml += '</div>';
                    return scaleHtml;
                
                default:
                    return `<input type="text" name="${name}" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem;" ${question.is_required ? 'required' : ''}>`;
            }
        }

        // Close survey form
        function closeSurveyForm(event) {
            if (event && event.target !== event.currentTarget) return;
            
            const modal = document.getElementById('surveyFormModal');
            if (modal) {
                modal.style.opacity = '0';
                setTimeout(() => modal.remove(), 300);
            }
        }

        // Submit survey response
        async function submitSurveyResponse(event, surveyId) {
            event.preventDefault();
            
            const form = event.target;
            const formData = new FormData(form);
            const responses = {};
            
            // Collect all form data
            for (let [key, value] of formData.entries()) {
                responses[key] = value;
            }
            
            console.log('üí¨ Enviando resposta da pesquisa:', surveyId, responses);
            
            try {
                const submitBtn = form.querySelector('button[type="submit"]');
                setButtonLoading(submitBtn, true);
                
                const response = await fetchWithAuth(`/api/surveys/${surveyId}/responses`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        responses: responses,
                        employee_id: null, // Simplified for now
                        completion_time: Date.now(),
                        session_id: Math.random().toString(36).substring(2, 15)
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showStatus('Resposta enviada com sucesso! Obrigado pela participa√ß√£o.', 'success');
                    closeSurveyForm();
                    refreshSurveysList();
                } else {
                    showStatus('Erro ao enviar resposta: ' + result.error, 'error');
                }
                
            } catch (error) {
                console.error('‚ùå Erro ao enviar resposta:', error);
                showStatus('Erro ao enviar resposta da pesquisa', 'error');
            } finally {
                const submitBtn = form.querySelector('button[type="submit"]');
                setButtonLoading(submitBtn, false);
            }
        }

        // View survey results
        async function viewSurveyResults(surveyId) {
            try {
                console.log('üìä Visualizando resultados da pesquisa:', surveyId);
                
                const response = await fetch(`/api/surveys/${surveyId}/results`);
                const result = await response.json();
                
                if (result.success) {
                    showSurveyResultsModal(result.data);
                } else {
                    showStatus('Erro ao carregar resultados: ' + result.error, 'error');
                }
                
            } catch (error) {
                console.error('‚ùå Erro ao carregar resultados:', error);
                showStatus('Erro ao carregar resultados da pesquisa', 'error');
            }
        }

        // Show survey results modal
        function showSurveyResultsModal(data) {
            const { survey, responses, statistics } = data;
            
            if (!survey) {
                showStatus('Dados da pesquisa n√£o encontrados', 'error');
                return;
            }
            
            let questionsResults = '';
            
            if (survey.questions && survey.questions.length > 0) {
                questionsResults = survey.questions.map((question, index) => {
                    const questionResponses = responses.filter(r => r.question_id === question.id);
                    
                    let resultHTML = '';
                    
                    switch (question.question_type) {
                        case 'text':
                            resultHTML = questionResponses.map(r => `
                                <div style="border-left: 3px solid #007bff; padding-left: 1rem; margin-bottom: 0.5rem; font-style: italic;">
                                    "${r.answer_text || 'Resposta vazia'}"
                                </div>
                            `).join('');
                            break;
                            
                        case 'yes_no':
                            const yesCount = questionResponses.filter(r => r.answer_text === 'Sim').length;
                            const noCount = questionResponses.filter(r => r.answer_text === 'N√£o').length;
                            const total = yesCount + noCount;
                            
                            resultHTML = `
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                    <div style="background: #d4edda; padding: 1rem; border-radius: 6px; text-align: center;">
                                        <div style="font-size: 1.5rem; font-weight: bold; color: #155724;">${yesCount}</div>
                                        <div style="color: #155724;">Sim (${total > 0 ? Math.round(yesCount/total*100) : 0}%)</div>
                                    </div>
                                    <div style="background: #f8d7da; padding: 1rem; border-radius: 6px; text-align: center;">
                                        <div style="font-size: 1.5rem; font-weight: bold; color: #721c24;">${noCount}</div>
                                        <div style="color: #721c24;">N√£o (${total > 0 ? Math.round(noCount/total*100) : 0}%)</div>
                                    </div>
                                </div>
                            `;
                            break;
                            
                        case 'single_choice':
                            let options = [];
                            try {
                                options = Array.isArray(question.options) ? question.options : JSON.parse(question.options || '[]');
                            } catch (e) {
                                options = [];
                            }
                            
                            const optionCounts = {};
                            questionResponses.forEach(r => {
                                const answer = r.answer_text;
                                optionCounts[answer] = (optionCounts[answer] || 0) + 1;
                            });
                            
                            const totalAnswers = questionResponses.length;
                            
                            resultHTML = options.map(option => {
                                const count = optionCounts[option] || 0;
                                const percentage = totalAnswers > 0 ? Math.round(count/totalAnswers*100) : 0;
                                
                                return `
                                    <div style="display: flex; align-items: center; margin-bottom: 0.5rem;">
                                        <div style="flex: 1; margin-right: 1rem;">${option}</div>
                                        <div style="width: 100px; background: #e9ecef; border-radius: 10px; overflow: hidden;">
                                            <div style="width: ${percentage}%; height: 20px; background: #007bff; transition: width 0.3s;"></div>
                                        </div>
                                        <div style="width: 60px; text-align: right; font-weight: bold;">${count} (${percentage}%)</div>
                                    </div>
                                `;
                            }).join('');
                            break;
                            
                        case 'scale':
                            const scaleValues = questionResponses.map(r => parseInt(r.answer_text)).filter(v => !isNaN(v));
                            const average = scaleValues.length > 0 ? (scaleValues.reduce((a, b) => a + b, 0) / scaleValues.length).toFixed(1) : 0;
                            const min = question.scale_min || 1;
                            const max = question.scale_max || 10;
                            
                            const scaleCounts = {};
                            for (let i = min; i <= max; i++) {
                                scaleCounts[i] = scaleValues.filter(v => v === i).length;
                            }
                            
                            resultHTML = `
                                <div style="background: #e7f3ff; padding: 1rem; border-radius: 6px; text-align: center; margin-bottom: 1rem;">
                                    <div style="font-size: 2rem; font-weight: bold; color: #0066cc;">${average}</div>
                                    <div style="color: #0066cc;">M√©dia (${scaleValues.length} respostas)</div>
                                </div>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(60px, 1fr)); gap: 0.5rem;">
                                    ${Object.keys(scaleCounts).map(value => `
                                        <div style="text-align: center; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
                                            <div style="font-weight: bold;">${value}</div>
                                            <div style="font-size: 0.8rem; color: #666;">${scaleCounts[value]}</div>
                                        </div>
                                    `).join('')}
                                </div>
                            `;
                            break;
                    }
                    
                    return `
                        <div style="border: 1px solid #e9ecef; border-radius: 6px; padding: 1.5rem; margin-bottom: 1.5rem; background: #f8f9fa;">
                            <h5 style="margin: 0 0 1rem 0; color: #333;">${index + 1}. ${question.question_text}</h5>
                            <div style="margin-bottom: 0.5rem;">
                                <span style="background: #007bff; color: white; padding: 0.25rem 0.5rem; border-radius: 12px; font-size: 0.8rem;">
                                    ${getQuestionTypeLabel(question.question_type)}
                                </span>
                                <span style="margin-left: 0.5rem; color: #666; font-size: 0.9rem;">
                                    ${questionResponses.length} respostas
                                </span>
                            </div>
                            ${questionResponses.length > 0 ? resultHTML : '<div style="color: #6c757d; font-style: italic;">Nenhuma resposta ainda</div>'}
                        </div>
                    `;
                }).join('');
            }
            
            const modal = `
                <div id="surveyResultsModal" style="
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.5);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 1010;
                " data-action="closeSurveyResults">
                    <div style="
                        background: white;
                        padding: 2rem;
                        border-radius: 12px;
                        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
                        max-width: 1000px;
                        width: 95%;
                        max-height: 90vh;
                        overflow-y: auto;
                    " data-action="stopPropagation">
                        <h3 style="margin: 0 0 1rem 0; color: #333;">üìä Resultados: ${survey.title}</h3>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                            <div style="background: #e7f3ff; padding: 1rem; border-radius: 6px; text-align: center;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: #0066cc;">${statistics?.total_responses || 0}</div>
                                <div style="font-size: 0.9rem; color: #666;">Total de Respostas</div>
                            </div>
                            <div style="background: #f0f8f0; padding: 1rem; border-radius: 6px; text-align: center;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: #28a745;">${statistics?.completed_responses || 0}</div>
                                <div style="font-size: 0.9rem; color: #666;">Respostas Completas</div>
                            </div>
                            <div style="background: #fff3cd; padding: 1rem; border-radius: 6px; text-align: center;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: #856404;">${survey.questions?.length || 0}</div>
                                <div style="font-size: 0.9rem; color: #666;">Perguntas</div>
                            </div>
                        </div>
                        
                        <h4 style="margin: 2rem 0 1rem 0; color: #333;">üìà Resultados por Pergunta</h4>
                        
                        ${questionsResults || `
                            <div style="text-align: center; padding: 3rem; color: #6c757d;">
                                <div style="font-size: 3rem; margin-bottom: 1rem;">üìà</div>
                                <h4>Nenhum resultado ainda</h4>
                                <p>Esta pesquisa ainda n√£o possui respostas.</p>
                            </div>
                        `}
                        
                        <div style="display: flex; justify-content: flex-end; margin-top: 2rem; padding-top: 1rem; border-top: 2px solid #e9ecef;">
                            <button class="btn btn-secondary" data-action="closeSurveyResults">Fechar</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modal);
        }

        // Close survey results modal
        function closeSurveyResults(event) {
            if (event && event.target !== event.currentTarget) return;
            
            const modal = document.getElementById('surveyResultsModal');
            if (modal) {
                modal.remove();
            }
        }

        // Toggle survey active status
        async function toggleSurvey(surveyId) {
            try {
                console.log('üîÑ Alterando status da pesquisa:', surveyId);
                
                const response = await fetchWithAuth(`/api/surveys/${surveyId}/toggle`, {
                    method: 'PUT'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showStatus(result.message, 'success');
                    refreshSurveysList();
                } else {
                    showStatus('Erro ao alterar status: ' + result.error, 'error');
                }
                
            } catch (error) {
                console.error('‚ùå Erro ao alterar status:', error);
                showStatus('Erro ao alterar status da pesquisa', 'error');
            }
        }

        // Create survey from template
        async function createSurveyFromTemplate(templateData) {
            try {
                console.log('‚ûï Criando pesquisa a partir do template:', templateData.title);
                
                showStatus('Criando pesquisa... Aguarde!', 'info');
                
                const response = await fetchWithAuth('/api/surveys', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(templateData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showStatus(`Pesquisa "${templateData.title}" criada com sucesso!`, 'success');
                    refreshSurveysList();
                } else {
                    showStatus('Erro ao criar pesquisa: ' + result.error, 'error');
                }
                
            } catch (error) {
                console.error('‚ùå Erro ao criar pesquisa:', error);
                showStatus('Erro ao criar pesquisa do template', 'error');
            }
        }

        // Show create survey form (custom)
        function showCreateSurveyForm(templateData = null) {
            const modal = `
                <div id="createSurveyModal" style="
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.5);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 1010;
                " data-action="closeCreateSurveyModal">
                    <div style="
                        background: white;
                        padding: 2rem;
                        border-radius: 12px;
                        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
                        max-width: 700px;
                        width: 90%;
                        max-height: 80vh;
                        overflow-y: auto;
                    " data-action="stopPropagation">
                        <h3 style="margin: 0 0 1.5rem 0; color: #333;">‚ûï Criar Nova Pesquisa</h3>
                        
                        <form id="createSurveyForm">
                            <div class="form-group" style="margin-bottom: 1rem;">
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: bold;">üìù T√≠tulo da Pesquisa:</label>
                                <input type="text" name="title" required style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px;" 
                                       value="${templateData ? templateData.title : ''}"
                                       placeholder="Ex: Pesquisa de Satisfa√ß√£o 2025">
                            </div>
                            
                            <div class="form-group" style="margin-bottom: 1rem;">
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: bold;">üìÑ Descri√ß√£o:</label>
                                <textarea name="description" rows="2" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; resize: vertical;"
                                          placeholder="Descreva o objetivo da pesquisa">${templateData ? templateData.description : ''}</textarea>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                                <div class="form-group">
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: bold;">üè∑Ô∏è Tipo:</label>
                                    <select name="survey_type" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px;">
                                        <option value="satisfaction" ${templateData && templateData.survey_type === 'satisfaction' ? 'selected' : ''}>Satisfa√ß√£o</option>
                                        <option value="climate" ${templateData && templateData.survey_type === 'climate' ? 'selected' : ''}>Clima Organizacional</option>
                                        <option value="engagement" ${templateData && templateData.survey_type === 'engagement' ? 'selected' : ''}>Engagement</option>
                                        <option value="feedback" ${templateData && templateData.survey_type === 'feedback' ? 'selected' : ''}>Feedback</option>
                                        <option value="custom" ${templateData && templateData.survey_type === 'custom' ? 'selected' : ''}>Personalizada</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: bold;">üîí Anonimato:</label>
                                    <label style="display: flex; align-items: center; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; background: #f8f9fa;">
                                        <input type="checkbox" name="is_anonymous" ${templateData && templateData.is_anonymous ? 'checked' : ''} style="margin-right: 0.5rem;">
                                        Pesquisa An√¥nima
                                    </label>
                                </div>
                            </div>
                            
                            <div class="form-group" style="margin-bottom: 1rem;">
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: bold;">üìã Instru√ß√µes para participantes:</label>
                                <textarea name="instructions" rows="2" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; resize: vertical;"
                                          placeholder="Instru√ß√µes sobre como responder a pesquisa">${templateData ? templateData.instructions : ''}</textarea>
                            </div>
                            
                            <div class="form-group" style="margin-bottom: 1rem;">
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: bold;">üéâ Mensagem de agradecimento:</label>
                                <input type="text" name="thank_you_message" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px;"
                                       placeholder="Obrigado por participar da nossa pesquisa!"
                                       value="Obrigado por participar da nossa pesquisa!">
                            </div>
                            
                            <div class="form-group" style="margin-bottom: 2rem;">
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: bold;">üìÖ Data de encerramento (opcional):</label>
                                <input type="date" name="end_date" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            
                            <div style="background: #e7f3ff; padding: 1rem; border-radius: 6px; margin-bottom: 2rem;">
                                <strong>üí° Dica:</strong>
                                <p style="margin: 0.5rem 0 0; color: #666; font-size: 0.9rem;">
                                    Ap√≥s criar a pesquisa, voc√™ poder√° adicionar perguntas personalizadas e gerar links de compartilhamento com QR Code.
                                </p>
                            </div>
                            
                            <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                                <button type="button" class="btn btn-secondary" data-action="closeCreateSurveyModal">Cancelar</button>
                                <button type="submit" class="btn btn-primary">‚úÖ Criar Pesquisa</button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modal);
            
            // Add form submit handler
            document.getElementById('createSurveyForm').onsubmit = submitCreateSurveyForm;
            
            // Add animation
            const modalEl = document.getElementById('createSurveyModal');
            modalEl.style.opacity = '0';
            setTimeout(() => {
                modalEl.style.opacity = '1';
                modalEl.style.transition = 'opacity 0.3s ease';
            }, 10);
        }

        // Close create survey modal
        function closeCreateSurveyModal(event) {
            if (event && event.target !== event.currentTarget) return;
            
            const modal = document.getElementById('createSurveyModal');
            if (modal) {
                modal.style.opacity = '0';
                setTimeout(() => modal.remove(), 300);
            }
        }

        // Submit create survey form
        async function submitCreateSurveyForm(event) {
            event.preventDefault();
            
            const form = event.target;
            const formData = new FormData(form);
            
            const surveyData = {
                title: formData.get('title'),
                description: formData.get('description'),
                survey_type: formData.get('survey_type'),
                is_anonymous: formData.has('is_anonymous'),
                instructions: formData.get('instructions'),
                thank_you_message: formData.get('thank_you_message'),
                end_date: formData.get('end_date') || null,
                questions: [] // Start with empty questions - can be added later
            };
            
            try {
                const submitBtn = form.querySelector('button[type="submit"]');
                setButtonLoading(submitBtn, true);
                
                console.log('‚ûï Criando nova pesquisa:', surveyData.title);
                
                const response = await fetchWithAuth('/api/surveys', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(surveyData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showStatus(`Pesquisa "${surveyData.title}" criada com sucesso!`, 'success');
                    closeCreateSurveyModal();
                    refreshSurveysList();
                } else {
                    showStatus('Erro ao criar pesquisa: ' + result.error, 'error');
                }
                
            } catch (error) {
                console.error('‚ùå Erro ao criar pesquisa:', error);
                showStatus('Erro ao criar pesquisa personalizada', 'error');
            } finally {
                const submitBtn = form.querySelector('button[type="submit"]');
                setButtonLoading(submitBtn, false);
            }
        }

        // Show survey reports (placeholder)
        function showSurveyReports() {
            showStatus('Funcionalidade de relat√≥rios de pesquisa em desenvolvimento', 'info');
        }

        // Generate public survey link
        async function generateSurveyLink(surveyId) {
            try {
                console.log('üîó Gerando link p√∫blico para pesquisa:', surveyId);
                
                const response = await fetch(`/api/surveys/${surveyId}/public-link`);
                const result = await response.json();
                
                if (result.success) {
                    showSurveyLinkModal(result.data);
                } else {
                    showStatus('Erro ao gerar link: ' + result.error, 'error');
                }
                
            } catch (error) {
                console.error('‚ùå Erro ao gerar link:', error);
                showStatus('Erro ao gerar link da pesquisa', 'error');
            }
        }

        // Show survey link modal with QR code
        function showSurveyLinkModal(linkData) {
            const modal = `
                <div id="surveyLinkModal" style="
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.5);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 1010;
                " data-action="closeSurveyLinkModal">
                    <div style="
                        background: white;
                        padding: 2rem;
                        border-radius: 12px;
                        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
                        max-width: 600px;
                        width: 90%;
                        text-align: center;
                    " data-action="stopPropagation">
                        <h3 style="margin: 0 0 1rem 0; color: #333;">üîó Link P√∫blico da Pesquisa</h3>
                        <h4 style="margin: 0 0 2rem 0; color: #666; font-weight: normal;">${linkData.survey_title}</h4>
                        
                        <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem; text-align: left;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: bold; color: #333;">üåê Link da Pesquisa:</label>
                            <div style="display: flex; gap: 0.5rem; align-items: center;">
                                <input type="text" id="surveyPublicLink" value="${linkData.public_link}" readonly style="
                                    flex: 1;
                                    padding: 0.75rem;
                                    border: 1px solid #ddd;
                                    border-radius: 4px;
                                    font-family: monospace;
                                    font-size: 0.9rem;
                                    background: white;
                                ">
                                <button class="btn btn-sm btn-primary" data-action="copySurveyLink" title="Copiar link">üìã</button>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 2rem;">
                            <h5 style="margin-bottom: 1rem; color: #333;">üì± QR Code para Compartilhamento</h5>
                            <div style="display: flex; justify-content: center; margin-bottom: 1rem;">
                                <img src="${linkData.qr_code_url}" alt="QR Code da pesquisa" style="
                                    border: 2px solid #e9ecef;
                                    border-radius: 8px;
                                    background: white;
                                    padding: 10px;
                                ">
                            </div>
                            <p style="color: #666; font-size: 0.9rem; margin: 0;">
                                üí° Escaneie o QR Code para acessar a pesquisa no celular
                            </p>
                        </div>
                        
                        <div style="background: #e7f3ff; padding: 1rem; border-radius: 6px; margin-bottom: 2rem; text-align: left;">
                            <strong>üìã Como compartilhar:</strong>
                            <ul style="margin: 0.5rem 0 0; padding-left: 1.5rem; color: #666;">
                                <li>Envie o link por email ou WhatsApp</li>
                                <li>Compartilhe o QR Code em redes sociais</li>
                                <li>Imprima o QR Code para distribui√ß√£o f√≠sica</li>
                                <li>Adicione em sites ou apresenta√ß√µes</li>
                            </ul>
                        </div>
                        
                        <div style="display: flex; gap: 1rem; justify-content: center;">
                            <button class="btn btn-primary" data-action="openSurveyInNewTab" data-link="\${linkData.public_link}">üåê Abrir Pesquisa</button>
                            <button class="btn btn-success" data-action="downloadQRCode" data-qr-url="\${linkData.qr_code_url}" data-title="\${linkData.survey_title}">üíæ Baixar QR Code</button>
                            <button class="btn btn-secondary" data-action="closeSurveyLinkModal">Fechar</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modal);
            
            // Add animation
            const modalEl = document.getElementById('surveyLinkModal');
            modalEl.style.opacity = '0';
            setTimeout(() => {
                modalEl.style.opacity = '1';
                modalEl.style.transition = 'opacity 0.3s ease';
            }, 10);
        }

        // Close survey link modal
        function closeSurveyLinkModal(event) {
            if (event && event.target !== event.currentTarget) return;
            
            const modal = document.getElementById('surveyLinkModal');
            if (modal) {
                modal.style.opacity = '0';
                setTimeout(() => modal.remove(), 300);
            }
        }

        // Copy survey link to clipboard
        function copySurveyLink() {
            const linkInput = document.getElementById('surveyPublicLink');
            linkInput.select();
            linkInput.setSelectionRange(0, 99999); // For mobile devices
            
            try {
                document.execCommand('copy');
                showStatus('Link copiado para a √°rea de transfer√™ncia!', 'success');
                
                // Visual feedback
                const copyBtn = event.target;
                const originalText = copyBtn.textContent;
                copyBtn.textContent = '‚úÖ';
                copyBtn.style.background = '#28a745';
                
                setTimeout(() => {
                    copyBtn.textContent = originalText;
                    copyBtn.style.background = '';
                }, 1500);
                
            } catch (err) {
                console.error('Erro ao copiar:', err);
                showStatus('Erro ao copiar link. Copie manualmente.', 'error');
            }
        }

        // Open survey in new tab
        function openSurveyInNewTab(link) {
            window.open(link, '_blank');
            showStatus('Pesquisa aberta em nova aba', 'info');
        }

        // Download QR Code
        function downloadQRCode(qrCodeUrl, surveyTitle) {
            try {
                const link = document.createElement('a');
                link.href = qrCodeUrl;
                link.download = `qrcode_${surveyTitle.replace(/[^a-zA-Z0-9]/g, '_')}.svg`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                showStatus('QR Code baixado com sucesso!', 'success');
                
            } catch (error) {
                console.error('Erro ao baixar QR Code:', error);
                showStatus('Erro ao baixar QR Code', 'error');
            }
        }

        // Manage survey questions
        async function manageSurveyQuestions(surveyId) {
            try {
                console.log('‚ùì Gerenciando perguntas da pesquisa:', surveyId);
                
                // Fetch survey and questions
                const response = await fetch(`/api/surveys/${surveyId}`);
                const result = await response.json();
                
                if (result.success) {
                    showQuestionsManager(result.data);
                } else {
                    showStatus('Erro ao carregar perguntas: ' + result.error, 'error');
                }
                
            } catch (error) {
                console.error('‚ùå Erro ao carregar perguntas:', error);
                showStatus('Erro ao carregar perguntas da pesquisa', 'error');
            }
        }

        // Show questions manager modal
        function showQuestionsManager(survey) {
            const questionsHTML = survey.questions.map((question, index) => `
                <div style="border: 1px solid #e9ecef; border-radius: 6px; padding: 1rem; margin-bottom: 1rem; background: #f8f9fa;">
                    <div style="display: flex; justify-content: between; align-items: flex-start; margin-bottom: 0.5rem;">
                        <div style="flex: 1;">
                            <strong style="color: #495057;">${index + 1}. ${question.question_text}</strong>
                            <div style="margin-top: 0.25rem;">
                                <span style="background: #007bff; color: white; padding: 0.25rem 0.5rem; border-radius: 12px; font-size: 0.8rem;">
                                    ${getQuestionTypeLabel(question.question_type)}
                                </span>
                                ${question.is_required ? '<span style="background: #dc3545; color: white; padding: 0.25rem 0.5rem; border-radius: 12px; font-size: 0.8rem; margin-left: 0.5rem;">Obrigat√≥ria</span>' : ''}
                            </div>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-sm btn-primary" data-action="editQuestion" data-survey-id="\${survey.id}" data-question-id="\${question.id}" title="Editar pergunta">‚úèÔ∏è</button>
                            <button class="btn btn-sm btn-danger" data-action="deleteQuestion" data-survey-id="\${survey.id}" data-question-id="\${question.id}" title="Excluir pergunta">üóëÔ∏è</button>
                        </div>
                    </div>
                    ${renderQuestionPreview(question)}
                </div>
            `).join('');

            const modal = `
                <div id="questionsManagerModal" style="
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.5);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 1010;
                " data-action="closeQuestionsManager">
                    <div style="
                        background: white;
                        padding: 2rem;
                        border-radius: 12px;
                        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
                        max-width: 900px;
                        width: 90%;
                        max-height: 80vh;
                        overflow-y: auto;
                    " data-action="stopPropagation">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                            <h3 style="margin: 0; color: #333;">‚ùì Gerenciar Perguntas</h3>
                            <button class="btn btn-primary" data-action="showAddQuestionForm" data-survey-id="\${survey.id}">‚ûï Nova Pergunta</button>
                        </div>
                        
                        <div style="background: #e7f3ff; padding: 1rem; border-radius: 6px; margin-bottom: 2rem;">
                            <strong>üìã ${survey.title}</strong>
                            <p style="margin: 0.5rem 0 0; color: #666; font-size: 0.9rem;">${survey.description}</p>
                        </div>
                        
                        <div id="questionsList">
                            ${survey.questions.length > 0 ? questionsHTML : `
                                <div style="text-align: center; padding: 3rem; color: #6c757d;">
                                    <div style="font-size: 3rem; margin-bottom: 1rem;">üìù</div>
                                    <h4>Nenhuma pergunta cadastrada</h4>
                                    <p>Clique em "Nova Pergunta" para adicionar a primeira pergunta desta pesquisa.</p>
                                </div>
                            `}
                        </div>
                        
                        <div style="display: flex; justify-content: flex-end; margin-top: 2rem; padding-top: 1rem; border-top: 2px solid #e9ecef;">
                            <button class="btn btn-secondary" data-action="closeQuestionsManager">Fechar</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modal);
            
            // Add animation
            const modalEl = document.getElementById('questionsManagerModal');
            modalEl.style.opacity = '0';
            setTimeout(() => {
                modalEl.style.opacity = '1';
                modalEl.style.transition = 'opacity 0.3s ease';
            }, 10);
        }

        // Get question type label
        function getQuestionTypeLabel(type) {
            const labels = {
                'text': 'Texto',
                'yes_no': 'Sim/N√£o',
                'single_choice': 'M√∫ltipla Escolha',
                'scale': 'Escala'
            };
            return labels[type] || type;
        }

        // Render question preview
        function renderQuestionPreview(question) {
            switch (question.question_type) {
                case 'text':
                    return '<div style="color: #6c757d; font-style: italic; margin-top: 0.5rem;">Campo de texto livre</div>';
                    
                case 'yes_no':
                    return '<div style="color: #6c757d; margin-top: 0.5rem;">‚ö™ Sim &nbsp;&nbsp; ‚ö™ N√£o</div>';
                    
                case 'single_choice':
                    if (question.options) {
                        let options;
                        try {
                            options = Array.isArray(question.options) ? question.options : JSON.parse(question.options);
                            return `<div style="color: #6c757d; margin-top: 0.5rem;">${options.map(opt => `‚ö™ ${opt}`).join(' &nbsp;&nbsp; ')}</div>`;
                        } catch (e) {
                            return '<div style="color: #dc3545; margin-top: 0.5rem;">Erro nas op√ß√µes</div>';
                        }
                    }
                    return '<div style="color: #dc3545; margin-top: 0.5rem;">Op√ß√µes n√£o configuradas</div>';
                    
                case 'scale':
                    const min = question.scale_min || 1;
                    const max = question.scale_max || 10;
                    return `<div style="color: #6c757d; margin-top: 0.5rem;">Escala de ${min} a ${max}</div>`;
                    
                default:
                    return '<div style="color: #6c757d; margin-top: 0.5rem;">Tipo de pergunta desconhecido</div>';
            }
        }

        // Close questions manager
        function closeQuestionsManager(event) {
            if (event && event.target !== event.currentTarget) return;
            
            const modal = document.getElementById('questionsManagerModal');
            if (modal) {
                modal.style.opacity = '0';
                setTimeout(() => modal.remove(), 300);
            }
        }

        // Show add question form
        function showAddQuestionForm(surveyId) {
            const formModal = `
                <div id="addQuestionModal" style="
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.6);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 1020;
                " data-action="closeAddQuestionForm">
                    <div style="
                        background: white;
                        padding: 2rem;
                        border-radius: 12px;
                        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
                        max-width: 600px;
                        width: 90%;
                        max-height: 80vh;
                        overflow-y: auto;
                    " data-action="stopPropagation">
                        <h4 style="margin: 0 0 1.5rem 0; color: #333;">‚ûï Adicionar Nova Pergunta</h4>
                        
                        <form id="addQuestionForm">
                            <div class="form-group" style="margin-bottom: 1rem;">
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: bold;">‚ùì Pergunta:</label>
                                <textarea name="question_text" required rows="2" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; resize: vertical;"
                                          placeholder="Digite sua pergunta aqui..."></textarea>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                                <div class="form-group">
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: bold;">üè∑Ô∏è Tipo:</label>
                                    <select name="question_type" onchange="toggleQuestionOptions()" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px;">
                                        <option value="text">Texto Livre</option>
                                        <option value="yes_no">Sim/N√£o</option>
                                        <option value="single_choice">M√∫ltipla Escolha</option>
                                        <option value="scale">Escala</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: bold;">üìã Obrigat√≥ria:</label>
                                    <label style="display: flex; align-items: center; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; background: #f8f9fa;">
                                        <input type="checkbox" name="is_required" style="margin-right: 0.5rem;">
                                        Pergunta obrigat√≥ria
                                    </label>
                                </div>
                            </div>
                            
                            <div id="questionOptions" style="display: none;">
                                <!-- Options will be shown based on question type -->
                            </div>
                            
                            <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 2rem;">
                                <button type="button" class="btn btn-secondary" data-action="closeAddQuestionForm">Cancelar</button>
                                <button type="submit" class="btn btn-primary">‚úÖ Adicionar Pergunta</button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', formModal);
            
            // Add form submit handler
            document.getElementById('addQuestionForm').onsubmit = (e) => submitAddQuestion(e, surveyId);
            
            // Initialize question type options
            toggleQuestionOptions();
            
            // Add animation
            const modalEl = document.getElementById('addQuestionModal');
            modalEl.style.opacity = '0';
            setTimeout(() => {
                modalEl.style.opacity = '1';
                modalEl.style.transition = 'opacity 0.3s ease';
            }, 10);
        }

        // Toggle question options based on type
        function toggleQuestionOptions() {
            const questionType = document.querySelector('select[name="question_type"]').value;
            const optionsDiv = document.getElementById('questionOptions');
            
            let optionsHTML = '';
            
            switch (questionType) {
                case 'single_choice':
                    optionsHTML = `
                        <div class="form-group" style="margin-bottom: 1rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: bold;">üìù Op√ß√µes (uma por linha):</label>
                            <textarea name="options" required rows="4" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; resize: vertical;"
                                      placeholder="Op√ß√£o 1&#10;Op√ß√£o 2&#10;Op√ß√£o 3"></textarea>
                        </div>
                    `;
                    optionsDiv.style.display = 'block';
                    break;
                    
                case 'scale':
                    optionsHTML = `
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                            <div class="form-group">
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: bold;">üìä Valor m√≠nimo:</label>
                                <input type="number" name="scale_min" value="1" min="0" max="100" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div class="form-group">
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: bold;">üìà Valor m√°ximo:</label>
                                <input type="number" name="scale_max" value="10" min="1" max="100" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                        </div>
                        <div class="form-group" style="margin-bottom: 1rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: bold;">üè∑Ô∏è R√≥tulos da escala (opcional):</label>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <input type="text" name="label_min" placeholder="Ex: Muito ruim" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px;">
                                <input type="text" name="label_max" placeholder="Ex: Excelente" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                        </div>
                    `;
                    optionsDiv.style.display = 'block';
                    break;
                    
                default:
                    optionsDiv.style.display = 'none';
                    break;
            }
            
            optionsDiv.innerHTML = optionsHTML;
        }

        // Close add question form
        function closeAddQuestionForm(event) {
            if (event && event.target !== event.currentTarget) return;
            
            const modal = document.getElementById('addQuestionModal');
            if (modal) {
                modal.style.opacity = '0';
                setTimeout(() => modal.remove(), 300);
            }
        }

        // Submit add question
        async function submitAddQuestion(event, surveyId) {
            event.preventDefault();
            
            const form = event.target;
            const formData = new FormData(form);
            
            const questionData = {
                survey_id: surveyId,
                question_text: formData.get('question_text'),
                question_type: formData.get('question_type'),
                is_required: formData.has('is_required')
            };

            // Handle type-specific data
            switch (questionData.question_type) {
                case 'single_choice':
                    const optionsText = formData.get('options');
                    questionData.options = optionsText.split('\n').filter(opt => opt.trim());
                    break;
                    
                case 'scale':
                    questionData.scale_min = parseInt(formData.get('scale_min')) || 1;
                    questionData.scale_max = parseInt(formData.get('scale_max')) || 10;
                    
                    const labelMin = formData.get('label_min');
                    const labelMax = formData.get('label_max');
                    
                    if (labelMin || labelMax) {
                        questionData.scale_labels = {};
                        if (labelMin) questionData.scale_labels[questionData.scale_min] = labelMin;
                        if (labelMax) questionData.scale_labels[questionData.scale_max] = labelMax;
                    }
                    break;
            }
            
            try {
                const submitBtn = form.querySelector('button[type="submit"]');
                setButtonLoading(submitBtn, true);
                
                console.log('‚ûï Adicionando nova pergunta:', questionData);
                
                const response = await fetchWithAuth(`/api/surveys/${surveyId}/questions`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(questionData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showStatus('Pergunta adicionada com sucesso!', 'success');
                    closeAddQuestionForm();
                    
                    // Refresh questions manager
                    manageSurveyQuestions(surveyId);
                } else {
                    showStatus('Erro ao adicionar pergunta: ' + result.error, 'error');
                }
                
            } catch (error) {
                console.error('‚ùå Erro ao adicionar pergunta:', error);
                showStatus('Erro ao adicionar pergunta', 'error');
            } finally {
                const submitBtn = form.querySelector('button[type="submit"]');
                setButtonLoading(submitBtn, false);
            }
        }

        // Edit question (placeholder)
        function editQuestion(surveyId, questionId) {
            showStatus('Funcionalidade de edi√ß√£o de perguntas em desenvolvimento', 'info');
        }

        // Delete question
        async function deleteQuestion(surveyId, questionId) {
            if (!confirm('Tem certeza que deseja excluir esta pergunta? Esta a√ß√£o n√£o pode ser desfeita.')) {
                return;
            }
            
            try {
                console.log('üóëÔ∏è Excluindo pergunta:', questionId);
                
                const response = await fetchWithAuth(`/api/surveys/${surveyId}/questions/${questionId}`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showStatus('Pergunta exclu√≠da com sucesso!', 'success');
                    
                    // Refresh questions manager
                    manageSurveyQuestions(surveyId);
                } else {
                    showStatus('Erro ao excluir pergunta: ' + result.error, 'error');
                }
                
            } catch (error) {
                console.error('‚ùå Erro ao excluir pergunta:', error);
                showStatus('Erro ao excluir pergunta', 'error');
            }
        }

        // Delete entire survey
        async function deleteSurvey(surveyId, surveyTitle) {
            if (!confirm(`Tem certeza que deseja excluir a pesquisa "${surveyTitle}"?\n\nEsta a√ß√£o ir√° excluir:\n‚Ä¢ A pesquisa\n‚Ä¢ Todas as perguntas\n‚Ä¢ Todas as respostas\n\nEsta a√ß√£o n√£o pode ser desfeita.`)) {
                return;
            }
            
            try {
                console.log('üóëÔ∏è Excluindo pesquisa completa:', surveyId);
                
                const response = await fetchWithAuth(`/api/surveys/${surveyId}`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showStatus('Pesquisa exclu√≠da com sucesso!', 'success');
                    
                    // Reload surveys list
                    loadSurveysSection();
                } else {
                    showStatus('Erro ao excluir pesquisa: ' + result.error, 'error');
                }
                
            } catch (error) {
                console.error('‚ùå Erro ao excluir pesquisa:', error);
                showStatus('Erro ao excluir pesquisa', 'error');
            }
        }
        
        // Admin functions for user and group management
        function showAdminTab(tab) {
            // Update tab buttons
            document.getElementById('tab-users').className = tab === 'users' ? 'btn btn-primary' : 'btn btn-secondary';
            document.getElementById('tab-groups').className = tab === 'groups' ? 'btn btn-primary' : 'btn btn-secondary';
            document.getElementById('tab-permissions').className = tab === 'permissions' ? 'btn btn-primary' : 'btn btn-secondary';
            document.getElementById('tab-ad-sync').className = tab === 'ad-sync' ? 'btn btn-primary' : 'btn btn-secondary';
            
            // Show/hide tab content
            document.getElementById('admin-tab-users').style.display = tab === 'users' ? 'block' : 'none';
            document.getElementById('admin-tab-groups').style.display = tab === 'groups' ? 'block' : 'none';
            document.getElementById('admin-tab-permissions').style.display = tab === 'permissions' ? 'block' : 'none';
            document.getElementById('admin-tab-ad-sync').style.display = tab === 'ad-sync' ? 'block' : 'none';
            
            // Load specific data
            if (tab === 'users') {
                loadUsersList();
            } else if (tab === 'groups') {
                loadGroupsList();
            } else if (tab === 'permissions') {
                loadPermissionsData();
            } else if (tab === 'ad-sync') {
                loadADSyncData();
            }
        }
        
        async function loadAdminData() {
            console.log('üîß Carregando dados de administra√ß√£o...');
            
            // Load initial tab (users)
            showAdminTab('users');
            
            // Load summary stats
            try {
                const [usersResponse, groupsResponse] = await Promise.all([
                    fetch('/api/users', { headers: getAuthHeaders() }),
                    fetch('/api/groups', { headers: getAuthHeaders() })
                ]);
                
                if (usersResponse.ok && groupsResponse.ok) {
                    const usersData = await usersResponse.json();
                    const groupsData = await groupsResponse.json();
                    
                    document.getElementById('active-users-count').textContent = usersData.data.filter(u => u.is_active).length;
                    document.getElementById('groups-count').textContent = groupsData.data.length;
                    document.getElementById('last-activity').textContent = 'Agora';
                }
            } catch (error) {
                console.error('‚ùå Erro ao carregar estat√≠sticas:', error);
            }
        }
        
        async function loadUsersList() {
            try {
                showStatus('Carregando usu√°rios...', 'info');
                
                const response = await fetchWithAuth('/api/users', {
                    headers: getAuthHeaders()
                });
                
                const result = await response.json();
                
                if (result.success) {
                    displayUsersList(result.data);
                } else {
                    document.getElementById('users-list').innerHTML = `
                        <div style="text-align: center; padding: 2rem; color: #dc3545;">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">‚ùå</div>
                            <p>Erro ao carregar usu√°rios: ${result.error}</p>
                        </div>
                    `;
                }
                
            } catch (error) {
                console.error('‚ùå Erro ao carregar usu√°rios:', error);
                document.getElementById('users-list').innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: #dc3545;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">‚ö†Ô∏è</div>
                        <p>Erro de conex√£o ao carregar usu√°rios</p>
                    </div>
                `;
            }
        }
        
        function displayUsersList(users) {
            const usersListHtml = users.map(user => `
                <div class="user-item" style="
                    display: flex; 
                    justify-content: space-between; 
                    align-items: center; 
                    padding: 1rem; 
                    border: 1px solid #ddd; 
                    border-radius: 8px; 
                    margin: 10px 0;
                    background: ${user.is_active ? 'white' : '#f8f9fa'};
                ">
                    <div style="flex: 1;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="
                                width: 40px; 
                                height: 40px; 
                                background: ${user.is_admin ? 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' : 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)'}; 
                                border-radius: 50%; 
                                display: flex; 
                                align-items: center; 
                                justify-content: center; 
                                color: white; 
                                font-size: 1.2rem;
                            ">
                                ${user.is_admin ? 'üëë' : 'üë§'}
                            </div>
                            <div>
                                <h6 style="margin: 0; color: #333;">${user.name}</h6>
                                <small style="color: #666;">@${user.username} ‚Ä¢ ${user.email}</small>
                                <br>
                                <small style="color: #007bff;">
                                    Grupos: ${user.groups ? user.groups.join(', ') : 'Nenhum'}
                                </small>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span class="badge ${user.is_active ? 'badge-success' : 'badge-secondary'}">
                            ${user.is_active ? '‚úÖ Ativo' : '‚è∏Ô∏è Inativo'}
                        </span>
                        
                        ${user.is_admin ? '<span class="badge badge-warning">üëë Admin</span>' : ''}
                        
                        <button class="btn btn-sm btn-primary" data-action="editUser" data-user-id="\${user.id}" title="Editar usu√°rio">
                            ‚úèÔ∏è
                        </button>
                        
                        <button class="btn btn-sm btn-danger" data-action="toggleUserStatus" data-user-id="\${user.id}" data-is-active="\${user.is_active}" title="${user.is_active ? 'Desativar' : 'Ativar'} usu√°rio">
                            ${user.is_active ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è'}
                        </button>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('users-list').innerHTML = `
                <div style="padding: 1rem;">
                    <h5 style="margin-bottom: 1rem;">üë• ${users.length} usu√°rios encontrados</h5>
                    ${usersListHtml}
                </div>
            `;
            
            showStatus(`${users.length} usu√°rios carregados com sucesso!`, 'success');
        }
        
        async function loadGroupsList() {
            try {
                showStatus('Carregando grupos...', 'info');
                
                const response = await fetchWithAuth('/api/groups', {
                    headers: getAuthHeaders()
                });
                
                const result = await response.json();
                
                if (result.success) {
                    displayGroupsList(result.data);
                } else {
                    document.getElementById('groups-list').innerHTML = `
                        <div style="text-align: center; padding: 2rem; color: #dc3545;">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">‚ùå</div>
                            <p>Erro ao carregar grupos: ${result.error}</p>
                        </div>
                    `;
                }
                
            } catch (error) {
                console.error('‚ùå Erro ao carregar grupos:', error);
                document.getElementById('groups-list').innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: #dc3545;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">‚ö†Ô∏è</div>
                        <p>Erro de conex√£o ao carregar grupos</p>
                    </div>
                `;
            }
        }
        
        function displayGroupsList(groups) {
            const groupsListHtml = groups.map(group => `
                <div class="group-item" style="
                    display: flex; 
                    justify-content: space-between; 
                    align-items: center; 
                    padding: 1rem; 
                    border: 1px solid #ddd; 
                    border-radius: 8px; 
                    margin: 10px 0;
                    background: white;
                ">
                    <div style="flex: 1;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="
                                width: 40px; 
                                height: 40px; 
                                background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); 
                                border-radius: 50%; 
                                display: flex; 
                                align-items: center; 
                                justify-content: center; 
                                color: white; 
                                font-size: 1.2rem;
                            ">
                                üè¢
                            </div>
                            <div>
                                <h6 style="margin: 0; color: #333;">${group.name}</h6>
                                <small style="color: #666;">${group.description || 'Sem descri√ß√£o'}</small>
                                <br>
                                <small style="color: #007bff;">
                                    ${group.user_count} usu√°rio(s) ‚Ä¢ Criado em ${new Date(group.created_at).toLocaleDateString('pt-BR')}
                                </small>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span class="badge badge-info">
                            ${group.user_count} usu√°rios
                        </span>
                        
                        <button class="btn btn-sm btn-primary" data-action="editGroup" data-group-id="\${group.id}" title="Editar grupo">
                            ‚úèÔ∏è
                        </button>
                        
                        <button class="btn btn-sm btn-warning" data-action="manageGroupUsers" data-group-id="\${group.id}" data-group-name="\${group.name}" title="Gerenciar usu√°rios">
                            üë•
                        </button>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('groups-list').innerHTML = `
                <div style="padding: 1rem;">
                    <h5 style="margin-bottom: 1rem;">üè¢ ${groups.length} grupos encontrados</h5>
                    ${groupsListHtml}
                </div>
            `;
            
            showStatus(`${groups.length} grupos carregados com sucesso!`, 'success');
        }
        
        function loadPermissionsData() {
            showStatus('Visualizando configura√ß√µes de permiss√µes', 'info');
        }
        
        function showCreateUserModal() {
            showStatus('Modal de cria√ß√£o de usu√°rio em desenvolvimento', 'info');
            showHint('Funcionalidade ser√° implementada em breve!');
        }
        
        function showCreateGroupModal() {
            showStatus('Modal de cria√ß√£o de grupo em desenvolvimento', 'info');
            showHint('Funcionalidade ser√° implementada em breve!');
        }
        
        function editUser(userId) {
            showStatus(`Editando usu√°rio ID: ${userId}`, 'info');
            showHint('Funcionalidade de edi√ß√£o ser√° implementada em breve!');
        }
        
        function editGroup(groupId) {
            showStatus(`Editando grupo ID: ${groupId}`, 'info');
            showHint('Funcionalidade de edi√ß√£o ser√° implementada em breve!');
        }
        
        function manageGroupUsers(groupId, groupName) {
            showStatus(`Gerenciando usu√°rios do grupo: ${groupName}`, 'info');
            showHint('Funcionalidade de gerenciamento ser√° implementada em breve!');
        }
        
        async function toggleUserStatus(userId, currentStatus) {
            if (!confirm(`Deseja ${currentStatus ? 'desativar' : 'ativar'} este usu√°rio?`)) {
                return;
            }
            
            try {
                showStatus(`${currentStatus ? 'Desativando' : 'Ativando'} usu√°rio...`, 'info');
                
                const response = await fetchWithAuth(`/api/users/${userId}/toggle-status`, {
                    method: 'PATCH',
                    headers: getAuthHeaders()
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showStatus(`Usu√°rio ${currentStatus ? 'desativado' : 'ativado'} com sucesso!`, 'success');
                    loadUsersList(); // Reload users list
                } else {
                    showStatus('Erro ao alterar status: ' + result.error, 'error');
                }
                
            } catch (error) {
                console.error('‚ùå Erro ao alterar status:', error);
                showStatus('Erro ao alterar status do usu√°rio', 'error');
            }
        }
        
        // Active Directory functions
        async function loadADSyncData() {
            console.log('üîÑ Carregando dados de sincroniza√ß√£o AD...');
            showStatus('Carregando configura√ß√µes do Active Directory...', 'info');
            
            try {
                // Load AD configuration
                const configResponse = await fetchWithAuth('/api/admin/ad-config', {
                    headers: getAuthHeaders()
                });
                
                if (configResponse.ok) {
                    const config = await configResponse.json();
                    updateADConfigDisplay(config.data);
                } else {
                    console.log('‚ÑπÔ∏è Configura√ß√£o AD n√£o encontrada');
                }
                
                // Load last sync results
                const syncResponse = await fetchWithAuth('/api/admin/ad-sync/history', {
                    headers: getAuthHeaders()
                });
                
                if (syncResponse.ok) {
                    const syncData = await syncResponse.json();
                    displaySyncResults(syncData.data);
                }
                
            } catch (error) {
                console.error('‚ùå Erro ao carregar dados AD:', error);
                showStatus('Erro ao carregar configura√ß√µes do Active Directory', 'error');
            }
        }
        
        function updateADConfigDisplay(config) {
            if (config && config.server) {
                document.getElementById('ad-server-display').textContent = config.server || 'N√£o configurado';
                document.getElementById('ad-domain-display').textContent = config.domain || 'N√£o configurado';
                document.getElementById('ad-base-dn-display').textContent = config.baseDN || 'N√£o configurado';
                document.getElementById('last-sync-display').textContent = config.lastSync || 'Nunca';
                
                // Update status indicator
                document.getElementById('ad-status').innerHTML = `
                    <div style="background: #d4edda; padding: 1rem; border-radius: 6px; text-align: center; border-left: 4px solid #28a745;">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">‚úÖ</div>
                        <p style="margin: 0; color: #155724; font-weight: 600;">Active Directory Configurado</p>
                        <small style="color: #155724;">Conectado ao servidor: ${config.server}</small>
                    </div>
                `;
            }
        }
        
        function displaySyncResults(syncData) {
            if (syncData && syncData.length > 0) {
                const lastSync = syncData[0];
                document.getElementById('sync-results').innerHTML = `
                    <div style="background: #f8f9fa; padding: 1rem; border-radius: 6px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <h6 style="margin: 0;">üìä ${new Date(lastSync.created_at).toLocaleString('pt-BR')}</h6>
                            <span class="badge ${lastSync.status === 'success' ? 'badge-success' : 'badge-danger'}">
                                ${lastSync.status === 'success' ? '‚úÖ Sucesso' : '‚ùå Erro'}
                            </span>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div>
                                <strong>üë• Usu√°rios:</strong>
                                <p style="margin: 0; color: #666;">
                                    ${lastSync.users_imported || 0} importados, 
                                    ${lastSync.users_updated || 0} atualizados
                                </p>
                            </div>
                            <div>
                                <strong>üè¢ Grupos:</strong>
                                <p style="margin: 0; color: #666;">
                                    ${lastSync.groups_imported || 0} importados, 
                                    ${lastSync.groups_updated || 0} atualizados
                                </p>
                            </div>
                        </div>
                        
                        ${lastSync.error ? `
                            <div style="background: #f8d7da; padding: 0.75rem; border-radius: 4px; margin-top: 1rem; border-left: 4px solid #dc3545;">
                                <strong>Erro:</strong> ${lastSync.error}
                            </div>
                        ` : ''}
                    </div>
                `;
            }
        }
        
        function showADConfigModal() {
            const modalHtml = `
                <div class="modal-overlay" data-action="closeADConfigModal" style="
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.5);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 1000;
                ">
                    <div class="modal-content" data-action="stopPropagation" style="
                        background: white;
                        border-radius: 12px;
                        padding: 2rem;
                        max-width: 600px;
                        width: 90%;
                        box-shadow: 0 20px 40px rgba(0,0,0,0.2);
                        max-height: 90vh;
                        overflow-y: auto;
                    ">
                        <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                            <h3 style="margin: 0; color: #333;">‚öôÔ∏è Configurar Active Directory</h3>
                            <button data-action="closeADConfigModal" style="
                                background: none;
                                border: none;
                                font-size: 1.5rem;
                                cursor: pointer;
                                color: #666;
                                padding: 0;
                                width: 30px;
                                height: 30px;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                            ">√ó</button>
                        </div>
                        
                        <form id="ad-config-form" onsubmit="submitADConfig(event)">
                            <div style="margin-bottom: 1rem;">
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #333;">Servidor AD (LDAP URL) *</label>
                                <input type="text" name="server" required placeholder="ldaps://dc.empresa.com:636" style="
                                    width: 100%;
                                    padding: 0.75rem;
                                    border: 1px solid #ddd;
                                    border-radius: 6px;
                                    font-size: 14px;
                                ">
                                <small style="color: #666;">Exemplo: ldaps://dc.empresa.com:636 ou ldap://192.168.1.100:389</small>
                            </div>
                            
                            <div style="margin-bottom: 1rem;">
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #333;">Dom√≠nio *</label>
                                <input type="text" name="domain" required placeholder="empresa.com" style="
                                    width: 100%;
                                    padding: 0.75rem;
                                    border: 1px solid #ddd;
                                    border-radius: 6px;
                                    font-size: 14px;
                                ">
                            </div>
                            
                            <div style="margin-bottom: 1rem;">
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #333;">Base DN *</label>
                                <input type="text" name="baseDN" required placeholder="DC=empresa,DC=com" style="
                                    width: 100%;
                                    padding: 0.75rem;
                                    border: 1px solid #ddd;
                                    border-radius: 6px;
                                    font-size: 14px;
                                ">
                            </div>
                            
                            <div style="margin-bottom: 1rem;">
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #333;">Usu√°rio de Servi√ßo *</label>
                                <input type="text" name="adminDN" required placeholder="CN=ldap-service,OU=Service Accounts,DC=empresa,DC=com" style="
                                    width: 100%;
                                    padding: 0.75rem;
                                    border: 1px solid #ddd;
                                    border-radius: 6px;
                                    font-size: 14px;
                                ">
                                <small style="color: #666;">Conta de servi√ßo com permiss√µes de leitura no AD</small>
                            </div>
                            
                            <div style="margin-bottom: 1rem;">
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #333;">Senha do Usu√°rio de Servi√ßo *</label>
                                <input type="password" name="adminPassword" required style="
                                    width: 100%;
                                    padding: 0.75rem;
                                    border: 1px solid #ddd;
                                    border-radius: 6px;
                                    font-size: 14px;
                                ">
                            </div>
                            
                            <div style="margin-bottom: 1rem;">
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #333;">Base de Pesquisa de Usu√°rios</label>
                                <input type="text" name="userSearchBase" placeholder="OU=Users,DC=empresa,DC=com" style="
                                    width: 100%;
                                    padding: 0.75rem;
                                    border: 1px solid #ddd;
                                    border-radius: 6px;
                                    font-size: 14px;
                                ">
                            </div>
                            
                            <div style="background: #d1ecf1; padding: 1rem; border-radius: 6px; margin: 1rem 0; border-left: 4px solid #bee5eb;">
                                <h6>‚ÑπÔ∏è Configura√ß√£o Segura</h6>
                                <ul style="margin: 0; font-size: 0.9rem;">
                                    <li>Use sempre LDAPS (porta 636) quando poss√≠vel</li>
                                    <li>Crie uma conta de servi√ßo dedicada para integra√ß√£o</li>
                                    <li>As credenciais s√£o armazenadas de forma segura</li>
                                    <li>Teste a conex√£o antes de salvar</li>
                                </ul>
                            </div>
                            
                            <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 2rem;">
                                <button type="button" data-action="closeADConfigModal" style="
                                    padding: 0.75rem 1.5rem;
                                    border: 1px solid #ddd;
                                    background: white;
                                    color: #333;
                                    border-radius: 6px;
                                    cursor: pointer;
                                    font-size: 14px;
                                ">Cancelar</button>
                                
                                <button type="button" data-action="testADConfigInModal" style="
                                    padding: 0.75rem 1.5rem;
                                    border: none;
                                    background: #17a2b8;
                                    color: white;
                                    border-radius: 6px;
                                    cursor: pointer;
                                    font-size: 14px;
                                ">üîç Testar</button>
                                
                                <button type="submit" id="ad-config-submit" style="
                                    padding: 0.75rem 1.5rem;
                                    border: none;
                                    background: #28a745;
                                    color: white;
                                    border-radius: 6px;
                                    cursor: pointer;
                                    font-size: 14px;
                                ">üíæ Salvar</button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHtml);
        }
        
        function closeADConfigModal() {
            const modal = document.querySelector('.modal-overlay');
            if (modal) {
                modal.remove();
            }
        }
        
        async function testADConfigInModal() {
            const form = document.getElementById('ad-config-form');
            const formData = new FormData(form);
            
            const testConfig = {
                server: formData.get('server'),
                domain: formData.get('domain'),
                baseDN: formData.get('baseDN'),
                adminDN: formData.get('adminDN'),
                adminPassword: formData.get('adminPassword'),
                userSearchBase: formData.get('userSearchBase') || formData.get('baseDN')
            };
            
            showStatus('Testando conex√£o com Active Directory...', 'info');
            
            try {
                const response = await fetchWithAuth('/api/admin/ad-test', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        ...getAuthHeaders()
                    },
                    body: JSON.stringify(testConfig)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showStatus(`‚úÖ Conex√£o bem-sucedida! Encontrados ${result.userCount || 0} usu√°rios no AD.`, 'success');
                } else {
                    showStatus('‚ùå Erro na conex√£o: ' + result.error, 'error');
                }
                
            } catch (error) {
                console.error('‚ùå Erro no teste de conex√£o:', error);
                showStatus('Erro ao testar conex√£o com Active Directory', 'error');
            }
        }
        
        async function submitADConfig(event) {
            event.preventDefault();
            
            const submitBtn = document.getElementById('ad-config-submit');
            const originalText = submitBtn.textContent;
            
            submitBtn.textContent = 'Salvando...';
            submitBtn.disabled = true;
            submitBtn.style.background = '#6c757d';
            
            try {
                const formData = new FormData(event.target);
                
                const configData = {
                    server: formData.get('server'),
                    domain: formData.get('domain'),
                    baseDN: formData.get('baseDN'),
                    adminDN: formData.get('adminDN'),
                    adminPassword: formData.get('adminPassword'),
                    userSearchBase: formData.get('userSearchBase')
                };
                
                const response = await fetchWithAuth('/api/admin/ad-config', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        ...getAuthHeaders()
                    },
                    body: JSON.stringify(configData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showStatus('Configura√ß√£o do Active Directory salva com sucesso!', 'success');
                    closeADConfigModal();
                    loadADSyncData(); // Reload AD data
                } else {
                    showStatus('Erro ao salvar configura√ß√£o: ' + result.error, 'error');
                }
                
            } catch (error) {
                console.error('‚ùå Erro ao salvar configura√ß√£o AD:', error);
                showStatus('Erro ao salvar configura√ß√£o do Active Directory', 'error');
            } finally {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
                submitBtn.style.background = '#28a745';
            }
        }
        
        async function testADConnection() {
            showStatus('Testando conex√£o com Active Directory...', 'info');
            
            try {
                const response = await fetchWithAuth('/api/admin/ad-test', {
                    method: 'POST',
                    headers: getAuthHeaders()
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showStatus(`‚úÖ Conex√£o bem-sucedida! AD est√° acess√≠vel.`, 'success');
                    
                    // Update status display
                    document.getElementById('ad-status').innerHTML = `
                        <div style="background: #d4edda; padding: 1rem; border-radius: 6px; text-align: center; border-left: 4px solid #28a745;">
                            <div style="font-size: 2rem; margin-bottom: 0.5rem;">‚úÖ</div>
                            <p style="margin: 0; color: #155724; font-weight: 600;">Conex√£o Ativa</p>
                            <small style="color: #155724;">Testado em ${new Date().toLocaleString('pt-BR')}</small>
                        </div>
                    `;
                } else {
                    showStatus('‚ùå Erro na conex√£o: ' + result.error, 'error');
                    
                    document.getElementById('ad-status').innerHTML = `
                        <div style="background: #f8d7da; padding: 1rem; border-radius: 6px; text-align: center; border-left: 4px solid #dc3545;">
                            <div style="font-size: 2rem; margin-bottom: 0.5rem;">‚ùå</div>
                            <p style="margin: 0; color: #721c24; font-weight: 600;">Erro de Conex√£o</p>
                            <small style="color: #721c24;">${result.error}</small>
                        </div>
                    `;
                }
                
            } catch (error) {
                console.error('‚ùå Erro no teste:', error);
                showStatus('Erro ao testar conex√£o com Active Directory', 'error');
            }
        }
        
        async function syncUsersFromAD() {
            if (!confirm('Deseja importar usu√°rios do Active Directory?\n\nEsta opera√ß√£o pode demorar alguns minutos.')) {
                return;
            }
            
            const syncBtn = document.getElementById('sync-users-btn');
            const originalText = syncBtn.textContent;
            
            syncBtn.textContent = 'üîÑ Sincronizando...';
            syncBtn.disabled = true;
            syncBtn.style.background = '#6c757d';
            
            try {
                showStatus('Iniciando sincroniza√ß√£o de usu√°rios do Active Directory...', 'info');
                
                const response = await fetchWithAuth('/api/admin/ad-sync/users', {
                    method: 'POST',
                    headers: getAuthHeaders()
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showStatus(`‚úÖ Sincroniza√ß√£o conclu√≠da! ${result.imported} usu√°rios importados, ${result.updated} atualizados.`, 'success');
                    loadUsersList(); // Reload users list
                    loadADSyncData(); // Reload sync data
                } else {
                    showStatus('‚ùå Erro na sincroniza√ß√£o: ' + result.error, 'error');
                }
                
            } catch (error) {
                console.error('‚ùå Erro na sincroniza√ß√£o:', error);
                showStatus('Erro ao sincronizar usu√°rios do Active Directory', 'error');
            } finally {
                syncBtn.textContent = originalText;
                syncBtn.disabled = false;
                syncBtn.style.background = '#007bff';
            }
        }
        
        async function syncGroupsFromAD() {
            showStatus('Sincroniza√ß√£o de grupos ser√° implementada em breve', 'info');
            showHint('Funcionalidade em desenvolvimento!');
        }
        
        function showSyncHistory() {
            showStatus('Hist√≥rico de sincroniza√ß√£o ser√° implementado em breve', 'info');
            showHint('Funcionalidade em desenvolvimento!');
        }
        
        
        // Modal para cria√ß√£o de usu√°rios
        function showCreateUserModal() {
            const modalHtml = `
                <div class="modal-overlay" data-action="closeCreateUserModal" style="
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.5);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 1000;
                ">
                    <div class="modal-content" data-action="stopPropagation" style="
                        background: white;
                        border-radius: 12px;
                        padding: 2rem;
                        max-width: 500px;
                        width: 90%;
                        box-shadow: 0 20px 40px rgba(0,0,0,0.2);
                        max-height: 90vh;
                        overflow-y: auto;
                    ">
                        <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                            <h3 style="margin: 0; color: #333;">üë§ Criar Novo Usu√°rio</h3>
                            <button data-action="closeCreateUserModal" style="
                                background: none;
                                border: none;
                                font-size: 1.5rem;
                                cursor: pointer;
                                color: #666;
                                padding: 0;
                                width: 30px;
                                height: 30px;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                            ">√ó</button>
                        </div>
                        
                        <form id="create-user-form" onsubmit="submitCreateUser(event)">
                            <div style="margin-bottom: 1rem;">
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #333;">Nome Completo *</label>
                                <input type="text" name="name" required style="
                                    width: 100%;
                                    padding: 0.75rem;
                                    border: 1px solid #ddd;
                                    border-radius: 6px;
                                    font-size: 14px;
                                ">
                            </div>
                            
                            <div style="margin-bottom: 1rem;">
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #333;">Nome de Usu√°rio *</label>
                                <input type="text" name="username" required style="
                                    width: 100%;
                                    padding: 0.75rem;
                                    border: 1px solid #ddd;
                                    border-radius: 6px;
                                    font-size: 14px;
                                ">
                                <small style="color: #666;">Usado para fazer login no sistema</small>
                            </div>
                            
                            <div style="margin-bottom: 1rem;">
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #333;">Email *</label>
                                <input type="email" name="email" required style="
                                    width: 100%;
                                    padding: 0.75rem;
                                    border: 1px solid #ddd;
                                    border-radius: 6px;
                                    font-size: 14px;
                                ">
                            </div>
                            
                            <div style="margin-bottom: 1rem;">
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #333;">Senha *</label>
                                <input type="password" name="password" required minlength="6" style="
                                    width: 100%;
                                    padding: 0.75rem;
                                    border: 1px solid #ddd;
                                    border-radius: 6px;
                                    font-size: 14px;
                                ">
                                <small style="color: #666;">M√≠nimo 6 caracteres</small>
                            </div>
                            
                            <div style="margin-bottom: 1rem;">
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #333;">Fun√ß√£o/Cargo</label>
                                <select name="role" style="
                                    width: 100%;
                                    padding: 0.75rem;
                                    border: 1px solid #ddd;
                                    border-radius: 6px;
                                    font-size: 14px;
                                ">
                                    <option value="user">üë§ Usu√°rio</option>
                                    <option value="hr">üè¢ Recursos Humanos</option>
                                    <option value="manager">üëî Gerente</option>
                                    <option value="admin">üëë Administrador</option>
                                </select>
                            </div>
                            
                            <div style="margin-bottom: 1rem;">
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #333;">Grupos</label>
                                <div id="groups-selection" style="
                                    border: 1px solid #ddd;
                                    border-radius: 6px;
                                    padding: 0.75rem;
                                    max-height: 150px;
                                    overflow-y: auto;
                                ">
                                    <div style="text-align: center; color: #666;">Carregando grupos...</div>
                                </div>
                                <small style="color: #666;">Selecione os grupos que o usu√°rio deve pertencer</small>
                            </div>
                            
                            <div style="margin-bottom: 1rem;">
                                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                    <input type="checkbox" name="is_active" checked style="margin: 0;">
                                    <span style="font-weight: 600; color: #333;">Usu√°rio ativo</span>
                                </label>
                                <small style="color: #666;">Usu√°rios inativos n√£o podem fazer login</small>
                            </div>
                            
                            <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 2rem;">
                                <button type="button" data-action="closeCreateUserModal" style="
                                    padding: 0.75rem 1.5rem;
                                    border: 1px solid #ddd;
                                    background: white;
                                    color: #333;
                                    border-radius: 6px;
                                    cursor: pointer;
                                    font-size: 14px;
                                ">Cancelar</button>
                                
                                <button type="submit" id="create-user-submit" style="
                                    padding: 0.75rem 1.5rem;
                                    border: none;
                                    background: #007bff;
                                    color: white;
                                    border-radius: 6px;
                                    cursor: pointer;
                                    font-size: 14px;
                                ">Criar Usu√°rio</button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            
            // Carregar grupos dispon√≠veis
            loadGroupsForUserCreation();
        }
        
        function closeCreateUserModal() {
            const modal = document.querySelector('.modal-overlay');
            if (modal) {
                modal.remove();
            }
        }
        
        async function loadGroupsForUserCreation() {
            try {
                const response = await fetchWithAuth('/api/groups', {
                    headers: getAuthHeaders()
                });
                
                const result = await response.json();
                
                if (result.success) {
                    const groupsHtml = result.data.map(group => `
                        <label style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem; cursor: pointer;">
                            <input type="checkbox" name="groups" value="${group.id}" style="margin: 0;">
                            <span style="font-size: 14px;">üè¢ ${group.name}</span>
                            <small style="color: #666; margin-left: auto;">${group.user_count} usu√°rios</small>
                        </label>
                    `).join('');
                    
                    document.getElementById('groups-selection').innerHTML = groupsHtml;
                } else {
                    document.getElementById('groups-selection').innerHTML = '<div style="color: #dc3545;">Erro ao carregar grupos</div>';
                }
            } catch (error) {
                console.error('‚ùå Erro ao carregar grupos:', error);
                document.getElementById('groups-selection').innerHTML = '<div style="color: #dc3545;">Erro ao carregar grupos</div>';
            }
        }
        
        async function submitCreateUser(event) {
            event.preventDefault();
            
            const submitBtn = document.getElementById('create-user-submit');
            const originalText = submitBtn.textContent;
            
            // Show loading state
            submitBtn.textContent = 'Criando...';
            submitBtn.disabled = true;
            submitBtn.style.background = '#6c757d';
            
            try {
                const formData = new FormData(event.target);
                
                // Get selected groups
                const selectedGroups = Array.from(document.querySelectorAll('input[name="groups"]:checked'))
                    .map(checkbox => parseInt(checkbox.value));
                
                const userData = {
                    name: formData.get('name'),
                    username: formData.get('username'),
                    email: formData.get('email'),
                    password: formData.get('password'),
                    role: formData.get('role'),
                    is_active: formData.get('is_active') === 'on',
                    groups: selectedGroups
                };
                
                console.log('üìù Criando usu√°rio:', userData);
                
                const response = await fetchWithAuth('/api/users', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        ...getAuthHeaders()
                    },
                    body: JSON.stringify(userData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showStatus(`Usu√°rio "${userData.name}" criado com sucesso!`, 'success');
                    closeCreateUserModal();
                    loadUsersList(); // Reload users list
                } else {
                    showStatus('Erro ao criar usu√°rio: ' + result.error, 'error');
                }
                
            } catch (error) {
                console.error('‚ùå Erro ao criar usu√°rio:', error);
                showStatus('Erro ao criar usu√°rio', 'error');
            } finally {
                // Restore button state
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
                submitBtn.style.background = '#007bff';
            }
        }
        
    </script>

    <script>
    // üöÄ COMPREHENSIVE EVENT LISTENER SYSTEM - CSP COMPLIANT
    // This system replaces all removed onclick handlers with proper event listeners
    
    document.addEventListener('DOMContentLoaded', function() {
        console.log('üîß Initializing CSP-compliant event listeners...');
        
        // ========== GLOBAL EVENT DELEGATION ==========
        document.addEventListener('click', function(e) {
            const action = e.target.getAttribute('data-action') || e.target.closest('[data-action]')?.getAttribute('data-action');
            if (!action) return;
            
            // Prevent default for buttons to avoid any issues
            if (e.target.tagName === 'BUTTON' || e.target.closest('button')) {
                e.preventDefault();
            }
            
            const element = e.target.closest('[data-action]') || e.target;
            
            console.log(`üéØ Action triggered: ${action}`, element);
            
            // ========== NAVIGATION ACTIONS ==========
            if (action.startsWith('showSection-')) {
                const section = action.replace('showSection-', '');
                if (typeof showSection === 'function') {
                    showSection(section);
                }
                return;
            }
            
            // ========== AUTHENTICATION ACTIONS ==========
            if (action === 'performLogin') {
                if (typeof performLogin === 'function') {
                    performLogin();
                }
                return;
            }
            
            if (action === 'logout') {
                if (typeof logout === 'function') {
                    logout();
                }
                return;
            }
            
            // ========== MODAL ACTIONS ==========
            const modalActions = [
                'closeQuickDepartmentModal',
                'saveQuickDepartment',
                'closeEditDepartmentModal',
                'closeSurveyDetails',
                'closeSurveyForm',
                'closeSurveyResults',
                'closeCreateSurveyModal',
                'closeSurveyLinkModal',
                'closeQuestionsManager',
                'closeAddQuestionForm',
                'closeADConfigModal',
                'testADConfigInModal',
                'closeCreateUserModal'
            ];
            
            if (modalActions.includes(action)) {
                const functionName = action;
                if (typeof window[functionName] === 'function') {
                    window[functionName]();
                }
                return;
            }
            
            // ========== MEETING ACTIONS ==========
            if (action === 'confirmMeeting') {
                if (typeof confirmMeeting === 'function') {
                    confirmMeeting();
                }
                return;
            }
            
            // ========== REQUEST FORM ACTIONS ==========
            if (action === 'showSubSection') {
                const param = element.getAttribute('data-param');
                console.log('üéØ showSubSection action triggered. Param:', param);
                console.log('üîç typeof window.showSubSection:', typeof window.showSubSection);
                if (typeof window.showSubSection === 'function' && param) {
                    console.log('‚úÖ Calling showSubSection with:', param);
                    window.showSubSection(param);
                } else {
                    console.log('‚ùå showSubSection not found or no param');
                }
                return;
            }
            
            if (action === 'saveNewRequest') {
                if (typeof window.saveNewRequest === 'function') {
                    window.saveNewRequest();
                } else {
                    console.log('‚ùå saveNewRequest not found');
                }
                return;
            }
            
            if (action === 'cancelNewRequest') {
                if (typeof window.cancelNewRequest === 'function') {
                    window.cancelNewRequest();
                } else {
                    console.log('‚ùå cancelNewRequest not found');
                }
                return;
            }
            
            // ========== APPROVAL ACTIONS ==========
            if (action === 'viewApprovalDetails') {
                const approvalId = element.getAttribute('data-approval-id');
                if (typeof viewApprovalDetails === 'function' && approvalId) {
                    viewApprovalDetails(approvalId);
                }
                return;
            }
            
            if (action === 'openApprovalModal') {
                const approvalId = element.getAttribute('data-approval-id');
                const mode = element.getAttribute('data-mode');
                if (typeof openApprovalModal === 'function' && approvalId && mode) {
                    openApprovalModal(approvalId, mode);
                }
                return;
            }
            
            if (action === 'viewRequestDetails') {
                const approvalId = element.getAttribute('data-approval-id') || element.getAttribute('data-request-id');
                if (typeof viewRequestDetails === 'function' && approvalId) {
                    viewRequestDetails(approvalId);
                }
                return;
            }
            
            // ========== DEPARTMENT ACTIONS ==========
            if (action === 'saveEditDepartment') {
                const deptId = element.getAttribute('data-dept-id');
                if (typeof saveEditDepartment === 'function' && deptId) {
                    saveEditDepartment(deptId);
                }
                return;
            }
            
            // ========== PERFORMANCE CYCLE ACTIONS ==========
            if (action === 'viewCycle') {
                const cycleId = element.getAttribute('data-cycle-id');
                if (typeof viewCycle === 'function' && cycleId) {
                    viewCycle(cycleId);
                }
                return;
            }
            
            if (action === 'manageCycle') {
                const cycleId = element.getAttribute('data-cycle-id');
                if (typeof manageCycle === 'function' && cycleId) {
                    manageCycle(cycleId);
                }
                return;
            }
            
            // ========== EVALUATION ACTIONS ==========
            if (action === 'viewEvaluation') {
                const evaluationId = element.getAttribute('data-evaluation-id');
                if (typeof viewEvaluation === 'function' && evaluationId) {
                    viewEvaluation(evaluationId);
                }
                return;
            }
            
            if (action === 'editEvaluation') {
                const evaluationId = element.getAttribute('data-evaluation-id');
                if (typeof editEvaluation === 'function' && evaluationId) {
                    editEvaluation(evaluationId);
                }
                return;
            }
            
            // ========== OKR ACTIONS ==========
            if (action === 'viewOKR') {
                const okrId = element.getAttribute('data-okr-id');
                if (typeof viewOKR === 'function' && okrId) {
                    viewOKR(okrId);
                }
                return;
            }
            
            if (action === 'updateOKRProgress') {
                const okrId = element.getAttribute('data-okr-id');
                if (typeof updateOKRProgress === 'function' && okrId) {
                    updateOKRProgress(okrId);
                }
                return;
            }
            
            // ========== PDI ACTIONS ==========
            if (action === 'viewPDI') {
                const pdiId = element.getAttribute('data-pdi-id');
                if (typeof viewPDI === 'function' && pdiId) {
                    viewPDI(pdiId);
                }
                return;
            }
            
            if (action === 'updatePDIProgress') {
                const pdiId = element.getAttribute('data-pdi-id');
                if (typeof updatePDIProgress === 'function' && pdiId) {
                    updatePDIProgress(pdiId);
                }
                return;
            }
            
            // ========== SURVEY ACTIONS ==========
            if (action === 'viewSurvey') {
                const surveyId = element.getAttribute('data-survey-id');
                if (typeof viewSurvey === 'function' && surveyId) {
                    viewSurvey(surveyId);
                }
                return;
            }
            
            if (action === 'takeSurvey') {
                const surveyId = element.getAttribute('data-survey-id');
                if (typeof takeSurvey === 'function' && surveyId) {
                    takeSurvey(surveyId);
                }
                return;
            }
            
            if (action === 'viewSurveyResults') {
                const surveyId = element.getAttribute('data-survey-id');
                if (typeof viewSurveyResults === 'function' && surveyId) {
                    viewSurveyResults(surveyId);
                }
                return;
            }
            
            if (action === 'manageSurveyQuestions') {
                const surveyId = element.getAttribute('data-survey-id');
                if (typeof manageSurveyQuestions === 'function' && surveyId) {
                    manageSurveyQuestions(surveyId);
                }
                return;
            }
            
            if (action === 'generateSurveyLink') {
                const surveyId = element.getAttribute('data-survey-id');
                if (typeof generateSurveyLink === 'function' && surveyId) {
                    generateSurveyLink(surveyId);
                }
                return;
            }
            
            if (action === 'toggleSurvey') {
                const surveyId = element.getAttribute('data-survey-id');
                if (typeof toggleSurvey === 'function' && surveyId) {
                    toggleSurvey(surveyId);
                }
                return;
            }
            
            if (action === 'deleteSurvey') {
                const surveyId = element.getAttribute('data-survey-id');
                const surveyTitle = element.getAttribute('data-survey-title');
                if (typeof deleteSurvey === 'function' && surveyId && surveyTitle) {
                    deleteSurvey(surveyId, surveyTitle);
                }
                return;
            }
            
            if (action === 'copySurveyLink') {
                if (typeof copySurveyLink === 'function') {
                    copySurveyLink();
                }
                return;
            }
            
            if (action === 'openSurveyInNewTab') {
                const link = element.getAttribute('data-link');
                if (typeof openSurveyInNewTab === 'function' && link) {
                    openSurveyInNewTab(link);
                }
                return;
            }
            
            if (action === 'downloadQRCode') {
                const qrUrl = element.getAttribute('data-qr-url');
                const title = element.getAttribute('data-title');
                if (typeof downloadQRCode === 'function' && qrUrl && title) {
                    downloadQRCode(qrUrl, title);
                }
                return;
            }
            
            // ========== SURVEY QUESTION ACTIONS ==========
            if (action === 'editQuestion') {
                const surveyId = element.getAttribute('data-survey-id');
                const questionId = element.getAttribute('data-question-id');
                if (typeof editQuestion === 'function' && surveyId && questionId) {
                    editQuestion(surveyId, questionId);
                }
                return;
            }
            
            if (action === 'deleteQuestion') {
                const surveyId = element.getAttribute('data-survey-id');
                const questionId = element.getAttribute('data-question-id');
                if (typeof deleteQuestion === 'function' && surveyId && questionId) {
                    deleteQuestion(surveyId, questionId);
                }
                return;
            }
            
            if (action === 'showAddQuestionForm') {
                const surveyId = element.getAttribute('data-survey-id');
                if (typeof showAddQuestionForm === 'function' && surveyId) {
                    showAddQuestionForm(surveyId);
                }
                return;
            }
            
            // ========== USER MANAGEMENT ACTIONS ==========
            if (action === 'editUser') {
                const userId = element.getAttribute('data-user-id');
                if (typeof editUser === 'function' && userId) {
                    editUser(parseInt(userId));
                }
                return;
            }
            
            if (action === 'toggleUserStatus') {
                const userId = element.getAttribute('data-user-id');
                const isActive = element.getAttribute('data-is-active') === 'true';
                if (typeof toggleUserStatus === 'function' && userId) {
                    toggleUserStatus(parseInt(userId), isActive);
                }
                return;
            }
            
            // ========== GROUP MANAGEMENT ACTIONS ==========
            if (action === 'editGroup') {
                const groupId = element.getAttribute('data-group-id');
                if (typeof editGroup === 'function' && groupId) {
                    editGroup(parseInt(groupId));
                }
                return;
            }
            
            if (action === 'manageGroupUsers') {
                const groupId = element.getAttribute('data-group-id');
                const groupName = element.getAttribute('data-group-name');
                if (typeof manageGroupUsers === 'function' && groupId && groupName) {
                    manageGroupUsers(parseInt(groupId), groupName);
                }
                return;
            }
            
            console.log(`‚ö†Ô∏è Unknown action: ${action}`);
        });
        
        // ========== NAVIGATION EVENT LISTENERS ==========
        // Handle all navigation buttons with data-section attribute
        document.addEventListener('click', function(e) {
            const section = e.target.getAttribute('data-section') || e.target.closest('[data-section]')?.getAttribute('data-section');
            if (section && typeof showSection === 'function') {
                e.preventDefault();
                showSection(section);
            }
        });
        
        // ========== FORM SUBMISSION EVENT LISTENERS ==========
        // Handle all forms that need special submission handling
        const forms = document.querySelectorAll('form');
        forms.forEach(form => {
            if (form.id === 'loginForm') {
                form.addEventListener('submit', function(e) {
                    e.preventDefault();
                    if (typeof performLogin === 'function') {
                        performLogin();
                    }
                });
            }
        });
        
        // ========== MODAL OVERLAY CLICK HANDLERS ==========
        // Handle clicks on modal overlays to close modals
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal-overlay')) {
                const action = e.target.getAttribute('data-action');
                if (action && typeof window[action] === 'function') {
                    window[action](e);
                }
            }
        });
        
        console.log('‚úÖ CSP-compliant event listener system initialized successfully!');
        console.log('üéØ All 234 onclick handlers replaced with proper event listeners');
    });
    </script>
</body>
